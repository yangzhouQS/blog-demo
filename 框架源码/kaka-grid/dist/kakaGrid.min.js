/*!
* @mctech/kaka-grid v2.3.1
* Copyright 2021 ChenGang <10147817@qq.com>
* Licensed under MIT
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).kakaGrid=e()}(this,(function(){"use strict";const t="undefined"==typeof window||void 0===window.window;let e,o;const n={get find(){return e||(e=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const o=n.findIndex(t,e);return o>=0?t[o]:void 0},e)},get findIndex(){return o||(o=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:o}=t;for(let n=0;n<o;n++){if(e(t[n],n,t))return n}return-1},o)}},i=t=>null!=t,r=t=>i(t)&&("string"!=typeof t||""!==t);const{IE:s,Chrome:l,Firefox:a,Edge:c,Safari:h}=function(){if(t)return{Chrome:!1,Edge:!1,Firefox:!1,IE:!1,Safari:!1};{const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}}();function d(t,e){for(const o in t)e(t[o],o,t)}function u(t,e){const o=[],n={};for(const i in t)o.push(i),Object.defineProperty(n,i,{get(){const o=t[i];return void 0===o?e[i]:o},set(e){t[i]=e},configurable:!0,enumerable:!0});for(const i in e)o.indexOf(i)>=0||Object.defineProperty(n,i,{get(){const o=t[i];return void 0===o?e[i]:o},set(e){t[i]=e},configurable:!0,enumerable:!0});return n}function g(...t){const e={};return t.forEach((t=>{for(const o in t)Object.defineProperty(e,o,{get:()=>t[o],set(e){t[o]=e},configurable:!0,enumerable:!0})})),e}function f(t,e){for(;e&&e.parentElement;){const o=e.parentElement;if(t===o)return!0;e=o}return!1}function p(t,e,...o){let n=t;for(let t=0;t<o.length&&i(n);t++)n=e(n,o[t]);return n}function _(t,...e){return p(t,((t,e)=>t[e]),...e)}function w(t,...e){return"function"==typeof t?t(...e):t}function C(t){return Boolean(t&&"function"==typeof t.then)}function m(t,e){return C(t)?t.then((t=>e(t))):e(t)}function y(t,e){return t.col===e.col&&t.row===e.row}function v(t,e,o){return t.start.col<=e&&e<=t.end.col&&t.start.row<=o&&o<=t.end.row}const b=s,x=c,R=l,E=h,L=l?33554431:a?17895588:10737433,S={setReadonly:function(t,e,o){Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:o})},isObject:function(t){return t===Object(t)}},k={endsWith:function(t,e,o){const n=t.toString();("number"!=typeof o||!isFinite(o)||Math.floor(o)!==o||o>n.length)&&(o=n.length),o-=e.length;const i=n.lastIndexOf(e,o);return-1!==i&&i===o},genChars:function(t){const e=/([\uD800-\uDBFF][\uDC00-\uDFFF]|\r\n|[^\uD800-\uDFFF])([\u180B-\u180D]|[\uFE00-\uFE0F]|\uDB40[\uDD00-\uDDEF])?/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}},genWords:function(t){const e=/[!-~]+|[^!-~\s]+|\s+/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}},escape:t=>String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),template:(t,...e)=>(...o)=>{const n=o[o.length-1]||{},i=[t[0]];return e.forEach(((e,r)=>{const s=(Number.isInteger?Number.isInteger(e):"number"==typeof e&&e!==1/0&&Math.floor(e)===e)?o[e]:n[e];i.push(s,t[r+1])})),i.join("")}},I={getMouseButtons:function(t){return i(t.buttons)?t.buttons:i(t.which)?3===t.which||2===t.which?4:t.which:0===t.button||1===t.button?1:2===t.button?2:0},getKeyCode:function(t){return t.keyCode||t.which},isTouchEvent:function(t){return!!t.changedTouches},cancel:function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}},T={toBoxArray:function(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:t:[t,t,t,t]}},B=()=>{};function A(t){if("number"==typeof t)return 0===t?1:0;if("string"==typeof t){if("false"===t)return"true";if("off"===t)return"on";if(/^0+$/.exec(t))return t.replace(/^(0*)0$/,"$11");if("true"===t)return"false";if("on"===t)return"off";if(/^0*1$/.exec(t))return t.replace(/^(0*)1$/,"$10")}return!t}const M=(t,e,o)=>{if("function"==typeof t){const n=e.getRowRecord(o);return!!C(n)||!!t(n)}return!!t},O=(t,e,o)=>M(e.disabled,e,o)||M(t,e,o),D=(t,e,o)=>M(e.readOnly,e,o)||M(t,e,o),F={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",DBLTAP_CELL:"dbltap_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",MOUSE_SELECTED_START:"mouse_selected_start",MOUSE_SELECTED_END:"mouse_selected_end",KEYDOWN:"keydown",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",MOUSEOVER_CELL:"mouseover_cell",MOUSEOUT_CELL:"mouseout_cell",CONTEXTMENU_CELL:"contextmenu_cell",INPUT_CELL:"input_cell",PASTE_CELL:"paste_cell",DELETE_CELL:"delete_cell",EDITABLEINPUT_CELL:"editableinput_cell",MODIFY_STATUS_EDITABLEINPUT_CELL:"modify_status_editableinput_cell",RESIZE_COLUMN:"resize_column",SCROLL:"scroll",FOCUS_GRID:"focus_grid",BLUR_GRID:"blur_grid",CAN_DRAG_SELECTION:"can_drag_selection",DRAG_SELECTION:"drag_selection",CLICK_UNDERLAY:"click_underlay",DBLCLICK_UNDERLAY:"dblclick_underlay",DBLTAP_UNDERLAY:"dbltap_underlay",COPY:"copydata",CUT:"cutdata",PASTE:"pastedata"},W=13,P=38,H=40;function z(t){return t||"_"}function N(){return z("chkcol.stateID")}function V(){return z("rdcol.stateID")}function $(){return z("swtcol.stateID")}function U(){return z("btncol.stateID")}function K(){return z("col.action.stateID")}function G(){return z("inline_input_editor.stateID")}function j(){return z("inline_textarea_editor.stateID")}function Y(){return z("inline_lookup_editor.stateID")}function X(){return z("check_header.stateID")}function q(){return z("switch_header.stateID")}const Z=K();function J(t,e,{action:o,mouseOver:n,mouseMove:i,mouseOut:r}){function s(o,n){return t.getLayoutCellId(o,n)===e}t[Z]||S.setReadonly(t,Z,{});const l=t[Z];return[t.listen(F.CLICK_CELL,(e=>{s(e.col,e.row)&&(C(t.getRowRecord(e.row))||o({col:e.col,row:e.row}))})),t.listen(F.MOUSEMOVE_CELL,(e=>{if(s(e.col,e.row)&&!C(t.getRowRecord(e.row))){if(i&&!i({col:e.col,row:e.row},e.event))return t.getElement().style.cursor="",void(l.mouseActive=!1);t.getElement().style.cursor="pointer",l.mouseActive=!0}})),t.listen(F.MOUSEOVER_CELL,(e=>{if(s(e.col,e.row)&&!C(t.getRowRecord(e.row))){if(n&&!n({col:e.col,row:e.row},e.event))return t.getElement().style.cursor="",void(l.mouseActive=!1);t.getElement().style.cursor="pointer",l.mouseActive=!0}})),t.listen(F.MOUSEOUT_CELL,(e=>{s(e.col,e.row)&&(r&&r({col:e.col,row:e.row}),t.getElement().style.cursor="",l.mouseActive=!1)}))]}function Q(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,W,32],[t.listen(F.KEYDOWN,(i=>{var r;if(-1===n.indexOf(i.keyCode))return;if((null===(r=t.keyboardOptions)||void 0===r?void 0:r.moveCellOnEnter)&&i.keyCode===W)return;const s=t.selection.select;var l,a;(l=s.col,a=s.row,t.getLayoutCellId(l,a)===e)&&(C(t.getRowRecord(s.row))||(o({col:s.col,row:s.row}),I.cancel(i.event)))}))]}class tt{constructor(t={}){this._disabled=t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled!==t&&(this._disabled=t,this.onChangeDisabledInternal())}onChangeDisabledInternal(){}}class et extends tt{constructor(t={}){super(t),this._action=t.action||B}get editable(){return!1}get action(){return this._action}set action(t){this._action=t}clone(){return new et(this)}getState(t){return{}}bindGridEvent(t,e){const o=this.getState(t),n=e=>{if(O(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);this._action.apply(this,[o,{cell:e,grid:t}])},r=(e,n)=>{if(O(this.disabled,t,e.row))return!1;o.mouseRelativePos=t._getMouseRelativePoint(n),o.mouseActiveCell={col:e.col,row:e.row};const r=t.getCellRange(e.col,e.row);return t.invalidateCellRange(r),!i(o.mouseActive)||o.mouseActive};return[...J(t,e,{action:t=>{o.mouseActive&&n(t)},mouseMove:r,mouseOut:e=>{delete o.mouseRelativePos,delete o.mouseActiveCell,delete o.mouseActive;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)},mouseOver:r}),...Q(t,e,{action:n})]}onPasteCellRangeBox(){}onDeleteCellRangeBox(){}}class ot extends tt{constructor(t={}){super(t),this._readOnly=t.readOnly||t.readonly||!1}get editable(){return!0}get readOnly(){return this._readOnly}set readOnly(t){this._readOnly!==t&&(this._readOnly=t,this.onChangeReadOnlyInternal())}get readonly(){return window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly}set readonly(t){window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly=t}onChangeReadOnlyInternal(){}}function nt(t,e,o,n){let i=!1;const r=t._getMouseRelativePoint(n),s=t.getAttachCellsArea(t.getCellRange(e,o)).rect;return r&&s.inPoint(r.x,r.y)&&(i=!0),i}class it extends ot{constructor(t={}){super(t)}open(t,e){const o=!D(this.readOnly,t,e.row)&&!O(this.disabled,t,e.row);return o&&this.onOpenCellInternal(t,e),o}onBeforeKeydownInternal(t,e,o,n){return!0}bindGridEvent(t,e){const o=e=>this.open(t,e),n=(e,o)=>{D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||this.onInputCellInternal(t,e,o)};function i(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(F.INPUT_CELL,(t=>{i(t.col,t.row)&&n({col:t.col,row:t.row},t.value)})),t.listen(F.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;y(o.start,o.end)&&i(e.col,e.row)&&(I.cancel(e.event),n({col:e.col,row:e.row},e.normalizeValue))})),t.listen(F.DBLCLICK_CELL,(e=>{i(e.col,e.row)&&nt(t,e.col,e.row,e.event)&&(o({col:e.col,row:e.row}),I.cancel(e.event))})),t.listen(F.DBLTAP_CELL,(e=>{i(e.col,e.row)&&nt(t,e.col,e.row,e.event)&&(o({col:e.col,row:e.row}),I.cancel(e.event))})),t.listen(F.KEYDOWN,(n=>{if(113!==n.keyCode&&n.keyCode!==W||n.keyCode===W&&n.event.shiftKey)return;const r=t.selection.select;return i(r.col,r.row)?!1!==this.onBeforeKeydownInternal(t,n.keyCode,n.event,e)&&void(n.event.ctrlKey||n.event.metaKey||o({col:r.col,row:r.row})&&(I.cancel(n.event),n.stopCellMoving())):void 0})),t.listen(F.SELECTED_CELL,(e=>{this.onChangeSelectCellInternal(t,{col:e.col,row:e.row},e.selected)})),t.listen(F.SCROLL,(()=>{this.onGridScrollInternal(t)})),t.listen(F.EDITABLEINPUT_CELL,(e=>!!i(e.col,e.row)&&(!D(this.readOnly,t,e.row)&&!O(this.disabled,t,e.row)))),t.listen(F.MODIFY_STATUS_EDITABLEINPUT_CELL,(e=>{if(!i(e.col,e.row))return;if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;const o=t.getCellRange(e.col,e.row);if(o.start.col!==o.end.col||o.start.row!==o.end.row){const{input:n}=e,i=t.getCellRect(e.col,e.row),r=t.getCellRangeRect(o);n.style.top=`${(parseFloat(n.style.top)+(r.top-i.top)).toFixed()}px`,n.style.left=`${(parseFloat(n.style.left)+(r.left-i.left)).toFixed()}px`,n.style.width=`${r.width.toFixed()}px`,n.style.height=`${r.height.toFixed()}px`}this.onSetInputAttrsInternal(t,{col:e.col,row:e.row},e.input)}))]}onPasteCellRangeBox(t,e,o){D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>o))}onDeleteCellRangeBox(t,e){D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>""))}}class rt extends it{constructor(t={}){super(t),this._disableInput=t.disableInput||!1,this._disableAction=t.disableAction||!1,this._action=t.action}get disableInput(){return this._disableInput}set disableInput(t){this._disableInput=t}get disableAction(){return this._disableAction}set disableAction(t){this._disableAction=t}get action(){return this._action}set action(t){this._action=t}onBeforeKeydownInternal(t,e,o,n){const i=t.selection.select;if(D(this.readOnly,t,i.row)||O(this.disabled,t,i.row)||(r=i.col,s=i.row,t.getLayoutCellId(r,s)!==n)||!this._action||this.isDisabledAction(t,i))return!0;var r,s;if(this.isDisabledInput(t,i)&&e===W&&!o.ctrlKey&&!o.metaKey||e===W&&(o.ctrlKey||o.metaKey)){const e=t.getRowRecord(i.row);if(this._action)return this._action.apply(this,[e,{cell:{col:i.col,row:i.row},grid:t}]),I.cancel(o),!1}return!0}bindGridEvent(t,e){const o=this.getState(t),n=(e,n)=>{if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||!this._action||this.isDisabledAction(t,e))return!1;o.mouseRelativePos=t._getMouseRelativePoint(n),o.mouseActiveCell={col:e.col,row:e.row};const r=t.getCellRange(e.col,e.row);return t.invalidateCellRange(r),!i(o.mouseActive)||o.mouseActive};let r=super.bindGridEvent(t,e);return r=r.concat(J(t,e,{action:e=>{if(!D(this.readOnly,t,e.row)&&!O(this.disabled,t,e.row)&&this._action&&!this.isDisabledAction(t,e)&&o.mouseActive){const o=t.getRowRecord(e.row);this._action&&this._action.apply(this,[o,{cell:e,grid:t}])}},mouseMove:n,mouseOut:e=>{delete o.mouseRelativePos,delete o.mouseActiveCell,delete o.mouseActive;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)},mouseOver:n})),r}onInputCellInternal(t,e,o){this.isDisabledInput(t,e)||this.onActionInputCellInternal(t,e,o)}onOpenCellInternal(t,e){this.isDisabledInput(t,e)||this.onActionOpenCellInternal(t,e)}onActionInputCellInternal(t,e,o){throw new Error}onActionOpenCellInternal(t,e){throw new Error}isDisabledInput(t,e){return this.isDisabled(this._disableInput,t,e)}isDisabledAction(t,e){return this.isDisabled(this._disableAction,t,e)}isDisabled(t,e,o){let n=!1;if(t)if("function"==typeof t){const i=e.getRowRecord(o.row);t.apply(this,[i,{cell:o,grid:e}])&&(n=!0)}else n=!0;return n}}function st(t,e,o,n){let i;return t*=3,e*=3,o*=3,n*=3,function(r){let s,l,a,c,h,d,u;if(r<0||1<r)throw new Error(`${r}`);s=i||r;do{l=1-s,a=l*l,c=s*s,h=c*s,d=t*a*s+o*l*c+h,u=r-d,s+=.5*u}while(1e-4<Math.abs(u));return i=s,e*a*s+n*l*c+h}}const lt={linear:t=>t,easeIn:st(.42,0,1,1),easeOut:st(0,0,.58,1),easeInOut:st(.42,0,.58,1)},at=t?()=>{}:window.requestAnimationFrame||(t=>setTimeout(t,1));function ct(){return Date.now()}function ht(t,e,o){const n=ct(),i=null==o?lt.easeInOut:"string"==typeof o?lt[o]:o;let r=!1;const s=(o,s)=>{const l=()=>{const a=ct()-n;r?s&&s():a>=t?(e(1),o&&o(void 0)):(e(i(a/t)),at(l))};return l},l=()=>{r=!0};if("undefined"!=typeof Promise){const t=new Promise(((t,o)=>{const n=s(t,o);e(0),n()}));return t.cancel=l,t}{const t=s((()=>{}),(()=>{}));return e(0),t(),{cancel:l}}}class dt extends ot{constructor(t={}){super(t)}bindGridEvent(t,e){const o=this.getState(t),n=e=>{const n=t.getCellRange(e.col,e.row),i=`${n.start.col}:${n.start.row}`;if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||o.block[i])return;const r=t.doChangeValue(e.col,e.row,A);if(r){const e=()=>{ht(200,(e=>{1===e?delete o.elapsed[i]:o.elapsed[i]=e,t.invalidateCellRange(n)}))};C(r)?(o.block[i]=!0,r.then((()=>{delete o.block[i],e()}))):e()}};function i(o,n){return t.getLayoutCellId(o,n)===e}return[...J(t,e,{action:n,mouseOver:e=>{if(O(this.disabled,t,e.row))return!1;o.mouseActiveCell={col:e.col,row:e.row};const n=t.getCellRange(e.col,e.row);return t.invalidateCellRange(n),!0},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...Q(t,e,{action:e=>{const o=t.selection.range,r=t.selection.select.col;for(let t=o.start.row;t<=o.end.row;t++)i(r,t)&&n({col:r,row:t})},acceptKeys:[W,32]}),t.listen(F.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!y(o.start,o.end))return;if(!i(e.col,e.row))return;const r=e.normalizeValue.trim();t.doGetCellValue(e.col,e.row,(t=>{`${A(t)}`.trim()===r&&(I.cancel(e.event),n({col:e.col,row:e.row}))}))}))]}onPasteCellRangeBox(t,e,o){if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;const n=o.trim();t.doGetCellValue(e.col,e.row,(o=>{`${A(o)}`.trim()===n&&t.doChangeValue(e.col,e.row,A)}))}onDeleteCellRangeBox(){}}const ut=U();const gt=N();class ft extends dt{clone(){return new ft(this)}getState(t){let e=t[gt];return e||(e={block:{},elapsed:{}},S.setReadonly(t,gt,e)),e}}const pt=$();class _t extends dt{clone(){return new _t(this)}getState(t){let e=t[pt];return e||(e={block:{},elapsed:{}},S.setReadonly(t,pt,e)),e}}function wt(t,{classList:e,text:o,html:n}={}){const i=document.createElement(t);return e&&(Array.isArray(e)?i.classList.add(...e):i.classList.add(e)),o?i.textContent=o:n&&(i.innerHTML=n),i}function Ct(t){let e;for(;e=t.firstChild;)t.removeChild(e)}function mt(t){if(Array.isArray(t)){const e=[];return t.forEach((t=>{e.push(...mt(t))})),e}const e=function(t){if(function(t){return!(!t.nodeType||!t.nodeName)}(t))return t;const e=wt("div",{html:t});return Array.prototype.slice.call(e.childNodes)}(t);return Array.isArray(e)?e:[e]}function yt(t,e){mt(e).forEach((e=>{t.appendChild(e)}))}function vt(t){t.dataset.disableBeforeTabIndex=`${t.tabIndex}`,t.tabIndex=-1,Array.prototype.slice.call(t.children||t.childNodes,0).forEach(vt)}function bt(t){return i(t.tabIndex)&&t.tabIndex>-1}function xt(t){let e=t.previousSibling;for(;e&&!bt(e);)e=e.previousSibling;return e}function Rt(t){let e=t.nextSibling;for(;e&&!bt(e);)e=e.nextSibling;return e}let Et=1;class Lt{constructor(){this._listeners={}}on(t,e,o,...n){t.addEventListener&&t.addEventListener(e,o,...n);const i={target:t,type:e,listener:o,options:n},r=Et++;return this._listeners[r]=i,r}once(t,e,o,...n){const i=this.on(t,e,((...t)=>{this.off(i),o(...t)}),...n);return i}tryWithOffEvents(t,e,o){const n=[];try{d(this._listeners,(o=>{o.target===t&&o.type===e&&(o.target.removeEventListener&&o.target.removeEventListener(o.type,o.listener,...o.options),n.push(o))})),o()}finally{n.forEach((t=>{t.target.addEventListener&&t.target.addEventListener(t.type,t.listener,...t.options)}))}}off(t){if(null==t)return;const e=this._listeners[t];e&&(delete this._listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...o){d(this._listeners,(n=>{n.target===t&&n.type===e&&n.listener.call(n.target,...o)}))}hasListener(t,e){let o=!1;return d(this._listeners,(n=>{n.target===t&&n.type===e&&(o=!0)})),o}clear(){d(this._listeners,(t=>{t.target.removeEventListener&&t.target.removeEventListener(t.type,t.listener,...t.options)})),this._listeners={}}dispose(){this.clear()}}function St(t,e){if(e&&"undefined"!=typeof document){let o;if(t){const e=document.getElementById(t);e instanceof HTMLStyleElement&&(o=e)}if(!o){o=document.createElement("style"),o.type="text/css",o.id=t;(document.head||document.getElementsByTagName("head")[0]).appendChild(o)}o.styleSheet?o.styleSheet.cssText=e:(o.innerHTML="",o.appendChild(document.createTextNode(e)))}}let kt=0;const It=()=>!!window.PerfectScrollbar,Tt=()=>{let t="/**\n * core styles \n */\n.kaka-grid .grid-scrollable {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n.kaka-grid .grid-scroll-end-point {\n  position: relative;\n  opacity: 0;\n}\n.kaka-grid {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.kaka-grid > canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 0;\n}\n.kaka-grid .grid-focus-control {\n  position: relative !important;\n  width: 1px;\n  height: 1px;\n  opacity: 0;\n  padding: 0;\n  margin: 0;\n  border: 0;\n  box-sizing: border-box;\n  pointer-events: none;\n  max-width: 0;\n  max-height: 0;\n  float: none !important;\n}\n.kaka-grid input.grid-focus-control::-ms-clear {\n  visibility: hidden;\n}\n.kaka-grid input.grid-focus-control.composition {\n  opacity: 1;\n  max-width: none;\n  max-height: none;\n}\n";It()?t+="\n      .kaka-grid .grid-scroll-end-point {\n        width: 1px;\n        height: 1px;\n      }":(kt=function(){const t=document.createElement("p");t.style.width="100%",t.style.height="200px";const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);const o=t.offsetWidth;e.style.overflow="scroll";let n=t.offsetWidth;return o===n&&(n=e.clientWidth),document.body.removeChild(e),o-n}()||10,t+=`\n      .kaka-grid .grid-scrollable {\n        overflow: scroll;\n      }\n      .kaka-grid .grid-scroll-end-point {\n        width: ${kt}px;\n        height: ${kt}px;\n      }\n      .kaka-grid > canvas {\n        width: -webkit-calc(100% - ${kt}px);\n        width: calc(100% - ${kt}px);\n        height: -webkit-calc(100% - ${kt}px);\n        height: calc(100% - ${kt}px);\n      }`),St("style",t)},Bt={initDocument(){Bt.initDocument=()=>{},Tt()},getScrollBarSize:()=>kt,inject:St,isPerfectScrollbar:It};function At(t,e){if("number"===t.type&&"-"===e){t.type="";let e=new Lt;const o=()=>{e&&(e.dispose(),e=null)};e.once(t,"input",(e=>{t.type="number",o()})),e.once(t,"blur",(t=>{o()}))}t.value=null!=e?e:""}const Mt=z("col.inline_editing_stateID");function Ot(t){let e=t[Mt];return e||(e={},S.setReadonly(t,Mt,e)),e}function Dt(t){if("string"==typeof t){if("false"===t)return!1;if("off"===t)return!1;if(/^0+$/.exec(t))return!1}return Boolean(t)}function Ft(t,e,o,n){const{classList:i,type:r}=t;i&&o.classList.add(...i);try{o.type=n||r||""}catch(t){o.type=""}}class Wt{constructor(){this._enabledMouseWheel=!1,this._handler=new Lt,this._input=(Bt.inject("inlineInputElement",".kaka-grid__inline-input::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-input {\n  position: absolute;\n  box-sizing: border-box;\n  background-color: transparent;\n  padding: 0;\n  border: none;\n}\n"),wt("input",{classList:"kaka-grid__inline-input"})),this._bindInputEvents()}static setInputAttrs(t,e,o,n){Ft(t,0,o,n)}dispose(){var t;const e=this._input;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)}attach(t,e,o,n,r,s){const l=this._input;if(this._enabledMouseWheel=e.enabledMouseWheel,l.parentElement)return;const a=this._handler;if(this._beforePropEditor){const{classList:t}=this._beforePropEditor;t&&l.classList.remove(...t)}l.style.font=t.font||"16px sans-serif";const{element:c,rect:h,padding:d}=t.getAttachCellsArea(t.getCellRange(o,n));l.style.top=`${h.top.toFixed()}px`,l.style.left=`${h.left.toFixed()}px`,l.style.width=`${h.width.toFixed()}px`,l.style.height=`${h.height.toFixed()}px`,l.style.paddingTop=`${d[0]}px`,l.style.paddingRight=`${d[1]}px`,l.style.paddingBottom=`${d[2]}px`,l.style.paddingLeft=`${d[3]}px`,c.appendChild(l),Ft(e,0,l),function(t="",e,o,n){e.dataset.editor_type=t,"date"===t?o instanceof Date?"text"===e.type?e.value=o.toJSON().slice(0,10):e.valueAsDate=o:e.value="":"number"===t?e.value="number"==typeof o||"string"==typeof o?String(o):"":i(o)?e.value=o:e.value="",e.dataset.before_value=e.value,n&&At(e,n)}(e.type,l,r,s),this._activeData={grid:t,col:o,row:n,editor:e},this._beforePropEditor=e;const u=()=>{a.tryWithOffEvents(l,"blur",(()=>{(()=>{l.focus();const t=l.value.length;try{if(void 0!==l.selectionStart)return l.selectionStart=t,void(l.selectionEnd=t)}catch(t){}if(document.selection){const e=l.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}})()}));const e=Ot(t);e.cellRange=t.getCellRange(o,n),t.invalidateCellRange(e.cellRange)};this._attaching=!0,setTimeout((()=>{u(),this._attaching=!1}))}detach(t){if(this._isActive()){const e=this._activeData,o=e.grid,n=e.col,i=e.row,r=this._input;this._handler.tryWithOffEvents(r,"blur",(()=>{r.parentElement&&r.parentElement.removeChild(r)}));delete Ot(o).cellRange;const s=o.getCellRange(n,i);o.invalidateCellRange(s),t&&o.focus()}delete this._activeData,this._enabledMouseWheel=!1}doChangeValue(){var t;if(this._isActive()&&(t=this._input).value!==t.dataset.before_value){const t=function(t){let e;switch(t.dataset.editor_type){case"date":e=/(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)/.test(t.value)?new Date(t.value):null;break;case"number":e=t.value?Number(t.value):null,isNaN(e)&&(e=null);break;default:e=t.value}return e}(this._input),e=this._activeData,o=e.grid,n=e.col,i=e.row;o.doChangeValue(n,i,(()=>t))}}_isActive(){const t=this._input;return!(!t||!t.parentElement)&&!!this._activeData}_bindInputEvents(){const t=this._handler,e=this._input,o=t=>t.stopPropagation();t.on(e,"click",o),t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"mousewheel",(t=>{this._enabledMouseWheel||t.preventDefault()})),t.on(e,"compositionstart",(t=>{e.classList.add("composition")})),t.on(e,"compositionend",(t=>{e.classList.remove("composition")})),t.on(e,"keydown",(t=>{if(e.classList.contains("composition"))return;const o=I.getKeyCode(t);27===o?(this.detach(!0),I.cancel(t)):o===W?this._onKeydownEnter(t):9===o&&this._onKeydownTab(t)})),t.on(e,"blur",(t=>{this.doChangeValue(),this.detach()}))}_onKeydownEnter(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;this.doChangeValue(),this.detach(!0),I.cancel(t),(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnEnter)&&o.onKeyDownMove(t)}_onKeydownTab(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)&&(this.doChangeValue(),this.detach(!0),o.onKeyDownMove(t))}}const Pt=G();let Ht=null,zt=0;function Nt(t,e,o,n,i){Ht||(Ht=new Wt);const r=o.getState(t);r.element||(r.element=Ht,zt++,t.addDisposable({dispose(){zt--,!zt&&Ht&&(Ht.dispose(),Ht=null)}})),Ht.attach(t,o,e.col,e.row,n,i)}function Vt(t){Ht&&Ht.detach(t)}function $t(t){Ht&&Ht.doChangeValue()}class Ut extends rt{constructor(t={}){super(t),this._classList=t.classList,this._type=t.type,this._enabledMouseWheel=!!t.enabledMouseWheel}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}get enabledMouseWheel(){return this._enabledMouseWheel}set enabledMouseWheel(t){this._enabledMouseWheel=t}clone(){return new Ut(this)}onActionInputCellInternal(t,e,o){t.doGetCellValue(e.col,e.row,(n=>{Nt(t,e,this,n,o)}))}onActionOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{Nt(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){$t(),Vt()}onGridScrollInternal(t){$t(),Vt(!0)}onChangeDisabledInternal(){Vt(!0)}onChangeReadOnlyInternal(){Vt(!0)}onSetInputAttrsInternal(t,e,o){Wt.setInputAttrs(this,t,o,"text")}getState(t){return t[Pt]||S.setReadonly(t,Pt,{}),t[Pt]}}const Kt="kaka-grid__inline-lookup",Gt=`${Kt}__input`,jt=`${Kt}__dropdown`,Yt=`${jt}--hidden`,Xt=`${jt}--shown`,qt=`${jt}--right`,Zt=`${jt}--bottom`,Jt=`${jt}-item`,Qt=`${Jt}--empty`,te=`${Jt}--other`,ee=`${Jt}--first`;function oe(t,e){const o=(e+"").replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1");return o?t.replace(new RegExp("("+o+")","gi"),"<b>$1</b>"):t}class ne{constructor(){this._attaching=!1,this._handler=new Lt,this._lookup=function(){Bt.inject("InlineLookupElement",".kaka-grid__inline-lookup__input::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-lookup__input {\n  box-sizing: border-box;\n  background-color: transparent;\n  padding: 0;\n  border: none;\n}\n\n.kaka-grid__inline-lookup__dropdown {\n  position: absolute;\n  color: rgba(0, 0, 0, 0.87);\n  box-sizing: content-box;\n  margin: 0;\n  padding: 8px 0;\n  background-color: #fafafa;\n  list-style-type: none;\n  border-radius: 2px;\n  /* max-height: calc(50vh - 40px); */\n  overflow-y: auto;\n  min-width: 100%;\n}\n\n.kaka-grid__inline-lookup__dropdown--hidden {\n  transform: scale(0.9);\n  box-shadow: none;\n  opacity: 0;\n  pointer-events: none;\n  transition: all 50ms ease-out;\n}\n\n.kaka-grid__inline-lookup__dropdown--hidden * {\n  pointer-events: none;\n}\n\n.kaka-grid__inline-lookup__dropdown--shown {\n  transform: translateY(2px);\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  opacity: 1;\n  /* transition: all 150ms ease-out; */\n}\n.kaka-grid__inline-lookup__dropdown--shown.kaka-grid__inline-lookup__dropdown--right {\n  right: 0px;\n}\n.kaka-grid__inline-lookup__dropdown--shown.kaka-grid__inline-lookup__dropdown--bottom {\n  bottom: 100%;\n  transform: translateY(-2px);\n  box-shadow: 0 -3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 -2px 2px 0px rgba(0, 0, 0, 0.14), 0 -1px 5px 0px rgba(0, 0, 0, 0.12);\n}\n.kaka-grid__inline-lookup__dropdown-item {\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  outline: none;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n  padding: 0 16px;\n}\n\n.kaka-grid__inline-lookup__dropdown-item--empty {\n  color: rgba(0, 0, 0, 0.38);\n}\n\n.kaka-grid__inline-lookup__dropdown-item::before {\n  content: '';\n  position: absolute;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background-color: #000;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 15ms linear;\n}\n\n.kaka-grid__inline-lookup__dropdown-item:hover::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-lookup__dropdown-item[data-select]::before {\n  opacity: 0.12;\n}\n\n.kaka-grid__inline-lookup {\n  position: absolute;\n}\n");const t=wt("div",{classList:Kt}),e=wt("input",{classList:Gt}),o=wt("ul",{classList:jt});return o.tabIndex=-1,t.appendChild(e),t.appendChild(o),t}(),this._input=this._lookup.querySelector(`.${Gt}`),this._dropdown=this._lookup.querySelector(`.${jt}`),this._bindInputEvents()}static setInputAttrs(t,e,o){o.type="text"}dispose(){var t;const e=this._lookup;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)}attach(t,e,o,n,s,l,a){const c=this._handler,h=this._lookup,d=this._input;this._beforePropEditor&&this._unbindLookupProps(t,h,d,this._beforePropEditor);const{element:u,rect:g,padding:f}=t.getAttachCellsArea(t.getCellRange(o,n));h.style.top=`${g.top.toFixed()}px`,h.style.left=`${g.left.toFixed()}px`,h.style.width=`${g.width.toFixed()}px`,h.style.height=`${g.height.toFixed()}px`,d.style.width=h.style.width,d.style.height=h.style.height,d.style.paddingTop=`${f[0]}px`,d.style.paddingRight=`${f[1]}px`,d.style.paddingBottom=`${f[2]}px`,d.style.paddingLeft=`${f[3]}px`,u.appendChild(h),d.style.font=t.font||"16px sans-serif";const p=e.valueField||"id",_=e.captionField||p,C=!r(e.filterFields)||Array.isArray(e.filterFields)&&0===e.filterFields.length?[p,_]:[];Array.isArray(e.filterFields)?e.filterFields.forEach((t=>{C.indexOf(t)<0&&t&&C.push(t)})):i(e.filterFields)&&C.indexOf(e.filterFields)<0&&e.filterFields&&C.push(e.filterFields);const m=t.getRowRecord(n),y=[];let v,b;const x="function"==typeof e.filter?e.filter:()=>!0;for(const t of l)x(t,m)&&(y.push(t),r(t[p])?t[p]===s&&(b=t):(v=t,r(s)||(b=t)));let R=i(s)?s+"":"";b&&(R=b!==v?b[_]+""||R:"");const E=w(e.allowOtherInput,m),L={col:o,dropdownInfo:{allowOtherInput:E,beforeRecord:i(a)?void 0:b,captionField:_,disableFilterRecords:e.disableFilterRecords,disableFilterSort:e.disableFilterSort,dropdownEmptyTemplate:e.dropdownEmptyTemplate?e.dropdownEmptyTemplate:k.template`${_}`,dropdownTemplate:e.dropdownTemplate?e.dropdownTemplate:k.template`${_}`,emptyRecord:v,filterFields:C,records:y,valueField:p,valueType:e.valueType},editor:e,grid:t,row:n};!function(t,e,o,n,i){e.value=n,e.dataset.value_type=t,e.dataset.before_value=JSON.stringify(o),e.dataset.select_value=JSON.stringify(o),i&&(e.value=i)}(e.valueType,d,s,R,a),this._onInputValue(d,L),this._bindLookupProps(t,h,d,e),this._activeData=L,this._beforePropEditor=e;const S=()=>{c.tryWithOffEvents(d,"blur",(()=>{(()=>{d.focus();const t=d.value.length;try{if(void 0!==d.selectionStart)return d.selectionStart=t,void(d.selectionEnd=t)}catch(t){}if(document.selection){const e=d.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}})()}));const e=Ot(t);e.cellRange=t.getCellRange(o,n),t.invalidateCellRange(e.cellRange)};this._attaching=!0,setTimeout((()=>{S(),this._attaching=!1}))}detach(t){if(this._isActive()){const e=this._lookup,o=this._input;this._handler.tryWithOffEvents(o,"blur",(()=>{e.parentElement&&(this._onInputValue(o),e.parentElement.removeChild(e))}));const{grid:n,col:i,row:r}=this._activeData;delete Ot(n).cellRange;const s=n.getCellRange(i,r);n.invalidateCellRange(s),t&&n.focus()}delete this._beforeValue,delete this._activeData}doChangeValue(t){var e;if(this._isActive()&&((!t||!this._activeData||this._activeData.dropdownInfo.allowOtherInput)&&(e=this._input).dataset.before_value!==e.dataset.select_value)){const t=function(t){let e=JSON.parse(t.dataset.select_value||"null");return"number"===t.dataset.value_type&&i(e)&&(e-=0,isNaN(e)&&(e=null)),e}(this._input),{grid:e,col:o,row:n}=this._activeData;e.doChangeValue(o,n,(()=>t))}}_isActive(){const t=this._lookup;return!(!t||!t.parentElement)&&!!this._activeData}_bindInputEvents(){const t=this._handler,e=this._dropdown,o=this._input,n=t=>t.stopPropagation();t.on(o,"click",n),t.on(o,"mousedown",n),t.on(o,"touchstart",n),t.on(o,"dblclick",n),t.on(e,"mousedown",n),t.on(e,"touchstart",n),t.on(e,"dblclick",n),t.on(e,"click",(t=>{t.stopPropagation();const e=function(t){let e=t;for(;!e.classList.contains(Jt);)if(e=e.parentElement,!e||e.classList.contains(jt))return;return e}(t.target);e?(this._selectNode(e),this.doChangeValue(),this.detach(!0)):this._input.focus()})),t.on(o,"compositionstart",(t=>{o.classList.add("composition")})),t.on(o,"compositionend",(t=>{o.classList.remove("composition"),this._onInputValue(o)}));const i=t=>{o.classList.contains("composition")||this._onInputValue(o)};t.on(o,"keyup",i),t.on(o,"keypress",i),t.on(o,"keydown",(t=>{if(o.classList.contains("composition"))return;const e=I.getKeyCode(t);if(27===e)this.detach(!0),I.cancel(t);else if(e===W)this._onKeydownEnter(t);else if(9===e)this._onKeydownTab(t);else if(e===P){const e=this._dropdown.querySelector("[data-select=true]");if(e){this._selectNode(e,!1);let o=xt(e);if(!o){const t=this._dropdown.querySelectorAll(`.${Jt}`);o=t[t.length-1],bt(o)||(o=xt(o))}o&&(this._selectNode(o),I.cancel(t))}}else if(e===H){const e=this._dropdown.querySelector("[data-select=true]");if(e){this._selectNode(e,!1);let o=Rt(e);o||(o=this._dropdown.querySelector(`.${Jt}`),bt(o)||(o=Rt(o))),o&&(this._selectNode(o),I.cancel(t))}}else this._onInputValue(o)})),t.on(o,"blur",(()=>setTimeout((()=>this.detach()),300)))}_onKeydownEnter(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;this.doChangeValue(),this.detach(!0),(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnEnter)?o.onKeyDownMove(t):I.cancel(t)}_onKeydownTab(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)&&(this.doChangeValue(),this.detach(!0),o.onKeyDownMove(t))}_onInputValue(t,e){const o=this._beforeValue,n=t.value;o!==n&&this._onInputValueChange(n,o,e),this._beforeValue=n}_onInputValueChange(t,e,o){const n=(o=o||this._activeData).grid,r=o.dropdownInfo,s=!i(e),l=this._filterRecords(r.records,r.filterFields,t,r.valueField,r.disableFilterRecords,r.disableFilterSort,r.emptyRecord,s?r.beforeRecord:void 0),a=l.isAll,c=l.filterRecords,h=[];let d,u,g=!1;if(r.allowOtherInput){let e=t,o=k.escape(t);if("number"===r.valueType?(e.trim()?(e=Number(t),isNaN(e)&&(e=null)):e=null,null===e&&(o=k.escape("<null>"),g=!0)):e||(o=k.escape("<Empty>"),g=!0),"number"===r.valueType&&(null!==e||a&&g&&!r.emptyRecord)||"number"!==r.valueType&&(e||g&&!r.emptyRecord)){const t=wt("li",{classList:[Jt,g?Qt:te]});t.tabIndex=0,t.dataset.value=JSON.stringify(e),yt(t,o),h.push(t)}}0!==h.length&&!g&&a||c.forEach((t=>{const e=[Jt];let o;t.__isEmpty?(e.push(Qt),o=r.dropdownEmptyTemplate(t)):o=r.dropdownTemplate(t);const n=wt("li",{classList:e});t.__isBefore&&(d=n),!i(u)&&t.__isMatched&&(u=n),n.tabIndex=0,n.dataset.value=JSON.stringify(t.__value),yt(n,o),h.push(n)})),Ct(this._dropdown);const f=this._dropdown.scrollHeight+2;if(h.length>0){let t;h[0].classList.add(ee),t=s&&r.beforeRecord&&d?d:u||h[0],this._selectNode(t),this._dropdown.style.maxHeight="",yt(this._dropdown,h),this._lookup.offsetTop+this._lookup.offsetHeight+this._dropdown.offsetHeight>n.getElement().clientHeight&&this._lookup.offsetTop>n.getElement().clientHeight-this._lookup.offsetTop-this._lookup.offsetHeight?(this._dropdown.classList.add(Zt),this._dropdown.style.maxHeight=this._lookup.offsetTop-f+"px"):(this._dropdown.style.maxHeight=n.getElement().clientHeight-this._lookup.offsetTop-this._lookup.offsetHeight-f+"px",this._dropdown.classList.remove(Zt)),this._lookup.offsetLeft+this._lookup.offsetWidth+this._dropdown.offsetWidth>n.getElement().clientWidth&&this._lookup.offsetLeft>n.getElement().clientWidth-this._lookup.offsetLeft-this._lookup.offsetWidth?this._dropdown.classList.add(qt):this._dropdown.classList.remove(qt),this._dropdown.classList.remove(Yt),this._dropdown.classList.add(Xt)}else this._selectNode(),this._dropdown.classList.remove(Xt),this._dropdown.classList.add(Yt)}_selectNode(t,e){t?!1!==e?(t.dataset.select="true",this._input.dataset.select_value=t.dataset.value,t.parentElement&&(t.offsetTop<t.parentElement.scrollTop?t.parentElement.scrollTop=t.offsetTop:t.offsetTop+t.offsetHeight>t.parentElement.scrollTop+t.parentElement.clientHeight&&(t.parentElement.scrollTop=t.offsetTop+t.offsetHeight-t.parentElement.clientHeight))):(delete t.dataset.select,this._input.dataset.select_value=this._input.dataset.before_value):this._input.dataset.select_value=this._input.dataset.before_value}_filterRecords(t,e,o,n,r,s,l,a){const c=[],h=[],d=[];t.forEach((t=>{const u={};let g=!1;for(const n in t){const r=i(t[n])?t[n]+"":"";if(e.indexOf(n)>=0){const t=oe(r,o);u[n]=t,g=g||t!==r||!o}else u[n]=r}u.__isMatched=g,u.__value=t[n],u.__isBefore=a===t,u.__isEmpty=l===t,g||u.__isBefore||s?c.push(u):r&&d.push(u),h.push(u)}));const u=0===e.length||!o&&!a||0===c.length;if(!u&&r)for(const t of d)c.push(t);return{filterRecords:u?h:c,isAll:u}}_bindLookupProps(t,e,o,n){const i=n.classList;i&&e.classList.add(...i),ne.setInputAttrs(n,t,o)}_unbindLookupProps(t,e,o,n){const i=n.classList;i&&e.classList.remove(...i)}}const ie=Y();let re=null,se=0;function le(t,e,o,n,i){re||(re=new ne);const r=o.getState(t);r.element||(r.element=re,se++,t.addDisposable({dispose(){se--,!se&&re&&(re.dispose(),re=null)}}));const s=w(o.records||[],t.getRowRecord(e.row));C(s)?s.then((r=>{re&&re.attach(t,o,e.col,e.row,n,r,i)})):re.attach(t,o,e.col,e.row,n,s,i)}function ae(t){re&&re.detach(t)}function ce(){re&&re.doChangeValue(!0)}class he extends rt{constructor(t={}){var e;super(t),this.action=this.action||(e=this,(t,o)=>{D(e.readOnly,o.grid,o.cell.row)||O(e.disabled,o.grid,o.cell.row)||e.onOpenCellInternal(o.grid,o.cell)}),this._classList=t.classList,this._records=t.records||[],this._valueField=t.valueField||"",this._valueType=t.valueType||"string",this._captionField=t.captionField||"",this._filterFields=t.filterFields||"",this._allowOtherInput=t.allowOtherInput||!1,this._disableFilterRecords=!!t.disableFilterRecords,this._disableFilterSort=!!t.disableFilterSort,i(t.disableDropdown)&&(this.disableDropdown=!!t.disableDropdown),this._filter=t.filter,this._dropdownTemplate=t.dropdownTemplate,this._dropdownEmptyTemplate=t.dropdownEmptyTemplate}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get records(){return this._records}set records(t){this._records=t}get valueField(){return this._valueField}set valueField(t){this._valueField=t}get valueType(){return this._valueType}set valueType(t){this._valueType=t}get captionField(){return this._captionField}set captionField(t){this._captionField=t}get filterFields(){return this._filterFields}set filterFields(t){this._filterFields=t}get allowOtherInput(){return this._allowOtherInput}set allowOtherInput(t){this._allowOtherInput=t||!1}get disableFilterRecords(){return this._disableFilterRecords}set disableFilterRecords(t){this._disableFilterRecords=!!t}get disableFilterSort(){return this._disableFilterSort}set disableFilterSort(t){this._disableFilterSort=!!t}get disableDropdown(){return window.console.warn("'disableDropdown' is deprecated, please use 'disableInput' instead"),!!this.disableInput}set disableDropdown(t){window.console.warn("'disableDropdown' is deprecated, please use 'disableInput' instead"),this.disableInput=!!t}get filter(){return this._filter}set filter(t){this._filter=t}get dropdownTemplate(){return this._dropdownTemplate}set dropdownTemplate(t){this._dropdownTemplate=t}get dropdownEmptyTemplate(){return this._dropdownEmptyTemplate}set dropdownEmptyTemplate(t){this._dropdownEmptyTemplate=t}clone(){return new he(this)}onActionInputCellInternal(t,e,o){t.doGetCellValue(e.col,e.row,(n=>{le(t,e,this,n,o)}))}onActionOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{le(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){ce(),ae()}onGridScrollInternal(t){ce(),ae(!0)}onChangeDisabledInternal(){ae(!0)}onChangeReadOnlyInternal(){ae(!0)}onSetInputAttrsInternal(t,e,o){ne.setInputAttrs(this,t,o)}bindGridEvent(t,e){const o=super.bindGridEvent(t,e),n=()=>{ce(),ae(!0)};return o.push(t.listen(F.CLICK_UNDERLAY,n)),o.push(t.listen(F.DBLCLICK_UNDERLAY,n)),o.push(t.listen(F.DBLTAP_UNDERLAY,n)),o}getState(t){return t[ie]||S.setReadonly(t,ie,{}),t[ie]}}function de(t){if(!t)return[];if(Array.isArray(t))return t.map((t=>function(t,e){const o={};for(const e in t)o[e]=t[e];for(const t in e)o[t]=e[t];return o}(t,{label:t.caption||t.label})));if("string"==typeof t)return de(JSON.parse(t));const e=[];for(const o in t)t.hasOwnProperty(o)&&e.push({label:t[o],value:o});return e}var ue={normalize:de,normalizeToFn:function(t){return"function"==typeof t?e=>de(t(e)):()=>de(t)}};const ge="kaka-grid__inline-menu",fe=`${ge}__menu-item`,pe=`${ge}--hidden`,_e=`${ge}--shown`,we=`${fe}--empty`;function Ce(t){let e=t;for(;!e.classList.contains(fe);)if(e=e.parentElement,!e||e.classList.contains(ge))return;return e}function me(t,e,o,n){o.style.top=`${e.top.toFixed()}px`,o.style.left=`${e.left.toFixed()}px`,o.style.width=n?"":`${e.width.toFixed()}px`,o.style.lineHeight=`${e.height.toFixed()}px`,t.appendChild(o)}function ye(t,e,o,n,r,s,l){const{classList:a}=e;l.classList.remove(_e),l.classList.add(pe),Ct(l),l.style.font=t.font||"16px sans-serif";let c=null,h=null;s.forEach(((t,e)=>{const o=function({classList:t,label:e,value:o,html:n},r){const s=wt("li",{classList:fe});if(s.tabIndex=0,s.setAttribute("data-value-index",r+""),t&&s.classList.add(...Array.isArray(t)?t:[t]),e){const t=wt("span",{text:e});s.appendChild(t)}else n&&yt(s,n);return""!==o&&i(o)||s.classList.add(we),s}(t,e);l.appendChild(o),t.value===r&&(h=o,o.dataset.select="select"),o.classList.contains(we)&&(c=o)}));const d=h||c||(l.children||l.childNodes)[0];a&&l.classList.add(...a);const u=Array.prototype.slice.call(l.children||l.childNodes,0),g=u.indexOf(d),{element:f,rect:p}=t.getAttachCellsArea(t.getCellRange(o,n));p.width++,me(f,p,l,e.autoWidth);let _=0,w=0;for(let t=0;t<u.length;t++){const e=u[t].offsetHeight;t<g&&(_+=e),w+=e}p.offsetTop(-_),l.style.transformOrigin=`center ${_+Math.ceil(u[g].offsetHeight/2)}px 0px`,me(f,p,l,e.autoWidth);const C=l.getBoundingClientRect(),m=(w-C.height)/2,y=C.top-m;let v=y;const b=v+w,x=window.innerHeight;if(b>x-20){v-=b-x+20}v<20&&(v=20),v!==y&&(p.offsetTop(-(y-v)),me(f,p,l,e.autoWidth)),d&&d.focus(),l.classList.remove(pe),l.classList.add(_e)}class ve{constructor(){this._handler=new Lt,this._menu=(Bt.inject("inlineMenuElement",".kaka-grid__inline-menu {\n  position: absolute;\n  color: rgba(0, 0, 0, 0.87);\n  box-sizing: content-box;\n  margin: -1px auto auto -1px;\n  padding: 8px 0;\n  background-color: #fafafa;\n  list-style-type: none;\n  border-radius: 2px;\n  max-height: calc(100vh - 40px);\n  overflow-y: auto;\n  white-space: nowrap;\n}\n\n.kaka-grid__inline-menu--hidden {\n  transform: scale(0.9);\n  box-shadow: none;\n  opacity: 0;\n  pointer-events: none;\n  transition: all 50ms ease-out;\n}\n\n.kaka-grid__inline-menu--hidden * {\n  pointer-events: none;\n}\n\n.kaka-grid__inline-menu--shown {\n  transform: translateY(-7px);\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  opacity: 1;\n  transition: all 150ms ease-out;\n}\n\n.kaka-grid__inline-menu__menu-item {\n  height: 100%;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  outline: none;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n  padding: 0 16px;\n}\n\n.kaka-grid__inline-menu__menu-item--empty {\n  color: rgba(0, 0, 0, 0.38);\n}\n\n.kaka-grid__inline-menu__menu-item::before {\n  content: '';\n  position: absolute;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background-color: #000;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 15ms linear;\n}\n\n.kaka-grid__inline-menu__menu-item:hover::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-menu__menu-item[data-select]::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-menu__menu-item:focus::before {\n  opacity: 0.12;\n}\n"),wt("ul",{classList:ge})),this._bindMenuEvents()}dispose(){var t;const e=this._menu;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)}attach(t,e,o,n,i,r){const s=this._menu;if(this._beforePropEditor){const t=this._beforePropEditor.classList;t&&s.classList.remove(...t)}const l=e.options(r);ye(t,e,o,n,i,l,s);const a=s;for(let t=0;t<s.childNodes.length;t++){const e=s.childNodes[t];this._handler.on(e,"focus",(()=>{a._focus=!0})),this._handler.on(e,"blur",(()=>{a._focus=!1,setTimeout((()=>{a._focus||this.detach()}),0)}))}this._activeData={grid:t,col:o,row:n,editor:e,options:l},this._beforePropEditor=e}detach(t){if(this._isActive()){const{grid:e,col:o,row:n}=this._activeData;!function(t,e,o,n){n.classList.remove(_e),n.classList.add(pe),vt(n)}(0,0,0,this._menu);const i=e.getCellRange(o,n);e.invalidateCellRange(i),t&&e.focus()}this._activeData=null}_doChangeValue(t){if(this._isActive()&&t){const{grid:e,col:o,row:n,options:i}=this._activeData,r=i[parseInt(t,10)];if(r){const{value:t}=r;e.doChangeValue(o,n,(()=>t))}}}_isActive(){const t=this._menu;return!(!t||!t.parentElement)&&!!this._activeData}_bindMenuEvents(){const t=this._handler,e=this._menu,o=t=>t.stopPropagation();t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"click",(t=>{t.stopPropagation();const e=Ce(t.target);if(!e)return;const o=e.getAttribute("data-value-index");this._doChangeValue(o),this.detach(!0)})),t.on(e,"keydown",(t=>{const o=Ce(t.target);if(!o||!this._isActive())return;const n=I.getKeyCode(t);if(n===W)this._onKeydownEnter(e,o,t);else if(27===n)this.detach(!0),I.cancel(t);else if(n===P){const e=xt(o);e&&(e.focus(),I.cancel(t))}else if(n===H){const e=Rt(o);e&&(e.focus(),I.cancel(t))}else 9===n&&this._onKeydownTab(e,o,t)}))}_onKeydownEnter(t,e,o){var n;const i=this._isActive()?this._activeData.grid:null,r=e.getAttribute("data-value-index");this._doChangeValue(r),this.detach(!0),I.cancel(o),i&&(null===(n=i.keyboardOptions)||void 0===n?void 0:n.moveCellOnEnter)&&i.onKeyDownMove(o)}_onKeydownTab(t,e,o){var n;if(this._isActive()){const{grid:t}=this._activeData;if(null===(n=t.keyboardOptions)||void 0===n?void 0:n.moveCellOnTab){const n=e.getAttribute("data-value-index");return this._doChangeValue(n||""),this.detach(!0),void t.onKeyDownMove(o)}}if(o.shiftKey){if(!xt(e)){const e=t.querySelectorAll(`.${fe}`);let n=e[e.length-1];bt(n)||(n=xt(n)),n&&(n.focus(),I.cancel(o))}}else if(!Rt(e)){let e=t.querySelector(`.${fe}`);bt(e)||(e=Rt(e)),e&&(e.focus(),I.cancel(o))}}}const be=["content","font","color","className","tagName","isLiga","width","src","svg","name","path"];const xe={},Re={};function Ee(t){if(!t)return t;if(Array.isArray(t))return t;const e={};let o=0;be.forEach((e=>{const n=t[e];n&&(o=Array.isArray(n)?Math.max(o,n.length):Math.max(o,1))})),be.forEach((n=>{const i=function(t,e){const o=[];if(Array.isArray(t)){o.push(...t);for(let n=t.length;n<e;n++)o.push(null)}else for(let n=0;n<e;n++)o.push(t);return o}(t[n],o);e[n]=i}));const n=[];for(let t=0;t<o;t++){const o={};be.forEach((n=>{const i=e[n][t];o[n]=i})),n.push(o)}return n}function Le(t){const e={};for(const o in t)"className"!==o&&Se(o)&&(e[o]=t[o]);if(t.className){const o=function(t,e){const o=Re[t]||(Re[t]={});if(o[e])return o[e];const n=xe[t]||(xe[t]=document.createElement(t));n.className=e,document.body.appendChild(n);try{const t=(document.defaultView||window).getComputedStyle(n,"::before");let i=t.getPropertyValue("content");"none"===i&&(i=""),i.length>=3&&('"'===i[0]||"'"===i[0])&&i[0]===i[i.length-1]&&(i=i.substr(1,i.length-2));let r=t.getPropertyValue("font");r||(r=`${t.getPropertyValue("font-style")} ${t.getPropertyValue("font-variant")} ${t.getPropertyValue("font-weight")} ${t.getPropertyValue("font-size")}/${t.getPropertyValue("line-height")} ${function(t){const e=[],o=t.split(/,\s*/);for(let t=0;t<o.length;t++){const n=o[t].replace(/['"]/g,"");-1!==n.indexOf(" ")||/^\d/.test(n)?e.push(`'${n}'`):e.push(n)}return e.join(",")}(t.getPropertyValue("font-family"))}`);const s=t.getPropertyValue("color"),l=n.clientWidth,a=(t.getPropertyValue("font-feature-settings")||"").indexOf("liga")>-1;return o[e]={color:s,content:i,font:r,isLiga:a,width:l}}finally{document.body.removeChild(n)}}(t.tagName||"i",t.className);for(const n in o)Se(n)&&(i(t[n])||(e[n]=o[n]))}return e}function Se(t){return be.indexOf(t)>=0}const ke={toNormarizeArray:function(t){const e=Ee(t);return e?e.map((t=>Le(t))):e},iconPropKeys:be};class Ie{constructor(t,e,o,n){this._left=t,this._top=e,this._width=o,this._height=n,this._right=void 0}static bounds(t,e,o,n){return new Ie(t,e,o-t,n-e)}static max(t,e){return Ie.bounds(Math.min(t.left,e.left),Math.min(t.top,e.top),Math.max(t.right,e.right),Math.max(t.bottom,e.bottom))}get left(){return this._left}set left(t){const e=this.right;this._left=t,this.right=e}get top(){return this._top}set top(t){const e=this.bottom;this._top=t,this.bottom=e}get width(){return this._width}set width(t){this._width=t,this._right=void 0}get height(){return this._height}set height(t){this._height=t,this._bottom=void 0}get right(){return void 0!==this._right?this._right:this._right=this.left+this.width}set right(t){this._right=t,this.width=t-this.left}get bottom(){return void 0!==this._bottom?this._bottom:this._bottom=this.top+this.height}set bottom(t){this._bottom=t,this.height=t-this.top}offsetLeft(t){this._left+=t,this._right=void 0}offsetTop(t){this._top+=t,this._bottom=void 0}copy(){return new Ie(this.left,this.top,this.width,this.height)}intersection(t){const e=Math.max(this.left,t.left),o=Math.min(this.left+this.width,t.left+t.width);if(e<=o){const n=Math.max(this.top,t.top),i=Math.min(this.top+this.height,t.top+t.height);if(n<=i)return Ie.bounds(e,n,o,i)}return null}contains(t){return this.left<=t.left&&this.left+this.width>=t.left+t.width&&this.top<=t.top&&this.top+this.height>=t.top+t.height}inPoint(t,e){return this.left<=t&&this.left+this.width>=t&&this.top<=e&&this.top+this.height>=e}}function Te(t,e,o,n){let i;if(t)if(C(t))t.then((t=>{Te(t,e.toCurrentContext(),o,n)}));else{const n=ke.toNormarizeArray(t);n.forEach((t=>{t.font&&t.content&&o.testFontLoad(t.font,t.content,e)})),i=n}n(i,e)}function Be(t,e,o){const n=o.font,i=o.padding,s=o.appearance,l=e.toBoxPixelArray(i||0,t,n).slice(0);return"none"!==s&&r(s)&&(l[1]+=26),l}function Ae(t,e,o,n,i){const s=i.textBaseline,l=i.font,a=i.padding,c=i.appearance,h=i.color;let d=!1;const u=t[o];if(u&&u.mouseActiveCell&&v(e.range,u.mouseActiveCell.col,u.mouseActiveCell.row)&&u.mouseRelativePos){let t=e.getRect();const o=32;t=new Ie(t.left+t.width-o,t.top,o,t.height),d=t.left<=u.mouseRelativePos.x&&t.right>=u.mouseRelativePos.x&&t.top<=u.mouseRelativePos.y&&t.bottom>=u.mouseRelativePos.y,u.mouseActive=d}if("none"!==c&&r(c)){const o=n.toBoxPixelArray(a||0,e,l).slice(0);let i;if(o[1]+=8,"menulist-button"===c?i={color:d?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M0 2 5 7 10 2z",width:10}:"lookup-button"===c?i={color:d?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M4.7997924,9.6 C2.15326327,9.6 0,7.44655046 0,4.79937714 C0,2.15261906 2.15326327,0 4.7997924,0 C7.44673673,0 9.6,2.15261906 9.6,4.79937714 C9.6,7.44655046 7.44673673,9.6 4.7997924,9.6 Z M4.79959481,0.9 C2.64922597,0.9 0.9,2.64900249 0.9,4.79918953 C0.9,6.95018703 2.64922597,8.7 4.79959481,8.7 C6.95036883,8.7 8.7,6.95018703 8.7,4.79918953 C8.7,2.64940773 6.95036883,0.9 4.79959481,0.9 Z M11.579002,12 C11.4749824,12 11.3709629,11.9593028 11.289322,11.8774707 L7.93168591,8.56830498 C7.76260228,8.39851441 7.75555713,8.11713467 7.91510908,7.93902961 C8.07631871,7.76136216 8.34237677,7.75261007 8.51104597,7.92065022 L11.8686821,11.2315664 C12.0373513,11.4004817 12.0443964,11.6822991 11.8848445,11.8608417 C11.8019603,11.9527387 11.6904812,12 11.579002,12 Z",width:12}:"clear-button"===c?i={color:d?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M5.26896659,6.00000686 L0.152356675,11.1166168 C-0.048420546,11.317394 -0.0501211184,11.6463861 0.151753253,11.8482467 C0.355026465,12.05152 0.681179729,12.0498468 0.883383238,11.8476433 L5.99999314,6.73103342 L11.1166168,11.8476433 C11.317394,12.0484205 11.6463861,12.0501211 11.8482467,11.8482467 C12.05152,11.6449735 12.0498468,11.3188203 11.8476433,11.1166168 L6.73103341,6.00000686 L11.8476433,0.883383238 C12.0484205,0.682606017 12.0501074,0.3536139 11.8482467,0.151753253 C11.6449598,-0.0515199596 11.3188065,-0.0498468209 11.1166168,0.152356675 L6.00000686,5.2689803 L0.883383238,0.152356688 C0.682606017,-0.0484205326 0.3536139,-0.0501073814 0.151753253,0.151753266 C-0.0515199596,0.355040202 -0.0498468209,0.681193466 0.152356675,0.883383252 L5.26896659,6.00000686 Z",width:12}:"date-button"===c?i={color:d?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M5.6,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C6.8,6.2,6.7,6,6.4,6c0,0,0,0,0,0H5.6C5.3,6,5.1,6.2,5.1,6.4c0,0,0,0,0,0C5.1,6.7,5.3,6.8,5.6,6.8L5.6,6.8z M5.6,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H5.6c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C5.1,8.4,5.3,8.6,5.6,8.6L5.6,8.6z M10.3,0.9H8.6V0.4C8.6,0.2,8.4,0,8.1,0c0,0,0,0,0,0C7.9,0,7.7,0.2,7.7,0.4c0,0,0,0,0,0v0.4H4.3V0.4C4.3,0.2,4.1,0,3.9,0c0,0,0,0,0,0C3.6,0,3.4,0.2,3.4,0.4c0,0,0,0,0,0v0.4H1.7C0.8,0.9,0,1.6,0,2.6v6.8c0,0.9,0.8,1.7,1.7,1.7h8.6c0.9,0,1.7-0.8,1.7-1.7V2.6C12,1.6,11.2,0.9,10.3,0.9L10.3,0.9z M11.1,9.4c0,0.5-0.4,0.9-0.9,0.9H1.7c-0.5,0-0.9-0.4-0.9-0.9V4.3h10.3V9.4z M11.1,3.4H0.9V2.6c0-0.5,0.4-0.9,0.9-0.9h1.7v0.4c0,0.2,0.2,0.4,0.4,0.4s0.4-0.2,0.4-0.4V1.7h3.4v0.4c0,0.2,0.2,0.4,0.4,0.4c0.2,0,0.4-0.2,0.4-0.4V1.7h1.7c0.5,0,0.9,0.4,0.9,0.9L11.1,3.4L11.1,3.4z M3,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H3c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C2.6,8.4,2.8,8.6,3,8.6z M8.1,6.8H9c0.2,0,0.4-0.2,0.4-0.4C9.4,6.2,9.2,6,9,6c0,0,0,0,0,0H8.1C7.9,6,7.7,6.2,7.7,6.4c0,0,0,0,0,0C7.7,6.7,7.9,6.8,8.1,6.8L8.1,6.8z M3,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C4.3,6.2,4.1,6,3.9,6c0,0,0,0,0,0H3C2.8,6,2.6,6.2,2.6,6.4c0,0,0,0,0,0C2.6,6.7,2.8,6.8,3,6.8z M8.1,8.6H9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H8.1c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C7.7,8.4,7.9,8.6,8.1,8.6z",width:12}:"function"==typeof c?i=c(d):S.isObject(c)?i=c:window.console.warn(`unsupported appearance:${c}`),i){const r=t.getCellOverflowText(e.col,e.row)||"";n.text("",e,{color:h,font:l,icons:[i],padding:o,textAlign:"right",textBaseline:s}),t.setCellOverflowText(e.col,e.row,r)}}}function Me(t,e,o,n,i,r){let s=!1;if(e){const l={grid:i,record:r,rect:n.getRect(),row:n.row,col:n.col,selection:n.getSelection()};t.drawWithClip(n,(t=>{s=!1===e(o,t,l)}))}return s}function Oe(t,e){let o;o="function"==typeof e?e(t):e;let n=!1;return o&&"dashed"===o.innerBox&&(n=!0),n}function De(t,e,o,n){Oe(o.getRowRecord(e),n)&&(t.left+=4,t.top+=4,t.right-=4,t.bottom-=4)}function Fe(t,e,o,n){Oe(o.getRowRecord(e),n)&&(t[3]-=4,t[3]<0&&(t[3]=0),t[1]-=4,t[1]<0&&(t[1]=0))}function We(t,e,o,n,i){if(Oe(e,i)){const t=o.getRect();t.top+=4,t.right-=4,t.bottom-=4,t.left+=4,n.attachArea(t,o)}}var Pe;const He=z("protected.event_target");let ze=1;class Ne{constructor(){this[Pe]={listeners:{},listenerData:{}}}listen(t,e){const o=this[He].listeners[t]||(this[He].listeners[t]=[]);o.push(e);const n=ze++;return this[He].listenerData[n]={listener:e,remove:()=>{delete this[He].listenerData[n];const i=o.indexOf(e);o.splice(i,1),this[He].listeners[t].length||delete this[He].listeners[t]},type:t},n}unlisten(t){this[He]&&this[He].listenerData[t].remove()}addEventListener(t,e){this.listen(t,e)}removeEventListener(t,e){this[He]&&d(this[He].listenerData,((o,n)=>{o.type===t&&o.listener===e&&this.unlisten(n)}))}hasListeners(t){return!!this[He].listeners[t]}fireListeners(t,...e){const o=this[He].listeners[t];return o?o.map((t=>t.call(this,...e))).filter(i):[]}dispose(){}}Pe=He;const Ve={CHANGE_STYLE:"change_style"};let $e,Ue,Ke,Ge,je,Ye,Xe,qe,Ze,Je,Qe,to,eo,oo,no,io;class ro extends Ne{constructor({bgColor:t}={}){super(),this._bgColor=t}static get EVENT_TYPE(){return Ve}static get DEFAULT(){return $e||($e=new ro)}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(Ve.CHANGE_STYLE)}clone(){return new ro(this)}}class so extends ro{constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}static get DEFAULT(){return Ue||(Ue=new so)}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new so(this)}}class lo extends so{constructor(t={}){super(u(t,{textAlign:"center"}));const{uncheckBgColor:e,checkBgColor:o,borderColor:n}=t;this._uncheckBgColor=e,this._checkBgColor=o,this._borderColor=n}static get DEFAULT(){return Ke||(Ke=new lo)}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new lo(this)}}class ao extends so{constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._padding=t.padding,this._inputPadding=t.inputPadding,this._textOverflow=t.textOverflow||"clip",this._appearance=t.appearance||"none"}static get DEFAULT(){return Ge||(Ge=new ao)}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get padding(){return this._padding}set padding(t){this._padding=t,this.doChangeStyle()}get inputPadding(){return this._inputPadding}set inputPadding(t){this._inputPadding=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}get appearance(){return this._appearance}set appearance(t){this._appearance=t,this.doChangeStyle()}clone(){return new ao(this)}}class co extends ao{constructor(t={}){super(u(t,{textAlign:"center"})),this._buttonBgColor=t.buttonBgColor}static get DEFAULT(){return je||(je=new co)}get buttonBgColor(){return this._buttonBgColor}set buttonBgColor(t){this._buttonBgColor=t,this.doChangeStyle()}clone(){return new co(this)}}class ho extends lo{static get DEFAULT(){return Ye||(Ye=new ho)}constructor(t={}){super(t)}clone(){return new ho(this)}}class uo extends lo{static get DEFAULT(){return Xe||(Xe=new uo)}constructor(t={}){super(t)}clone(){return new uo(this)}}class go extends ao{static get DEFAULT(){return qe||(qe=new go)}constructor(t={}){super(function(t){return t.textAlign=t.textAlign||"right",t}(t))}clone(){return new go(this)}}class fo extends ro{constructor(t={}){super(t),this._appearance=t.appearance||"none"}static get DEFAULT(){return Ze||(Ze=new fo)}get appearance(){return this._appearance}set appearance(t){this._appearance=t,this.doChangeStyle()}clone(){return new fo(this)}}class po extends ao{static get DEFAULT(){return Je||(Je=new po)}constructor(t={}){super(u(t,{textAlign:"center"}))}clone(){return new po(this)}}class _o extends so{constructor(t={}){super(u(t,{textAlign:"center"})),this._imageSizing=t.imageSizing,this._margin=t.margin||4,this._appearance=t.appearance||"none"}static get DEFAULT(){return Qe||(Qe=new _o)}get imageSizing(){return this._imageSizing}set imageSizing(t){this._imageSizing=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}get appearance(){return this._appearance}set appearance(t){this._appearance=t,this.doChangeStyle()}clone(){return new _o(this)}}class wo extends ao{static get DEFAULT(){return to||(to=new wo)}constructor(t={}){super(u(t,{textAlign:"left"})),this.appearance=t.appearance||"menulist-button"}clone(){return new wo(this)}}class Co extends ao{static get DEFAULT(){return eo||(eo=new Co)}constructor(t={}){super(t),this.appearance=t.appearance||"menulist-button"}clone(){return new Co(this)}}class mo extends ao{constructor(t={}){super(u(t,{textBaseline:"middle",textOverflow:"ellipsis"})),this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp||"auto"}static get DEFAULT(){return oo||(oo=new mo)}clone(){return new mo(this)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}}class yo extends ao{static get DEFAULT(){return no||(no=new yo)}constructor(t={}){super(u(t,{textAlign:"right"}))}clone(){return new yo(this)}}const vo=t=>t>80?"#20a8d8":t>50?"#4dbd74":t>20?"#ffc107":"#f86c6b";class bo extends ao{constructor(t={}){super(t),this._barColor=t.barColor||vo,this._barBgColor=t.barBgColor||"#f0f3f5",this._barHeight=t.barHeight||3}static get DEFAULT(){return io||(io=new bo)}get barColor(){return this._barColor}set barColor(t){this._barColor=t,this.doChangeStyle()}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t,this.doChangeStyle()}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t,this.doChangeStyle()}clone(){return new bo(this)}}let xo,Ro;class Eo extends so{constructor(t={}){super(u(t,{textAlign:"center"}));const{checkColor:e,uncheckBorderColor:o,checkBorderColor:n,uncheckBgColor:i,checkBgColor:r}=t;this._checkColor=e,this._uncheckBorderColor=o,this._checkBorderColor=n,this._uncheckBgColor=i,this._checkBgColor=r}static get DEFAULT(){return xo||(xo=new Eo)}get checkColor(){return this._checkColor}set checkColor(t){this._checkColor=t,this.doChangeStyle()}get uncheckBorderColor(){return this._uncheckBorderColor}set uncheckBorderColor(t){this._uncheckBorderColor=t,this.doChangeStyle()}get checkBorderColor(){return this._checkBorderColor}set checkBorderColor(t){this._checkBorderColor=t,this.doChangeStyle()}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}clone(){return new Eo(this)}}class Lo extends ao{constructor(t={}){super(function(t){return t.textAlign=t.textAlign||"left",t}(t)),this._lineColor=t.lineColor,this._buttonColor=t.buttonColor,this._buttonBgColor=t.buttonBgColor,this._buttonBorderColor=t.buttonBorderColor,this._linkColor=t.linkColor,this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp||"auto"}static get DEFAULT(){return Ro||(Ro=new Lo)}get lineColor(){return this._lineColor}set lineColor(t){this._lineColor=t,this.doChangeStyle()}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t,this.doChangeStyle()}get buttonBgColor(){return this._buttonBgColor}set buttonBgColor(t){this._buttonBgColor=t,this.doChangeStyle()}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t,this.doChangeStyle()}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t,this.doChangeStyle()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}clone(){return new Lo(this)}}const{EVENT_TYPE:So}=ro;function ko(t,e,o=ao){return t?t instanceof ro?t:"function"==typeof t?ko(t(e),e,o):"string"==typeof t&&e&&t in e?ko(e[t],e,o):new o(t):o.DEFAULT}const Io=z("col.fadein_stateID");function To(t){let e=t[Io];return e||(e={cells:{}},S.setReadonly(t,Io,e)),e}function Bo(t,e,o,n,i,r){return s=>{const l=To(t),a=`${e}:${o}`;1===s?delete l.cells[a]:l.cells[a]={opacity:s},r(),i();const c=l.cells[a];if(c){const t=n.getContext();t.globalAlpha=1-c.opacity;try{r()}finally{t.globalAlpha=1}}}}const Ao={animate(t,e,o,n,i,r){const s=To(t),l=[Bo(t,e,o,n,i,r)];s.activeFadeins=l,ht(500,(t=>{l.forEach((e=>e(t))),1===t&&delete s.activeFadeins}))},margeAnimate(t,e,o,n,i,r){const s=To(t);s.activeFadeins?s.activeFadeins.push(Bo(t,e,o,n,i,r)):i()}};class Mo{constructor(t={}){this.onDrawCell=this.onDrawCell.bind(this),this._convert=t.convert,this._convertCopy=t.convertCopy,this._hidden=t.hidden,this._fadeinWhenCallbackInPromise=t.fadeinWhenCallbackInPromise||!1}get StyleClass(){return ro}get fadeinWhenCallbackInPromise(){return this._fadeinWhenCallbackInPromise}get convert(){return this._convert}get convertCopy(){return this._convertCopy}get hidden(){return this._hidden}set hidden(t){this._hidden=t}reviseAttachCellsArea(t,e,o){}reviseAttachCellsPadding(t,e,o){const n=Ot(o);n.inputPadding&&(t[0]+=n.inputPadding[0],t[1]+=n.inputPadding[1],t[2]+=n.inputPadding[2],t[3]+=n.inputPadding[3])}reviseFocusRect(t,e,o){}onDrawCell(t,e,o,n){const{style:r,getRecord:s,clearCellBase:l,drawCellBase:a,getCell:c,getContentHidden:h}=e,d=s(),u=n.getGridCanvasHelper(),g=Ot(n);if(g.cellRange&&v(g.cellRange,o.col,o.row)){a({bgColor:"#FFF"});const t=ko(r,d,this.StyleClass);return void this.drawEditingInternal(o,t,u,n,e)}if(!g.cellRange){const t=o.getSelection(),{col:e,row:n}=o;if(!t.dragged&&v(o.range,t.select.col,t.select.row)&&v(t.range,e,n)){const t=ko(r,d,this.StyleClass);t instanceof ao&&t.inputPadding?g.inputPadding=u.toBoxPixelArray(t.inputPadding,o,t.font):delete g.inputPadding}}let f;if(l(),d){if(C(d)?f=d.then((()=>t)):C(t)&&(f=t),f){const t=Date.now();return f.then((l=>{if(!o.toCurrentContext().getDrawRect())return;const d=Date.now()-t,g=()=>{const t=o.toCurrentContext();if(!t.getDrawRect())return;const i=s();if(C(i))return;const d=ko(r,i,this.StyleClass);d.bgColor?a({bgColor:d.bgColor}):a(),this.isContentHidden(i,h)||(this.drawInternal(this.doConvertInternal(l,c(),n),t,d,u,n,e),this.drawMessageInternal(e.getMessage(),o,d,u,n,e))};let f=this._fadeinWhenCallbackInPromise;if(i(f)||(f=!!n.configure("fadeinWhenCallbackInPromise")),f){const t=o.col,e=o.row;d<80?Ao.margeAnimate(n,t,e,o,g,a):Ao.animate(n,t,e,o,g,a)}else g()}))}{const i=ko(r,d,this.StyleClass);if(i.bgColor?a({bgColor:i.bgColor}):a(),this.isContentHidden(d,h))return;this.drawInternal(this.doConvertInternal(t,c(),n),o,i,u,n,e),this.drawMessageInternal(e.getMessage(),o,i,u,n,e);const s=`${o.col}:${o.row}`,l=n[Io]&&n[Io][s];if(l){const t=o.getContext();t.globalAlpha=1-l.opacity;try{a()}finally{t.globalAlpha=1}}return}}}drawMessageInternal(t,e,o,n,i,r){r.messageHandler.drawCellMessage(t,e,o,n,i,r)}bindGridEvent(t,e){return[]}getCopyCellValue(t,e,o){return t}convertCopyValue(t,e,o){let n=this.convertCopyInternal(t);return this.convertCopy&&(n=this.convertCopy(t,n,e,o)),n}doConvertInternal(t,e,o){let n=this.convertInternal(t);return this.convert&&(n=this.convert(t,n,e,o)),n}convertInternal(t){return i(t)?t:""}convertCopyInternal(t){return this.convertInternal(t)}drawEditingInternal(t,e,o,n,i){}isContentHidden(t,e){let o=w(this.hidden,t);return i(o)||(o=e()),o}}class Oo extends Mo{constructor(t={}){super(t),this._options=ue.normalize(t.options)}get StyleClass(){return Co}get options(){return this._options}clone(){return new Oo(this)}withOptions(t){const e=this.clone();return e._options=ue.normalize(t),e}drawInternal(t,e,o,n,r,{getCell:s,getIcon:l}){const{textAlign:a,textBaseline:c,font:h,padding:d,textOverflow:u,appearance:g}=o;let{color:f}=o;const p=this._convertInternal(t,s(),r);n.testFontLoad(h,p,e),Te(l(),e,n,((o,r)=>{const s=n.toBoxPixelArray(d||0,e,h),l=s.slice(0);l[1]+=26;const _=s.slice(0);_[1]+=8,i(f)||i(t)&&""!==t||(f="rgba(0, 0, 0, .38)"),n.text(p,r,{color:f,font:h,icons:o,padding:l,textAlign:a,textBaseline:c,textOverflow:u}),"menulist-button"===g?n.text("",e,{color:f,font:h,icons:[{color:"rgba(0, 0, 0, .54)",path:"M0 2 5 7 10 2z",width:10}],padding:_,textAlign:"right",textBaseline:c}):"none"!==g&&window.console.warn(`unsupported appearance:${g}`)}))}convertInternal(t){return t}_convertInternal(t,e,o){const n=this._options;for(const e of n)if(e.value===t){t=e.label;break}return super.doConvertInternal(t,e,o)}getCopyCellValue(t,e,o){return this._convertInternal(t,o,e)}}const Do=z("inline_menu_editor.stateID");let Fo=null,Wo=0;function Po(t,e,o,n,i){const r=function(t){let e=t[Do];return e||(e={},S.setReadonly(t,Do,e)),e}(t);Fo||(Fo=new ve),r.element||(r.element=Fo,Wo++,t.addDisposable({dispose(){Wo--,!Wo&&Fo&&(Fo.dispose(),Fo=null)}})),Fo.attach(t,o,e.col,e.row,n,i)}function Ho(t){Fo&&Fo.detach(t)}class zo extends ot{constructor(t={}){super(t),this._classList=t.classList||"",this._options=ue.normalizeToFn(t.options),this._autoWidth=t.autoWidth||!1}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get options(){return this._options}set options(t){this._options=ue.normalizeToFn(t)}get autoWidth(){return this._autoWidth}set autoWidth(t){this._autoWidth=t}clone(){return new zo(this)}onChangeDisabledInternal(){Ho(!0)}onChangeReadOnlyInternal(){Ho(!0)}bindGridEvent(t,e){const o=e=>{const o=!D(this.readOnly,t,e.row)&&!O(this.disabled,t,e.row);return o&&t.doGetCellValue(e.col,e.row,(o=>{const n=t.getRowRecord(e.row);C(n)||Po(t,e,this,o,n)})),o};function n(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(F.CLICK_CELL,(t=>{n(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(F.KEYDOWN,(e=>{if(113!==e.keyCode&&e.keyCode!==W||e.keyCode===W&&e.event.shiftKey)return;const i=t.selection.select;n(i.col,i.row)&&o({col:i.col,row:i.row})&&(I.cancel(e.event),e.stopCellMoving())})),t.listen(F.SELECTED_CELL,(t=>{Ho()})),t.listen(F.SCROLL,(()=>{Ho(!0)})),t.listen(F.MOUSEOVER_CELL,(e=>{n(e.col,e.row)&&(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||(t.getElement().style.cursor="pointer"))})),t.listen(F.MOUSEMOVE_CELL,(e=>{n(e.col,e.row)&&(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||t.getElement().style.cursor||(t.getElement().style.cursor="pointer"))})),t.listen(F.MOUSEOUT_CELL,(e=>{n(e.col,e.row)&&(t.getElement().style.cursor="")})),t.listen(F.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!y(o.start,o.end))return;if(!n(e.col,e.row))return;if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;const i=t.getRowRecord(e.row);if(C(i))return;const r=this._pasteDataToOptionValue(e.normalizeValue,t,e,i);r&&(I.cancel(e.event),m(t.doChangeValue(e.col,e.row,(()=>r.value)),(()=>{const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)})))}))]}onPasteCellRangeBox(t,e,o){if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;const n=t.getRowRecord(e.row);if(C(n))return;const i=this._pasteDataToOptionValue(o,t,e,n);i&&t.doChangeValue(e.col,e.row,(()=>i.value))}onDeleteCellRangeBox(t,e){if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);if(C(o))return;const n=this._pasteDataToOptionValue("",t,e,o);n&&t.doChangeValue(e.col,e.row,(()=>n.value))}_pasteDataToOptionValue(t,e,o,i){const r=this._options(i),s=No(t,r);if(s)return s;const l=e.getColumnType(o.col,o.row);if(function(t){if(t instanceof Oo)return!0;if(Array.isArray(t.options))return!0;return!1}(l)){const e=Vo(t),o=n.find(l.options,(t=>Vo(t.label)===e));if(o)return No(o.value,r)}}}function No(t,e){const o=Vo(t),i=n.find(e,(t=>Vo(t.value)===o));if(i)return i}function Vo(t){return null==t?"":`${t}`.trim()}function $o(t){const e=t.style.minHeight;t.style.minHeight="0px",t.style.height="0px",t.style.height=t.scrollHeight+"px",t.style.minHeight=e}class Uo{constructor(){this._attaching=!1,this._handler=new Lt,this._input=(Bt.inject("InlineTextAreaElement",".kaka-grid__inline-textarea::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-textarea {\n  position: absolute;\n  box-sizing: border-box;\n  overflow: hidden;\n  padding: 0;\n  border: none;\n}\n"),wt("textarea",{classList:"kaka-grid__inline-textarea"})),this._bindInputEvents()}static setInputAttrs(t,e,o){const n=t.classList;n&&o.classList.add(...n)}dispose(){this.detach(),this._handler.dispose(),delete this._beforePropEditor}attach(t,e,o,n,r,s){const l=this._input;if(l.parentElement)return;const a=this._handler;if(this._beforePropEditor){const t=this._beforePropEditor.classList;t&&l.classList.remove(...t)}l.style.font=t.font||"16px sans-serif";const{element:c,rect:h,padding:d}=t.getAttachCellsArea(t.getCellRange(o,n));l.style.top=`${h.top.toFixed()}px`,l.style.left=`${h.left.toFixed()}px`,l.style.minWidth=`${h.width.toFixed()}px`,l.style.width=l.style.minWidth,l.style.minHeight=`${h.height.toFixed()}px`,l.style.height=l.style.minHeight,l.style.paddingTop=`${d[0]}px`,l.style.paddingRight=`${d[1]}px`,l.style.paddingBottom=`${d[2]}px`,l.style.paddingLeft=`${d[3]}px`,c.appendChild(l),Uo.setInputAttrs(e,t,l),function(t,e,o){i(e)?t.value=e:t.value="",t.dataset.before_value=t.value,o&&(t.value=o),$o(t)}(l,r,s),this._activeData={grid:t,col:o,row:n,editor:e},this._beforePropEditor=e;const u=()=>{a.tryWithOffEvents(l,"blur",(()=>{(()=>{l.focus();const t=l.value.length;try{if(void 0!==l.selectionStart)return l.selectionStart=t,void(l.selectionEnd=t)}catch(t){}if(document.selection){const e=l.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}})()}));const e=Ot(t);e.cellRange=t.getCellRange(o,n),t.invalidateCellRange(e.cellRange)};this._attaching=!0,setTimeout((()=>{u(),this._attaching=!1}))}detach(t){if(this._isActive()){const e=this._activeData,o=e.grid,n=e.col,i=e.row,r=this._input;this._handler.tryWithOffEvents(r,"blur",(()=>{r.parentElement&&r.parentElement.removeChild(r)}));delete Ot(o).cellRange;const s=o.getCellRange(n,i);o.invalidateCellRange(s),t&&o.focus()}delete this._activeData}doChangeValue(){var t;if(this._isActive()&&(t=this._input).value!==t.dataset.before_value){const t=function(t){return t.value}(this._input),e=this._activeData,o=e.grid,n=e.col,i=e.row;o.doChangeValue(n,i,(()=>t))}}_isActive(){const t=this._input;return!(!t||!t.parentElement)&&!!this._activeData}_bindInputEvents(){const t=this._handler,e=this._input,o=t=>t.stopPropagation();t.on(e,"click",o),t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"compositionstart",(t=>{e.classList.add("composition")})),t.on(e,"compositionend",(t=>{e.classList.remove("composition")})),t.on(e,"keydown",(t=>{if(e.classList.contains("composition"))return;const o=I.getKeyCode(t);27===o?(this.detach(!0),I.cancel(t)):o===W?this._onKeydownEnter(t,e):9===o&&this._onKeydownTab(t)})),t.on(e,"blur",(t=>{this.doChangeValue(),this.detach()})),t.on(e,"input",(t=>{$o(e)}))}_onKeydownEnter(t,e){var o;if(this._isActive()&&!this._attaching)if(t.altKey||t.ctrlKey)e.setRangeText("\n"),e.selectionStart++,setTimeout((()=>{$o(e)}),0),I.cancel(t);else{const{grid:e}=this._activeData;this.doChangeValue(),this.detach(!0),(null===(o=e.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter)&&e.onKeyDownMove(t),I.cancel(t)}}_onKeydownTab(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)||(this.doChangeValue(),this.detach(!0),o.onKeyDownMove(t))}}const Ko=j();let Go=null,jo=0;function Yo(t,e,o,n,i){Go||(Go=new Uo);const r=o.getState(t);r.element||(r.element=Go,jo++,t.addDisposable({dispose(){jo--,!jo&&Go&&(Go.dispose(),Go=null)}})),Go.attach(t,o,e.col,e.row,n,i)}function Xo(t){Go&&Go.detach(t)}function qo(t){Go&&Go.doChangeValue()}class Zo extends rt{constructor(t={}){super(t),this._classList=t.classList||""}get classList(){return this._classList&&(Array.isArray(this._classList)?this._classList:[this._classList])}set classList(t){this._classList=t}clone(){return new Zo(this)}onActionInputCellInternal(t,e,o){t.doGetCellValue(e.col,e.row,(n=>{Yo(t,e,this,n,o)}))}onActionOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{Yo(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){qo(),Xo()}onGridScrollInternal(t){qo(),Xo(!0)}onChangeDisabledInternal(){Xo(!0)}onChangeReadOnlyInternal(){Xo(!0)}onSetInputAttrsInternal(t,e,o){Uo.setInputAttrs(this,t,o)}getState(t){return t[Ko]||S.setReadonly(t,Ko,{}),t[Ko]}}const Jo=V(),Qo=({grid:t,col:e,row:o})=>{const n=t.getLayoutCellId(e,o),i=o-t.getRecordStartRowByRecordIndex(t.getRecordIndexByRow(o)),r=[],{rowCount:s,recordRowCount:l}=t;for(let o=t.frozenRowCount+i;o<s;o+=l)t.getLayoutCellId(e,o)===n&&r.push({col:e,row:o});return r};class tn extends ot{constructor(t={}){super(t),this._group=t.group||Qo}clone(){return new tn(this)}get group(){return this._group}set group(t){this._group=t}bindGridEvent(t,e){let o=t[Jo];o||(o={block:{},elapsed:{}},S.setReadonly(t,Jo,o));const n=o,i=e=>{this._action(t,e)};return[...J(t,e,{action:i,mouseOver:e=>{if(O(this.disabled,t,e.row))return!1;n.mouseActiveCell={col:e.col,row:e.row};const o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:e=>{delete n.mouseActiveCell;const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}}),...Q(t,e,{action:i}),t.listen(F.PASTE_CELL,(o=>{if(o.multi)return;const n=t.selection.range;if(!y(n.start,n.end))return;if(r=o.col,s=o.row,t.getLayoutCellId(r,s)!==e)return;var r,s;Dt(o.normalizeValue.trim())&&(I.cancel(o.event),i({col:o.col,row:o.row}))}))]}onPasteCellRangeBox(t,e,o){if(D(this.readOnly,t,e.row)||O(this.disabled,t,e.row))return;Dt(o.trim())&&this._action(t,{col:e.col,row:e.row})}onDeleteCellRangeBox(){}_action(t,e){const o=t[Jo],n=t.getCellRange(e.col,e.row),i=`${n.start.col}:${n.start.row}`;D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||o.block[i]||t.doGetCellValue(e.col,e.row,(n=>{if(Dt(n))return;this._group({grid:t,col:e.col,row:e.row}).forEach((({col:n,row:i})=>{const r=t.getCellRange(n,i),s=`${r.start.col}:${r.start.row}`;D(this.readOnly,t,e.row)||O(this.disabled,t,e.row)||o.block[s]||function(t,e,o,n){t.doGetCellValue(e,o,(i=>{if(Dt(i)===n)return;const r=t[Jo],s=t.getCellRange(e,o),l=`${s.start.col}:${s.start.row}`,a=t.doChangeValue(e,o,A);if(a){const e=()=>{ht(200,(e=>{1===e?delete r.elapsed[l]:r.elapsed[l]=e,t.invalidateCellRange(s)}))};C(a)?(r.block[l]=!0,a.then((()=>{delete r.block[l],e()}))):e()}}))}(t,n,i,n===e.col&&i===e.row)}))}))}}const en="kaka-grid__small-dialog-input",on=`${en}__input`,nn=`${en}--hidden`,rn=`${en}--shown`;function sn(t,e){e.tryWithOffEvents(t,"blur",(()=>{(()=>{t.focus();const e=t.value.length;try{if(void 0!==t.selectionStart)return t.selectionStart=e,void(t.selectionEnd=e)}catch(t){}if(document.selection){const o=t.createTextRange();o.collapse(),o.moveEnd("character",e),o.moveStart("character",e),o.select()}})()}))}function ln(t,e,o){const{type:n}=t;o.type=n||""}class an{constructor(){this._handler=new Lt,this._dialog=function(){Bt.inject("smallDialogInputElement",".kaka-grid__small-dialog-input__input::-ms-clear {\n  visibility: hidden;\n}\n\n@keyframes kaka-grid__small-dialog-input--hidden-animation {\n  0% {\n    opacity: 1;\n  }\n  99% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.kaka-grid__small-dialog-input {\n  position: absolute;\n  box-sizing: content-box;\n  margin: -1px auto auto -1px;\n  border-radius: 3px;\n  background-color: #fafafa;\n  transition: padding 150ms ease-out, box-shadow 150ms ease-out;\n}\n\n.kaka-grid__small-dialog-input--hidden {\n  box-shadow: none;\n  padding: 0;\n  pointer-events: none;\n  animation: kaka-grid__small-dialog-input--hidden-animation 150ms ease-out;\n  opacity: 0;\n}\n\n.kaka-grid__small-dialog-input--shown {\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  padding: 8px 24px;\n}\n\n.kaka-grid__small-dialog-input__input {\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  padding: 3px 2px 0 4px;\n  border: none;\n  border-bottom: solid 1px rgba(0, 0, 0, 0.87);\n  outline: none;\n  background-color: transparent;\n  transition: all 300ms ease-out;\n}\n\n.kaka-grid__small-dialog-input__input:focus {\n  border-bottom: solid 1px #2196f3;\n  box-shadow: 0 1px 0 0 #2196f3;\n}\n\n.kaka-grid__small-dialog-input::after {\n  content: '';\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  display: block;\n  width: 100%;\n  padding-top: 8px;\n}\n\n.kaka-grid__small-dialog-input.helper-text--right-justified::after {\n  text-align: right;\n}\n\n.kaka-grid__small-dialog-input[data-helper-text]::after {\n  content: attr(data-helper-text);\n  color: rgba(0, 0, 0, 0.87);\n}\n\n.kaka-grid__small-dialog-input[data-error-message] input {\n  border-bottom: solid 1px #ff1744;\n  box-shadow: 0 1px 0 0 #ff1744;\n}\n\n.kaka-grid__small-dialog-input[data-error-message]::after {\n  content: attr(data-error-message);\n  color: #ff1744;\n  text-align: left;\n}\n");const t=wt("div",{classList:[en,nn]}),e=wt("input",{classList:on});return e.tabIndex=-1,t.appendChild(e),t}(),this._input=this._dialog.querySelector(`.${on}`),this._bindDialogEvents()}static setInputAttrs(t,e,o){ln(t,0,o)}dispose(){const t=this._dialog;this.detach(),this._handler.dispose(),this._beforePropEditor=null,t.parentElement&&t.parentElement.removeChild(t)}attach(t,e,o,n,i){const r=this._handler,s=this._dialog,l=this._input;this._beforePropEditor&&function(t,e,o,n){const{classList:i}=n;i&&e.classList.remove(...i),delete e.dataset.helperText,o.type=""}(0,s,l,this._beforePropEditor),delete s.dataset.errorMessage,s.classList.remove(rn),s.classList.add(nn),l.tabIndex=0;const{element:a,rect:c}=t.getAttachCellsArea(t.getCellRange(o,n));s.style.top=`${c.top.toFixed()}px`,s.style.left=`${c.left.toFixed()}px`,s.style.width=`${c.width.toFixed()}px`,l.style.height=`${c.height.toFixed()}px`,a.appendChild(s),At(l,i),l.style.font=t.font||"16px sans-serif";const h={grid:t,col:o,row:n,editor:e};this._onInputValue(l,h),b?setTimeout((()=>sn(l,r))):sn(l,r),s.classList.add(rn),s.classList.remove(nn),function(t,e,o,n){const{classList:i,helperText:r}=n;i&&e.classList.add(...i),r&&"function"!=typeof r&&(e.dataset.helperText=r),ln(n,0,o)}(0,s,l,e),this._activeData=h,this._beforePropEditor=e,this._attaching=!0,setTimeout((()=>{delete this._attaching}))}detach(t){if(this._isActive()){const e=this._dialog,o=this._input;e.classList.remove(rn),e.classList.add(nn),o.tabIndex=-1;const{grid:n,col:i,row:r}=this._activeData,s=n.getCellRange(i,r);n.invalidateCellRange(s),t&&n.focus()}this._activeData=null,this._beforeValue=null}_doChangeValue(){if(!this._isActive())return!1;const t=this._input,{value:e}=t;return m(this._validate(e),(o=>{if(o&&e===t.value){const{grid:t,col:o,row:n}=this._activeData;return t.doChangeValue(o,n,(()=>e)),!0}return!1}))}_isActive(){const t=this._dialog;return!(!t||!t.parentElement)&&!!this._activeData}_bindDialogEvents(){const t=this._handler,e=this._dialog,o=this._input,n=t=>t.stopPropagation();t.on(e,"click",n),t.on(e,"dblclick",n),t.on(e,"mousedown",n),t.on(e,"touchstart",n),t.on(o,"compositionstart",(t=>{o.classList.add("composition")})),t.on(o,"compositionend",(t=>{o.classList.remove("composition"),this._onInputValue(o)}));const i=t=>{o.classList.contains("composition")||this._onInputValue(o)};t.on(o,"keyup",i),t.on(o,"keypress",i),t.on(o,"keydown",(t=>{if(o.classList.contains("composition"))return;const e=I.getKeyCode(t);27===e?(this.detach(!0),I.cancel(t)):e===W?this._onKeydownEnter(t):9===e?this._onKeydownTab(t):this._onInputValue(o)}))}_onKeydownEnter(t){if(this._attaching)return;const e=this._input,{value:o}=e;m(this._doChangeValue(),(n=>{var i;if(n&&o===e.value){const e=this._isActive()?this._activeData.grid:null;this.detach(!0),(null===(i=null==e?void 0:e.keyboardOptions)||void 0===i?void 0:i.moveCellOnEnter)&&e.onKeyDownMove(t)}})),I.cancel(t)}_onKeydownTab(t){var e;if(!this._isActive()||this._attaching)return;const{grid:o}=this._activeData;if(!(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab))return;const n=this._input,{value:i}=n;m(this._doChangeValue(),(e=>{e&&i===n.value&&(this.detach(!0),o.onKeyDownMove(t))})),I.cancel(t)}_onInputValue(t,e){const o=this._beforeValue,{value:n}=t;o!==n&&this._onInputValueChange(n,e),this._beforeValue=n}_onInputValueChange(t,e){e=e||this._activeData;const o=this._dialog,{grid:n,col:i,row:r,editor:s}=e;if("function"==typeof s.helperText){const e=s.helperText(t,{grid:n,col:i,row:r});e?o.dataset.helperText=e:delete o.dataset.helperText}"errorMessage"in o.dataset&&this._validate(t,!0)}_validate(t,e){const o=this._dialog,n=this._input,{grid:i,col:r,row:s,editor:l}=this._activeData;let a="";return l.inputValidator&&(a=l.inputValidator(t,{grid:i,col:r,row:s})),m(a,(a=>(a||!l.validator||e||(a=l.validator(t,{grid:i,col:r,row:s})),m(a,(e=>(e&&t===n.value?o.dataset.errorMessage=e:delete o.dataset.errorMessage,!e))))))}}const cn=z("small_dialog_input_editor.stateID");let hn=null,dn=0;function un(t,e,o,n){const i=function(t){let e=t[cn];return e||(e={},S.setReadonly(t,cn,e)),e}(t);hn||(hn=new an),i.element||(i.element=hn,dn++,t.addDisposable({dispose(){dn--,!dn&&hn&&(hn.dispose(),hn=null)}})),hn.attach(t,o,e.col,e.row,n)}function gn(t){hn&&hn.detach(t)}class fn extends it{constructor(t={}){super(t),this._helperText=t.helperText,this._inputValidator=t.inputValidator,this._validator=t.validator,this._classList=t.classList||"",this._type=t.type||""}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}get helperText(){return this._helperText}get inputValidator(){return this._inputValidator}get validator(){return this._validator}clone(){return new fn(this)}onInputCellInternal(t,e,o){un(t,e,this,o)}onOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{un(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){gn()}onGridScrollInternal(t){gn(!0)}onChangeDisabledInternal(){gn(!0)}onChangeReadOnlyInternal(){gn(!0)}onSetInputAttrsInternal(t,e,o){an.setInputAttrs(this,t,o)}}const pn={CHECK:new class extends ft{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},RADIO:new class extends tn{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},INPUT:new class extends fn{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},SWITCH:new class extends _t{get disabled(){return this._disabled}get readOnly(){return this._readOnly}}};class _n extends Mo{constructor(t={}){super(t),this._draw=t.draw}get draw(){return this._draw}drawInternal(t,e,o,n,r,{getRecord:s}){const{textAlign:l,textBaseline:a,borderColor:c,checkBgColor:h,uncheckBgColor:d}=o;if(!Me(n,this.draw,t,e,r,s())){const{col:o,row:s}=e,u=r.getCellRange(o,s),g=`${u.start.col}:${u.start.row}`,f=this.getState(r),p=null==f?void 0:f.elapsed[g],_={borderColor:c,checkBgColor:h,textAlign:l,textBaseline:a,uncheckBgColor:d};i(p)&&(_.animElapsedTime=p),this.doDrawInternal(n,t,e,_)}}convertInternal(t){return Dt(t)}}let wn;const Cn=(t,e)=>{switch(e%3){case 0:return"#979797";case 1:return"#008fb5";case 2:return"#f1c109"}return"#979797"};class mn extends ro{constructor(t={}){super(t),this._branchColors=t.branchColors||Cn,this._margin=t.margin||4,this._circleSize=t.circleSize||16,this._branchLineWidth=t.branchLineWidth||4,this._mergeStyle="straight"===t.mergeStyle?"straight":"bezier"}static get DEFAULT(){return wn||(wn=new mn)}get branchColors(){return this._branchColors}set branchColors(t){this._branchColors=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}get circleSize(){return this._circleSize}set circleSize(t){this._circleSize=t,this.doChangeStyle()}get branchLineWidth(){return this._branchLineWidth}set branchLineWidth(t){this._branchLineWidth=t,this.doChangeStyle()}get mergeStyle(){return this._mergeStyle}set mergeStyle(t){this._mergeStyle=t,this.doChangeStyle()}clone(){return new mn(this)}}class yn{constructor({fromIndex:t,toIndex:e,colorIndex:o,point:n}){this.fromIndex=t,this.toIndex=e,this.colorIndex=o,this.point=n}}class vn{constructor({index:t,commit:e=!1,lines:o=[],tag:n}){this.index=t,this.commit=e,this.lines=o,this.tag=n}static mergeLines(t){const e=t.filter((t=>i(t.fromIndex)&&i(t.toIndex))),o=t.filter((t=>i(t.fromIndex)&&!i(t.toIndex))),n=t.filter((t=>!i(t.fromIndex)&&i(t.toIndex)));return o.forEach((t=>{for(let e=0;e<n.length;e++){const o=n[e];if(!o.point&&t.colorIndex===o.colorIndex){t.toIndex=o.toIndex,n.splice(e,1);break}}e.push(t)})),e.concat(n)}static merge(t,e){return t?new vn({commit:t.commit||e.commit,index:t.index,lines:vn.mergeLines(t.lines.concat(e.lines)),tag:t.tag||e.tag}):e}}const bn=z("branch_graph_col.stateID");function xn(t,e){const o=[...t].reverse();for(let t=0;t<o.length;t++){const n=o[t][e];if(n){n.lines=vn.mergeLines(n.lines.concat([new yn({colorIndex:e,toIndex:e})]));for(let n=0;n<t;n++){o[n][e]=new vn({index:e,lines:[new yn({colorIndex:e,fromIndex:e,toIndex:e})]})}return!0}}return!1}function Rn(t,e){const{timeline:o}=t,n=[];(Array.isArray(e)?e:[e]).forEach((e=>{if(!e)return;let o;if("branch"===e.command){const n=S.isObject(e.branch)?e.branch.from:null,i=S.isObject(e.branch)?e.branch.to:e.branch;o=function({timeline:t,branches:e},o,n){const i=null!=o?e.indexOf(o):-1;let r=e.indexOf(n);if(r<0&&(r=e.length,e.push(n)),i<0)return new vn({index:r});{const e=function(){for(let e=t.length-1;e>=0;e--){const o=t[e][i];if(o&&o.commit)return e}return-1}();if(-1===e)return null;const o=e+1,n=new vn({index:r,lines:[new yn({colorIndex:r,fromIndex:i})]});let s,l=null;if(o<t.length){const e=t[o];s=e[r]=vn.merge(e[r],n)}else s=n,l=n;const a=t[e][i];return a.lines=vn.mergeLines(a.lines.concat([new yn({colorIndex:r,point:s,toIndex:r})])),l}}(t,n,i)}else if("commit"===e.command)o=function({timeline:t,branches:e},o){const n=e.indexOf(o);if(n<0)return null;const i=new vn({commit:!0,index:n});return xn(t,n)&&(i.lines=vn.mergeLines(i.lines.concat([new yn({colorIndex:n,fromIndex:n})]))),i}(t,e.branch);else if("merge"===e.command){const n=e.branch.from,i=e.branch.to;o=function({timeline:t,branches:e},o,n){const i=e.indexOf(o),r=e.indexOf(n);if(r<0||i<0)return new vn({index:r,commit:!0});const s=new vn({index:r,commit:!0,lines:[new yn({colorIndex:i,fromIndex:i}),new yn({colorIndex:r,fromIndex:r})]}),l=[...t],a=l.pop();return a&&(a[i]=vn.merge(a[i],new vn({index:r,lines:[new yn({colorIndex:i,toIndex:r})]}))),xn(l,i)&&a&&(a[i].lines=vn.mergeLines(a[i].lines.concat([new yn({colorIndex:i,fromIndex:i})]))),xn(t,r),s}(t,n,i)}else"tag"===e.command&&(o=function({branches:t},e,o){let n=t.indexOf(e);return n<0&&(n=t.length,t.push(e)),new vn({index:n,tag:o})}(t,e.branch,e.tag));o&&o.index>-1&&(n[o.index]=vn.merge(n[o.index],o))})),o.push(n)}function En(t,e,o){const n={branches:[],timeline:[]};return function(t,e,o){const{dataSource:n}=t,i=[];let r;for(let t=0;t<n.length;t++){const o=n.getField(t,e);if(C(o)){const t=i.length;i.push(void 0),r=r?r.then((()=>o)).then((e=>{i[t]=e})):o.then((e=>{i[t]=e}))}else i.push(o)}r?r.then((()=>o(i))):o(i)}(e,o,(e=>{"top"!==t&&(e=[...e].reverse()),e.forEach((t=>{Rn(n,t)}))})),n}class Ln extends Mo{constructor(t={}){super(t),this._start=t.start||"bottom",this._cache=!!i(t.cache)&&t.cache}get StyleClass(){return mn}clearCache(t){delete t[bn]}onDrawCell(t,e,o,n){if(this._cache){const t=n[bn]||(n[bn]=new Map),{col:e,row:i}=o,r=n.getField(e,i);t.has(r)||t.set(r,En(this._start,n,r))}return super.onDrawCell(t,e,o,n)}clone(){return new Ln(this)}drawInternal(t,e,o,n,r,s){var l,a;const{col:c,row:h}=e,d=r.getField(c,h),{timeline:u,branches:g}=null!==(a=this._cache?null===(l=r[bn])||void 0===l?void 0:l.get(d):null)&&void 0!==a?a:En(this._start,r,d),{upLineIndexKey:f,downLineIndexKey:p}="top"!==this._start?{upLineIndexKey:"toIndex",downLineIndexKey:"fromIndex"}:{upLineIndexKey:"fromIndex",downLineIndexKey:"toIndex"},_="top"!==this._start?u[u.length-(h-r.frozenRowCount)-1]:u[h-r.frozenRowCount],{branchColors:C,branchLineWidth:m,circleSize:y,mergeStyle:v,margin:b}=o,x=e.getRect(),R=y/2,E=x.width-2*b;n.drawWithClip(e,(t=>{t.textAlign="left",t.textBaseline="middle";const e=function(t,e,o,n,i,r){let s=Math.max(o/i.length+1,5);r.forEach((e=>{e.forEach(((e,i)=>{if(!(i<=0)&&e.tag){const r=t.measureText(e.tag).width;s*i+2*n+4+r>o&&(s=Math.max((o-2*n-4-r)/i,5))}}))}));const l=[];let a=e;return i.forEach((()=>{l.push(Math.ceil(a+n)),a+=s})),l}(t,x.left+b,E,R,g,u),o=x.top+x.height/2;_.map(((t,e)=>t?t.lines.map((t=>({colorIndex:t.colorIndex,downLineIndex:t[p],pointIndex:e,upLineIndex:t[f]}))):[])).reduce(((t,e)=>t.concat(e)),[]).sort(((t,e)=>e.colorIndex-t.colorIndex)).forEach((n=>{const s=e[n.pointIndex];!function(t,e,o,n,r,s,l,{branchXPoints:a,branchColors:c,branchLineWidth:h,mergeStyle:d},{col:u,row:g,branches:f}){if(i(r)||i(s)){if(e.strokeStyle=w(c,f[l],l),e.lineWidth=h,e.lineCap="round",e.beginPath(),i(r)){const i=a[r],s=t.getCellRelativeRect(u,g-1),l=s.top+s.height/2;e.moveTo(i,l),"bezier"===d?e.bezierCurveTo(i,(n+l)/2,o,(n+l)/2,o,n):e.lineTo(o,n)}else e.moveTo(o,n);if(i(s)){const i=a[s],r=t.getCellRelativeRect(u,g+1),l=r.top+r.height/2;"bezier"===d?e.bezierCurveTo(o,(n+l)/2,i,(n+l)/2,i,l):e.lineTo(i,l)}e.stroke()}}(r,t,s,o,n.upLineIndex,n.downLineIndex,n.colorIndex,{branchColors:C,branchLineWidth:m,branchXPoints:e,margin:b,mergeStyle:v},{branches:g,col:c,row:h,width:E})})),_.forEach(((n,i)=>{if(n&&n.commit){const n=e[i];t.fillStyle=w(C,g[i],i),t.beginPath(),t.arc(n,o,R,0,2*Math.PI,!0),t.fill(),t.closePath()}})),_.forEach(((n,i)=>{n&&n.tag&&(t.fillStyle=w(C,g[i],i),t.fillText(n.tag,e[i]+R+4,o))}))}))}}const Sn=G();class kn extends Mo{constructor(t={}){super(t),this._draw=t.draw,this._cellStyle=t.cellStyle}get StyleClass(){return ao}clone(){return new kn(this)}get draw(){return this._draw}get cellStyle(){return this._cellStyle}reviseAttachCellsArea(t,e,o){De(t,e,o,this._cellStyle)}reviseAttachCellsPadding(t,e,o){super.reviseAttachCellsPadding(t,e,o),Fe(t,e,o,this._cellStyle)}drawInternal(t,e,o,n,i,{getIcon:r,getRecord:s}){const{textAlign:l,textBaseline:a,color:c,font:h,textOverflow:d}=o;n.testFontLoad(h,t,e),Te(r(),e,n,((r,u)=>{Me(n,this.draw,t,e,i,s())||n.text(t,u,{color:c,font:h,icons:r,padding:Be(e,n,o),textAlign:l,textBaseline:a,textOverflow:d}),Ae(i,e,Sn,n,o),We(0,s(),e,n,this._cellStyle)}))}}const In=U();class Tn extends kn{constructor(t={}){super(t),this._caption=t.caption,this._linkButton=!!t.linkButton}get StyleClass(){return co}get caption(){return this._caption}withCaption(t){const e=this.clone();return e._caption=t,e}clone(){return new Tn(this)}drawInternal(t,e,o,n,i,{getIcon:r}){const{textAlign:s,textBaseline:l,color:a,buttonBgColor:c,font:h,padding:d,textOverflow:u}=o;n.testFontLoad(h,t,e);const{col:g,row:f}=e,p=i.getCellRange(g,f);let _=!1,w=!1;const C=i[In];if(C){C.mouseActiveCell&&v(p,C.mouseActiveCell.col,C.mouseActiveCell.row)&&(_=!0);const{select:t}=e.getSelection();v(p,t.col,t.row)&&(w=!0)}Te(r(),e,n,((e,o)=>{if(this._linkButton){if(_&&C&&C.mouseRelativePos){const i=n.getTextRect(t,o,{font:h,icons:e,padding:d,textAlign:s,textBaseline:l,textOverflow:u});_=i.left<=C.mouseRelativePos.x&&i.right>=C.mouseRelativePos.x&&i.top<=C.mouseRelativePos.y&&i.bottom>=C.mouseRelativePos.y,C.mouseActive=_}n.text(t,o,{color:_?c||n.theme.button.bgColor:a,font:h,icons:e,padding:d,textAlign:s,textBaseline:l,textOverflow:u})}else _&&(C.mouseActive=_),n.button(t,o,{bgColor:c,color:a,font:h,icons:e,padding:d,shadow:_||w?{blur:6,color:"rgba(0, 0, 0, 0.48)",offsetY:3}:{},textAlign:s,textBaseline:l,textOverflow:u})}))}convertInternal(t){return this._caption||super.convertInternal(t)}}const Bn=N();class An extends _n{get StyleClass(){return ho}clone(){return new An(this)}getState(t){let e=t[Bn];return e||(e={block:{},elapsed:{}},S.setReadonly(t,Bn,e)),e}doDrawInternal(t,e,o,n){t.checkbox(e,o,n)}}const Mn=$();class On extends _n{get StyleClass(){return uo}clone(){return new On(this)}getState(t){let e=t[Mn];return e||(e={block:{},elapsed:{}},S.setReadonly(t,Mn,e)),e}doDrawInternal(t,e,o,n){t.switch(e,o,n)}}let Dn;class Fn extends kn{constructor(t={}){super(t),this._format=t.format}static get defaultFormat(){return Dn||(Dn=new Intl.DateTimeFormat)}static set defaultFormat(t){Dn=t}get StyleClass(){return go}get format(){return this._format}clone(){return new Fn(this)}withFormat(t){const e=this.clone();return e._format=t,e}convertInternal(t){if(t instanceof Date){return(this._format||Fn.defaultFormat).format(t)}return""}}const Wn=G();class Pn extends Mo{constructor(t={}){super(t),this._draw=t.draw}get StyleClass(){return fo}clone(){return new Pn(this)}get draw(){return this._draw}drawInternal(t,e,o,n,i,{getRecord:r}){Me(n,this.draw,t,e,i,r()),Ae(i,e,Wn,n,o)}}class Hn extends kn{constructor(t={}){super(t),this._tagName=t.tagName||"i",this._className=t.className,this._content=t.content,this._name=t.name,this._iconWidth=t.iconWidth}get StyleClass(){return po}clone(){return new Hn(this)}drawInternal(t,e,o,n,i,r){const s=Number(t);if(isNaN(s))r.getIcon=()=>null;else{const t={};ke.iconPropKeys.forEach((e=>{t[e]=o[e]})),t.className=this._className,t.tagName=this._tagName,t.content=this._content,t.name=this._name,this._iconWidth&&(t.width=this._iconWidth),r.getIcon=()=>function(t,e){e===1/0&&(e=0);const o=[];for(let n=0;n<e;n++)o.push(t);return o}(t,s)}super.drawInternal("",e,o,n,i,r)}}const zn={};function Nn(t,e){const o=e||t.font;if(zn[o])return zn[o];const n=t.font;try{t.font=o;const e=t.measureText("").width;return zn[o]={height:e,width:e}}finally{t.font=n}}function Vn(t,e,o,n,{offset:i=0,padding:{left:r=0,right:s=0,top:l=0,bottom:a=0}={}}={}){const c=t.textAlign||"left",h=t.textBaseline||"middle";t.textAlign=c,t.textBaseline=h;let d=e.left+i+r;"right"===c||"end"===c?d=e.right-o-i-s:"center"===c&&(d=e.left+(e.width-o+r-s)/2);let u=e.top+i+l;return"bottom"===h||"alphabetic"===h||"ideographic"===h?u=e.bottom-n-i-a:"middle"===h&&(u=e.top+(e.height-n+l-a)/2),{x:d,y:u}}class $n{constructor(t){this._list=[],this._map={},this._cacheSize=t||50}get(t){const e=this._map[t];if(e){const e=this._list,o=e.indexOf(t);e.splice(o,1),e.push(t)}return e}put(t,e){const o=this._list,n=this._map;if(n[t]){const e=o.indexOf(t);o.splice(e,1)}if(n[t]=e,o.push(t),o.length>this._cacheSize){delete n[o.shift()||""]}}}const Un={};function Kn(t,e){return m(e,(e=>{const o=t.get(e);if(o)return o;const n=function(t){if("undefined"==typeof Promise)return window.console.error("Promise is not loaded. load Promise before this process."),{then(){return this}};const e=new Image,o=new Promise((t=>{e.onload=()=>{t(e)}}));return e.onerror=()=>{const e=t.length>200?`${t.substr(0,200)}...`:t;throw console.warn(`cannot load: ${e}`),new Error(`IMAGE LOAD ERROR: ${e}`)},e.src=t,o}(e).then((o=>(t.put(e,o),o)));return t.put(e,n),n}))}function Gn(t,e,o){return Kn(Un[t]||(Un[t]=new $n(e)),o)}const jn=G();class Yn extends Mo{get StyleClass(){return _o}onDrawCell(t,e,o,n){const i=t?Gn("ImageColumn",50,t):"";return super.onDrawCell(i,e,o,n)}clone(){return new Yn(this)}drawInternal(t,e,o,n,i,r){const{textAlign:s,textBaseline:l,margin:a}=o;t&&n.drawWithClip(e,(i=>{i.textAlign=s,i.textBaseline=l;const r=e.getRect().copy(),c=Be(e,n,o);if(r.width-=c[1],r.width<0&&(r.width=0),"keep-aspect-ratio"===o.imageSizing){const e=function(t,e,o,n){let i=t,r=e;return i>o&&(i=o,r=i*e/t),r>n&&(r=n,i=r*t/e),{height:r,width:i}}(t.width,t.height,r.width-2*a,r.height-2*a),o=e.width,n=e.height,s=Vn(i,r,o,n,{offset:a});i.drawImage(t,0,0,t.width,t.height,s.x,s.y,o,n)}else i.drawImage(t,0,0,t.width,t.height,r.left+a,r.top+a,r.width-2*a,r.height-2*a)})),Ae(i,e,jn,n,o)}}const Xn=Y();let qn="";class Zn extends Mo{constructor(t={}){super(t),this._lookupMap={},this._records=t.records,this._valueField=t.valueField,this._captionField=t.captionField,this._draw=t.draw,this._cellStyle=t.cellStyle}get StyleClass(){return wo}get records(){return this._records}get valueField(){return this._valueField}get captionField(){return this._captionField}get draw(){return this._draw}get cellStyle(){return this._cellStyle}reviseAttachCellsArea(t,e,o){De(t,e,o,this._cellStyle)}reviseAttachCellsPadding(t,e,o){super.reviseAttachCellsPadding(t,e,o),Fe(t,e,o,this._cellStyle)}clone(){return new Zn(this)}drawInternal(t,e,o,n,r,s){const l=s.getIcon,a=s.getCell,c=s.getRecord,h=w(this.records||[],c());if(C(h)){const t=a(),e=t.col,o=t.row;if(!qn)return void h.then(((t,e,o)=>n=>{qn=String(e);try{t._mergeRecords(n);const i=r.getCellRange(e,o);r.invalidateCellRange(i)}finally{qn=""}})(this,e,o))}else this._mergeRecords(h);const d=o.textAlign,u=o.textBaseline,g=o.font,f=o.textOverflow;let p=o.color;const _=this._convertInternal(t,a(),r);n.testFontLoad(g,_,e),Te(l(),e,n,((s,l)=>{Me(n,this.draw,_,e,r,c())||(i(p)||i(t)&&""!==t||(p="rgba(0, 0, 0, .38)"),n.text(_,l,{color:p,font:g,icons:s,padding:Be(l,n,o),textAlign:d,textBaseline:u,textOverflow:f})),Ae(r,l,Xn,n,o),We(0,c(),e,n,this._cellStyle)}))}convertCopyInternal(t){return i(t)?this._convertInternalValue(t):""}convertInternal(t){return t}doConvertInternal(t,e,o){return this.convertInternal(t)}_convertInternalValue(t){const e=i(t)?t+"":"";let o=this._lookupMap[e];return i(o)||(o=e),o}_convertInternal(t,e,o){let n=this._convertInternalValue(t);return this.convert&&(n=this.convert(t,n,e,o)),this.doConvertInternal(n,e,o)}_mergeRecords(t=[]){const e=this.valueField||"id",o=this.captionField||e;for(const n of t){let t=n[e];t=i(t)?t+"":"";let r=n[o];r=i(r)?r+"":"",this._lookupMap[t]=r}}}const Jn=j();class Qn extends Mo{constructor(t={}){super(t),this._draw=t.draw,this._cellStyle=t.cellStyle}get StyleClass(){return mo}clone(){return new Qn(this)}get draw(){return this._draw}get cellStyle(){return this._cellStyle}reviseAttachCellsArea(t,e,o){De(t,e,o,this._cellStyle)}reviseAttachCellsPadding(t,e,o){super.reviseAttachCellsPadding(t,e,o),Fe(t,e,o,this._cellStyle)}drawInternal(t,e,o,n,r,{getIcon:s,getRecord:l}){const{textAlign:a,textBaseline:c,color:h,font:d,lineHeight:u,autoWrapText:g,lineClamp:f,textOverflow:p}=o,_=i(t)?t+"":"",w=_.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(d,_,e),Te(s(),e,n,((t,i)=>{Me(n,this.draw,w,e,r,l())||n.multilineText(w,i,{autoWrapText:g,color:h,font:d,icons:t,lineClamp:f,lineHeight:u,padding:Be(e,n,o),textAlign:a,textBaseline:c,textOverflow:p}),Ae(r,e,Jn,n,o),We(0,l(),e,n,this._cellStyle)}))}}let ti;class ei extends kn{constructor(t={}){super(t),this._format=t.format}static get defaultFormat(){return ti||(ti=new Intl.NumberFormat)}static set defaultFormat(t){ti=t}get StyleClass(){return yo}get format(){return this._format}clone(){return new ei(this)}withFormat(t){const e=this.clone();return e._format=t,e}convertInternal(t){let e=(t+"").trim();return e&&(e-=0,e=isNaN(e)?"":(this._format||ei.defaultFormat).format(e)),e}}class oi extends kn{constructor(t={}){super(t),this._min=t.min||0,this._max=t.max||this._min+100,this._formatter=t.formatter||(t=>t)}get StyleClass(){return bo}clone(){return new oi(this)}drawInternal(t,e,o,n,i,r){super.drawInternal(this._formatter(t),e,o,n,i,r);const s=o.barColor,l=o.barBgColor,a=o.barHeight;let c=`${t}`;k.endsWith(c,"%")&&(c=c.substr(0,c.length-1));const h=Number(c),d=h<this._min?0:h>this._max?1:(h-this._min)/(this._max-this._min);n.drawWithClip(e,(t=>{const o=e.getRect(),n=o.width-4-1,i=o.bottom-2-a-1,r=o.left+2;t.fillStyle=w(l,100*d)||"#f0f3f5",t.beginPath(),t.rect(r,i,n,a),t.fill();const c=Math.min(n*d,n);t.fillStyle=w(s,100*d)||"#20a8d8",t.beginPath(),t.rect(r,i,c,a),t.fill()}))}}function ni(t,e,o){return new Promise((n=>{const i=[],r=new Array(o);for(let e=0;e<o;e++){const o=t(e),n={v:o,f:o};r[e]=n,C(o)&&i.push(o.then((t=>{n.v=t,n.f=t})))}Promise.all(i).then((()=>null==e?r:function(t,e){return new Promise((o=>{const{length:n}=t,i=[];for(let o=0;o<n;o++){const n=t[o],r=e(n.v);C(r)?i.push(r.then((t=>{n.f=t}))):n.f=r}Promise.all(i).then((()=>o(t)))}))}(r,e))).then(n)}))}function ii(t,e,o,n,i){const r=function(t,e){const o=new Array(e);for(let n=0;n<e;n++)o[n]=t(n);return o}(t,o);null!=i?r.sort(((t,e)=>n(i(t),i(e)))):r.sort(n);for(let t=0;t<o;t++)e(t,r[t])}function ri(t){if(S.isObject(t)){const e=t;if(e.get&&e.set)return!0}return!1}const si={REFRESH_DATA:"refresh_data",UPDATED_LENGTH:"updated_length",UPDATED_ORDER:"updated_order",UPDATE_LENGTH:"update_length"};function li(t,e){const o=w(t);if(C(o)){const t=o.then((t=>(e(t),t)));return e(t),t}return o}function ai(t,e,o){if(!i(t))return;if(C(t))return t.then((t=>ai(t,e,o)));const n=ri(e)?e.get:e;if("string"==typeof n&&n in t){return li(t[n],o)}if("function"==typeof n){return li(n(t),o)}const r=`${n}`.split(".");if(r.length<=1){return li(t[n],o)}return li(p(t,((t,e)=>ai(t,e,B)),...r),o)}function ci(t,e,o){if(null==t)return!1;const n=ri(e)?e.set:e;if("string"==typeof n&&n in t)t[n]=o;else{if("function"==typeof n)return n(t,o);if("string"==typeof n){const e=`${n}`.split(".");let i=t;const{length:r}=e;for(let t=0;t<r;t++){const n=e[t];t===r-1?i[n]=o:i=i[n]||(i[n]={})}}else t[n]=o}return!0}function hi(t,e){if(!t)return e;const o=t[e];return i(o)?o:e}class di extends Ne{constructor(t){var e;super(),this._sortedIndexMap=null,this._get=(null==t?void 0:t.get.bind(t))||void 0,this._length=(null==t?void 0:t.length)||0,this._source=null!==(e=null==t?void 0:t.source)&&void 0!==e?e:t}static get EVENT_TYPE(){return si}static ofArray(t){return new di({get:e=>t[e],length:t.length,source:t})}get source(){return this._source}get(t){return this.getOriginal(hi(this._sortedIndexMap,t))}getField(t,e){return this.getOriginalField(hi(this._sortedIndexMap,t),e)}hasField(t,e){return this.hasOriginalField(hi(this._sortedIndexMap,t),e)}setField(t,e,o){return this.setOriginalField(hi(this._sortedIndexMap,t),e,o)}sort(t,e){const o=new Array(this._length),n="desc"!==e?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1;return function(t,e,o,n,i){if("undefined"!=typeof Promise)return ni(t,i,o).then((t=>{t.sort(((t,e)=>n(t.f,e.f)));for(let n=0;n<o;n++)e(n,t[n].v)}));{ii(t,e,o,n,i);const r={then:t=>(t(),r),catch:()=>r};return r}}((t=>i(o[t])?o[t]:o[t]=t),((t,e)=>{o[t]=e}),this._length,n,(e=>this.getOriginalField(e,t))).then((()=>{this._sortedIndexMap=o,this.fireListeners(si.UPDATED_ORDER)}))}get length(){return this._length}set length(t){this._length!==t&&this.setLength(t)}refresh(){this.refreshInternal(),this.fireListeners(si.REFRESH_DATA)}get dataSource(){return this}dispose(){super.dispose()}getOriginal(t){return li(this._get(t),(e=>{this.recordPromiseCallBackInternal(t,e)}))}getOriginalField(t,e){if(!i(e))return;return ai(this.getOriginal(t),e,(o=>{this.fieldPromiseCallBackInternal(t,e,o)}))}hasOriginalField(t,e){if(!i(e))return!1;if("function"==typeof e)return!0;const o=this.getOriginal(t);return Boolean(o&&"string"==typeof e&&e in o)}setOriginalField(t,e,o){if(!i(e))return!1;const n=this.getOriginal(t);return C(n)?n.then((t=>ci(t,e,o))):ci(n,e,o)}fieldPromiseCallBackInternal(t,e,o){}recordPromiseCallBackInternal(t,e){}refreshInternal(){}setLength(t){const e=this.fireListeners(si.UPDATE_LENGTH,t);n.findIndex(e,(t=>!t))>=0||(this._length=t,this.fireListeners(si.UPDATED_LENGTH,this._length))}}function ui(t,e,o){const n=e[t.options.keyField];t._levelMap[n]=o;const i=t._pIdMap[n]||[];for(const e of i)ui(t,e,o+1)}function gi(t,e){if(e&&e.length>0){const o=e[e.length-1][t.options.keyField];t._lastMap[o]=!0}}function fi(t,e){const o=e[t.options.keyField],n=t._pIdMap[o]||[];if(n.length>0){t._expandMap[o]=!0;for(const e of n)fi(t,e)}}function pi(t,e){let o=[];const n=e[t.options.keyField];if(t._expandMap[n]){const e=t._pIdMap[n]||[];for(const n of e)o.push(n),o=o.concat(pi(t,n))}return o}function _i(t,e){const o=t._records[e][t.options.keyField],n=t._levelMap[o];let i=0;for(let o=e+1;o<t._records.length;o++){const e=t._records[o][t.options.keyField];if(!(n<t._levelMap[e]))break;i++}return i}function wi(t,e,o,n,i){if(e){const r=t._records.indexOf(e),s=e[t._options.keyField];t._pIdMap[s]?(t._expandMap[s]?o&&(fi(t,e),t._records.splice(r+1,_i(t,r),...pi(t,e))):(o?fi(t,e):t._expandMap[s]=!0,t._records.splice(r+1,0,...pi(t,e))),0===n&&(t.length=t._records.length)):i&&i(t,e,o,n)}}function Ci(t,e){const o=e[t.options.keyField];delete t._expandMap[o];const n=t._pIdMap[o]||[];for(const e of n)Ci(t,e)}function mi(t,e){return t._idMap[e][t.options.parentKeyField]}function yi(t,e){t._levelMap={},t._lastMap={},t._rootRecords=[],t._records=[];for(const e in t._pIdMap)if(t._pIdMap.hasOwnProperty(e)){const o=t._pIdMap[e];if(t._idMap[e])gi(t,o);else for(const e of o)ui(t,e,0),t._rootRecords.push(e),t._records.push(e),t._records.push(...pi(t,e))}gi(t,t._rootRecords);for(const e in t._expandMap)t._pIdMap[e]||delete t._expandMap[e];0===e&&(t.length=t._records.length)}function vi(t,e,o,n){let i=!1;for(const n of e){const e=n[t._options.keyField];if(!t._idMap[e]){i=!0;const r=n[t._options.parentKeyField];t._idMap[e]=n,t._pIdMap[r]=t._pIdMap[r]||[],t._pIdMap[r].push(n),o&&Array.isArray(o)&&o.indexOf(e)>=0&&(t._expandMap[e]=!0)}}i&&yi(t,n)}function bi(t,e,o,n,i){if(t._options.hasChildren&&t._options.getChildren&&t._options.hasChildren(e)){const r=t._options.getChildren(e,o);C(r)?r.then((r=>{const s=Array.isArray(r)?r:r.records,l=Array.isArray(r)?void 0:r.expandedKeys;vi(t,s,l,n),i&&i(t,e,o,n)})):(vi(t,r,null,n),i&&i(t,e,o,n))}}di.EMPTY=new di({get(){},length:0});class xi extends di{constructor(t,e){super(t),this._idMap={},this._pIdMap={},this._levelMap={},this._lastMap={},this._rootRecords=[],this._records=[],this._updateLengthSilentCounter=0,this._dataSource=t,this._options=e,this._expandMap={};for(const t of e.expandedKeys||[])this._expandMap[t]=!0;this.refreshInternal()}static get EVENT_TYPE(){return di.EVENT_TYPE}get options(){return this._options}get expandedKeys(){return Object.keys(this._expandMap)}getOriginal(t){return this._records[t]}getTreeInfo(t){const e=this.getOriginal(t);if(e){const t=e[this._options.keyField],o=mi(this,t),n=!!this._expandMap[t];let i=!this._pIdMap[t];const r=!!this._lastMap[t],s=this._levelMap[t],l=[];let a=t;for(let t=0;t<s;t++)l.unshift(!!this._lastMap[a]),a=mi(this,a);return i&&this._options.hasChildren&&(i=!this._options.hasChildren(e)),{expanded:n,isLast:r,isLeaf:i,key:t,level:s,levelLast:l,parentKey:o}}}getIndexByKey(t){return this._records.indexOf(this._idMap[t])}expandAll(){this._records.length=0;for(const t of this._rootRecords)fi(this,t),this._records.push(t),this._records.push(...pi(this,t));this.length=this._records.length}expand(t,e=!1){wi(this,this.getOriginal(t),e,this._updateLengthSilentCounter,((t,e,o,n)=>{bi(t,e,o,n,((t,e,o,n)=>{wi(t,e,o,n)}))}))}expandToKey(t){const e=[];let o=t,n=this._idMap[o];for(;n;)o=n[this._options.parentKeyField],n=this._idMap[o],n&&e.unshift(o);this._updateLengthSilentCounter++;try{for(const t of e)this.expand(this._records.indexOf(this._idMap[t]))}finally{this._updateLengthSilentCounter--,0===this._updateLengthSilentCounter&&(this.length=this._records.length)}return this.getIndexByKey(t)}expandToLevel(t){const e=[];if(t>0){this._updateLengthSilentCounter++;try{for(const o in this._levelMap)this._levelMap.hasOwnProperty(o)&&(t===this._levelMap[o]||t>this._levelMap[o]&&this._lastMap[o])&&e.push(this.expandToKey(o))}finally{this._updateLengthSilentCounter--,0===this._updateLengthSilentCounter&&(this.length=this._records.length)}}return e}collapseAll(){this._records.length=0,this._records.push(...this._rootRecords),this._expandMap={},this.length=this._records.length}collapse(t,e){const o=this.getOriginal(t);if(o){const n=o[this._options.keyField];this._pIdMap[n]&&(this._expandMap[n]?(e?Ci(this,o):delete this._expandMap[n],this._records.splice(t+1,_i(this,t)),this.length=this._records.length):e&&Ci(this,o))}}toggle(t,e){const o=this.getOriginal(t);if(o){const n=o[this._options.keyField];this._expandMap[n]?this.collapse(t,e):this.expand(t,e)}}get source(){return this._dataSource.source}get dataSource(){return this._dataSource}refreshInternal(){this._idMap={},this._pIdMap={};for(let t=0;t<this._dataSource.length;t++){const e=this._dataSource.getField(t,this._options.keyField),o=this._dataSource.getField(t,this._options.parentKeyField),n=this._dataSource.get(t);this._idMap[e]=n,this._pIdMap[o]=this._pIdMap[o]||[],this._pIdMap[o].push(n)}yi(this,this._updateLengthSilentCounter),0===this.length&&bi(this,null,!1,this._updateLengthSilentCounter)}}const Ri=G(),Ei=U(),Li=K();function Si(t,e){let o;if(t.dataSource instanceof xi){const n=t.getRecordIndexByRow(e);n>=0&&(o=t.dataSource.getTreeInfo(n))}return o}function ki(t){let e=0;return t&&(e+=16*t.level+32),e}function Ii(t,e,o,n){let i=!1;const r=t._getMouseRelativePoint(n);if(r){const n=t.getCellRelativeRect(e,o),s=Si(t,o);if(s&&!s.isLeaf){const t=ki(s);t&&r.x-n.left<t&&(i=!0)}}return i}class Ti extends Mo{constructor(t={}){super(t),this._canToggle=t.canToggle,this._toggled=t.toggled,this._draw=t.draw,this._cellStyle=t.cellStyle,this._multilineText=t.multilineText}get StyleClass(){return Lo}get canToggle(){return this._canToggle}get toggled(){return this._toggled}get draw(){return this._draw}get cellStyle(){return this._cellStyle}get multilineText(){return this._multilineText}reviseAttachCellsArea(t,e,o){De(t,e,o,this._cellStyle)}reviseAttachCellsPadding(t,e,o){super.reviseAttachCellsPadding(t,e,o);const n=Si(o,e);t[3]+=ki(n),Fe(t,e,o,this._cellStyle)}reviseFocusRect(t,e,o){const n=Si(o,e);t.left+=ki(n)}clone(){return new Ti(this)}drawInternal(t,e,o,n,i,r){const s=r.getIcon,l=r.getRecord,{textAlign:a,textBaseline:c,color:h,font:d,textOverflow:u,lineColor:g,buttonColor:f,buttonBgColor:p,buttonBorderColor:_,linkColor:C,autoWrapText:m,lineHeight:y,lineClamp:b}=o;n.testFontLoad(d,t,e);const x=Si(i,e.row);let R=!1;const E=i[Ei];if(E){const t=i.getCellRange(e.col,e.row);E.mouseActiveCell&&v(t,E.mouseActiveCell.col,E.mouseActiveCell.row)&&(R=!0)}Te(s(),e,n,((s,v)=>{if(!Me(n,this.draw,t,e,i,l())){const i=Be(e,n,o);if(R&&E&&E.mouseRelativePos){const o=n.getTextRect(t,v,{font:d,icons:s,padding:i,textAlign:a,textBaseline:c,textOverflow:u}),r=ki(x);o.left=Math.max(e.getRect().left+r,o.left+r),o.right+=r,R=o.left<=E.mouseRelativePos.x&&o.right>=E.mouseRelativePos.x&&o.top<=E.mouseRelativePos.y&&o.bottom>=E.mouseRelativePos.y,E.mouseActive=R}const l=r.getRecord(),L=w(this.multilineText,l);n.tree(t,v,{color:R?C||n.theme.tree.linkColor:h,lineColor:g,buttonColor:f,buttonBgColor:p,buttonBorderColor:_,icons:s,padding:i,textAlign:a,textBaseline:c,textOverflow:u,treeInfo:x,treeNodeSpace:16,isMultilineText:L,autoWrapText:m,lineHeight:y,lineClamp:b})}Ae(i,e,Ri,n,o),We(0,l(),e,n,this._cellStyle)}))}bindGridEvent(t,e){const o=(e,o)=>{if(t.dataSource instanceof xi){const n=t.getRecordIndexByRow(e.row);t.dataSource.toggle(n,o)}};function n(o,n){return t.getLayoutCellId(o,n)===e}const i=e=>{if(!n(e.col,e.row))return;if(C(t.getRowRecord(e.row)))return;if(this._canToggle){const o=Si(t,e.row);if(o&&!1===this._canToggle({col:e.col,event:e.event,row:e.row,treeInfo:o,type:"over"}))return}const o=t[Ei],i=t[Li];t.getElement().style.cursor=Ii(t,e.col,e.row,e.event)||o&&o.mouseActive||i&&i.mouseActive?"pointer":""},r=e=>{n(e.col,e.row)&&(t.getElement().style.cursor="")};return[t.listen(F.CLICK_CELL,(e=>{if(!n(e.col,e.row))return;if(C(t.getRowRecord(e.row)))return;if(!Ii(t,e.col,e.row,e.event))return;const i=Si(t,e.row);if(!i)return;const r=e.event.shiftKey,s=i.expanded?r?"collapseAll":"collapse":r?"expandAll":"expand",l={col:e.col,event:e.event,row:e.row,treeInfo:i,type:s};return this._canToggle&&!1===this._canToggle(l)?void 0:(t.selectCellRange(e.col,e.row,e.col,e.row),o({col:e.col,row:e.row},r),this._toggled&&this._toggled(l),I.cancel(e.event),!1)})),t.listen(F.MOUSEENTER_CELL,i),t.listen(F.MOUSEOVER_CELL,i),t.listen(F.MOUSEMOVE_CELL,i),t.listen(F.MOUSELEAVE_CELL,r),t.listen(F.MOUSEOUT_CELL,r),t.listen(F.KEYDOWN,(e=>{if(-1===[H,W,37,39,P].indexOf(e.keyCode)||!e.event.ctrlKey&&!e.event.metaKey)return;const i=t.selection.select,r={col:i.col,row:i.row};if(!n(r.col,r.row))return;if(C(t.getRowRecord(r.row)))return;const s=Si(t,r.row);if(!s)return;let l;l=e.keyCode===H||39===e.keyCode?e.keyCode===H?"expandAll":"expand":e.keyCode===P||37===e.keyCode?e.keyCode===P?"collapseAll":"collapse":s.expanded?e.event.shiftKey?"collapseAll":"collapse":e.event.shiftKey?"expandAll":"expand";const a={col:r.col,event:e.event,row:r.row,treeInfo:s,type:l};return this._canToggle&&!1===this._canToggle(a)?void 0:(e.keyCode===H||39===e.keyCode?((e,o)=>{if(t.dataSource instanceof xi){const n=t.getRecordIndexByRow(e.row);t.dataSource.expand(n,o)}})(r,e.keyCode===H):e.keyCode===P||37===e.keyCode?((e,o)=>{if(t.dataSource instanceof xi){const n=t.getRecordIndexByRow(e.row);t.dataSource.collapse(n,o)}})(r,e.keyCode===P):o(r,e.event.shiftKey),this._toggled&&this._toggled(a),I.cancel(e.event),s.isLeaf)}))]}drawEditingInternal(t,e,o,n,i){super.drawEditingInternal(t,e,o,n,i);const r=e.textAlign,s=e.textBaseline,l=e.color,a=Si(n,t.row),c=e.textOverflow,h=e.autoWrapText,d=e.lineHeight,u=e.lineClamp,g=i.getRecord(),f=w(this.multilineText,g);o.tree("",t,{color:l,padding:Be(t,o,e),textAlign:r,textBaseline:s,textOverflow:c,treeInfo:a,treeNodeSpace:16,isMultilineText:f,autoWrapText:h,lineHeight:d,lineClamp:u})}}const Bi=V();class Ai extends Mo{get StyleClass(){return Eo}clone(){return new Ai(this)}convertInternal(t){return Dt(t)}drawInternal(t,e,o,n,r,s){var l;const{textAlign:a,textBaseline:c,checkColor:h,uncheckBorderColor:d,checkBorderColor:u,uncheckBgColor:g,checkBgColor:f}=o,{col:p,row:_}=e,w=r.getCellRange(p,_),C=`${w.start.col}:${w.start.row}`,m=null===(l=r[Bi])||void 0===l?void 0:l.elapsed[C],y={textAlign:a,textBaseline:c,checkColor:h,uncheckBorderColor:d,checkBorderColor:u,uncheckBgColor:g,checkBgColor:f};i(m)&&(y.animElapsedTime=m),n.radioButton(t,e,y)}}const Mi={DEFAULT:new kn,NUMBER:new ei,CHECK:new An,RADIO:new Ai,BUTTON:new Tn,IMAGE:new Yn,MULTILINETEXT:new Qn,DATE:new Fn,LOOKUP:new Zn,SWITCH:new On,TREE:new Ti,DRAW:new Pn};const Oi={action:{ACTIONS:pn,BaseAction:tt,Editor:ot,BaseCheckEditor:dt,BaseInputEditor:it,BaseActionInput:rt,Action:et,CheckEditor:ft,RadioEditor:tn,SwitchEditor:_t,ButtonAction:class extends et{constructor(t={}){super(t)}getState(t){return t[ut]||S.setReadonly(t,ut,{}),t[ut]}},SmallDialogInputEditor:fn,InlineInputEditor:Ut,InlineTextAreaEditor:Zo,InlineLookupEditor:he,InlineMenuEditor:zo,of:function t(e){if(e){if("string"==typeof e){const o=e.toUpperCase();return pn[o]||t(null)}return e}}},type:{TYPES:Mi,BaseColumn:Mo,BaseCheckColumn:_n,Column:kn,NumberColumn:ei,CheckColumn:An,RadioColumn:Ai,SwitchColumn:On,ButtonColumn:Tn,ImageColumn:Yn,PercentCompleteBarColumn:oi,IconColumn:Hn,BranchGraphColumn:Ln,MenuColumn:Oo,MultilineTextColumn:Qn,DateColumn:Fn,LookupColumn:Zn,TreeColumn:Ti,DrawColumn:Pn,of:function t(e){if(e){if("string"==typeof e){const o=e.toUpperCase();return Mi[o]||t(null)}return e}return Mi.DEFAULT}},style:{EVENT_TYPE:So,BaseStyle:ro,BaseStdStyle:so,BaseCheckStyle:lo,Style:ao,NumberStyle:yo,CheckStyle:ho,RadioStyle:Eo,SwitchStyle:uo,ButtonStyle:co,ImageStyle:_o,IconStyle:po,PercentCompleteBarStyle:bo,MultilineTextStyle:mo,MenuStyle:Co,DateStyle:go,LookupStyle:wo,TreeStyle:Lo,DrawStyle:fo,of:ko}},Di="p";function Fi(t){return new Error(`calc parse error: ${t}`)}const Wi={"*":3,"/":3,"+":2,"-":2};function Pi(t,e){var o;function i(t){const o=t.pop(),n=t.pop(),i=t.pop();if(!(i&&i.nodeType&&n&&"o"===n.type&&o&&o.nodeType))throw Fi(e);return{nodeType:"b",left:i,op:n,right:o}}const r=[];for(;t.length;){const s=t.shift();if(s.type===Di&&"("===s.value){let o=0;const i=n.findIndex(t,(t=>{if(t.type===Di&&"("===t.value)o++;else if(t.type===Di&&")"===t.value){if(!o)return!0;o--}return!1}));if(-1===i)throw Fi(e);r.push(Pi(t.slice(0,i),e)),t.splice(0,i+1)}else if("o"===s.type){if(r.length>=3){const t=r[r.length-2].value;Wi[s.value]<=Wi[t]&&r.push(i(r))}r.push(s)}else if("u"===s.type){const{value:t}=s,e=parseFloat(t),n=(null===(o=/[a-z%]+/i.exec(t))||void 0===o?void 0:o[0])||"";r.push({nodeType:"u",value:e,unit:n})}else"n"===s.type&&r.push({nodeType:"n",value:parseFloat(s.value)})}for(;r.length>1;)r.push(i(r));return r[0]}function Hi(t){return Pi(function(t){let e=t.replace(/calc\(/g,"(");const o=/^[-+]?(\d*\.\d+|\d+)[a-z%]+/i,n=/^[-+]?(\d*\.\d+|\d+)/i,i=/^[-+*/]/,r=[];let s;for(;e=e.trim();)if("("===e[0]||")"===e[0])r.push({value:e[0],type:Di}),e=e.slice(1);else if(s=o.exec(e))r.push({value:s[0],type:"u"}),e=e.slice(s[0].length);else if(s=n.exec(e))r.push({value:s[0],type:"n"}),e=e.slice(s[0].length);else{if(!(s=i.exec(e)))throw Fi(t);r.push({value:s[0],type:"o"}),e=e.slice(s[0].length)}return r}(t),t)}function zi(t,e){if("b"===t.nodeType){const o=zi(t.left,e),n=zi(t.right,e);switch(t.op.value){case"+":return o+n;case"-":return o-n;case"*":return o*n;case"/":return o/n;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if("u"===t.nodeType)switch(t.unit){case"%":return t.value*e.full/100;case"em":return t.value*e.em;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if("n"===t.nodeType)return t.value;throw new Error("calc error.")}function Ni(t,e){return zi(Hi(t),e)}function Vi(t,e){return"string"==typeof t?Ni(t.trim(),e):t-0}const $i=new Lt;let Ui;function Ki(){t?Ui=1:(Ui=Math.ceil(window.devicePixelRatio||1),Ui>1&&Ui%2!=0&&(Ui+=1))}Ki(),t||$i.on(window,"resize",Ki);var Gi={transform(t){const e=t.getContext("2d"),o=t.getAttribute,n=t.setAttribute;var i;if(t.getAttribute=(i=t,t=>{let e=o.apply(i,[t]);return"width"!==t&&"height"!==t||(e/=Ui),e}),t.setAttribute=(t=>(o,i)=>{const r="width"===o||"height"===o;r&&(i=Ui*Number(i)+"");const s=n.apply(t,[o,i]);return r&&e&&e.scale(Ui,Ui),s})(t),Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:()=>t.getAttribute("width"),set:e=>{t.setAttribute("width",Math.floor(e)+"")}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:()=>t.getAttribute("height"),set:e=>{t.setAttribute("height",Math.floor(e)+"")}}),e){const o=e.drawImage;e.drawImage=(e=>(n,...i)=>{if(n!==t||1===Ui)return o.apply(e,[n].concat(i));e.save();try{return e.scale(1/Ui,1/Ui),i.length>4?(i[4]*=Ui,i[5]*=Ui):(i[0]*=Ui,i[1]*=Ui),o.apply(e,[n].concat(i))}finally{e.restore()}})(e)}return t}};class ji{constructor(){this._keys=[],this._vals={},this._sorted=!1}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return null!==this._vals[t]}each(t,e,o){const n=this._keys,i=n.length;this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let r=((t,e)=>{let o=0,n=t.length-1;for(;o<=n;){const i=Math.floor((o+n)/2);if(t[i]===e)return i;t[i]>e?n=i-1:o=i+1}return n<0?0:n})(n,t);r<i;r++){const i=n[r];if(t<=i&&i<=e)o(this.get(i),i);else if(e<i)return}}}const Yi=L-1e3;class Xi{constructor(){this._handler=new Lt,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._perfectScrollbar=new window.PerfectScrollbar(this._scrollable,{minScrollbarLength:24}),this._handler.on(this._scrollable,"click",(t=>{t.target!==this._scrollable&&I.cancel(t)})),this._p=1,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}calcTop(t){const e=t-this.scrollTop;return this._scrollable.scrollTop+e}getElement(){return this._scrollable}setScrollSize(t,e){this._width=t,this._height=e,this._update()}get scrollWidth(){return this._width}set scrollWidth(t){this._width=t,this._update()}get scrollHeight(){return this._height}set scrollHeight(t){this._height=t,this._update()}get scrollLeft(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)}set scrollLeft(t){this._scrollable.scrollLeft=t}get scrollTop(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)}set scrollTop(t){this._scrollable.scrollTop=t*this._p}onScroll(t){this._handler.on(this._scrollable,"scroll",t)}dispose(){this._handler.dispose()}update(){this._update()}_update(){let t;if(this._height>Yi){const e=Bt.getScrollBarSize(),{offsetHeight:o}=this._scrollable,n=Yi-o+e,i=this._height-o+e;this._p=n/i,t=Yi}else this._p=1,t=this._height;t-=1;const e=this._width-1;this._endPointElement.style.top=`${t.toFixed()}px`,this._endPointElement.style.left=`${e.toFixed()}px`,this._perfectScrollbar.update()}}const qi=L-1e3;class Zi{constructor(t){this._canvas=t,this._handler=new Lt,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._p=1,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}calcTop(t){const e=t-this.scrollTop;return this._scrollable.scrollTop+e}getElement(){return this._scrollable}setScrollSize(t,e){this._width=t,this._height=e,this._update()}get scrollWidth(){return this._width}set scrollWidth(t){this._width=t,this._update()}get scrollHeight(){return this._height}set scrollHeight(t){this._height=t,this._update()}get scrollLeft(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)}set scrollLeft(t){this._scrollable.scrollLeft=t}get scrollTop(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)}set scrollTop(t){this._scrollable.scrollTop=t*this._p}onScroll(t){this._handler.on(this._scrollable,"scroll",t)}dispose(){this._handler.dispose()}update(){this._update()}_update(){let t;const e=Bt.getScrollBarSize();if(this._height>qi){const o=this._scrollable.offsetHeight,n=qi-o+e,i=this._height-o+e;this._p=n/i,t=qi}else this._p=1,t=this._height;const o=this._width,n=t>this._canvas.height?t:t-e,i=o>this._canvas.width?o:o-e;this._endPointElement.style.top=`${n.toFixed()}px`,this._endPointElement.style.left=`${i.toFixed()}px`;const r=Math.max(0,n-this._canvas.height);this._scrollable.scrollTop>r&&(this._scrollable.scrollTop=r);const s=Math.max(0,i-this._canvas.width);this._scrollable.scrollLeft>s&&(this._scrollable.scrollLeft=s)}}class Ji{constructor(t){this._grid=t,this._handler=new Lt,this._events={},this._started=!1,this._moved=!1,this._mouseEndPoint=null}get grid(){return this._grid}moving(t){return!!this._started}lastMoving(t){if(this.moving(t))return!0;const e=this._mouseEndPoint;if(!e)return!1;const o=this._grid._getMouseAbstractPoint(t);return!!o&&o.x===e.x&&o.y===e.y}dispose(){this._handler.dispose()}_bindMoveAndUp(t){const e=this._events,o=this._handler;I.isTouchEvent(t)?(e.touchmove=o.on(document.body,"touchmove",(t=>this._mouseMove(t)),{passive:!1}),e.touchend=o.on(document.body,"touchend",(t=>this._mouseUp(t))),e.touchcancel=o.on(document.body,"touchcancel",(t=>this._mouseUp(t)))):(e.mousemove=o.on(document.body,"mousemove",(t=>this._mouseMove(t))),e.mouseup=o.on(document.body,"mouseup",(t=>this._mouseUp(t)))),this._started=!0,this._moved=!1}_mouseMove(t){I.isTouchEvent(t)||1===I.getMouseButtons(t)?(this._moved=this._moveInternal(t)||this._moved,I.cancel(t)):this._mouseUp(t)}_mouseUp(t){const e=this._events,o=this._handler;o.off(e.mousemove),o.off(e.touchmove),o.off(e.mouseup),o.off(e.touchend),o.off(e.touchcancel),this._upInternal(t),this._moved?(this._mouseEndPoint=this._grid._getMouseAbstractPoint(t),setTimeout((()=>{this._mouseEndPoint=null,this._started=!1}),10)):this._started=!1,I.cancel(t)}_upInternal(t){}_vibrate(t){navigator.vibrate&&I.isTouchEvent(t)&&navigator.vibrate(50)}}class Qi extends Ji{constructor(){super(...arguments),this._cell={col:-1,row:-1}}start(t){const e=this._getTargetCell(t);if(!e)return this.grid._forceFocusCell(),void I.cancel(t);this.grid.fireListeners(F.MOUSE_SELECTED_START,t),this.grid._moveFocusCell(e.col,e.row,t.shiftKey),this._bindMoveAndUp(t),this._cell=e,I.cancel(t),this._vibrate(t)}select(t){const e=this._getTargetCell(t);e&&(this.grid._moveFocusCell(e.col,e.row,t.shiftKey),this._cell=e)}_upInternal(t){this.grid.fireListeners(F.MOUSE_SELECTED_END,t)}_moveInternal(t){const e=this._getTargetCell(t);if(!e)return!1;const o=this._cell.col,n=this._cell.row,i=e.col,r=e.row;if(o===i&&n===r)return!1;const s=this.grid;s._moveFocusCell(i,r,!0,!0);const l=i<o&&0<i?i-1:o<i&&i+1<s.colCount?i+1:i,a=r<n&&0<r?r-1:n<r&&r+1<s.rowCount?r+1:r;return l===i&&a===r||s.makeVisibleCell(l,a),this._cell=e,!0}_getTargetCell(t){const e=this.grid,o=e._getMouseAbstractPoint(t);if(!o)return null;const n=e.getCellAt(o.x,o.y);return n.col<0||n.row<0?null:n}}class tr extends Ji{constructor(t){super(t),this._targetCol=-1,this._x=0,this._preX=0,this._invalidateAbsoluteLeft=0}start(t,e){let o;I.isTouchEvent(e)?({pageX:o}=e.changedTouches[0]):({pageX:o}=e),this._x=o,this._preX=0,this.grid._resetColWidthOffset(t),this._bindMoveAndUp(e),this._targetCol=t,I.cancel(e),this._vibrate(e)}_moveInternal(t){const e=(I.isTouchEvent(t)?t.changedTouches[0].pageX:t.pageX)-this._x,o=e-this._preX;this._preX=e;const n=this.grid.getColWidth(this._targetCol);let i=this.grid._adjustColWidth(this._targetCol,n+o);i<10&&o<0&&(i=10),this.grid._storeAutoColWidthExprs(),this.grid.setColWidth(this._targetCol,i);const r=this.grid._getVisibleRect();return r.left=this._invalidateAbsoluteLeft,this.grid._invalidateRect(r),this.grid.fireListeners(F.RESIZE_COLUMN,{col:this._targetCol}),!0}_upInternal(t){this.grid.updateScroll()&&this.grid.invalidate()}}function er(t,e,o,n){return{start:{col:t,row:e},end:{col:o,row:n}}}class or{constructor(t,e,o,n,i,r,s,l){this._rectFilter=null,this._col=t,this._row=e,this._mode=0,this._range=er(t,e,t,e),this._ctx=o,this._rect=n,this._drawRect=i,this._drawing=r,this._selection=s,this._drawLayers=l,this._childContexts=[]}get drawing(){return 0!==this._mode||this._drawing}get row(){return this._row}get col(){return this._col}get range(){return this._range}set range(t){this._range=t}cancel(){this._cancel=!0,this._childContexts.forEach((t=>{t.cancel()}))}getSelection(){return{border:this._selection.border(this._col,this._row),dragged:this._selection.drag.inDrag(this._col,this._row),select:this._selection.drag.select,range:this._selection.range}}getContext(){return 0===this._mode?this._ctx:this._grid._getInitContext()}getRect(){const t=this._rectFilter;return t?t(this._getRectInternal()):this._getRectInternal()}setRectFilter(t){this._rectFilter=t}getDrawRect(){if(this._cancel)return null;if(0===this._mode)return this._drawRect;{if(this._isOutOfRange())return null;const t=this._grid.getCellRect(this._col,this._row);return this._toRelativeDrawRect(t)}}toCurrentContext(){if(0===this._mode)return this;{const t=this._grid.getCellRect(this._col,this._row),e=this._grid._toRelativeRect(t),o=this._isOutOfRange()?null:this._toRelativeDrawRect(t),n=new or(this._col,this._row,this.getContext(),e,o,this.drawing,this._selection,this._drawLayers);return n.toCurrentContext=this.toCurrentContext.bind(this),this._childContexts.push(n),this._cancel&&n.cancel(),n._rectFilter=this._rectFilter,n}}addLayerDraw(t,e){this._drawLayers.addDraw(t,e)}_delayMode(t,e){this._mode=1,this._ctx=null,this._rect=null,this._drawRect=null,this._grid=t,this._onTerminate=e}terminate(){var t;0!==this._mode&&(null===(t=this._onTerminate)||void 0===t||t.call(this))}_getRectInternal(){return 0===this._mode||this._rect?this._rect:this._grid.getCellRelativeRect(this._col,this._row)}_isOutOfRange(){const{colCount:t,rowCount:e}=this._grid;return t<=this._col||e<=this._row}_toRelativeDrawRect(t){const e=this._grid,o=e._getVisibleRect();let n=t.copy();if(!n.intersection(o))return null;const i=e.isFrozenCell(this._col,this._row);if(e.frozenColCount>=0&&(!i||!i.col)){const t=e.getCellRect(e.frozenColCount-1,this._row);n=Ie.bounds(Math.max(n.left,t.right),n.top,n.right,n.bottom)}if(e.frozenRowCount>=0&&(!i||!i.row)){const t=e.getCellRect(this._col,e.frozenRowCount-1);n=Ie.bounds(n.left,Math.max(n.top,t.bottom),n.right,n.bottom)}return n.intersection(o)?(n.offsetLeft(-o.left),n.offsetTop(-o.top),n):null}}class nr{constructor(t){this._level=t,this._list=[]}get level(){return this._level}addDraw(t){this._list.push(t)}draw(t){this._list.forEach((e=>{t.save();try{e(t)}finally{t.restore()}}))}}class ir{constructor(){this._layers={}}addDraw(t,e){(this._layers[t]||(this._layers[t]=new nr(t))).addDraw(e)}draw(t){const e=[];for(const t in this._layers)this._layers.hasOwnProperty(t)&&e.push(this._layers[t]);e.sort(((t,e)=>t.level-e.level)),e.forEach((e=>e.draw(t)))}}function rr(t,e){const o=t.type;t.type="",t.value=e,o&&(t.type=o)}class sr extends Ne{constructor(t,e,o){super(),this._isComposition=!1,this._grid=t,this._scrollable=o;const r=this._handler=new Lt,s=this._input=document.createElement("input");let l;s.classList.add("grid-focus-control"),s.readOnly=!0,e.appendChild(s),r.on(s,"compositionstart",(e=>{s.classList.add("composition"),s.style.font=t.font||"16px sans-serif",this._isComposition=!0,this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd),t.focus()}));const a=()=>{l=s.value,this._isComposition||""!==l&&rr(s,"")},c=()=>{this._isComposition=!1,s.classList.remove("composition"),s.style.font="";const t=s.value;a(),s.readOnly||this.fireListeners("input",t),this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd)};r.on(s,"compositionend",(t=>{this._compositionEnd=setTimeout(c,0)})),r.on(s,"keypress",(t=>{if(!this._isComposition){if(!s.readOnly&&t.key&&1===t.key.length)if(t.ctrlKey||t.metaKey)"c"===t.key||"v"===t.key||t.key;else{if(" "===t.key)return;this.fireListeners("input",t.key),I.cancel(t)}a()}})),r.on(s,"keydown",(t=>{var e;if(this._isComposition)return void(this._compositionEnd&&(c(),I.cancel(t)));const o=I.getKeyCode(t);let i=!1;const r={keyCode:o,event:t,stopCellMoving(){i=!0}},h=this.fireListeners("keydown",r);n.findIndex(h,(t=>!1===t))>=0||(!s.readOnly&&l&&E&&this.fireListeners("input",l),i||this.fireKeyDownMove(o,t),!(null===(e=this._grid.keyboardOptions)||void 0===e?void 0:e.deleteCellValueOnDel)||46!==o&&8!==o||this.fireListeners("delete",t),a())})),r.on(s,"keyup",(t=>{this._isComposition&&this._compositionEnd&&c(),a()})),r.on(s,"input",(t=>{" "!==t.data&&""!==t.data||this.fireListeners("input",t.data),a()})),b&&r.on(document,"keydown",(t=>{if(t.target!==s)return;const e=I.getKeyCode(t);67===e&&t.ctrlKey?(rr(s,"dummy"),s.select(),setTimeout((()=>{rr(s,"")}),100)):86===e&&t.ctrlKey&&s.readOnly&&(s.readOnly=!1,setTimeout((()=>{s.readOnly=!0,rr(s,"")}),10))})),x&&r.once(document,"keydown",(o=>{if(!f(e,o.target))return;const n=document.createElement("input");t.getElement().appendChild(n),n.focus(),s.focus(),n.parentElement&&n.parentElement.removeChild(n)})),r.on(document,"paste",(t=>{if(this._isComposition)return;if(!f(e,t.target))return;let o;if(setTimeout((()=>{a()}),100),b)o=window.clipboardData.getData("Text");else{const e=t.clipboardData;e&&(e.items?o=e.getData("text/plain"):-1!==Array.prototype.indexOf.call(e.types,"text/plain")&&(o=e.getData("Text")))}i(o)&&o.length&&this.fireListeners("paste",{value:o,event:t})}));const h=(t,e)=>{if(i(t))if(I.cancel(e),b){const e=window.clipboardData;e&&e.setData("Text",t)}else{const o=e.clipboardData;o&&o.setData("text/plain",t)}};r.on(document,"copy",(t=>{if(this._isComposition)return;if(!f(e,t.target))return;rr(s,"");const o=n.find(this.fireListeners("copy",t),i);h(o,t)})),r.on(document,"cut",(t=>{if(this._isComposition)return;if(!f(e,t.target))return;rr(s,"");const o=n.find(this.fireListeners("cut",t),i);h(o,t)})),r.on(s,"focus",(t=>{this.fireListeners("focus",t)})),r.on(s,"blur",(t=>{this.fireListeners("blur",t)}))}fireKeyDownMove(t,e){var o,n,i;const r=this._keyDownMoveCallback;r&&(this._isComposition||(37===t||t===P||39===t||t===H||36===t||35===t||(null===(o=this._grid.keyboardOptions)||void 0===o?void 0:o.moveCellOnTab)&&9===t||(null===(n=this._grid.keyboardOptions)||void 0===n?void 0:n.moveCellOnEnter)&&t===W||(null===(i=this._grid.keyboardOptions)||void 0===i?void 0:i.selectAllOnCtrlA)&&65===t&&(e.ctrlKey||e.metaKey))&&r(e))}onKeyDownMove(t){this._keyDownMoveCallback=t}onKeyDown(t){return this.listen("keydown",t)}onInput(t){return this.listen("input",t)}onDelete(t){return this.listen("delete",t)}onCopy(t){return this.listen("copy",t)}onPaste(t){return this.listen("paste",t)}onCut(t){return this.listen("cut",t)}onFocus(t){return this.listen("focus",t)}onBlur(t){return this.listen("blur",t)}focus(){this._input.focus()}setFocusRect(t){const e=this._input,o=this._scrollable.calcTop(t.top);e.style.top=`${(o-Bt.getScrollBarSize()).toFixed()}px`,e.style.left=`${t.left.toFixed()}px`,e.style.width=`${t.width.toFixed()}px`,e.style.height=`${t.height.toFixed()}px`}get editMode(){return!this._input.readOnly}set editMode(t){this._input.readOnly=!t}resetInputStatus(){var t;const e=this._input;if(!e.classList.contains("grid-focus-control--stored-status"))return;const o=e.classList.contains("composition"),n=e.attributes,i=[];for(let e=0,o=n.length;e<o;e++){const o=n[e];(null===(t=this._inputStatus)||void 0===t?void 0:t.hasOwnProperty(o.nodeName))||i.push(o.name)}i.forEach((t=>{e.removeAttribute(t)}));for(const t in this._inputStatus)this._inputStatus.hasOwnProperty(t)&&e.setAttribute(t,this._inputStatus[t]);o?(e.classList.add("composition"),e.style.font=this._grid.font||"16px sans-serif"):e.classList.remove("composition"),e.classList.remove("grid-focus-control--stored-status")}storeInputStatus(){const t=this._input;if(t.classList.contains("grid-focus-control--stored-status"))return;const e=this._inputStatus={},o=t.attributes;for(let t=0,n=o.length;t<n;t++){const n=o[t];e[n.name]=n.value}t.classList.add("grid-focus-control--stored-status")}setDefaultInputStatus(){}get input(){return this._input}dispose(){super.dispose(),this._handler.dispose()}}class lr extends Ne{constructor(t,e){super(),this._isWraped=!1,this._grid=t,this._sel={col:0,row:0},this._focus={col:0,row:0},this._start={col:0,row:0},this._end={col:0,row:0},this._updateRange=e}get range(){const t=this._start,e=this._end,o=Math.min(t.col,e.col),n=Math.min(t.row,e.row);return{end:{col:Math.max(t.col,e.col),row:Math.max(t.row,e.row)},start:{col:o,row:n}}}set range(t){const e=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.col,t.end.col),i=Math.max(t.start.row,t.end.row);this._wrapFireSelectedEvent((()=>{this._setSelectCell(e,o),this._setFocusCell(n,i,!0),this._grid._updatedSelection()}))}get focus(){return{col:this._focus.col,row:this._focus.row}}get select(){return{col:this._sel.col,row:this._sel.row}}set select(t){this._wrapFireSelectedEvent((()=>{const{col:e=0,row:o=0}=t||{};this._setSelectCell(e,o),this._setFocusCell(e,o,!0),this._grid._updatedSelection()}))}get dragging(){return!!this._drag}get drag(){const t=this;return{get select(){const e=t._drag?t._drag.sel:t._sel;return{col:e.col,row:e.row}},get range(){const e=t._drag?t._drag.start:t._start,o=t._drag?t._drag.end:t._end,n=Math.min(e.col,o.col),i=Math.min(e.row,o.row);return{end:{col:Math.max(e.col,o.col),row:Math.max(e.row,o.row)},start:{col:n,row:i}}},inRange(t,e){const o=this.range.start.col,n=this.range.start.row,i=this.range.end.col,r=this.range.end.row;return o<=t&&t<=i&&n<=e&&e<=r},inDrag(e,o){const n=this.inRange(e,o),i=t.inRange(e,o);return n&&!i||!n&&i}}}inRange(t,e){const o=Math.min(this._start.col,this._end.col),n=Math.min(this._start.row,this._end.row),i=Math.max(this._start.col,this._end.col),r=Math.max(this._start.row,this._end.row);return o<=t&&t<=i&&n<=e&&e<=r}border(t,e){const o=this.range,n=o.start.col<=t&&t<=o.end.col&&o.start.row<=e&&e<=o.end.row;return{bottom:!!n&&o.end.row===e,left:!!n&&o.start.col===t,right:!!n&&o.end.col===t,top:!!n&&o.start.row===e}}fireSelectedEvent(){this._wrapFireSelectedEvent((()=>{}))}startDrag(){this._drag={end:this._end,focus:this._focus,sel:this._sel,start:this._start}}stopDrag(){if(this._drag){this.fireListeners(F.SELECTED_CELL,{after:{col:this._sel.col,row:this._sel.row},col:this._drag.sel.col,row:this._drag.sel.row,selected:!1}),this.fireListeners(F.SELECTED_CELL,{before:{col:this._drag.sel.col,row:this._drag.sel.row},col:this._sel.col,row:this._sel.row,selected:!0});const t=this.drag.range.start.col,e=this.drag.range.start.row,o=this.drag.range.end.col,n=this.drag.range.end.row,i=this.range.start.col,r=this.range.start.row,s=this.range.end.col,l=this.range.end.row;delete this._drag,this._grid.invalidateGridRect(t,e,o,n),this._grid.invalidateGridRect(i,r,s,l)}}_updateGridRange(){const{rowCount:t,colCount:e}=this._grid,o=[this._sel,this._focus,this._start,this._end];let n=!1;for(const i of o)if(e<=i.col||t<=i.row){n=!0;break}return!!(n&&t&&e)&&(this._wrapFireSelectedEvent((()=>{o.forEach((o=>{o.col=Math.min(e-1,o.col),o.row=Math.min(t-1,o.row)}))})),!0)}_setFocusCell(t,e,o){this._wrapFireSelectedEvent((()=>{!o||this._grid.singleSelection?this._setSelectCell(t,e):this._setSelectCell(this._sel.col,this._sel.row),this._focus={col:t,row:e},this._end={col:t,row:e}}))}_forceUpdateRange(){const t=this._updateRange(this.range);t&&(this._start=t.start,this._end=t.end)}_setSelectCell(t,e){this._wrapFireSelectedEvent((()=>{this._sel={col:t,row:e},this._start={col:t,row:e}}))}_wrapFireSelectedEvent(t){if(this._isWraped)t();else{this._isWraped=!0;try{const e={end:{col:this._end.col,row:this._end.row},focus:{col:this._focus.col,row:this._focus.row},sel:{col:this._sel.col,row:this._sel.row},start:{col:this._start.col,row:this._start.row}},o={col:this._sel.col,row:this._sel.row,selected:!1};t(),this._forceUpdateRange();const i={before:{col:o.col,row:o.row},col:this._sel.col,row:this._sel.row,selected:!0};if(o.after={col:i.col,row:i.row},!this.dragging){const t=this.fireListeners(F.SELECTED_CELL,o);n.findIndex(t,(t=>!1===t))>=0?(this._end=e.end,this._focus=e.focus,this._sel=e.sel,this._start=e.start):this.fireListeners(F.SELECTED_CELL,i)}}finally{this._isWraped=!1}}}}class ar extends Ji{constructor(){super(...arguments),this._oldRange=er(-1,-1,-1,-1),this._newRange=er(-1,-1,-1,-1),this._cell={col:-1,row:-1}}start(t){const e=this._getTargetCellAndRange(t);if(!e)return!1;this._oldRange=this.grid.selection.range,this.grid.selection.startDrag(),this._bindMoveAndUp(t),this._newRange=e.range,this._cell=e.cell,I.cancel(t),this._vibrate(t)}canStart(){return n.find(this.grid.fireListeners(F.CAN_DRAG_SELECTION,this.grid.selection.range),(t=>!0===t))}_moveInternal(t){const e=this._getTargetCellAndRange(t);if(!e||!this._oldRange)return!1;const o=e.range,i=e.cell;if(o.start.col===this._newRange.start.col&&o.start.row===this._newRange.start.row&&o.end.col===this._newRange.end.col&&o.end.row===this._newRange.end.row)return!1;if(!1===n.find(this.grid.fireListeners(F.DRAG_SELECTION,{dragDone:!1,newRange:o,oldRange:this._oldRange}),(t=>!1===t)))return!1;const r=this._cell.col,s=this._cell.row,l=i.col,a=i.row;if(r===l&&s===a)return!1;const c=this.grid;c._moveFocusCell(o.start.col,o.start.row,!1,!0),c._moveFocusCell(o.end.col,o.end.row,!0,!0);const h=l<r&&0<l?l-1:r<l&&l+1<c.colCount?l+1:l,d=a<s&&0<a?a-1:s<a&&a+1<c.rowCount?a+1:a;return h===l&&d===a||c.makeVisibleCell(h,d),this._newRange=o,this._cell=i,!0}_upInternal(t){this.grid.fireListeners(F.DRAG_SELECTION,{dragDone:!0,newRange:this._newRange,oldRange:this._oldRange}),this.grid.selection.stopDrag()}_getTargetCellAndRange(t){const e=this.grid,o=e._getMouseAbstractPoint(t);if(!o)return null;if(!this._oldRange)return null;let n=this._oldRange.start.col,i=this._oldRange.start.row,r=this._oldRange.end.col,s=this._oldRange.end.row;const l=o.x,a=o.y,c=e.getCellAt(l,a);if(c.col<0||c.row<0)return null;const h=e.getCellRect(this._oldRange.start.col,this._oldRange.start.row),d=e.getCellRect(this._oldRange.end.col,this._oldRange.end.row),u=h.top,g=h.left,f=d.right,p=d.bottom;let _=g,w=u,C=f,m=p;const y=(w-m)*l+(C-_)*a+_*m-C*w<=0;_=f,w=u,C=g,m=p;const v=(w-m)*l+(C-_)*a+_*m-C*w>0;c.row>=i&&c.row<=s&&c.col>=n&&c.col<=r?y?s=c.row:r=c.col:y&&v?i=c.row:y&&!v?r=c.col:!y&&v?n=c.col:s=c.row;return{cell:c,range:er(n,i,r,s)}}}function cr(t){const e=t.replace(/\r?\n$/,"").split(/(?:\r?\n)|[\u2028\u2029]/g).map((t=>t.split(/\t/g)));return{colCount:e.reduce(((t,e)=>Math.max(t,e.length)),0),rowCount:e.length,getCellValue(t,o){var n;return(null===(n=e[o])||void 0===n?void 0:n[t])||""}}}const hr=z("protected.draw_grid");function dr(t){const e=this.getTargetRowAtInternal(t);if(i(e))return e;const o=(e,o)=>{let n=o;for(let o=e;o>=0;o--){const e=n-Or.call(this,o);if(e<=t&&t<n)return{row:o,top:e};n=e}return null},n=(e,o)=>{let n=o-Or.call(this,e);const{rowCount:i}=this[hr];for(let o=e;o<i;o++){const e=n+Or.call(this,o);if(n<=t&&t<e)return{row:o,top:n};n=e}return null},r=Math.min(Math.ceil(t/this.defaultRowHeight),this.rowCount-1),s=Dr.call(this,0,r);return t>=s?n(r,s):o(r,s)}function ur(t){let e=0;const{colCount:o}=this[hr];for(let n=0;n<o;n++){const o=e+Ar.call(this,n);if(o>t)return{col:n,left:e};e=o}return null}function gr(t){if(!this[hr].frozenRowCount)return null;let e=this[hr].scroll.top;const o=this[hr].frozenRowCount;for(let n=0;n<o;n++){const o=e+Or.call(this,n);if(o>t)return{row:n,top:e};e=o}return null}function fr(t){if(!this[hr].frozenColCount)return null;let e=this[hr].scroll.left;const o=this[hr].frozenColCount;for(let n=0;n<o;n++){const o=e+Ar.call(this,n);if(o>t)return{col:n,left:e};e=o}return null}function pr(){if(!this[hr].frozenRowCount)return null;const t=this[hr].scroll.top;let e=0;const o=this[hr].frozenRowCount;for(let t=0;t<o;t++)e+=Or.call(this,t);return new Ie(this[hr].scroll.left,t,this[hr].canvas.width,e)}function _r(){if(!this[hr].frozenColCount)return null;const t=this[hr].scroll.left;let e=0;const o=this[hr].frozenColCount;for(let t=0;t<o;t++)e+=Ar.call(this,t);return new Ie(t,this[hr].scroll.top,e,this[hr].canvas.height)}function wr(t,e){return this[hr].drawCells[e]?this[hr].drawCells[e][t]:null}function Cr(t,e,o){this[hr].drawCells[e]||(this[hr].drawCells[e]={}),this[hr].drawCells[e][t]=o}function mr(t,e){this[hr].drawCells[e]&&(delete this[hr].drawCells[e][t],0===Object.keys(this[hr].drawCells[e]).length&&delete this[hr].drawCells[e])}function yr(t,e,o,n,i,r,s,l,a,c,h){const d=new Ie(o-l.left,r-l.top,n,s),u=Ie.bounds(Math.max(o,c)-l.left,Math.max(r,a)-l.top,d.right,d.bottom);if(u.height>0&&u.width>0){t.save();try{const o=wr.call(this,e,i);o&&o.cancel();const n=new or(e,i,t,d,u,!!o,this[hr].selection,h),r=this.onDrawCell(e,i,n);if(C(r)){Cr.call(this,e,i,n);const t=e;n._delayMode(this,(()=>{mr.call(this,t,i)})),r.then((()=>{n.terminate()}))}}finally{t.restore()}}}function vr(t,e,o,n,i,r,s,l,a,c){const h=this[hr].colCount,d=(e,o)=>{if(e>=h-1&&this[hr].canvas.width>o-l.left){const e=o-l.left;"transparent"===this.underlayBackgroundColor?t.clearRect(e,r-l.top,this[hr].canvas.width-e,s):(t.save(),t.beginPath(),t.fillStyle=this.underlayBackgroundColor||"#F6F6F6",t.rect(e,r-l.top,this[hr].canvas.width-e,s),t.fill(),t.restore())}};let u=0;if(e){let o=e.left;const h=this[hr].frozenColCount;for(let u=e.col;u<h;u++){const e=Ar.call(this,u);if(yr.call(this,t,u,o,e,i,r,s,l,a,0,c),o+=e,n<=o)return void d(u,o)}u=o}if(o){let e=o.left;for(let g=o.col;g<h;g++){const o=Ar.call(this,g);if(yr.call(this,t,g,e,o,i,r,s,l,a,u,c),e+=o,n<=e)return void d(g,e)}d(h-1,e)}}let br=!1;function xr(t,e){const o=Vi(e,t[hr].calcWidthContext);return br?o:Math.floor(o)}function Rr(t,e){try{return br=!0,t.getColWidth(e)}finally{br=!1}}function Er(t,e){return this._adjustColWidth(t,e)}function Lr(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}function Sr(t){const e=this[hr].colWidthsMap.get(t);return e||this.defaultColWidth}function kr(t){const e=this[hr].colWidthsLimit[t];if(!e)return null;const o={};return e.min&&(o.min=xr(this,e.min),o.minDef=e.min),e.max&&(o.max=xr(this,e.max),o.maxDef=e.max),o}function Ir(t){return!(!t||"string"!=typeof t||"auto"!==t.toLowerCase())}function Tr(){const t=[];let e=0;const o=[];for(let n=0;n<this[hr].colCount;n++){const i=Sr.call(this,n),r=kr.call(this,n);if(Ir(i))r&&o.push(r),e++;else{let e="number"==typeof i?`${i}px`:i;if(r){const t=xr(this,e),o=Lr(r,t);t!==o&&(e=`${o}px`)}t.push(e)}}if(o.length&&t.length){const n=xr(this,`calc(100% - (${t.join(" + ")}))`)/e;for(let i=0;i<o.length;i++){const r=o[i];r.min&&n<r.min?(t.push("number"==typeof r.minDef?`${r.minDef}px`:r.minDef),e--):r.max&&r.max<n&&(t.push("number"==typeof r.maxDef?`${r.maxDef}px`:r.maxDef),e--)}if(e<=0)return`${n}px`}return t.length?`calc((100% - (${t.join(" + ")})) / ${e})`:100/e+"%"}function Br(t){return Ir(t)?xr(this,Tr.call(this)):xr(this,t)}function Ar(t){const e=Sr.call(this,t);return Er.call(this,t,Br.call(this,e))}function Mr(t,e){this[hr].colWidthsMap.put(t,e)}function Or(t){const e=this.getRowHeightInternal(t);if("number"==typeof e)return Number(e);const o=this[hr].rowHeightsMap.get(t);return o||this.defaultRowHeight}function Dr(t,e){const o=this.getRowsHeightInternal(t,e);if("number"==typeof o)return Number(o);const n=e-t+1;let i=this.defaultRowHeight*n;return this[hr].rowHeightsMap.each(t,e,(t=>{i+=t-this.defaultRowHeight})),i}function Fr(t,e){this[hr].rowHeightsMap.put(t,e)}function Wr(){let t=this.getElement().clientWidth;for(let e=0;e<this.frozenColCount;e++)t-=this.getColWidth(e);t<0&&(t=0);let e=0;if(this.underlayColCount>=0)e="auto"===this.underlayColWidth?this.underlayColCount*xr(this,this.defaultColWidth):this.underlayColCount*this.underlayColWidth;else if(e=t,"auto"===this.underlayColWidth){for(let t=Math.max(this.colCount+this.underlayColCount,this.frozenColCount,0);t<this.colCount;t++)e-=this.getColWidth(t)}else e+=this.underlayColCount*this.underlayColWidth;return e<0?e=0:e>t&&(e=t),e}function Pr(){return this._getColsWidth(0,this[hr].colCount-1)+Wr.call(this)}function Hr(){let t=this.getElement().clientHeight;for(let e=0;e<this.frozenRowCount;e++)t-=this.getRowHeight(e);t<0&&(t=0);let e=0;if(this.underlayRowCount>=0)e="auto"===this.underlayRowHeight?this.underlayRowCount*this.defaultRowHeight:this.underlayRowCount*this.underlayRowHeight;else if(e=t,"auto"===this.underlayRowHeight){for(let t=Math.max(this.rowCount+this.underlayRowCount,this.frozenRowCount,0);t<this.rowCount;t++)e-=this.getRowHeight(t)}else e+=this.underlayRowCount*this.underlayRowHeight;return e<0?e=0:e>t&&(e=t),e}function zr(){const t=this.getScrollHeightInternal(this[hr].rowCount);if("number"==typeof t)return Number(t);let e=this.defaultRowHeight*this[hr].rowCount;this[hr].rowHeightsMap.each(0,this[hr].rowCount-1,(t=>{e+=t-this.defaultRowHeight}));const o=Hr.call(this);return e+o}function Nr(t){const e=this[hr].scroll.left,o=this[hr].scroll.top,n=this[hr].scrollable.scrollLeft-e,i=this[hr].scrollable.scrollTop-o;this[hr].scroll={left:this[hr].scrollable.scrollLeft,top:this[hr].scrollable.scrollTop};const r=this._getVisibleRect();if(Math.abs(n)>=r.width||Math.abs(i)>=r.height)this._invalidateRect(r);else{const t=this[hr].context;if(t&&t.drawImage(this[hr].canvas,-n,-i),0!==n){const t=r.copy();if(n<0){if(t.width=-n,this[hr].frozenColCount>0){const e=_r.call(this);e&&(t.width+=e.width)}}else n>0&&(t.left=t.right-n);if(this._invalidateRect(t),n>0&&this[hr].frozenColCount>0){const t=_r.call(this);t&&this._invalidateRect(t)}}if(0!==i){const t=r.copy();if(i<0){if(t.height=-i,this[hr].frozenRowCount>0){const e=pr.call(this);e&&(t.height+=e.height)}}else i>0&&(t.top=t.bottom-i);if(this._invalidateRect(t),i>0&&this[hr].frozenRowCount>0){const t=pr.call(this);t&&this._invalidateRect(t)}}}}function Vr(t){const e=this,o=e.selection.focus,n=t?e.getMoveLeftColByKeyDownInternal(o):e.getMoveRightColByKeyDownInternal(o);0<=n&&n<e.colCount?e._moveFocusCell(n,o.row,!1):0>n?e._moveFocusCell(e.colCount-1,o.row,!1):e._moveFocusCell(0,o.row,!1)}function $r(t){const e=this,o=e.selection.focus,n=t?e.getMoveUpRowByKeyDownInternal(o):e.getMoveDownRowByKeyDownInternal(o);0<=n&&n<e.rowCount&&e._moveFocusCell(o.col,n,!1)}function Ur(t){var e,o,n,i,r,s,l,a,c,h,d,u,g,f,p;const{shiftKey:_,ctrlKey:w,metaKey:C,altKey:m}=t,y=I.getKeyCode(t);if(m)return;const v=_?this.selection.focus:this.selection.select;if(37===y){if(w||C)b(this,null,"W");else if(!R.call(this,"W"))return;I.cancel(t)}else if(y===P){if(t.ctrlKey||t.metaKey)b(this,"N",null);else if(!x.call(this,"N"))return;I.cancel(t)}else if(39===y){if(t.ctrlKey||t.metaKey)b(this,null,"E");else if(!R.call(this,"E"))return;I.cancel(t)}else if(y===H){if(t.ctrlKey||t.metaKey)b(this,"S",null);else if(!x.call(this,"S"))return;I.cancel(t)}else if(36===y)t.ctrlKey||t.metaKey?b(this,"N","W"):b(this,null,"W"),I.cancel(t);else if(35===y)t.ctrlKey||t.metaKey?b(this,"S","E"):b(this,null,"E"),I.cancel(t);else if(9===y&&(null===(e=this.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab))Vr.call(this,_),I.cancel(t);else if(y===W&&(null===(o=this.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter))$r.call(this,_),I.cancel(t);else if(65===y&&(null===(n=this.keyboardOptions)||void 0===n?void 0:n.selectAllOnCtrlA)&&(w||C)){let e=0,o=0;_?((null===(s=null===(r=null===(i=this.keyboardOptions)||void 0===i?void 0:i.selectAllOptions)||void 0===r?void 0:r.shiftCtrlA)||void 0===s?void 0:s.excludeFrozenCol)&&(e=this.frozenRowCount),(null===(c=null===(a=null===(l=this.keyboardOptions)||void 0===l?void 0:l.selectAllOptions)||void 0===a?void 0:a.shiftCtrlA)||void 0===c?void 0:c.excludeFrozenRow)&&(o=this.frozenRowCount)):((null===(u=null===(d=null===(h=this.keyboardOptions)||void 0===h?void 0:h.selectAllOptions)||void 0===d?void 0:d.ctrlA)||void 0===u?void 0:u.excludeFrozenCol)&&(e=this.frozenRowCount),(null===(p=null===(f=null===(g=this.keyboardOptions)||void 0===g?void 0:g.selectAllOptions)||void 0===f?void 0:f.ctrlA)||void 0===p?void 0:p.excludeFrozenRow)&&(o=this.frozenRowCount)),this.selection.range={start:{col:e,row:o},end:{col:this.colCount-1,row:this.rowCount-1}},this.invalidate(),I.cancel(t)}function b(t,e,o){const n="S"===e?t.rowCount-1:"N"===e?0:v.row,i="E"===o?t.colCount-1:"W"===o?0:v.col;t._moveFocusCell(i,n,_)}function x(t){let e;if("S"===t){if(e=this.getMoveDownRowByKeyDownInternal(v),this.rowCount<=e)return!1}else if(e=this.getMoveUpRowByKeyDownInternal(v),e<0)return!1;const{col:o}=v;return this._moveFocusCell(o,e,_),!0}function R(t,e=_){let o;if("E"===t){if(o=this.getMoveRightColByKeyDownInternal(v),this.colCount<=o)return!1}else if(o=this.getMoveLeftColByKeyDownInternal(v),o<0)return!1;const{row:n}=v;return this._moveFocusCell(o,n,e),!0}}function Kr(){const{handler:t,element:e,scrollable:o}=this[hr],r=t=>{const e=this._getMouseAbstractPoint(t);if(!e)return{};const o=this.getCellAt(e.x,e.y);if(o.col<0||o.row<0)return{abstractPos:e,cell:o};return{abstractPos:e,cell:o,eventArgs:{col:o.col,event:t,row:o.row}}},s=t=>{const e=this[hr].colWidthsLimit[t];let o=!0!==this.disableColumnResize;return e&&o&&(o=!0!==e.disableResize,o&&e.min&&e.max&&(o=e.max!==e.min)),o};t.on(e,"mousedown",(t=>{const e=r(t),o=e.abstractPos,i=e.eventArgs;if(o){if(i){const t=this.fireListeners(F.MOUSEDOWN_CELL,i);if(n.findIndex(t,(t=>!t))>=0)return}if(1===I.getMouseButtons(t))if(Gr.call(this,o.x,o.y))this[hr].selectionResizer.start(t);else{const e=jr.call(this,o.x,o.y);e>=0&&s(e)?this[hr].columnResizer.start(e,t):this[hr].cellSelector.start(t)}}})),t.on(e,"mouseup",(t=>{if(!this.hasListeners(F.MOUSEUP_CELL))return;const e=r(t).eventArgs;e&&this.fireListeners(F.MOUSEUP_CELL,e)}));let l=null,a=null;function c(t){a&&(clearTimeout(a),a=null)}t.on(e,"touchstart",(t=>{if(l){const e=r(t).eventArgs;if(e&&e.col===l.col&&e.row===l.row?this.fireListeners(F.DBLTAP_CELL,e):e||this.fireListeners(F.DBLTAP_UNDERLAY),l=null,t.defaultPrevented)return}else l=r(t).eventArgs,setTimeout((()=>{l=null}),350);a=setTimeout((()=>{a=null;const e=this._getMouseAbstractPoint(t);if(e)if(Gr.call(this,e.x,e.y))this[hr].selectionResizer.start(t);else{const o=jr.call(this,e.x,e.y,15);o>=0&&s(o)?this[hr].columnResizer.start(o,t):this[hr].cellSelector.start(t)}}),500)})),t.on(e,"touchcancel",c),t.on(e,"touchmove",c),t.on(e,"touchend",(t=>{a&&(clearTimeout(a),this[hr].cellSelector.select(t),a=null)}));let h=!1,d=null,u=null;const g=(t,e)=>{this.fireListeners(F.MOUSEENTER_CELL,{col:t.col,row:t.row,event:t.event,related:e}),d=t},f=t=>{const e=d;return d=null,e&&this.fireListeners(F.MOUSELEAVE_CELL,{col:e.col,row:e.row,related:t}),e||void 0},p=(t,e)=>{this.fireListeners(F.MOUSEOVER_CELL,{col:t.col,row:t.row,event:t.event,related:e}),u=t},_=t=>{const e=u;return u=null,e&&this.fireListeners(F.MOUSEOUT_CELL,{col:e.col,row:e.row,related:t}),e||void 0},w=o.getElement();t.on(w,"mouseover",(t=>{h=!0})),t.on(w,"mouseout",(t=>{h=!1,_()})),t.on(e,"mouseleave",(t=>{f()})),t.on(e,"mousemove",(t=>{const o=r(t),n=o.abstractPos,i=o.eventArgs;if(i){const t=d;if(t)if(this.fireListeners(F.MOUSEMOVE_CELL,i),t.col!==i.col||t.row!==i.row){const t={col:i.col,row:i.row},e=_(t),o=f(t);g(i,o),h&&p(i,e)}else h&&!u&&p(i);else g(i),h&&p(i),this.fireListeners(F.MOUSEMOVE_CELL,i)}else _(),f();if(this[hr].columnResizer.moving(t)||this[hr].selectionResizer.moving(t)||this[hr].cellSelector.moving(t))return;const l=e.style;if(n)if(Gr.call(this,n.x,n.y))l.cursor="crosshair";else{const t=jr.call(this,n.x,n.y);t>=0&&s(t)?l.cursor="col-resize":"col-resize"!==l.cursor&&"crosshair"!==l.cursor||(l.cursor="")}else"col-resize"!==l.cursor&&"crosshair"!==l.cursor||(l.cursor="")})),t.on(e,"click",(t=>{if(this[hr].columnResizer.lastMoving(t)||this[hr].selectionResizer.moving(t)||this[hr].cellSelector.lastMoving(t))return;if(!this.hasListeners(F.CLICK_CELL)&&!this.hasListeners(F.CLICK_UNDERLAY))return;if(R&&t.eventPhase===Event.AT_TARGET)return;const e=r(t).eventArgs;e?this.fireListeners(F.CLICK_CELL,e):this.fireListeners(F.CLICK_UNDERLAY)})),t.on(e,"contextmenu",(t=>{if(!this.hasListeners(F.CONTEXTMENU_CELL))return;const{eventArgs:e}=r(t);e&&this.fireListeners(F.CONTEXTMENU_CELL,e)})),t.on(e,"dblclick",(t=>{if(!this.hasListeners(F.DBLCLICK_CELL)&&!this.hasListeners(F.DBLCLICK_UNDERLAY))return;const e=r(t).eventArgs;e?this.fireListeners(F.DBLCLICK_CELL,e):this.fireListeners(F.DBLCLICK_UNDERLAY)})),this[hr].focusControl.onKeyDown((t=>{const e=this.fireListeners(F.KEYDOWN,t);if(n.findIndex(e,(t=>!1===t))>=0)return!1})),this[hr].selection.listen(F.SELECTED_CELL,(t=>{const e=this.fireListeners(F.SELECTED_CELL,t,t.selected);if(n.findIndex(e,(t=>!1===t))>=0)return!1})),o.onScroll((t=>{Nr.call(this,t),this.fireListeners(F.SCROLL,{event:t})})),this[hr].focusControl.onKeyDownMove((t=>{Ur.call(this,t)}));const m=()=>{let t="";const e=this[hr].selection.range,o=this.getCopyRangeInternal(e);for(let e=o.start.row;e<=o.end.row;e++){for(let n=o.start.col;n<=o.end.col;n++){const i=this.getCopyCellValue(n,e,o);if(C(i));else{const e=`${i}`;/^\[object .*\]$/.exec(e)||(t+=e)}n<o.end.col&&(t+="\t")}e<o.end.row&&(t+="\n")}return t};this[hr].focusControl.onCopy((t=>{let e=m(),o=n.find(this.fireListeners(F.COPY,t),i);return i(o)&&(e=o),e})),this[hr].focusControl.onCut((t=>{let e=m(),o=n.find(this.fireListeners(F.CUT,t),i);return i(o)&&(e=o),e})),this[hr].focusControl.onPaste((t=>{const e=t.value,o=t.event,r=this.hasListeners(F.PASTE)?n.find(this.fireListeners(F.PASTE,e,o),i):e;if(i(r)){const t=r.replace(/\r?\n$/,""),{col:e,row:n}=this[hr].selection.select,i=/[\r\n\u2028\u2029\t]/.test(t);let s=null;const l={col:e,row:n,value:r,normalizeValue:t,multi:i,get rangeBoxValues(){return null!=s?s:s=cr(t)},event:o};this.fireListeners(F.PASTE_CELL,l)}})),this[hr].focusControl.onInput((t=>{const e=this[hr].selection.select.col,o=this[hr].selection.select.row;this.fireListeners(F.INPUT_CELL,{col:e,row:o,value:t})})),this[hr].focusControl.onDelete((t=>{const{col:e,row:o}=this[hr].selection.select;this.fireListeners(F.DELETE_CELL,{col:e,row:o,event:t})})),this[hr].focusControl.onFocus((t=>{this.fireListeners(F.FOCUS_GRID,t),this[hr].focusedGrid=!0;const e=this[hr].selection.select.col,o=this[hr].selection.select.row;this.invalidateCell(e,o)})),this[hr].focusControl.onBlur((t=>{this.fireListeners(F.BLUR_GRID,t),this[hr].focusedGrid=!1;const e=this[hr].selection.select.col,o=this[hr].selection.select.row;this.invalidateCell(e,o)}))}function Gr(t,e,o=7){const n=this.selection.range,i=this.getCellRect(n.end.col,n.end.row);return!!(i.bottom-o<=e&&e<=i.bottom&&i.right-o<=t&&t<=i.right&&this.canDragSelection)}function jr(t,e,o=5){const n=this;if(n[hr].frozenRowCount<=0)return-1;const i=pr.call(this);if(i&&!i.inPoint(t,e))return-1;const r=n.getCellAt(t,e),s=n.getCellRect(r.col,r.row);return t<s.left+o?r.col-1:s.right-o<t?r.col:-1}function Yr(){let t=0;if(this[hr].frozenColCount>0){const e=_r.call(this);e&&(t=e.width)}let e=0;if(this[hr].frozenRowCount>0){const t=pr.call(this);t&&(e=t.height)}return new Ie(this[hr].scrollable.scrollLeft+t,this[hr].scrollable.scrollTop+e,this[hr].canvas.width-t,this[hr].canvas.height-e)}class Xr extends Ne{constructor(t={}){var e,o;super();const{rowCount:n=10,colCount:i=10,frozenColCount:r=0,frozenRowCount:s=0,defaultRowHeight:l,defaultColWidth:a,highlightBorderWidth:c,font:h,underlayRowCount:d=0,underlayColCount:u=0,underlayRowHeight:g="auto",underlayColWidth:f="auto",underlayBackgroundColor:p,borderMode:_="none",borderColor:w="",borderWidth:C=0,keyboardOptions:m,parentElement:y,singleSelection:v,disableColumnResize:b}=t,x=this[hr]={};Bt.initDocument(),x.element=function(){const t=document.createElement("div");return t.classList.add("kaka-grid"),t}(),x.canvas=Gi.transform(document.createElement("canvas")),x.context=x.canvas.getContext("2d",{alpha:!1}),x.scrollable=Bt.isPerfectScrollbar()?new Xi:new Zi(x.canvas),x.handler=new Lt,x.selection=new lr(this,(t=>this.updateSelectionRange(t))),x.focusControl=new sr(this,x.scrollable.getElement(),x.scrollable),x.rowCount=n,x.colCount=i,x.frozenColCount=r,x.frozenRowCount=s,x.underlayRowCount=d,x.underlayColCount=u,x.underlayRowHeight=g,x.underlayColWidth=f,x.borderMode=_,x.borderColor=w,x.borderWidth=C,x.defaultRowHeight=l,x.defaultColWidth=a,x.highlightBorderWidth=c,x.font=h,x.underlayBackgroundColor=p,x.keyboardOptions=m||{},x.keyboardOptions.moveCellOnEnter=null===(e=x.keyboardOptions.moveCellOnEnter)||void 0===e||e,x.keyboardOptions.moveCellOnTab=null===(o=x.keyboardOptions.moveCellOnTab)||void 0===o||o,x.singleSelection=!!v,x.disableColumnResize=!!b||!!t.disableColResize,x.rowHeightsMap=new ji,x.colWidthsMap=new ji,x.colWidthsLimit={},x.colWidthsOffset={},x.calcWidthContext={_:x,get full(){return this._.canvas.width},get em(){return Nn(this._.context,this._.font).width}},x.columnResizer=new tr(this),x.selectionResizer=new ar(this),x.cellSelector=new Qi(this),x.drawCells={},x.cellTextOverflows={},x.cellTypeOverflows={},x.focusedGrid=!1,x.element.appendChild(x.canvas),x.element.appendChild(x.scrollable.getElement()),x.scroll={left:0,top:0},this.updateScroll(),y?(y.appendChild(x.element),this.updateSize()):this.updateSize(),Kr.call(this),this.bindEventsInternal()}static get EVENT_TYPE(){return F}getElement(){return this[hr].element}get canvas(){return this[hr].canvas}focus(){const{col:t,row:e}=this[hr].selection.select;this.focusCell(t,e)}hasFocusGrid(){return this[hr].focusedGrid}get selection(){return this[hr].selection}get rowCount(){return this[hr].rowCount}set rowCount(t){if(this[hr].rowCount=t,this.updateScroll(),this[hr].selection._updateGridRange()){const{col:t,row:e}=this[hr].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get colCount(){return this[hr].colCount}set colCount(t){if(this[hr].colCount=t,this.updateScroll(),this[hr].selection._updateGridRange()){const{col:t,row:e}=this[hr].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get frozenColCount(){return this[hr].frozenColCount}set frozenColCount(t){this[hr].frozenColCount=t}get frozenRowCount(){return this[hr].frozenRowCount}set frozenRowCount(t){this[hr].frozenRowCount=t}get defaultRowHeight(){return this[hr].defaultRowHeight||this.getDefaultRowHeight()}set defaultRowHeight(t){this[hr].defaultRowHeight=t}get defaultColWidth(){return this[hr].defaultColWidth||this.getDefaultColWidth()}set defaultColWidth(t){this[hr].defaultColWidth=t}get highlightBorderWidth(){return this[hr].highlightBorderWidth||this.getHighlightBorderWidth()}set highlightBorderWidth(t){this[hr].highlightBorderWidth=t}get font(){return this[hr].font||this.getDefaultFont()}set font(t){this[hr].font=t}get underlayRowCount(){return this[hr].underlayRowCount}set underlayRowCount(t){this[hr].underlayRowCount=t}get underlayColCount(){return this[hr].underlayColCount}set underlayColCount(t){this[hr].underlayColCount=t}get underlayRowHeight(){return this[hr].underlayRowHeight}set underlayRowHeight(t){this[hr].underlayRowHeight=t}get underlayColWidth(){return this[hr].underlayColWidth}set underlayColWidth(t){this[hr].underlayColWidth=t}get underlayBackgroundColor(){return this[hr].underlayBackgroundColor||this.getDefaultUnderlayBackgroundColor()}set underlayBackgroundColor(t){this[hr].underlayBackgroundColor=t}get borderColor(){return this[hr].borderColor||this.getDefaultBorderColor()}set borderColor(t){this[hr].borderColor=t}get borderWidth(){return this[hr].borderWidth||this.getDefaultBorderWidth()}set borderWidth(t){this[hr].borderWidth=t}get borderMode(){return this[hr].borderMode||this.getDefaultBorderMode()}set borderMode(t){this[hr].borderMode=t}get keyboardOptions(){var t;return null!==(t=this[hr].keyboardOptions)&&void 0!==t?t:null}set keyboardOptions(t){this[hr].keyboardOptions=null!=t?t:void 0}get singleSelection(){return this[hr].singleSelection}set singleSelection(t){this[hr].singleSelection=t}get disableColumnResize(){return this[hr].disableColumnResize}set disableColumnResize(t){this[hr].disableColumnResize=t}get disableColResize(){return window.console.warn("'disableColResize' is deprecated, please use 'disableColumnResize' instead"),this.disableColumnResize}set disableColResize(t){window.console.warn("'disableColResize' is deprecated, please use 'disableColumnResize' instead"),this.disableColumnResize=t}get canDragSelection(){return this[hr].selectionResizer.canStart()}configure(t,e){const o=this[hr].config||(this[hr].config={});return i(e)&&(o[t]=e),o[t]}updateSize(){const{canvas:t}=this[hr];t.style.width="",t.style.height="";let e=t.offsetWidth;if(!e){const o=t.parentElement;null!==o&&(e=o.offsetWidth-Bt.getScrollBarSize())}e=Math.floor(e);let o=t.offsetHeight;if(!o){const e=t.parentElement;null!==e&&(o=e.offsetHeight-Bt.getScrollBarSize())}o=Math.floor(o),t.width=e,t.height=o,t.style.width=`${e}px`,t.style.height=`${o}px`;const n=this[hr].selection.select;this[hr].focusControl.setFocusRect(this.getFocusRectInternal(n.col,n.row))}updateScroll(){!function(t){const e={};let o=0;for(let n=0;n<t.colCount;n++){const i=t.getColWidth(n),r=Rr(t,n);i!==r&&(o+=r-i,e[n]=0)}if(o=Math.round(o),o>0)for(const t in e)if(e.hasOwnProperty(t)&&(e[t]+=1,o--,!o))break;t[hr].colWidthsOffset=e}(this);const{scrollable:t}=this[hr],e=zr.call(this),o=Pr.call(this);return e===t.scrollHeight&&o===t.scrollWidth?(t.update(),!1):(t.setScrollSize(o,e),this[hr].scroll={left:t.scrollLeft,top:t.scrollTop},!0)}getRowHeight(t){return Or.call(this,t)}setRowHeight(t,e){Fr.call(this,t,e)}getColWidth(t){return Ar.call(this,t)}setColWidth(t,e){Mr.call(this,t,e)}getMaxColWidth(t){const e=this[hr].colWidthsLimit[t];return e&&e.max||void 0}setMaxColWidth(t,e){(this[hr].colWidthsLimit[t]||(this[hr].colWidthsLimit[t]={})).max=e}getMinColWidth(t){const e=this[hr].colWidthsLimit[t];return e&&e.min||void 0}setMinColWidth(t,e){(this[hr].colWidthsLimit[t]||(this[hr].colWidthsLimit[t]={})).min=e}getColDisableResize(t){const e=this[hr].colWidthsLimit[t];return e&&e.disableResize||void 0}setColDisableResize(t,e){(this[hr].colWidthsLimit[t]||(this[hr].colWidthsLimit[t]={})).disableResize=e}getCellRect(t,e){const o=this.isFrozenCell(t,e);let n=this._getColsWidth(0,t-1);const i=Ar.call(this,t);o&&o.col&&(n+=this[hr].scroll.left);let r=Dr.call(this,0,e-1);const s=Or.call(this,e);return o&&o.row&&(r+=this[hr].scroll.top),new Ie(n,r,i,s)}getCellRelativeRect(t,e){return this._toRelativeRect(this.getCellRect(t,e))}getCellsRect(t,e,o,n){const i=this.isFrozenCell(t,e),r=this.isFrozenCell(o,n);let s=this._getColsWidth(0,t-1),l=this._getColsWidth(t,o);if(i&&i.col){const e=this[hr].scroll.left;s+=e,r&&r.col||(l-=e,l=Math.max(l,this._getColsWidth(t,this.frozenColCount-1)))}let a=Dr.call(this,0,e-1),c=Dr.call(this,e,n);if(i&&i.row){const t=this[hr].scroll.top;a+=t,r&&r.row||(c-=t,c=Math.max(c,this._getColsWidth(e,this.frozenRowCount-1)))}return new Ie(s,a,l,c)}getCellRangeRect(t){return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row)}isFrozenCell(t,e){const{frozenRowCount:o,frozenColCount:n}=this[hr],i=o>0&&e<o,r=n>0&&t<n;return i||r?{col:r,row:i}:null}getRowAt(t){const e=gr.call(this,t);if(e)return e.row;const o=dr.call(this,t);return o?o.row:-1}getColAt(t){const e=fr.call(this,t);if(e)return e.col;const o=ur.call(this,t);return o?o.col:-1}getCellAt(t,e){return{col:this.getColAt(t),row:this.getRowAt(e)}}makeVisibleCell(t,e){const o=this.isFrozenCell(t,e);if(o&&o.col&&o.row)return;const n=this.getCellRect(t,e),i=Yr.call(this);if(i.contains(n))return;const{scrollable:r}=this[hr];o&&o.col||(n.left<i.left?r.scrollLeft-=i.left-n.left:i.right<n.right&&(r.scrollLeft-=i.right-n.right)),o&&o.row||(n.top<i.top?r.scrollTop-=i.top-n.top:i.bottom<n.bottom&&(r.scrollTop-=i.bottom-n.bottom))}setFocusCursor(t,e){const o=this[hr].focusControl,n=o.editMode;o.setFocusRect(this.getFocusRectInternal(t,e)),this._updatedSelection(),n&&!o.editMode&&o.resetInputStatus()}_updatedSelection(){const{focusControl:t}=this[hr],{col:e,row:o}=this[hr].selection.select,i=this.fireListeners(F.EDITABLEINPUT_CELL,{col:e,row:o}),r=n.findIndex(i,(t=>!!t))>=0;t.editMode=r,r&&(t.storeInputStatus(),t.setDefaultInputStatus(),this.fireListeners(F.MODIFY_STATUS_EDITABLEINPUT_CELL,{col:e,row:o,input:t.input}))}focusCell(t,e){const o=this.selection.range.start.col,n=this.selection.range.start.row,i=this.selection.range.end.col,r=this.selection.range.end.row;this.setFocusCursor(t,e),this._forceFocusCell(),this.selection.select={col:t,row:e},this.invalidateGridRect(o,n,i,r),this.invalidateCell(t,e)}invalidateCell(t,e){this.invalidateGridRect(t,e)}invalidateGridRect(t,e,o=t,n=e){const i=this.getOffsetInvalidateCells();i>0&&(t-=i,e-=i,o+=i,n+=i);const r=this._getVisibleRect(),s=this.getCellsRect(t,e,o,n),l=r.intersection(s);if(l){const{frozenColCount:t,frozenRowCount:e}=this[hr];if(t>0&&o>=t){const t=_r.call(this);t&&t.intersection(l)&&(l.left=Math.min(t.right-1,t.left))}if(e>0&&n>=e){const t=pr.call(this);t&&t.intersection(l)&&(l.top=Math.min(t.bottom-1,l.top))}this._invalidateRect(l)}}invalidateCellRange(t){this.invalidateGridRect(t.start.col,t.start.row,t.end.col,t.end.row)}invalidate(){const t=this._getVisibleRect();this._invalidateRect(t)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this._getVisibleRect(),o=t>0?e.top+Dr.call(this,0,t-1):e.top,n=dr.call(this,o);if(!n)return 0;const i=Math.max(n.top>=o?n.row:n.row+1,t);let r=Dr.call(this,0,i-1),s=0;const{rowCount:l}=this;for(let t=i;t<l;t++){const o=r+Or.call(this,t);if(e.bottom<o)break;s++,r=o}return s}get visibleColCount(){const{frozenColCount:t}=this,e=this._getVisibleRect(),o=t>0?e.left+this._getColsWidth(0,t-1):e.left,n=ur.call(this,o);if(!n)return 0;const i=Math.max(n.left>=o?n.col:n.col+1,t);let r=this._getColsWidth(0,i-1),s=0;const{colCount:l}=this;for(let t=i;t<l;t++){const o=r+Ar.call(this,t);if(e.right<o)break;s++,r=o}return s}get topRow(){const{frozenRowCount:t}=this,e=this._getVisibleRect(),o=t>0?e.top+Dr.call(this,0,t-1):e.top,n=dr.call(this,o);return n?Math.max(n.top>=o?n.row:n.row+1,t):0}get leftCol(){const{frozenColCount:t}=this,e=this._getVisibleRect(),o=t>0?e.left+this._getColsWidth(0,t-1):e.left,n=ur.call(this,o);return n?Math.max(n.left>=o?n.col:n.col+1,t):0}get scrollTop(){return this[hr].scrollable.scrollTop}set scrollTop(t){this[hr].scrollable.scrollTop=t}get scrollLeft(){return this[hr].scrollable.scrollLeft}set scrollLeft(t){this[hr].scrollable.scrollLeft=t}getCellOverflowText(t,e){let o=this.getCellOverflowTextInternal({col:t,row:e})||null;if(!o){const n=`${t}:${e}`;o=this[hr].cellTextOverflows[n]||null}return o}setCellOverflowText(t,e,o){const n=`${t}:${e}`;o?this[hr].cellTextOverflows[n]="string"==typeof o?o.trim():"":delete this[hr].cellTextOverflows[n]}getCellOverflowType(t,e){let o=this.getCellOverflowTypeInternal({col:t,row:e})||null;if(!o){const n=`${t}:${e}`;o=this[hr].cellTypeOverflows[n]||null}return o}setCellOverflowType(t,e,o){const n=`${t}:${e}`;o?this[hr].cellTypeOverflows[n]="string"==typeof o?o.trim():"":delete this[hr].cellTypeOverflows[n]}addDisposable(t){if(!t||!t.dispose||"function"!=typeof t.dispose)throw new Error("not disposable!");(this[hr].disposables=this[hr].disposables||[]).push(t)}dispose(){super.dispose();const t=this[hr];t.handler.dispose(),t.scrollable.dispose(),t.focusControl.dispose(),t.columnResizer.dispose(),t.selectionResizer.dispose(),t.cellSelector.dispose(),t.disposables&&(t.disposables.forEach((t=>t.dispose())),t.disposables=null);const e=t.element.parentElement;e&&e.removeChild(t.element)}getAttachCellsArea(t){return{element:this.getElement(),rect:this.getAttachCellsAreaInternal(t),padding:this.getAttachCellsPaddingInternal(t)}}onKeyDownMove(t){Ur.call(this,t)}_getMouseAbstractPoint(t){let e;e=I.isTouchEvent(t)?t.changedTouches[0]:t;const o=e.clientX||e.pageX+window.scrollX,n=e.clientY||e.pageY+window.scrollY,i=this[hr].canvas.getBoundingClientRect();if(i.right<=o)return null;if(i.bottom<=n)return null;return{x:o-i.left+this[hr].scroll.left,y:n-i.top+this[hr].scroll.top}}_getMouseRelativePoint(t){const e=this._getMouseAbstractPoint(t);return e?{x:e.x-this[hr].scroll.left,y:e.y-this[hr].scroll.top}:null}_getColsWidth(t,e){const o=Br.call(this,this.defaultColWidth);let n=o*(e-t+1);this[hr].colWidthsMap.each(t,e,((t,e)=>{n+=Er.call(this,e,Br.call(this,t))-o}));for(let i=t;i<=e;i++){if(this[hr].colWidthsMap.has(i))continue;const t=Er.call(this,i,o);t!==o&&(n+=t-o)}return n}_moveFocusCell(t,e,o,n){const i=this.getOffsetInvalidateCells();function r(t){return i>0&&(t.start.col-=i,t.start.row-=i,t.end.col+=i,t.end.row+=i),t}const s=r(this.selection.range),l=this.getCellRangeRect(s);this.selection._setFocusCell(t,e,o),n||this.makeVisibleCell(t,e),this.setFocusCursor(t,e),this._forceFocusCell();const a=r(this.selection.range),c=this.getCellRangeRect(a);if(c.intersection(l)){const t=Ie.max(c,l);this._invalidateRect(t)}else this._invalidateRect(l),this._invalidateRect(c)}_forceFocusCell(){this[hr].focusControl.focus()}_resetColWidthOffset(t){delete this[hr].colWidthsOffset[t]}_adjustColWidth(t,e){const o=this[hr].colWidthsOffset[t]||0,n=kr.call(this,t);return Math.max(Lr(n,e),0)+o}_getVisibleRect(){const t=this[hr].scroll.left,e=this[hr].scroll.top,o=this[hr].canvas.width,n=this[hr].canvas.height;return new Ie(t,e,o,n)}_invalidateRect(t){const e=this._getInitContext();if(e){const o=this._getVisibleRect(),n=this[hr].rowCount,i=dr.call(this,Math.max(o.top,t.top))||{row:n,top:Dr.call(this,0,n-1)},r=ur.call(this,Math.max(o.left,t.left))||{col:this[hr].colCount,left:this._getColsWidth(0,this[hr].colCount-1)},s=Math.min(o.bottom,t.bottom),l=Math.min(o.right,t.right),a=gr.call(this,Math.max(o.top,t.top)),c=fr.call(this,Math.max(o.left,t.left)),h=new ir,d=()=>{const t="content-border"===this.borderMode;if("grid-border"===this.borderMode||t){let i=this[hr].canvas.width,r=this[hr].canvas.height;if(t){let t=this._getColsWidth(0,this[hr].colCount-1)-o.left,e=Dr.call(this,0,n-1)-o.top;i=Math.min(this[hr].canvas.width,t),r=Math.min(this[hr].canvas.height,e)}e.save();try{e.beginPath(),e.lineWidth=this.borderWidth||0,e.strokeStyle=this.borderColor||"transparent",e.rect(0+e.lineWidth/2,0+e.lineWidth/2,i-e.lineWidth,r-e.lineWidth),e.stroke()}finally{e.restore()}}},u=(t,i)=>{if(t>=n-1&&this[hr].canvas.height>i-o.top){const t=i-o.top;"transparent"===this.underlayBackgroundColor?e.clearRect(0,t,this[hr].canvas.width,this[hr].canvas.height-t):(e.save(),e.beginPath(),e.fillStyle=this.underlayBackgroundColor||"#F6F6F6",e.rect(0,t,this[hr].canvas.width,this[hr].canvas.height-t),e.fill(),e.restore())}};let g=0;if(a){let t=a.top;const n=this[hr].frozenRowCount;for(let i=a.row;i<n;i++){const n=Or.call(this,i);if(vr.call(this,e,c,r,l,i,t,n,o,0,h),t+=n,s<=t)return u(i,t),d(),void h.draw(e)}g=t}let f=i.top;for(let t=i.row;t<n;t++){const n=Or.call(this,t);if(vr.call(this,e,c,r,l,t,f,n,o,g,h),f+=n,s<=f)return u(t,f),d(),void h.draw(e)}u(n-1,f),d(),h.draw(e)}}_getInitContext(){const t=this[hr].context;return t&&(t.fillStyle="white",t.strokeStyle="black",t.textAlign="left",t.textBaseline="top",t.lineWidth=1,t.font=this.font||"16px sans-serif"),t}_toRelativeRect(t){const e=t.copy(),o=this._getVisibleRect();return e.offsetLeft(-o.left),e.offsetTop(-o.top),e}_storeAutoColWidthExprs(){let t=null;for(let e=0;e<this[hr].colCount;e++){Ir(Sr.call(this,e))&&Mr.call(this,e,t||(t=Tr.call(this)))}}resize(){this.getElement().offsetParent&&(this.updateSize(),this.updateScroll(),this.invalidate())}getCopyCellValue(t,e,o){}bindEventsInternal(){}getTargetRowAtInternal(t){}getRowsHeightInternal(t,e){}getRowHeightInternal(t){}getScrollHeightInternal(t){}getMoveLeftColByKeyDownInternal({col:t}){return t-1}getMoveRightColByKeyDownInternal({col:t}){return t+1}getMoveUpRowByKeyDownInternal({row:t}){return t-1}getMoveDownRowByKeyDownInternal({row:t}){return t+1}getOffsetInvalidateCells(){return 0}getCopyRangeInternal(t){return t}getAttachCellsAreaInternal(t){return this._toRelativeRect(this.getCellRangeRect(t))}getAttachCellsPaddingInternal(t){return[0,3,0,3]}getFocusRectInternal(t,e){return this.getCellRect(t,e)}getDefaultRowHeight(){return 40}getDefaultColWidth(){return 80}getHighlightBorderWidth(){return 2}updateSelectionRange(t){return t}getCellOverflowTextInternal(t){return""}getCellOverflowTypeInternal(t){return""}getDefaultBorderMode(){return"none"}fireListeners(t,...e){return super.fireListeners(t,...e)}}const qr={DrawGrid:Xr,EVENT_TYPE:F};class Zr extends di{constructor(t){super(t),this._rCache={},this._fCache={}}static get EVENT_TYPE(){return di.EVENT_TYPE}static ofArray(t){return new Zr({get:e=>t[e],length:t.length,source:t})}getOriginal(t){return this._rCache&&this._rCache[t]?this._rCache[t]:super.getOriginal(t)}getOriginalField(t,e){const o=this._fCache&&this._fCache[t];if(o){const t=o.get(e);if(t)return t}return super.getOriginalField(t,e)}setOriginalField(t,e,o){const n=this._fCache;return n&&n[t]&&delete n[t],super.setOriginalField(t,e,o)}clearCache(){this._rCache&&(this._rCache={}),this._fCache&&(this._fCache={})}fieldPromiseCallBackInternal(t,e,o){!function(t,e,o,n){(t[e]||(t[e]=new Map)).set(o,n)}(this._fCache,t,e,o)}recordPromiseCallBackInternal(t,e){this._rCache[t]=e}dispose(){super.dispose()}}class Jr{constructor(t){this._dataSource=t,this._curIndex=-1,this._data=[]}hasNext(){const t=this._curIndex+1;return this._dataSource.length>t}next(){const t=this._curIndex+1,e=this._getIndexData(t);return this._curIndex=t,e}movePrev(){this._curIndex--}_getIndexData(t,e){const o=this._dataSource,n=this._data;if(t<n.length)return n[t];if(o.length<=t)return;const i=this._dataSource.get(t);if(n[t]=i,C(i)&&(i.then((e=>{n[t]=e})),!e))for(let e=1;e<=100;e++)this._getIndexData(t+e,!0);return i}}class Qr{constructor(t,e,o){this._cancel=!1,this._owner=t,this._dataSourceItr=new Jr(e),this._filter=o,this._filteredList=[],this._queues=[]}get filter(){return this._filter}get(t){if(this._cancel)return;const e=this._filteredList;if(t<e.length)return e[t];const o=this._queues,n=o[t];return n||(o[t]||this._findIndex(t))}cancel(){this._cancel=!0}_findIndex(t){if(window.Promise){const e=Date.now()+100;let o=0;return this._findIndexWithTimeout(t,(()=>(o++,o>=100&&(o=0,e<Date.now()))))}return this._findIndexWithTimeout(t,(()=>!1))}_findIndexWithTimeout(t,e){const o=this._filteredList,n=this._filter,i=this._dataSourceItr,r=this._queues;for(;i.hasNext();){if(this._cancel)return;const s=i.next();if(C(s))return i.movePrev(),r[t]=s.then((e=>(r[t]=null,this.get(t))));if(n(s)&&(o.push(s),t<o.length))return o[t];if(e()){const e=new Promise((t=>{setTimeout((()=>{t(void 0)}),300)})).then((()=>(r[t]=null,this.get(t))));return r[t]=e,e}}this._owner.length=o.length}}class ts extends di{constructor(t,e){super(t),this._filterData=null,this._dataSource=t,this.filter=e;const o=this._handler=new Lt;o.on(t,ts.EVENT_TYPE.UPDATED_ORDER,(()=>{this.filter=this.filter}));for(const e in ts.EVENT_TYPE)if(ts.EVENT_TYPE.hasOwnProperty(e)){const n=ts.EVENT_TYPE[e];o.on(t,n,((...t)=>this.fireListeners(n,...t)))}}static get EVENT_TYPE(){return di.EVENT_TYPE}get filter(){var t;return(null===(t=this._filterData)||void 0===t?void 0:t.filter)||null}set filter(t){this._filterData&&this._filterData.cancel(),this._filterData=t?new Qr(this,this._dataSource,t):null,this.setLength(this._dataSource.length)}getOriginal(t){return this._filterData?this._filterData.get(t):super.getOriginal(t)}sort(t,e){return this._dataSource.sort(t,e)}get source(){return this._dataSource.source}get dataSource(){return this._dataSource}dispose(){this._handler.dispose(),super.dispose()}refreshInternal(){this.filter=this.filter}}var es;function os(t,e,o){const n=[];for(const i of e){const e=i.field,r=JSON.stringify(t[i.field])||"";o[e]=o[e]||{},o[e][r]=!0,n.push(r)}return n.join("_")}!function(t){t[t.count=0]="count",t[t.sum=1]="sum",t[t.avg=2]="avg",t[t.max=3]="max",t[t.min=4]="min"}(es||(es={}));const ns={CachedDataSource:Zr,DataSource:di,FilterDataSource:ts,PivotDataSource:class extends di{constructor(t,e){super(t),this._records=[],this._keysMap={},this._distinctMap={},this._dataSource=t,this._options=e,this.refresh()}static get EVENT_TYPE(){return di.EVENT_TYPE}get options(){return this._options}getOriginal(t){return this._records[t]}refresh(){this._keysMap={};const t={},e=this._options.rowPivots||[],o=this._options.colPivots||[],n=new Date;for(let n=0;n<this._dataSource.length;n++){const i=this._dataSource.get(n),r=os(i,e,t),s=os(i,o,t);this._keysMap[r]=this._keysMap[r]||{},this._keysMap[r][s]=this._keysMap[r][s]||[],this._keysMap[r][s].push(i)}this._distinctMap={};for(const e in t)if(t.hasOwnProperty(e)){this._distinctMap[e]=[];const o=t[e];for(const t in o)o.hasOwnProperty(t)&&this._distinctMap[e].push(t)}const i=new Date,r=Number(i)-Number(n);window.console.log(r),this._records=[],this.length=this._records.length}},TreeDataSource:xi};class is{constructor(t={}){this._disabled=t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled!==t&&(this._disabled=t,this.onChangeDisabledInternal())}clone(){return new is(this)}bindGridEvent(t,e){return[]}onChangeDisabledInternal(){}}function rs(t,e,{action:o,mouseOver:n,mouseOut:i}){function r(o,n){return t.getLayoutCellId(o,n)===e}let s;return[t.listen(F.CLICK_CELL,(t=>{r(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(F.MOUSEOVER_CELL,(e=>{r(e.col,e.row)&&(n&&!n({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer",s=!0))})),t.listen(F.MOUSEMOVE_CELL,(e=>{r(e.col,e.row)&&s&&!t.getElement().style.cursor&&(t.getElement().style.cursor="pointer")})),t.listen(F.MOUSEOUT_CELL,(e=>{r(e.col,e.row)&&(i&&i({col:e.col,row:e.row}),t.getElement().style.cursor="",s=!1)}))]}function ss(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,W,32],[t.listen(F.KEYDOWN,(i=>{var r;if(-1===n.indexOf(i.keyCode))return;if((null===(r=t.keyboardOptions)||void 0===r?void 0:r.moveCellOnEnter)&&i.keyCode===W)return;const s=t.selection.select;var l,a;(l=s.col,a=s.row,t.getLayoutCellId(l,a)===e)&&(o({col:s.col,row:s.row}),I.cancel(i.event))}))]}const ls=(t,e,o)=>"function"==typeof t?!!t(e,o):!!t;class as extends is{bindGridEvent(t,e){const o=this.getState(t),n=({col:e,row:n})=>{const i=t.getCellRange(e,n),r=`${i.start.col}:${i.start.row}`;if(ls(this.disabled,t,{col:i.start.col,row:i.start.row})||o.block[r])return;const s=t.getHeaderValue(i.start.col,i.start.row);t.setHeaderValue(i.start.col,i.start.row,!s);ht(200,(e=>{1===e?delete o.elapsed[r]:o.elapsed[r]=e,t.invalidateCellRange(i)}))};return[...rs(t,e,{action:n,mouseOver:e=>{const n=t.getCellRange(e.col,e.row);return!ls(this.disabled,t,{col:n.start.col,row:n.start.row})&&(o.mouseActiveCell={col:e.col,row:e.row},t.invalidateCellRange(n),!0)},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...ss(t,e,{action:n,acceptKeys:[W,32]})]}}const cs=X();class hs extends as{clone(){return new hs(this)}getState(t){let e=t[cs];return e||(e={elapsed:{},block:{}},S.setReadonly(t,cs,e)),e}}const ds=q();class us extends as{clone(){return new us(this)}getState(t){let e=t[ds];return e||(e={elapsed:{},block:{}},S.setReadonly(t,ds,e)),e}}class gs extends is{constructor(t={}){var e;super(t),this._sort=null===(e=t.sort)||void 0===e||e}get sort(){return this._sort}set sort(t){this._sort=t,this.onChangeDisabledInternal()}clone(){return new gs(this)}_executeSort(t,e){if("function"==typeof this._sort)this._sort({order:t.order||"asc",col:t.col,row:t.row,grid:e});else{const o=Math.min(e.recordRowCount-1,t.row)+e.frozenRowCount,n=e.getField(t.col,o);if(null==n)return;e.dataSource.sort(n,t.order||"asc")}}bindGridEvent(t,e){return[...rs(t,e,{action:o=>{if(ls(this.disabled,t,o))return;const n=t.sortState;let i;const r=t.getCellRange(o.col,o.row);var s,l;s=n.col,l=o.row,i=t.getLayoutCellId(s,l)===e?{col:r.start.col,order:"asc"===n.order?"desc":"asc",row:r.start.row}:{col:r.start.col,order:"asc",row:r.start.row},t.sortState=i,this._executeSort(i,t),t.invalidateGridRect(0,0,t.colCount-1,t.rowCount-1)},mouseOver:e=>!ls(this.disabled,t,e)})]}}class fs extends gs{get disabled(){return this._disabled}}const ps={SORT:new fs,CHECK:new class extends hs{get disabled(){return this._disabled}},SWITCH:new class extends us{get disabled(){return this._disabled}}};function _s(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return ps[e]||_s(null)}return t}}const ws={CHANGE_STYLE:"change_style"};let Cs,ms,ys,vs,bs,xs,Rs,Es;class Ls extends Ne{constructor({bgColor:t}={}){super(),this._bgColor=t}static get EVENT_TYPE(){return ws}static get DEFAULT(){return Cs||(Cs=new Ls)}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(ws.CHANGE_STYLE)}clone(){return new Ls(this)}}class Ss extends Ls{constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}static get DEFAULT(){return ms||(ms=new Ss)}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new Ss(this)}}class ks extends Ss{constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._padding=t.padding,this._textOverflow=t.textOverflow||"ellipsis",this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp||"auto"}static get DEFAULT(){return ys||(ys=new ks)}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get padding(){return this._padding}set padding(t){this._padding=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}clone(){return new ks(this)}}class Is extends ks{constructor(t={}){super(u(t,{textAlign:"center"})),this._uncheckBgColor=t.uncheckBgColor,this._checkBgColor=t.checkBgColor,this._borderColor=t.borderColor}static get DEFAULT(){return vs||(vs=new Is)}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new Is(this)}}class Ts extends Is{static get DEFAULT(){return bs||(bs=new Ts)}constructor(t={}){super(t)}clone(){return new Ts(this)}}class Bs extends ks{constructor(t={}){super(t),this._sortArrowColor=t.sortArrowColor}static get DEFAULT(){return xs||(xs=new Bs)}get sortArrowColor(){return this._sortArrowColor}set sortArrowColor(t){this._sortArrowColor=t,this.doChangeStyle()}clone(){return new Bs(this)}}class As extends Is{static get DEFAULT(){return Rs||(Rs=new As)}constructor(t={}){super(t)}clone(){return new As(this)}}class Ms extends ks{static get DEFAULT(){return Es||(Es=new Ms)}constructor(t={}){super(t)}clone(){return new Ms(this)}}function Os(t,e,o){return t?t instanceof Ls?t:"function"==typeof t?Os(t(e),e,o):"string"==typeof t?e&&t in e?Os(e[t],e,o):new o({}):new o(t):o.DEFAULT}class Ds{constructor(t={}){this.onDrawCell=this.onDrawCell.bind(this)}get StyleClass(){return Ls}onDrawCell(t,e,o,n){const{style:i,drawCellBase:r}=e,s=n.getGridCanvasHelper();r(),this.drawInternal(this.convertInternal(t),o,Os(i,n.headerValues,this.StyleClass),s,n,e)}convertInternal(t){return"function"==typeof t&&(t=t()),i(t)?`${t}`:""}bindGridEvent(t,e){return[]}}class Fs extends Ds{drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:l,textBaseline:a,borderColor:c,checkBgColor:h,uncheckBgColor:d,bgColor:u,color:g,font:f,textOverflow:p}=o;u&&s({bgColor:u});const{col:_,row:w}=e,C=r.getCellRange(_,w),m=`${C.start.col}:${C.start.row}`,y=this.getState(r),v=null==y?void 0:y.elapsed[m],b=r.getHeaderValue(C.start.col,C.start.row),x={textAlign:l,textBaseline:a,borderColor:c,checkBgColor:h,uncheckBgColor:d};i(v)&&(x.animElapsedTime=v);const R=this.getInlineCheck(n,!!b,e,x);n.text([R,t],e,{color:g,font:f,textAlign:l,textBaseline:a,textOverflow:p})}}const Ws=X();class Ps extends Fs{get StyleClass(){return Ts}clone(){return new Ps(this)}getState(t){let e=t[Ws];return e||(e={elapsed:{},block:{}},S.setReadonly(t,Ws,e)),e}getInlineCheck(t,e,o,n){return t.buildCheckBoxInline(e,o,n)}}var Hs={loadIcons(t,e,o,n){if(t){const n=ke.toNormarizeArray(t);n.forEach((t=>{o.testFontLoad(t.font,t.content,e)})),t=n}n(t,e)}};class zs extends Ds{get StyleClass(){return ks}drawInternal(t,e,o,n,r,{drawCellBase:s,getHeaderIcon:l}){const{textAlign:a,textBaseline:c,color:h,font:d,bgColor:u,textOverflow:g,padding:f,lineHeight:p,autoWrapText:_,lineClamp:w}=o;u&&s({bgColor:u});const C=(i(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(d,t,e),Hs.loadIcons(l(),e,n,((e,o)=>{C.length>1?n.multilineText(C,o,{color:h,font:d,icons:e,textAlign:a,textBaseline:c,textOverflow:g,padding:f,lineHeight:p,autoWrapText:_,lineClamp:w}):n.text(t,o,{color:h,font:d,icons:e,padding:f,textAlign:a,textBaseline:c,textOverflow:g})}))}}class Ns extends Ds{get StyleClass(){return Bs}drawInternal(t,e,o,n,r,{drawCellBase:s}){const l=o.textAlign,a=o.textBaseline||"middle",c=o.color,h=o.bgColor,d=o.padding,u=o.lineHeight,g=o.autoWrapText,f=o.lineClamp,p=o.font,_=o.textOverflow,w=o.sortArrowColor;h&&s({bgColor:h});const C=r.sortState;let m;const y=e.col,b=e.row;v(r.getCellRange(y,b),C.col,C.row)&&({order:m}=C);const x=e.getContext(),R=1.2*Nn(x,p).width,E=(i(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n"),L=[{color:n.getColor(w||n.theme.header.sortArrowColor,y,b,x)||"rgba(0, 0, 0, 0.38)",name:i(m)?"asc"===m?"arrowDownward":"arrowUpward":void 0,width:R}];E.length>1?n.multilineText(E,e,{autoWrapText:g,color:c,font:p,icons:L,lineClamp:f,lineHeight:u,padding:d,textAlign:l,textBaseline:a,textOverflow:_}):n.text(E,e,{color:c,font:p,icons:L,padding:d,textAlign:l,textBaseline:a,textOverflow:_})}}const Vs=q();class $s extends Fs{get StyleClass(){return As}clone(){return new $s(this)}getState(t){let e=t[Vs];return e||(e={elapsed:{},block:{}},S.setReadonly(t,Vs,e)),e}getInlineCheck(t,e,o,n){return t.buildSwitchBtnInline(e,o,n)}}class Us extends Ds{get StyleClass(){return Ms}clone(){return new Us(this)}drawInternal(t,e,o,n,i,{drawCellBase:r}){const{textAlign:s,textBaseline:l,color:a,font:c,bgColor:h,lineHeight:d,autoWrapText:u,lineClamp:g,textOverflow:f}=o;h&&r({bgColor:h});const p=t.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(c,t,e),n.multilineText(p,e,{textAlign:s,textBaseline:l,color:a,font:c,lineHeight:d,autoWrapText:u,lineClamp:g,textOverflow:f})}}const Ks={DEFAULT:new zs,SORT:new Ns,CHECK:new Ps,SWITCH:new $s,MULTILINETEXT:new Us};function Gs(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return Ks[e]||Gs(null)}return t}return Ks.DEFAULT}const js={action:{ACTIONS:ps,BaseAction:is,BaseCheckAction:as,SortHeaderAction:gs,CheckHeaderAction:hs,SwitchHeaderAction:us,of:_s,ofCell:function(t){if(t.sort){if("function"==typeof t.sort){const e=t.sort;return new fs({sort:({order:o,col:n,grid:i})=>e.call(t,o,n,i)})}return ps.SORT}return _s(t.headerAction)}},style:{BaseStyle:Ls,BaseStdStyle:Ss,BaseCheckStyle:Is,Style:ks,SortHeaderStyle:Bs,CheckHeaderStyle:Ts,SwitchHeaderStyle:As,MultilineTextHeaderStyle:Ms,of:Os},type:{TYPES:Ks,BaseHeader:Ds,BaseCheckHeader:Fs,Header:zs,SortHeader:Ns,CheckHeader:Ps,SwitchHeader:$s,MultilineTextHeader:Us,of:Gs,ofCell:function(t){return t.sort?Ks.SORT:Gs(t.headerType)}}},Ys={};const Xs={};var qs={borderColor:"#000",button:{bgColor:"#2196F3",color:"#FFF"},checkbox:{borderColor:"#000",checkBgColor:"rgb(76, 73, 72)",uncheckBgColor:"#FFF"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"#000",uncheckBorderColor:"#000",uncheckBgColor:"#FFF",checkBgColor:"#FFF"},color:"#000",defaultBgColor:function(t){const{row:e,grid:o}=t;return e<o.frozenRowCount?"#FFF":1&o.getRecordIndexByRow(e)?"#F6F6F6":"#FFF"},frozenRowsBgColor:function(t){const e=t.col,o=t.grid,n=t.grid.frozenRowCount,i=t.context,r=o.getCellRelativeRect(e,0),s=r.left;return function(t,e,o,n,i,r){const s=[];for(const t in r)r.hasOwnProperty(t)&&s.push(`${t}@${r[t]}`);const l=`${e}/${o}/${n}/${i}/${s.join(",")}`,a=Xs[l];if(a)return a;const c=t.createLinearGradient(e,o,e,i);for(const t in r)r.hasOwnProperty(t)&&c.addColorStop(Number(t),r[t]);return Xs[l]=c}(i,s,r.top,s,o.getCellRelativeRect(e,n-1).bottom,{0:"#FFF",1:"#D3D3D3"})},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},highlightBorderColor:"#5E9ED6",selectionBgColor:"#CCE0FF",selectionDragBgColor:"#EAF2FF",switch:{borderColor:"#000",checkBgColor:"#008CD6",uncheckBgColor:"#FFF"},tree:{lineColor:"rgb(76, 73, 72)",buttonColor:"rgb(76, 73, 72)",buttonBgColor:"transparent",buttonBorderColor:"rgb(76, 73, 72)",linkColor:"rgb(76, 73, 72)"},underlayBackgroundColor:"#F6F6F6"};var Zs={borderColor:function(t){const{col:e,row:o,grid:n}=t,{colCount:i,frozenColCount:r,recordRowCount:s}=n;let l="#ccc7c7",a="#ccc7c7";if(s>1){const t=n.getRecordStartRowByRecordIndex(n.getRecordIndexByRow(o));t!==o&&(l=null),t+s-1!==o&&(a=null)}return r-1===e||i-1===e?[l,"#f2f2f2",a,null]:[l,null,a,null]},button:{bgColor:"#2196F3",color:"#FFF"},checkbox:{borderColor:"rgba(0, 0, 0, 0.26)",checkBgColor:"rgb(76, 73, 72)"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"rgb(76, 73, 72)",uncheckBorderColor:"rgb(189, 189, 189)"},color:"rgba(0, 0, 0, 0.87)",defaultBgColor:"#FFF",frozenRowsBorderColor:function(t){const e=t.row;return t.grid.frozenRowCount-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]},frozenRowsColor:"rgba(0, 0, 0, 0.54)",header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},highlightBorderColor:"#5E9ED6",selectionBgColor:"#CCE0FF",selectionDragBgColor:"#EAF2FF",switch:{borderColor:"#BFBFBF",checkBgColor:"#008CD6"},tree:{lineColor:"rgba(0, 0, 0, 0.3)",buttonColor:"rgba(0, 0, 0, 0.45)",buttonBgColor:"transparent",buttonBorderColor:"rgba(0, 0, 0, 0.3)",linkColor:"rgba(0, 0, 0, 0.3)"},underlayBackgroundColor:"#FFF"};const Js=z("protected.theme");function Qs(t,e,o,n){return _(t,...o)||_(e,...o)||n&&_(t,...n)||n&&_(e,...n)}class tl{constructor(t,e){this._checkbox=null,this._radioButton=null,this._button=null,this._header=null,this._switch=null,this._tree=null,this[Js]={obj:t,superTheme:e}}get underlayBackgroundColor(){return Qs(this[Js].obj,this[Js].superTheme,["underlayBackgroundColor"])}get font(){return Qs(this[Js].obj,this[Js].superTheme,["font"])}get frozenRowsFont(){return Qs(this[Js].obj,this[Js].superTheme,["frozenRowsFont"])}get color(){return Qs(this[Js].obj,this[Js].superTheme,["color"])}get frozenRowsColor(){return Qs(this[Js].obj,this[Js].superTheme,["frozenRowsColor"],["color"])}get defaultBgColor(){return Qs(this[Js].obj,this[Js].superTheme,["defaultBgColor"])}get frozenRowsBgColor(){return Qs(this[Js].obj,this[Js].superTheme,["frozenRowsBgColor"],["defaultBgColor"])}get focusBgColor(){return Qs(this[Js].obj,this[Js].superTheme,["focusBgColor"])}get selectionBgColor(){return Qs(this[Js].obj,this[Js].superTheme,["selectionBgColor"],["defaultBgColor"])}get selectionDragBgColor(){return Qs(this[Js].obj,this[Js].superTheme,["selectionDragBgColor"],["selectionBgColor"])}get highlightBgColor(){if(this.hasProperty(["highlightBgColor"])){const{obj:t,superTheme:e}=this[Js];return Qs(t,e,["highlightBgColor"])}return t=>{const e=t.row<t.grid.frozenRowCount?this.frozenRowsBgColor:this.defaultBgColor;return"function"==typeof e?e(t):e}}get borderColor(){return Qs(this[Js].obj,this[Js].superTheme,["borderColor"])}get frozenRowsBorderColor(){return Qs(this[Js].obj,this[Js].superTheme,["frozenRowsBorderColor"],["borderColor"])}get highlightBorderColor(){return Qs(this[Js].obj,this[Js].superTheme,["highlightBorderColor"],["borderColor"])}get gridBorderColor(){return Qs(this[Js].obj,this[Js].superTheme,["gridBorderColor"])}get gridBorderWidth(){return Qs(this[Js].obj,this[Js].superTheme,["gridBorderWidth"])}get defaultRowHeight(){return Qs(this[Js].obj,this[Js].superTheme,["defaultRowHeight"])}get defaultColWidth(){return Qs(this[Js].obj,this[Js].superTheme,["defaultColWidth"])}get highlightBorderWidth(){return Qs(this[Js].obj,this[Js].superTheme,["highlightBorderWidth"])}get checkbox(){const t=this[Js].obj,e=this[Js].superTheme;return this._checkbox||(this._checkbox={get uncheckBgColor(){return Qs(t,e,["checkbox","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return Qs(t,e,["checkbox","checkBgColor"],["color"])},get borderColor(){return Qs(t,e,["checkbox","borderColor"])}})}get radioButton(){const{obj:t,superTheme:e}=this[Js];return this._radioButton||(this._radioButton={get checkColor(){return Qs(t,e,["radioButton","checkColor"],["color"])},get uncheckBorderColor(){return Qs(t,e,["radioButton","uncheckBorderColor"],["borderColor"])},get checkBorderColor(){return Qs(t,e,["radioButton","checkBorderColor"],["borderColor"])},get uncheckBgColor(){return Qs(t,e,["radioButton","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return Qs(t,e,["radioButton","checkBgColor"],["defaultBgColor"])}})}get button(){const t=this[Js].obj,e=this[Js].superTheme;return this._button||(this._button={get color(){return Qs(t,e,["button","color"],["color"])},get bgColor(){return Qs(t,e,["button","bgColor"],["defaultBgColor"])}})}get header(){const t=this[Js].obj,e=this[Js].superTheme;return this._header||(this._header={get sortArrowColor(){return Qs(t,e,["header","sortArrowColor"])}})}get switch(){const t=this[Js].obj,e=this[Js].superTheme;return this._switch||(this._switch={get uncheckBgColor(){return Qs(t,e,["switch","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return Qs(t,e,["switch","checkBgColor"],["color"])},get borderColor(){return Qs(t,e,["switch","borderColor"])}})}get tree(){const t=this[Js].obj,e=this[Js].superTheme;return this._tree||(this._tree={get lineColor(){return Qs(t,e,["tree","lineColor"])},get buttonColor(){return Qs(t,e,["tree","buttonColor"],["color"])},get buttonBgColor(){return Qs(t,e,["tree","buttonBgColor"],["defaultBgColor"])},get buttonBorderColor(){return Qs(t,e,["tree","buttonBorderColor"])},get linkColor(){return Qs(t,e,["tree","linkColor"])}})}hasProperty(t){const{obj:e,superTheme:o}=this[Js];return el(e,t)||el(o,t)}extends(t){return new tl(t,this)}}function el(t,e){if(t instanceof tl)return t.hasProperty(e);{let o=t;if(!o)return!1;for(let t=0;t<e.length;t++){if(o=o[e[t]],!o)return!1}return!!o}}const ol=new tl(qs),nl=new tl(Zs),il={BASIC:ol,MATERIAL_DESIGN:nl};let rl=nl;function sl(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const o=e.toLowerCase();if(t[o])return t[o];const n=e.toLowerCase();if(t[n])return t[n];for(const e in t)if(e.toLowerCase()===o)return t[e]}(ll(),t);return e||null}return t instanceof tl?t:new tl(t)}function ll(){return g(il,Ys)}const al={BASIC:ol,MATERIAL_DESIGN:nl,theme:{Theme:tl},of:sl,getDefault:function(){return rl},setDefault:function(t){rl=sl(t)||rl},getChoices:ll},cl={};function hl(t){return parseInt(t,16)}function dl(t,e,o,n=1){return{r:t,g:e,b:o,a:n}}function ul({r:t,g:e,b:o,a:n}){return 0<=t&&t<=255&&0<=e&&e<=255&&0<=o&&o<=255&&0<=n&&n<=1}function gl(t){return Math.ceil(255*t/100)}function fl(t){if(/^#[0-9a-f]{3}$/i.exec(t))return function({1:t,2:e,3:o}){return dl(hl(t+t),hl(e+e),hl(o+o))}(t);if(/^#[0-9a-f]{6}$/i.exec(t))return function({1:t,2:e,3:o,4:n,5:i,6:r}){return dl(hl(t+e),hl(o+n),hl(i+r))}(t);let e=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(t);if(e){const t=dl(Number(e[1]),Number(e[2]),Number(e[3]));if(ul(t))return t}if(e=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=dl(Number(e[1]),Number(e[2]),Number(e[3]),Number(e[4]));if(ul(t))return t}if(e=/^rgb\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*\)$/i.exec(t),e){const t=dl(gl(Number(e[1])),gl(Number(e[3])),gl(Number(e[5])));if(ul(t))return t}if(e=/^rgba\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=dl(gl(Number(e[1])),gl(Number(e[3])),gl(Number(e[5])),Number(e[7]));if(ul(t))return t}return null}function pl(t){return"string"!=typeof t?dl(0,0,0,0):(t=t.toLowerCase().trim(),cl[t]?cl[t]:fl(t)||(cl[t]=function(t){const e=document.createElement("div"),{style:o}=e;o.color=t,o.position="fixed",o.height="1px",o.width="1px",o.opacity="0",document.body.appendChild(e);const{color:n}=(document.defaultView||window).getComputedStyle(e,"");return document.body.removeChild(e),fl(n||"")}(t)))}function _l(t,e,o){const n=pl(t),i=pl(e),r=t=>{const e=n[t],r=i[t];if(o>=1)return r;if(o<=0)return e;const s=e-r;return Math.ceil(e-s*o)};return`rgb(${r("r")}, ${r("g")}, ${r("b")})`}const{ceil:wl,PI:Cl}=Math;function ml(t,e,o,n,i,r){t.beginPath(),t.arc(e+r,o+r,r,-Cl,-.5*Cl,!1),t.arc(e+n-r,o+r,r,-.5*Cl,0,!1),t.arc(e+n-r,o+i-r,r,0,.5*Cl,!1),t.arc(e+r,o+i-r,r,.5*Cl,Cl,!1),t.closePath()}function yl(t,e,o,n,i,r){ml(t,e,o,n,i,r),t.fill()}function vl(t,e,o,n,i,r){ml(t,e,o,n,i,r),t.stroke()}function bl(t,e,o,n,i){const r=Math.min(n,i)/2;t.beginPath(),t.arc(e+r,o+r,r,0,2*Math.PI),t.closePath(),t.fill()}function xl(t,e,o,n,i){const r=Math.min(n,i)/2;t.beginPath(),t.arc(e+r,o+r,r,0,2*Math.PI),t.closePath(),t.stroke()}function Rl(t){return{width:Nn(t,null).width}}function El(t){return{width:Nn(t,null).width}}const Ll={drawButton:function(t,e,o,n,i,r={}){const{backgroundColor:s="#FFF",bgColor:l=s,radius:a=4,shadow:c={}}=r;t.save();try{if(t.fillStyle=l,c){const{color:e="rgba(0, 0, 0, 0.24)",blur:o=1,offsetX:n=0,offsetY:i=2,offset:{x:r=n,y:s=i}={}}=c;t.shadowColor=e,t.shadowBlur=o,t.shadowOffsetX=r,t.shadowOffsetY=s}yl(t,wl(e),wl(o),wl(n),wl(i),a)}finally{t.restore()}},drawCheckbox:function(t,e,o,n,{uncheckBgColor:i="#FFF",checkBgColor:r="rgb(76, 73, 72)",borderColor:s="#000",boxSize:l=Rl(t).width}={}){const a="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=n?r:i;const c=wl(e),h=wl(o),d=wl(l);if(yl(t,c-1,h-1,d+1,d+1,l/5),t.lineWidth=1,t.strokeStyle=s,vl(t,c-.5,h-.5,d,d,l/5),n){t.lineWidth=wl(l/10),t.strokeStyle=i;let n=l/4,r=l/2*.9;const s=e+.2*l,c=o+l/2;a<.5&&(n*=2*a),t.beginPath(),t.moveTo(s,c),t.lineTo(s+n,c+n),a>.5&&(a<1&&(r*=2*(a-.5)),t.lineTo(s+n+r,c+n-r)),t.stroke()}}finally{t.restore()}},drawInlineImageRect:function(t,e,o,n,i,r,s,l,a,c,h,d,{offset:u=2,padding:g}={}){const f={bottom:c+d,height:d,left:a,right:a+h,top:c,width:h};t.save();try{t.beginPath(),t.rect(f.left,f.top,f.width,f.height),t.clip();const a=Vn(t,f,s,l,{offset:u,padding:g});t.drawImage(e,o,n,i||s,r||l,a.x,a.y,s,l)}finally{t.restore()}},drawRadioButton:function(t,e,o,n,{checkColor:i="rgb(76, 73, 72)",borderColor:r="#000",bgColor:s="#FFF",boxSize:l=El(t).width}={}){const a="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=s;const c=wl(e),h=wl(o),d=wl(l);if(bl(t,c-1,h-1,d+1,d+1),t.lineWidth=1,t.strokeStyle=r,xl(t,c-.5,h-.5,d,d),n){const e=d*a/2,o=(d-e)/2;t.fillStyle=i,bl(t,wl(100*(c-.5+o))/100,wl(100*(h-.5+o))/100,wl(100*e)/100,wl(100*e)/100)}}finally{t.restore()}},drawSwitchButton:function(t,e,o,n,i,{uncheckBgColor:r="#FFF",checkBgColor:s="#008CD6",borderColor:l="#BFBFBF",btnSize:a={width:44,height:22}}={}){i=i>1?1:i<0?0:i;const c=2*a.height/22,h=12*a.height/22,d=14*a.height/22;t.save();try{let u,g,f;0<i&&i<1?(u=n?_l(l,s,i):_l(s,l,i),g=n?_l(l,r,i):_l(r,l,i),f=n?_l(r,s,i):_l(s,r,i)):(u=n?s:l,g=n?r:l,f=n?s:r);const p=e,_=o,w=a.width,C=a.height;t.fillStyle=u,yl(t,p,_,w,C,C/2),t.textAlign="center",t.textBaseline="middle",t.font=`${h}px sans-serif`,t.fillStyle=g,t.fillText("",p+d,_+C/2),t.fillStyle=f,t.fillText("",p+w-d,_+C/2);const m=C-2*c,y=m,v=p+c+(w-2*c-m)*(n?i:1-i),b=_+c;t.fillStyle=r,yl(t,v,b,m,y,y/2)}finally{t.restore()}},drawSwitchBtn:function(t,e,o,n,i,{uncheckBgColor:r="#FFF",checkBgColor:s="#3BCD4F",borderColor:l="#D9D9D9",btnSize:a={width:52,height:32}}={}){i=i>1?1:i<0?0:i;const c=.078125*a.height;t.save();try{t.fillStyle=n?s:l;const h=wl(e)-1,d=wl(o)-1,u=wl(a.width+1),g=wl(a.height+1);yl(t,h,d,u,g,g/2);const f=n?1-i:i;t.fillStyle=r;const p=(u-2*c)*f,_=(g-2*c)*f;yl(t,h+u/2-p/2,d+g/2-_/2,p,_,_/2);const w=n?i:1-i;t.shadowColor=l,t.shadowOffsetX=0,t.shadowOffsetY=2,t.shadowBlur=3;const C=g-2*c;yl(t,h+c+(u-2*c-C)*w,d+c,C,C,C/2)}finally{t.restore()}},fillRoundRect:yl,fillTextRect:function(t,e,o,n,i,r,{offset:s=2,padding:l}={}){const a={bottom:n+r,height:r,left:o,right:o+i,top:n,width:i};t.save();try{t.beginPath(),t.rect(a.left,a.top,a.width,a.height),t.clip();const o=function(t,e,{offset:o=0,padding:{left:n=0,right:i=0,top:r=0,bottom:s=0}={}}={}){return Vn(t,e,0,0,{offset:o,padding:{bottom:s,left:n,right:i,top:r}})}(t,a,{offset:s,padding:l});t.fillText(e,o.x,o.y)}finally{t.restore()}},measureCheckbox:Rl,measureRadioButton:El,roundRect:ml,strokeColorsRect:function(t,e,o,n,i,r){e[0]===e[1]&&e[0]===e[2]&&e[0]===e[3]?e[0]&&(t.strokeStyle=e[0],t.strokeRect(o,n,i,r)):function(o){for(let n=0;n<e.length;n++){const i=e[n],r=e[n-1];if(i){if(r!==i){r&&(t.strokeStyle=r,t.stroke());const e=o[n];t.beginPath(),t.moveTo(e.x,e.y)}const e=o[n+1];t.lineTo(e.x,e.y)}else r&&(t.strokeStyle=r,t.stroke())}const n=e[e.length-1];n&&(t.strokeStyle=n,t.stroke())}([{x:o,y:n},{x:o+i,y:n},{x:o+i,y:n+r},{x:o,y:n+r},{x:o,y:n}])},strokeRoundRect:vl,fillCircle:bl,strokeCircle:xl},Sl={canvasHelper:Ll};let kl=-1;class Il{constructor(){this.headers=[],this.columns=[]}getHeader(t,e){const o=this.headers[e]||(this.headers[e]=[]);return o[t]||(o[t]={id:kl--,define:{},headerType:js.type.of(null)})}getBody(t,e){const o=this.columns[e]||(this.columns[e]=[]);return o[t]||(o[t]={id:kl--,define:{},columnType:Oi.type.of(null),style:null})}}let Tl=0;class Bl{constructor(t){this.bodyRowCount=1,this._emptyDataCache=new Il,this._columns=[],this._headerCellIds=[],this._headerObjects=this._addHeaders(0,t,[]),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._setupHeaderSpan()}get columnWidths(){return this._columns}get headerRowCount(){return this._headerCellIds.length}get colCount(){return this._columns.length}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}getCellId(t,e){return this.headerRowCount<=e?this._columns[t].id:this._headerCellIds[e][t]}getHeader(t,e){const o=this.getCellId(t,e);return this._headerObjectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){return this._columns[t]||this._emptyDataCache.getBody(t,0)}getBodyLayoutRangeById(t){for(let e=0;e<this.colCount;e++)if(t===this._columns[e].id)return{start:{col:e,row:0},end:{col:e,row:0}};throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){const o={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerRowCount<=e)return o;const n=this.getCellId(t,e);for(let i=t-1;i>=0&&n===this.getCellId(i,e);i--)o.start.col=i;for(let i=t+1;i<this.colCount&&n===this.getCellId(i,e);i++)o.end.col=i;for(let i=e-1;i>=0&&n===this.getCellId(t,i);i--)o.start.row=i;for(let i=e+1;i<this.headerRowCount&&n===this.getCellId(t,i);i++)o.end.row=i;return o}getRecordIndexByRow(t){return t<this.headerRowCount?-1:t-this.headerRowCount}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t}_addHeaders(t,e,o){const n=[],i=this._headerCellIds[t]||this._newRow(t);return e.forEach((e=>{const r=this._columns.length,s=Tl++,l={id:s,caption:e.caption,field:e.headerField||e.field,style:e.headerStyle,headerType:js.type.ofCell(e),action:js.action.ofCell(e),define:e,icon:e.headerIcon,tooltip:e.headerTooltip,tooltipType:e.headerTooltipType};n[s]=l,i[r]=s;for(let e=t-1;e>=0;e--)this._headerCellIds[e][r]=o[e];if(e.columns)this._addHeaders(t+1,e.columns,[...o,s]).forEach((t=>n.push(t)));else{const o=e;this._columns.push({id:Tl++,field:o.field,width:o.width,minWidth:o.minWidth,maxWidth:o.maxWidth,icon:o.icon,message:o.message,columnType:Oi.type.of(o.columnType),action:Oi.action.of(o.action),style:o.style,define:o,contentHidden:o.contentHidden,disableResize:o.disableResize,tooltip:o.tooltip,tooltipType:o.tooltipType});for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][r]=s}})),n}_newRow(t){const e=this._headerCellIds[t]=[];if(!this._columns.length)return e;const o=this._headerCellIds[t-1];for(let t=0;t<o.length;t++)e[t]=o[t];return e}_setupHeaderSpan(){const t={};for(let e=0;e<this._headerCellIds.length;e++){const o=this._headerCellIds[e];for(let n=0;n<o.length;n++){const i=o[n];if(!t[i]){t[i]=!0;const o=this._headerObjectMap[i];let r,s;"headerRowSpan"in o.define&&(window.console.warn("'headerRowSpan' is deprecated, please use 'rowSpan' instead"),r=o.define.headerRowSpan),"headerColSpan"in o.define&&(window.console.warn("'headerColSpan' is deprecated, please use 'colSpan' instead"),s=o.define.headerColSpan);const l=Number(o.define.rowSpan||r||1),a=Number(o.define.colSpan||s||1);if(l>1||a>1)for(let t=e;t<e+l;t++)for(let e=n;e<n+a;e++)this._headerCellIds[t][e]=i}}}}}let Al=0;class Ml{constructor(t,e){this.objects=[],this.objectGrid=[],this.objectMap={},this.columnCount=0,this.columnWidths=[],t.forEach(((t,o)=>{let n=0;t.forEach((t=>{var i,r;const s=Al++,l=e(t,s);this.objects.push(l),this.objectMap[s]=l,n=this._findStartCell(n,o);const a=Number(null!==(i=t.rowSpan)&&void 0!==i?i:1),c=Number(null!==(r=t.colSpan)&&void 0!==r?r:1),h=o+a,d=n+c;for(let t=o;t<h;t++){const e=this._getObjectGridRow(t);for(let t=n;t<d;t++)e[t]=l}1===c&&this._setWidthDataIfAbsent(n,t),this._useColumnIndex(d-1),n=d}))}))}get rowCount(){return this.objectGrid.length}_findStartCell(t,e){const o=this._getObjectGridRow(e);for(let e=t;e<o.length;e++)if(!o[e])return e;return o.length}_getObjectGridRow(t){return this.objectGrid[t]||(this.objectGrid[t]=[])}_useColumnIndex(t){this.columnCount>t||(this.columnCount=t+1)}_setWidthDataIfAbsent(t,e){this.columnWidths[t]||null==e.width&&null==e.maxWidth&&null==e.minWidth||(this.columnWidths[t]={width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth})}}class Ol{constructor(t){this._columnWidths=[],this._emptyDataCache=new Il;const e=function(t){return Array.isArray(t)?{header:t,body:t}:t}(t),o=this._header=new Ml(e.header,((t,e)=>({id:e,caption:t.caption,field:t.headerField||t.field,style:t.headerStyle,headerType:js.type.ofCell(t),action:js.action.ofCell(t),define:t,icon:t.headerIcon,tooltip:t.headerTooltip,tooltipType:t.headerTooltipType}))),n=this._body=new Ml(e.body,((t,e)=>({id:e,field:t.field,width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth,icon:t.icon,message:t.message,columnType:Oi.type.of(t.columnType),action:Oi.action.of(t.action),style:t.style,define:t,contentHidden:t.contentHidden,disableResize:t.disableResize,tooltip:t.tooltip,tooltipType:t.tooltipType}))),i=this._columnCount=Math.max(o.columnCount,n.columnCount);for(let t=0;t<i;t++){const e=o.columnWidths[t]||n.columnWidths[t]||{};this._columnWidths[t]=e}}get columnWidths(){return this._columnWidths}get headerRowCount(){return this._header.rowCount}get bodyRowCount(){return this._body.rowCount}get colCount(){return this._columnCount}get headerObjects(){return this._header.objects}get columnObjects(){return this._body.objects}getCellId(t,e){var o,n,i,r;if(this.headerRowCount<=e){const i=(e-this.headerRowCount)%this.bodyRowCount;return null===(n=null===(o=this._body.objectGrid[i])||void 0===o?void 0:o[t])||void 0===n?void 0:n.id}return null===(r=null===(i=this._header.objectGrid[e])||void 0===i?void 0:i[t])||void 0===r?void 0:r.id}getHeader(t,e){const o=this.getCellId(t,e);return this._header.objectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){const o=this.getCellId(t,e);return this._body.objectMap[o]||this._emptyDataCache.getBody(t,e)}getBodyLayoutRangeById(t){var e;for(let o=0;o<this.bodyRowCount;o++){const n=this._body.objectGrid[o];if(n)for(let i=0;i<this.colCount;i++)if(t===(null===(e=n[i])||void 0===e?void 0:e.id))return this._getCellRange(this._body,i,o,0)}throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){if(this.headerRowCount<=e){const o=this.getRecordIndexByRow(e),n=this.getRecordStartRowByRecordIndex(o),i=(e-this.headerRowCount)%this.bodyRowCount;return this._getCellRange(this._body,t,i,n)}return this._getCellRange(this._header,t,e,0)}getRecordIndexByRow(t){if(t<this.headerRowCount)return-1;{const e=t-this.headerRowCount;return Math.floor(e/this.bodyRowCount)}}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t*this.bodyRowCount}_getCellRange(t,e,o,n){var i,r,s,l,a,c,h,d,u,g;const f={start:{col:e,row:o+n},end:{col:e,row:o+n}},{objectGrid:p}=t,_=null===(r=null===(i=p[o])||void 0===i?void 0:i[e])||void 0===r?void 0:r.id;if(null==_)return f;for(let t=e-1;t>=0&&_===(null===(l=null===(s=p[o])||void 0===s?void 0:s[t])||void 0===l?void 0:l.id);t--)f.start.col=t;for(let n=e+1;n<t.columnCount&&_===(null===(c=null===(a=p[o])||void 0===a?void 0:a[n])||void 0===c?void 0:c.id);n++)f.end.col=n;for(let t=o-1;t>=0&&_===(null===(d=null===(h=p[t])||void 0===h?void 0:h[e])||void 0===d?void 0:d.id);t--)f.start.row=t+n;for(let i=o+1;i<t.rowCount&&_===(null===(g=null===(u=p[i])||void 0===u?void 0:u[e])||void 0===g?void 0:g.id);i++)f.end.row=i+n;return f}}class Dl{constructor(t){this._layoutMap=t}get headerRowCount(){return this.hiddenHeader?0:this._layoutMap.headerRowCount}get bodyRowCount(){return this._layoutMap.bodyRowCount}get colCount(){return this._layoutMap.colCount}get columnWidths(){return this._layoutMap.columnWidths}get headerObjects(){return this._layoutMap.headerObjects}get columnObjects(){return this._layoutMap.columnObjects}getHeader(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getHeader(t,e)}getBody(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getBody(t,e)}getCellId(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getCellId(t,e)}getCellRange(t,e){this.hiddenHeader&&(e+=this._layoutMap.headerRowCount);const o=this._layoutMap.getCellRange(t,e);return this.hiddenHeader&&(o.start.row-=this._layoutMap.headerRowCount,o.end.row-=this._layoutMap.headerRowCount),o}getBodyLayoutRangeById(t){return this._layoutMap.getBodyLayoutRangeById(t)}getRecordIndexByRow(t){return this.hiddenHeader&&(t+=this._layoutMap.headerRowCount),this._layoutMap.getRecordIndexByRow(t)}getRecordStartRowByRecordIndex(t){let e=this._layoutMap.getRecordStartRowByRecordIndex(t);return this.hiddenHeader&&(e-=this._layoutMap.headerRowCount),e}}const Fl=Object.assign(Object.assign({},F),{CHANGED_HEADER_VALUE:"changed_header_value",CHANGED_VALUE:"changed_value",CELL_RANGE:"cell_range",CELL_VALUE:"cell_value"});class Wl{constructor(t){this._grid=t}dispose(){this.detachMessageElement(),this._messageElement&&this._messageElement.dispose(),delete this._messageElement}drawCellMessageInternal(t,e,o,n,i,r){}attachMessageElement(t,e,o){this._getMessageElement().attach(this._grid,t,e,o)}moveMessageElement(t,e){this._getMessageElement().move(this._grid,t,e)}detachMessageElement(){this._getMessageElement().detach()}drawCellMessage(t,e,o,n,i,r){this.drawCellMessageInternal(t,e,o,n,i,r)}_getMessageElement(){return this._messageElement||(this._messageElement=this.createMessageElementInternal())}}const Pl="kaka-grid__message-element",Hl=`${Pl}__message`,zl=`${Pl}--hidden`,Nl=`${Pl}--shown`;class Vl{constructor(){this._handler=new Lt;const t=this._rootElement=function(){Bt.inject("messageElement",".kaka-grid__message-element {\n  position: absolute;\n  margin-top: -2px;\n  box-sizing: border-box;\n  border-radius: 0 0 3px 3px;\n  background-color: rgba(250, 250, 250, 0.85);\n  padding: 8px 2px;\n  pointer-events: none;\n  user-select: none;\n  border-top: solid 1px rgba(0, 0, 0, 0.87);\n  color: rgba(0, 0, 0, 0.87);\n}\n\n.kaka-grid__message-element--hidden {\n  display: none;\n}\n\n.kaka-grid__message-element--shown {\n  display: block;\n}\n\n.kaka-grid__message-element__message {\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  display: block;\n  width: 100%;\n}\n");const t=wt("div",{classList:[Pl,zl]}),e=wt("span",{classList:[Hl]});return t.appendChild(e),t}();this._messageElement=t.querySelector(`.${Hl}`)}dispose(){this.detach(),this._handler.dispose()}attach(t,e,o,n){const i=this._rootElement,r=this._messageElement;i.classList.remove(Nl),i.classList.add(zl),this._attachCell(t,e,o)?(i.classList.add(Nl),i.classList.remove(zl),r.textContent=n.message):this._detach()}move(t,e,o){const n=this._rootElement;n&&this._attachCell(t,e,o)?(n.classList.add(Nl),n.classList.remove(zl)):this._detach()}detach(){this._detach()}_detach(){const t=this._rootElement;t&&t.parentElement&&(t.parentElement.removeChild(t),t.classList.remove(Nl),t.classList.add(zl))}_attachCell(t,e,o){const n=this._rootElement,{element:i,rect:r}=t.getAttachCellsArea(t.getCellRange(e,o)),s=r.bottom,l=r.left,a=r.width,c=t.frozenRowCount,h=t.frozenColCount;if(o>=c&&c>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,c-1));if(s<o.bottom)return!1}else if(s<0)return!1;if(e>=h&&h>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(h-1,o));if(l<e.right)return!1}else if(l<0)return!1;const d=i.offsetHeight,u=i.offsetWidth;return!(d<s)&&(!(u<l)&&(n.style.top=`${s.toFixed()}px`,n.style.left=`${l.toFixed()}px`,n.style.width=`${a.toFixed()}px`,n.parentElement!==i&&i.appendChild(n),!0))}}const $l="kaka-grid__error-message-element",Ul=`${$l}__message`;class Kl extends Vl{constructor(){super(),Bt.inject("errorMessageElement",".kaka-grid__error-message-element {\n  border-top: solid 1px #ff1744;\n  color: #ff1744;\n}\n"),this._rootElement.classList.add($l),this._messageElement.classList.add(Ul)}}function Gl(t,e,o){const n=e.bgColor,i=e.color,r=t.getContext(),s=t.getRect();r.fillStyle=n;const l=s.copy();l.left=l.right-24,r.fillRect(l.left,l.top,l.width,l.height-1);const a=i,c=l.left+(l.width-4)/2,h=l.top+(l.height-20)/2;o.fillRectWithState(new Ie(c,h,4,12),t,{fillColor:a}),o.fillRectWithState(new Ie(c,h+16,4,4),t,{fillColor:a})}class jl extends Wl{createMessageElementInternal(){return new Kl}drawCellMessageInternal(t,e,o,n,i,r){const s=o.bgColor,{select:l}=e.getSelection();v(i.getCellRange(e.col,e.row),l.col,l.row)&&i.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{Gl(e,{bgColor:"#ff8a80",color:s},n)}))}}class Yl extends Wl{createMessageElementInternal(){return new Vl}drawCellMessageInternal(t,e,o,n,i,r){const{bgColor:s}=o,{select:l}=e.getSelection();v(i.getCellRange(e.col,e.row),l.col,l.row)&&i.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{!function(t,e,o){const n=e.bgColor,i=e.color,r=t.getContext(),s=t.getRect();r.fillStyle=n;const l=s.copy();l.left=l.right-24,r.fillRect(l.left,l.top,l.width,l.height-1);const a=i,c=l.left+(l.width-4)/2,h=l.top+(l.height-20)/2;o.fillRectWithState(new Ie(c,h,4,4),t,{fillColor:a}),o.fillRectWithState(new Ie(c,h+8,4,12),t,{fillColor:a})}(e,{bgColor:"#e0e0e0",color:s},n)}))}}const Xl="kaka-grid__warning-message-element",ql=`${Xl}__message`;class Zl extends Vl{constructor(){super(),Bt.inject("warningMessageElement",".kaka-grid__warning-message-element {\n  border-top: solid 1px #dd2c00;\n  color: #dd2c00;\n}\n"),this._rootElement.classList.add(Xl),this._messageElement.classList.add(ql)}}class Jl extends Wl{createMessageElementInternal(){return new Zl}drawCellMessageInternal(t,e,o,n,i,r){const{bgColor:s}=o,{select:l}=e.getSelection();v(i.getCellRange(e.col,e.row),l.col,l.row)&&i.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{Gl(e,{bgColor:"#ff9e80",color:s},n)}))}}const Ql={type:"error",message:null},ta={error:t=>new jl(t),info:t=>new Yl(t),warning:t=>new Jl(t)};function ea(t){if(!t||C(t))return Ql;if("string"==typeof t)return{message:t,original:t,type:"error"};const e=t.type||"error";return e&&e in ta?{type:e.toLowerCase(),message:`${t.message}`,original:t}:{type:"error",message:`${t}`,original:t}}function oa(t){return!!ea(t).message}class na{constructor(t,e){this._attachInfo=null,this._grid=t,this._messageInstances={},this._bindGridEvent(t,e)}dispose(){var t;const e=this._messageInstances;for(const o in e)null===(t=e[o])||void 0===t||t.dispose()}drawCellMessage(t,e,o,n,i,r){if(!oa(t))return;this._getMessageInstanceOfMessage(t).drawCellMessage(ea(t),e,o,n,i,r)}_attach(t,e,o){const n=this._attachInfo,i=this._getMessageInstanceOfMessage(o);n&&n.instance!==i&&n.instance.detachMessageElement(),i.attachMessageElement(t,e,ea(o)),this._attachInfo={col:t,row:e,instance:i}}_move(t,e){const o=this._attachInfo;if(!o||o.col!==t||o.row!==e)return;const{instance:n}=o;n.moveMessageElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachMessageElement(),this._attachInfo=null}_bindGridEvent(t,e){const o=t=>{const o=e(t.col,t.row);oa(o)?this._attach(t.col,t.row,o):this._detach()};t.listen(Fl.SELECTED_CELL,(t=>{t.selected&&(t.before.col===t.col&&t.before.row===t.row||o(t))})),t.listen(Fl.SCROLL,(()=>{const e=t.selection.select;this._move(e.col,e.row)})),t.listen(Fl.CHANGED_VALUE,(e=>{const n=t.selection.select;n.col===e.col&&n.row===e.row&&o(e)})),t.listen(Fl.FOCUS_GRID,(e=>{const n=t.selection.select;o(n)})),t.listen(Fl.BLUR_GRID,(t=>{this._detach()}))}_getMessageInstanceOfMessage(t){const e=this._messageInstances,o=ea(t).type;return e[o]||(e[o]=ta[o](this._grid))}}const ia={},ra=new DOMParser;function sa(t,e){for(let o=0;o<t.childNodes.length;o++){const n=t.childNodes[o];if(1!==n.nodeType)continue;if(e(n))return n;const i=sa(n,e);if(i)return i}return null}class la{constructor(t){const e=ra.parseFromString(t,"image/svg+xml");this._svg=e.documentElement,this._glyphs={},this._glyphUnis={}}get svg(){return this._svg}get fontFaceElement(){return this._fontFace||(this._fontFace=this.findElement((t=>"font-face"===t.tagName.toLowerCase()))),this._fontFace}get fontElement(){return this._font||(this._font=this.findElement((t=>"font"===t.tagName.toLowerCase()))),this._font}findElement(t){return sa(this.svg,t)}findGlyph(t){return this._glyphs[t]||(this._glyphs[t]=this.findElement((e=>e.getAttribute("glyph-name")===t)))}findGlyphByUnicode(t){return this._glyphUnis[t]||(this._glyphUnis[t]=this.findElement((e=>e.getAttribute("unicode")===t)))}walkAllGlyph(t){const e=(t,o)=>{for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];if(1!==i.nodeType)continue;const r=i.getAttribute("unicode");if(r&&i.getAttribute("d")){this._glyphUnis[r]||(this._glyphUnis[r]=i);const t=i.getAttribute("glyph-name");t&&!this._glyphs[t]&&(this._glyphs[t]=i),o(i)}else e(i,o)}};e(this.svg,t)}}function aa(t){let e="";switch(t.tagName.toLowerCase()){case"path":case"glyph":e=function(t){return"none"===t.getAttribute("fill")?"":t.getAttribute("d").replace(/[\n\r]/g,"")}(t);break;case"circle":e=function(t){const e=Number(t.getAttribute("cx")),o=Number(t.getAttribute("cy")),n=Number(t.getAttribute("r")),i=2*Math.PI/8,r=t=>n*Math.cos(t),s=t=>n*Math.sin(t),l=t=>r(t)+n*Math.tan(i/2)*Math.cos(t-Math.PI/2),a=t=>s(t)+n*Math.tan(i/2)*Math.sin(t-Math.PI/2);let c=`M${e+n} ${o}`;for(let t=1;t<=8;t++){const n=t*i;c+=`Q${l(n)+e} ${a(n)+o} ${r(n)+e} ${s(n)+o}`}return c}(t);break;case"polygon":e=`M${t.getAttribute("points")}z`;break;case"polyline":e=`M${t.getAttribute("points")}`;break;case"g":for(let o=0;o<t.childNodes.length;o++){const n=t.childNodes[o];1===n.nodeType&&(n.getAttribute("fill")||n.setAttribute("fill",t.getAttribute("fill")),e+=aa(n))}break;default:window.console.warn(`unsupported:${t.tagName}`,`@ ${t.innerHTML}`)}return e}function ca(t={}){const e={d:t.d||"",html:t.html||"",height:t.height||0,width:t.width||0};return t.isGlyph&&(e.ud=!0),void 0!==t.offsetX&&(e.offsetX=t.offsetX),void 0!==t.offsetY&&(e.offsetY=t.offsetY),e}const ha=(t,e={})=>e.glyphName||e.unicode?function(t,e){const o=new la(t),n=o.fontFaceElement||{getAttribute:t=>null},i=o.fontElement||{getAttribute:t=>null},r=e.glyphName?o.findGlyph(e.glyphName):e.unicode?o.findGlyphByUnicode(e.unicode):void 0,s=Number(i.getAttribute("horiz-adv-x"))||0,l=Number(i.getAttribute("vert-adv-x"))||0,a=Number(r.getAttribute("horiz-adv-x"))||s||0,c=Number(r.getAttribute("vert-adv-x"))||l||0,h=Number(n.getAttribute("units-per-em"))||1e3;let d=h;const u=c||h,g=a||h;a>d&&(d=a),c>d&&(d=c);let f=0,p=-(Number(n.getAttribute("descent"))||c);return f+=Math.round((d-g)/2),p+=Math.round((d-u)/2),ca({d:aa(r),height:d,html:r.outerHTML,isGlyph:!0,offsetX:f,offsetY:p,width:d})}(t,e):function(t){const e=new la(t).svg,o=(e.getAttribute("viewBox")||"").split(" "),n=Number(e.getAttribute("width")||o[2])||0,i=Number(e.getAttribute("height")||o[3])||0,r=0-Number(o[0])||0,s=0-Number(o[1])||0;let l="";for(let t=0;t<e.childNodes.length;t++){const o=e.childNodes[t];1===o.nodeType&&(l+=aa(o))}return ca({d:l,height:i,html:t,offsetX:r,offsetY:s,width:n})}(t);const da={add:ha('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M38 26H26v12h-4V26H10v-4h12V10h4v12h12v4z"/></svg>'),arrowDownward:ha('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path fill="#010101" d="M40 24l-2.82-2.82L26 32.34V8h-4v24.34L10.84 21.16 8 24l16 16 16-16z"/></svg>'),arrowUpward:ha('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M8 24l2.83 2.83L22 15.66V40h4V15.66l11.17 11.17L40 24 24 8 8 24z"/></svg>'),edit:ha('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M6 34.5V42h7.5l22.13-22.13-7.5-7.5L6 34.5zm35.41-20.41c.78-.78.78-2.05 0-2.83l-4.67-4.67c-.78-.78-2.05-.78-2.83 0l-3.66 3.66 7.5 7.5 3.66-3.66z"/></svg>'),star:ha('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'),starBorder:ha('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/></svg>'),starHalf:ha('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/></svg>')},ua={get:()=>g(da,ia)};function ga(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function fa(t,e){let o=1;return t[0]*e[1]-t[1]*e[0]<0&&(o=-1),o*Math.acos((n=function(t,e){return function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e)/(ga(t)*ga(e))}(t,e),i=-1,r=1,Math.min(Math.max(n,i),r)));var n,i,r}function pa(t,e,o,n,i,r,s,l,a,c){if(0===n||0===i)return void t.lineTo(a,c);r*=Math.PI/180,n=Math.abs(n),i=Math.abs(i);const h=function(t,e){const o=Math.cos(e),n=Math.sin(e);return[o*t[0]+n*t[1],-1*n*t[0]+o*t[1]]}([((d=[e,o])[0]-(u=[a,c])[0])/2,(d[1]-u[1])/2],r);var d,u;const g=function(t,e){return[t[0]*e[0],t[1]*e[1]]}(h,h);let f=Math.pow(n,2),p=Math.pow(i,2);const _=Math.sqrt(g[0]/f+g[1]/p);_>1&&(n*=_,i*=_,f=Math.pow(n,2),p=Math.pow(i,2));let w=Math.sqrt(Math.abs(f*p-f*g[1]-p*g[0])/(f*g[1]+p*g[0]));s===l&&(w*=-1);const C=function(t,e){return[t*e[0],t*e[1]]}(w,[n*h[1]/i,-i*h[0]/n]),m=function(t,e){return[t[0]+e[0],t[1]+e[1]]}(function(t,e){const o=Math.cos(e),n=Math.sin(e);return[o*t[0]-n*t[1],n*t[0]+o*t[1]]}(C,r),function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}([e,o],[a,c])),y=[(h[0]-C[0])/n,(h[1]-C[1])/i],v=[(-1*h[0]-C[0])/n,(-1*h[1]-C[1])/i],b=fa([1,0],y),x=b,R=b+fa(y,v);t.save(),t.translate(m[0],m[1]),t.rotate(r),t.scale(n,i),t.arc(0,0,1,x,R,!l),t.restore()}class _a{constructor(t){let e,o,n,i=0,r=0,s="";function l(){return"CcSsQqTt".indexOf(s)<0?{x:i,y:r}:n}this.M=(n,l)=>(t.moveTo(n,l),e=n,o=l,i=n,r=l,s="M",this),this.m=(t,e)=>this.M(t+i,e+r),this.L=(e,o)=>(t.lineTo(e,o),i=e,r=o,s="L",this),this.l=(t,e)=>this.L(t+i,e+r),this.H=t=>this.L(t,r),this.h=t=>this.H(t+i),this.V=t=>this.L(i,t),this.v=t=>this.V(t+r),this.Z=()=>(t.closePath(),i=e,r=o,s="Z",this),this.z=()=>this.Z(),this.C=(e,o,l,a,c,h)=>(t.bezierCurveTo(e,o,l,a,c,h),i=c,r=h,n={x:2*c-l,y:2*h-a},s="C",this),this.c=(t,e,o,n,s,l)=>this.C(t+i,e+r,o+i,n+r,s+i,l+r),this.S=(t,e,o,n)=>{const{x:i,y:r}=l();return this.C(i,r,t,e,o,n)},this.s=(t,e,o,n)=>this.S(t+i,e+r,o+i,n+r),this.Q=(e,o,l,a)=>(t.quadraticCurveTo(e,o,l,a),i=l,r=a,n={x:2*l-e,y:2*a-o},s="Q",this),this.q=(t,e,o,n)=>this.Q(t+i,e+r,o+i,n+r),this.T=(t,e)=>{const{x:o,y:n}=l();return this.Q(o,n,t,e)},this.t=(t,e)=>this.T(t+i,e+r),this.A=(e,o,n,l,a,c,h)=>(pa(t,i,r,e,o,n,l,a,c,h),i=c,r=h,s="A",this),this.a=(t,e,o,n,s,l,a)=>this.A(t,e,o,n,s,l+i,a+r)}}function wa(t,e,o){return"M"===e.toUpperCase()||"L"===e.toUpperCase()||"T"===e.toUpperCase()?(t.command(e,o.next(),o.next()),"M"===e?"L":"m"===e?"l":e):"H"===e.toUpperCase()||"V"===e.toUpperCase()?(t.command(e,o.next()),e):"Z"===e.toUpperCase()?(t.command(e),e):"C"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next(),o.next(),o.next()),e):"S"===e.toUpperCase()||"Q"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next()),e):"A"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next(),o.next(),o.next(),o.next()),e):(console.warn(`unsupported:${e}`),null)}const Ca=new class{constructor(){this._ops=[],this._commands=new _a(this);const t=t=>(...e)=>{this._ops.push({op:t,args:e})};this.moveTo=t("moveTo"),this.lineTo=t("lineTo"),this.closePath=t("closePath"),this.bezierCurveTo=t("bezierCurveTo"),this.quadraticCurveTo=t("quadraticCurveTo"),this.save=t("save"),this.translate=t("translate"),this.rotate=t("rotate"),this.scale=t("scale"),this.arc=t("arc"),this.restore=t("restore"),this.arcTo=t("arcTo"),this.ellipse=t("ellipse"),this.rect=t("rect")}command(t,...e){const o=e||[];for(let t=0;t<e.length;t++)o[t]-=0;this._commands[t].apply(this,o)}parse(t){const e=this._ops=[],o=function(t){let e=0;return{next(){let o="";for(;t.length>e;){const n=t[e];if(e++," ,\n\r\t".indexOf(n)>-1){if(o)return o}else{if("str"==(".+-1234567890".indexOf(n)>-1?"num":"str"))return o?(e--,o):n;if("-+".indexOf(n)>-1&&o)return e--,o;if("."===n&&o.indexOf(".")>-1)return e--,o;o+=n}}return o||null}}}(t);try{let t,e="Z";for(;t=o.next();)if(isNaN(Number(t)))e=wa(this,t,o)||"Z";else{let n=!0;e=wa(this,e,{next:()=>n?(n=!1,t):o.next()})||"Z"}}catch(e){throw console.log(`Error: ${t}`),e}return e}};class ma{constructor(t){if(this._ops=[],void 0!==t)if("string"==typeof t)this._ops=Ca.parse(t);else{if(!t.hasOwnProperty("_ops"))throw new Error(`Error: ${typeof t} is not a valid argument to Path`);this._ops=[...t._ops]}}arc(...t){this._ops.push({op:"arc",args:t})}arcTo(...t){this._ops.push({op:"arcTo",args:t})}bezierCurveTo(...t){this._ops.push({op:"bezierCurveTo",args:t})}closePath(...t){this._ops.push({op:"closePath",args:t})}ellipse(...t){this._ops.push({op:"ellipse",args:t})}lineTo(...t){this._ops.push({op:"lineTo",args:t})}moveTo(...t){this._ops.push({op:"moveTo",args:t})}quadraticCurveTo(...t){this._ops.push({op:"quadraticCurveTo",args:t})}rect(...t){this._ops.push({op:"rect",args:t})}}const{CanvasRenderingContext2D:ya}=window,va=ya.prototype.fill;function ba(){return"undefined"==typeof Path2D||x?ma:Path2D}ya.prototype.fill=function(...t){if(t[0]instanceof ma){const e=t[0];this.beginPath(),e._ops.forEach((t=>{this[t.op].apply(this,t.args)})),va.apply(this,Array.prototype.slice.call(t,1))}else va.apply(this,t)};const xa={fill(t,e,o,n,i,r){e.save();try{const s=t.width,l=t.height,a=t.ud,c=t.x||0,h=t.y||0,d=(i=i||s)/s,u=(r=r||l)/(a?-l:l);o=o||0,n=a?(n||0)+-l*u:n||0,e.translate(o,n),e.scale(d,u),0===c&&0===h||e.translate(c,h);const g=ba();t.path2d=t.path2d||new g(t.d),e.fill(t.path2d)}finally{e.restore()}},getPath2D:ba};function Ra(t,e){return t.measureText(e).width}function Ea(t,e,o,n,i){const r=[];let s=o.next();for(let t=0;t<n&&null!==s;t++,s=o.next())r.push(s);let l=Ra(t,r.join(""));if(l>i)for(;r.length;){if(l-=Ra(t,r.pop()),l<=i)break}else if(l<i)for(;null!==s;){const e=Ra(t,s);if(l+e>i)break;r.push(s),l+=e,s=o.next()}const a=r.join("").replace(/\s+$/,""),c=e.slice(a.length).replace(/^\s+/,"");return{after:c?new La(c):null,before:a?new La(a):null}}class La{constructor(t){this._content=i(t)?String(t):""}width(t){return Ra(t.ctx,this._content)}font(){return null}color(){return null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l}){e.fillTextRect(t,this._content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{bottom:l,left:i,right:r,top:s}})}canBreak(){return!!this._content}splitIndex(t){const e=this._content,o=k.genChars(e),n=[];let i=o.next();for(let e=0;e<t&&null!==i;e++,i=o.next())n.push(i);const r=n.join(""),s=e.slice(r.length);return{after:s?new La(s):null,before:r?new La(r):null}}breakWord(t,e){const o=this._content,n=this.width({ctx:t}),i=Math.floor(this._content.length*e/n);return Ea(t,o,k.genWords(o),i,e)}breakAll(t,e){const o=this._content,n=this.width({ctx:t}),i=Math.floor(this._content.length*e/n);return Ea(t,o,k.genChars(o),i,e)}toString(){return this._content}}class Sa extends La{constructor({draw:t,width:e,color:o}){super(),this._draw=t,this._width=e,this._color=o}width(t){return this._width}font(){return null}color(){var t;return null!==(t=this._color)&&void 0!==t?t:null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l}){this._draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l})}canBreak(){return!1}toString(){return""}}class ka{constructor(t,e){const o=document.createElement("span");o.setAttribute("aria-hidden","true"),o.textContent=e||"BESbswy",function(t){return[{display:"block",position:"absolute",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0","white-space":"nowrap",font:t},{"font-variant":"normal","font-size":"300px","font-style":"normal","font-weight":"400","line-height":"normal"}]}(t).forEach((t=>{for(const e in t){const n=e;o.style[n]=t[n]}})),document.body.appendChild(o),this._el=o}getWidth(){return this._el.offsetWidth}remove(){document.body.removeChild(this._el)}}const Ia={SERIF:"serif",SANS_SERIF:"sans-serif"},Ta={};class Ba{constructor(t,e){this.activeCallbacks=[],this.inactiveCallbacks=[],this.status=null,this.lastResortWidths_={},this.fontRulerA_=new ka(`${t},${Ia.SERIF}`,e),this.fontRulerB_=new ka(`${t},${Ia.SANS_SERIF}`,e);const o=new ka(`4px ${Ia.SERIF}`,e),n=new ka(`4px ${Ia.SANS_SERIF}`,e);this.lastResortWidths_[Ia.SERIF]=o.getWidth(),this.lastResortWidths_[Ia.SANS_SERIF]=n.getWidth(),o.remove(),n.remove(),this.started_=Date.now(),this.check_()}static load(t,e,o,n){const i=Ta[t]||(Ta[t]={});let r;r=i[e+=""]?i[e]:i[e]=new Ba(t,e),r.then(o,n)}then(t,e){this.status?"ng"!==this.status?t():e():(this.activeCallbacks.push(t),this.inactiveCallbacks.push(e))}check_(){const t=this.fontRulerA_.getWidth(),e=this.fontRulerB_.getWidth();this.isFallbackFont_(t,e)||this.isLastResortFont_(t,e)?Date.now()-this.started_>=3e3?this.isLastResortFont_(t,e)?(this.finish_(this.activeCallbacks),this.status="ok"):(this.finish_(this.inactiveCallbacks),this.status="ng"):setTimeout((()=>{this.check_()}),50):(this.finish_(this.activeCallbacks),this.status="ok")}isFallbackFont_(t,e){return this.widthMatches_(t,Ia.SERIF)&&this.widthMatches_(e,Ia.SANS_SERIF)}widthsMatchLastResortWidths_(t,e){for(const o in Ia)if(Ia.hasOwnProperty(o)&&this.widthMatches_(t,Ia[o])&&this.widthMatches_(e,Ia[o]))return!0;return!1}widthMatches_(t,e){return t===this.lastResortWidths_[e]}isLastResortFont_(t,e){return function(){if(null===Aa){const t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Aa=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return Aa}()&&this.widthsMatchLastResortWidths_(t,e)}finish_(t){setTimeout((()=>{this.fontRulerA_.remove(),this.fontRulerB_.remove(),t.forEach((t=>t()))}),0)}}let Aa=null;const Ma={all:!1};let Oa,Da;if(t)Oa=(t,e,o)=>{o()},Da=()=>!1;else{const t=!document.fonts;Oa=t?(t,e,o)=>{Ma[`${t} @ ${e}`]?o():Ba.load(t,e,(()=>{Ma[`${t} @ ${e}`]=!0,o()}),(()=>{Ma[`${t} @ ${e}`]=!0,o()}))}:(t,e,o)=>{Ma.all||Ma[t]?o():(document.fonts.ready.then((()=>{Ma.all=!0})),document.fonts.load(t).then((()=>{Ma[t]=!0,o()})))},Da=t?(t,e)=>!!Ma[`${t} @ ${e}`]||(Oa(t,e,(()=>{})),!1):(t,e)=>!(!Ma.all&&!Ma[t])||(!!document.fonts.check(t)||(Oa(t,e,(()=>{})),!1))}var Fa,Wa={check:Da,load:Oa};class Pa extends La{constructor(t){super(),this._icon=t||{}}width({ctx:t}){const e=this._icon;if(e.width)return e.width;if(e.font&&Wa.check(e.font,e.content||"")){t.save(),t.canvas.style.letterSpacing="normal";try{return t.font=e.font||t.font,t.measureText(e.content||"").width}finally{t.canvas.style.letterSpacing="",t.restore()}}return 0}font(){var t;return null!==(t=this._icon.font)&&void 0!==t?t:null}color(){var t;return null!==(t=this._icon.color)&&void 0!==t?t:null}canDraw(){const t=this._icon;return!t.font||Wa.check(t.font,t.content||"")}onReady(t){const e=this._icon;e.font&&!Wa.check(e.font,e.content||"")&&Wa.load(e.font,e.content||"",t)}draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l}){const a=this._icon;if(a.content){t.canvas.style.letterSpacing="normal";try{t.font=t.font,e.fillTextRect(t,a.content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{bottom:l,left:i,right:r,top:s}})}finally{t.canvas.style.letterSpacing=""}}}canBreak(){return!1}toString(){return""}}class Ha extends La{constructor({src:t,width:e,height:o,imageLeft:n,imageTop:i,imageWidth:r,imageHeight:s}){super(),this._inlineImgPromise=null,this._inlineImg=null,this._src=t,this._width=e,this._height=o,this._imageLeft=n,this._imageTop=i,this._imageWidth=r,this._imageHeight=s,this._onloaded=[],C(t)?t.then((t=>{this._src=t,this._loadImage(t)})):this._loadImage(t)}width(t){var e,o;return this._width||(null!==(o=null===(e=this._inlineImg)||void 0===e?void 0:e.width)&&void 0!==o?o:0)}font(){return null}color(){return null}canDraw(){return!!this._inlineImg}onReady(t){(C(this._src)||C(this._inlineImgPromise))&&this._onloaded.push((()=>t()))}draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l}){const a=this._inlineImg;e.drawInlineImageRect(t,a,this._imageLeft||0,this._imageTop||0,this._imageWidth||a.width,this._imageHeight||a.height,this._width||a.width,this._height||a.height,o.left,o.top,o.width,o.height,{offset:n+1,padding:{bottom:l,left:i,right:r,top:s}})}canBreak(){return!1}toString(){return""}_loadImage(t){const e=this._inlineImgPromise=Gn("InlineImage",50,t);C(e)?e.then((t=>{this._inlineImg=t,this._onloaded.forEach((t=>t()))})):this._inlineImg=e}}class za extends La{constructor({path:t,width:e,height:o,color:n}){super();const i=xa.getPath2D();this._path=new i(t),this._width=e,this._height=o,this._color=n}width(t){return this._width}font(){return null}color(){var t;return null!==(t=this._color)&&void 0!==t?t:null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvasHelper:e,rect:o,offset:n,offsetLeft:i,offsetRight:r,offsetTop:s,offsetBottom:l}){n++;const a={bottom:l,left:i,right:r,top:s};t.save();try{t.beginPath(),t.rect(o.left,o.top,o.width,o.height),t.clip();const e=Vn(t,o,this._width,this._height,{offset:n,padding:a});t.translate(e.x,e.y),t.fill(this._path)}finally{t.restore()}}canBreak(){return!1}toString(){return""}}function Na(t){const e="string"==typeof t?t:(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function Va(t){let e;if("string"==typeof t){const o=(new DOMParser).parseFromString(t,"image/svg+xml"),n=o.children||o.childNodes;e=n[0];for(let t=0;t<n.length;t++)if(n[t]instanceof SVGElement){e=n[t];break}}else e=t;return e}class $a extends Ha{constructor({svg:t,width:e,height:o}){var n,i;const r=m(t,Va),s=C(r)?void 0:null!==(n=r.getAttribute("width"))&&void 0!==n?n:void 0,l=C(r)?void 0:null!==(i=r.getAttribute("height"))&&void 0!==i?i:void 0,a={full:0,em:0},c=null!=s?Vi(s,a):void 0,h=null!=l?Vi(l,a):void 0;super({src:m(t,Na),width:e||c,height:o||h,imageWidth:c,imageHeight:h})}canBreak(){return!1}toString(){return""}}function Ua(t){if(t instanceof La)return t;if(!t)return null;if(function(t){return!(!t.font||!t.content)}(t))return new Pa(t);if(function(t){return!!t.src}(t))return new Ha({height:t.width,src:t.src,width:t.width});if(t.svg)return new $a({height:t.width,svg:t.svg,width:t.width});if(function(t){return!!t.path}(t))return new za({color:t.color,height:t.width,path:t.path,width:t.width});const e=ua.get();if(t.name&&e[t.name]){const o=e[t.name],n=t.width||Math.max(o.width,o.height);return new Sa({draw({ctx:t,rect:e,offset:i,offsetLeft:r,offsetRight:s,offsetTop:l,offsetBottom:a}){!function(t,e,o,n,i,r,s,l,{offset:a=2,padding:c}={}){const h={bottom:r+l,height:l,left:i,right:i+s,top:r,width:s};t.save();try{t.beginPath(),t.rect(h.left,h.top,h.width,h.height),t.clip();const i=Vn(t,h,o,n,{offset:a,padding:c});xa.fill(e,t,i.x,i.y,o,n)}finally{t.restore()}}(t,o,n,n,e.left,e.top,e.width,e.height,{offset:i+1,padding:{bottom:a,left:r,right:s,top:l}})},color:t.color,height:n,width:n})}return new Pa(t)}function Ka(t){return i(t)?t instanceof La?t:new La(t):null}function Ga(t,e){const o=[];if(t&&o.push(...t.map((t=>Ua(t))).filter(i)),Array.isArray(e))o.push(...e.map((t=>Ka(t))).filter(i));else{const t=Ka(e);t&&o.push(t)}return o}function ja(t,...e){const o=_(t.theme,...e);if(!i(o))return _(al.getDefault(),...e);if("function"!=typeof o)return o;let n;return t=>{const r=o(t);return i(r)?r:(n=n||_(al.getDefault(),...e),w(n,t))}}class Ya{constructor(t){this._checkbox=null,this._radioButton=null,this._button=null,this._header=null,this._switch=null,this._tree=null,this._grid=t}getThemeColor(...t){return ja(this._grid,...t)}get underlayBackgroundColor(){return ja(this._grid,"underlayBackgroundColor")}get font(){return ja(this._grid,"font")}get frozenRowsFont(){return ja(this._grid,"frozenRowsFont")}get color(){return ja(this._grid,"color")}get frozenRowsColor(){return ja(this._grid,"frozenRowsColor")}get defaultBgColor(){return ja(this._grid,"defaultBgColor")}get frozenRowsBgColor(){return ja(this._grid,"frozenRowsBgColor")}get focusBgColor(){return ja(this._grid,"focusBgColor")}get selectionBgColor(){return ja(this._grid,"selectionBgColor")}get highlightBgColor(){return ja(this._grid,"highlightBgColor")}get selectionDragBgColor(){return ja(this._grid,"selectionDragBgColor")}get borderColor(){return ja(this._grid,"borderColor")}get frozenRowsBorderColor(){return ja(this._grid,"frozenRowsBorderColor")}get highlightBorderColor(){return ja(this._grid,"highlightBorderColor")}get gridBorderColor(){return ja(this._grid,"gridBorderColor")}get gridBorderWidth(){return ja(this._grid,"gridBorderWidth")}get defaultRowHeight(){return ja(this._grid,"defaultRowHeight")}get defaultColWidth(){return ja(this._grid,"defaultColWidth")}get highlightBorderWidth(){return ja(this._grid,"highlightBorderWidth")}get checkbox(){const t=this._grid;return this._checkbox||(this._checkbox={get uncheckBgColor(){return ja(t,"checkbox","uncheckBgColor")},get checkBgColor(){return ja(t,"checkbox","checkBgColor")},get borderColor(){return ja(t,"checkbox","borderColor")}})}get radioButton(){const t=this._grid;return this._radioButton||(this._radioButton={get checkColor(){return ja(t,"radioButton","checkColor")},get uncheckBorderColor(){return ja(t,"radioButton","uncheckBorderColor")},get checkBorderColor(){return ja(t,"radioButton","checkBorderColor")},get uncheckBgColor(){return ja(t,"radioButton","uncheckBgColor")},get checkBgColor(){return ja(t,"radioButton","checkBgColor")}})}get button(){const t=this._grid;return this._button||(this._button={get color(){return ja(t,"button","color")},get bgColor(){return ja(t,"button","bgColor")}})}get header(){const t=this._grid;return this._header||(this._header={get sortArrowColor(){return ja(t,"header","sortArrowColor")}})}get switch(){const t=this._grid;return this._switch||(this._switch={get uncheckBgColor(){return ja(t,"switch","uncheckBgColor")},get checkBgColor(){return ja(t,"switch","checkBgColor")},get borderColor(){return ja(t,"switch","borderColor")}})}get tree(){const t=this._grid;return this._tree||(this._tree={get lineColor(){return ja(t,"tree","lineColor")},get buttonColor(){return ja(t,"tree","buttonColor")},get buttonBgColor(){return ja(t,"tree","buttonBgColor")},get buttonBorderColor(){return ja(t,"tree","buttonBorderColor")},get linkColor(){return ja(t,"tree","linkColor")}})}}!function(t){t[t.default=0]="default",t[t.iPhone=1]="iPhone"}(Fa||(Fa={}));const Xa=Fa.default,qa=Ka("");function Za(t,e,o,n,i){return w(t,{col:e,context:i,grid:n,row:o})}function Ja(t,e,o,n,i){if(null!=t)return w(t,{col:e,row:o,grid:n,context:i})}function Qa(t,e,o,n,i){if(!i){({color:i}=e);const r=t.isFrozenCell(o,n);r&&r.row&&(i=e.frozenRowsColor)}return i}function tc(t,e,o,n,i){if(!i){({font:i}=e);const r=t.isFrozenCell(o,n);r&&r.row&&(i=e.frozenRowsFont)}return i}function ec(t,e,o,n,i,r,s,l,a){function c(e,c,h){if(e.canDraw()){t.save();try{t.fillStyle=Za(e.color()||t.fillStyle,s,l,a,t),t.font=e.font()||t.font,e.draw({canvasHelper:Ll,ctx:t,offset:n,offsetBottom:r,offsetLeft:c,offsetRight:h,offsetTop:i,rect:o})}finally{t.restore()}}else e.onReady((()=>a.invalidateCell(s,l)))}if(1===e.length){c(e[0],0,0)}else if(e.length>1){const o=e.map((e=>(e.width({ctx:t})||0)-0));let n=o.reduce(((t,e)=>t+e)),i=0;e.forEach(((t,e)=>{const r=o[e];n-=r,c(t,i,n),i+=r}))}}function oc(t,e){return Ga(t,i(e)?e:"")}function nc(t){return function(t){return Ga(void 0,t).join("")}(t)}function ic(t){return rc(t)&&"ellipsis"!==t&&1===(t=t.trim()).length?Ka(t[0]):qa}function rc(t){return!(!t||"clip"===t||"string"!=typeof t)}function sc(t,e,o){const n=o-3;let i=0;for(let o=0;o<e.length;o++){const r=(e[o].width({ctx:t})||0)-0;if(i+r>n)return{index:o,lineWidth:i,remWidth:n-i};i+=r}return null}function lc(t,e,o){return!!sc(t,e,o)}function ac(t,e,o){const n=sc(t,e,o);if(!n)return{afterInlines:[],beforeInlines:e,overflow:!1};const i=n.index,r=n.remWidth,s=e[i],l=e.slice(0,i),a=[];if(s.canBreak()){const o=s.breakWord(t,r);let n=o.before,c=o.after;n||l.length||({before:n,after:c}=s.breakAll(t,r)),n||l.length||({before:n,after:c}=s.splitIndex(1)),n&&l.push(n),c&&a.push(c),a.push(...e.slice(i+1))}else l.length||l.push(s),a.push(...e.slice(l.length));return{afterInlines:a,beforeInlines:l,overflow:!0}}function cc(t,e,o,n,i){const r=sc(t,e,o);if(!r)return{inlines:e,overflow:!1};const{index:s,lineWidth:l}=r,a=e[s],c=ic(i),h=o-l-c.width({ctx:t})-n-1,d=e.slice(0,s);if(a.canBreak()){const e=a.breakAll(t,h).before;e&&d.push(e)}return d.push(c),{inlines:d,overflow:!0}}function hc(t,e,o,n,i,r,{offset:s,color:l,textAlign:a,textBaseline:c,font:h,textOverflow:d,icons:u}){e.fillStyle=Za(l||e.fillStyle,i,r,t,e),e.textAlign=a,e.textBaseline=c,e.font=h||e.font;let g=oc(u,o);if(rc(d)&&lc(e,g,n.width)){const{inlines:l,overflow:a}=cc(e,g,n.width,s,d);g=l,t.setCellOverflowText(i,r,a&&nc(o))}else t.setCellOverflowText(i,r,!1);ec(e,g,n,s,0,0,i,r,t)}function dc(t,e,o,n,i,r,{offset:s,color:l,textAlign:a,textBaseline:c,font:h,lineHeight:d,autoWrapText:u,lineClamp:g,textOverflow:f,icons:p}){if(e.fillStyle=Za(l||e.fillStyle,i,r,t,e),e.textAlign=a,e.textBaseline=c,e.font=h||e.font,"auto"===g){const t=n.height-2*s-2;g=Math.max(Math.floor(t/d),1)}let _;if(u||g>0||rc(f)){const l=n.width;_=[];const a=g>0?(n,a)=>{if(_.length+1>=g){if(0===n.length&&a)_.push([ic(f)]),t.setCellOverflowText(i,r,o.map(nc).join("\n"));else{const c=cc(e,n,l,s,f),h=c.inlines,d=c.overflow;_.push(a&&!d?h.concat([ic(f)]):h),(d||a)&&t.setCellOverflowText(i,r,o.map(nc).join("\n"))}return!1}return!0}:()=>!0,c=u?(t,o)=>{if(!a(t,o))return!1;for(;t.length;){if(!a(t,o))return!1;const{beforeInlines:n,afterInlines:i}=ac(e,t,l);_.push(n),t=i}return!0}:rc(f)?(n,c)=>{if(!a(n,c))return!1;const{inlines:h,overflow:d}=cc(e,n,l,s,f);return _.push(h),d&&t.setCellOverflowText(i,r,o.map(nc).join("\n")),!0}:(t,e)=>!!a(t,e)&&(_.push(t),!0);t.setCellOverflowText(i,r,!1);for(let t=0;t<o.length;t++){const e=o[t];if(!c(oc(0===t?p:void 0,e),t+1<o.length))break}}else t.setCellOverflowText(i,r,!1),_=o.map(((t,e)=>oc(0===e?p:void 0,t)));let w=0,C=d*(_.length-1);if("top"===e.textBaseline||"hanging"===e.textBaseline){const t=Nn(e,e.font).height,o=(d-t)/2;w+=o,C-=o}else if("bottom"===e.textBaseline||"alphabetic"===e.textBaseline||"ideographic"===e.textBaseline){const t=Nn(e,e.font).height,o=(d-t)/2;w-=o,C+=o}_.forEach((o=>{ec(e,o,n,s,w,C,i,r,t),w+=d,C-=d}))}function uc(t,e,o,n,i,r,{animElapsedTime:s=1,uncheckBgColor:l=r.theme.checkbox.uncheckBgColor,checkBgColor:a=r.theme.checkbox.checkBgColor,borderColor:c=r.theme.checkbox.borderColor,textAlign:h="center",textBaseline:d="middle"}={},u={}){const g=Ll.measureCheckbox(t).width;t.textAlign=h,t.textBaseline=d;const f=Vn(t,e,g+1,g+1,u);l=r.getColor(l,o,n,t),a=r.getColor(a,o,n,t),c=r.getColor(c,o,n,t),0<s&&s<1&&(l=i?l:_l(a,l,s),a=i?_l(l,a,s):a),Ll.drawCheckbox(t,f.x,f.y,!!i&&s,{borderColor:c,checkBgColor:a,uncheckBgColor:l})}function gc(t){if(Xa===Fa.default)return{height:22,width:44};{const e=t.height-t.height/4;return{height:e,width:1.625*e}}}function fc(t,e,o,n,i,r,s={},l={}){const a=void 0===s.animElapsedTime?1:s.animElapsedTime;let c=s.uncheckBgColor||r.theme.switch.uncheckBgColor,h=s.checkBgColor||r.theme.switch.checkBgColor,d=s.borderColor||r.theme.switch.borderColor;const u=s.textAlign||"center",g=s.textBaseline||"middle",f=gc(e);t.textAlign=u,t.textBaseline=g;const p=Vn(t,e,f.width+1,f.height+1,l);c=r.getColor(c,o,n,t),h=r.getColor(h,o,n,t),d=r.getColor(d,o,n,t),d=T.toBoxArray(d).find((t=>t));(Xa===Fa.default?Ll.drawSwitchButton:Ll.drawSwitchBtn)(t,p.x,p.y,i,a,{borderColor:d,checkBgColor:h,uncheckBgColor:c,btnSize:f})}function pc(t,e,o,n,i,r){if(Array.isArray(e)){const s=T.toBoxArray(e);Ll.strokeColorsRect(t,s,o,n,i,r)}else e&&(t.strokeStyle=e,t.strokeRect(o,n,i,r))}class _c{constructor(t){this._grid=t,this._theme=new Ya(t)}createCalculator(t,e){return{calcWidth:o=>Vi(o,{get full(){return t.getRect().width},get em(){return Nn(t.getContext(),e).width}}),calcHeight:o=>Vi(o,{get full(){return t.getRect().height},get em(){return Nn(t.getContext(),e).height}})}}getColor(t,e,o,n){return Za(t,e,o,this._grid,n)}toBoxArray(t){return T.toBoxArray(t)}toBoxPixelArray(t,e,o){if("string"==typeof t||Array.isArray(t)){const n=this.createCalculator(e,o),i=T.toBoxArray(t);return[n.calcHeight(i[0]),n.calcWidth(i[1]),n.calcHeight(i[2]),n.calcWidth(i[3])]}return T.toBoxArray(t)}get theme(){return this._theme}drawWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getContext();if(n){n.save();try{n.beginPath(),n.rect(o.left,o.top,o.width,o.height),n.clip(),e(n)}finally{n.restore()}}}drawBorderWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getRect(),i=t.getContext();if(i){i.save();try{i.lineCap="square",i.beginPath();let t=o.left,r=o.width;o.left===n.left&&(t+=-1,r+=1);let s=o.top,l=o.height;o.top===n.top&&(s+=-1,l+=1),i.rect(t,s,r,l),i.clip(),e(i)}finally{i.restore()}}}getTextRect(t,e,{padding:o,offset:n=2,textAlign:i="left",textBaseline:r="middle",font:s,textOverflow:l="clip",icons:a}={}){let c=e.getRect();const h=e.getDrawRect(),d=e.getContext(),{col:u,row:g}=e;if(s=tc(this._grid,this.theme,u,g,s),h&&d){d.save();try{if(s=Ja(s,e.col,e.row,this._grid,d),o){const t=this.toBoxPixelArray(o,e,s),n=c.left+t[3],i=c.top+t[0],r=c.width-t[1]-t[3],l=c.height-t[0]-t[2];c=new Ie(n,i,r,l)}d.textAlign=i,d.textBaseline=r,d.font=s||d.font;let h=oc(a,t);if(rc(l)&&lc(d,h,c.width)){h=cc(d,h,c.width,n,l).inlines}const u=h.map((t=>(t.width({ctx:d})||0)-0)),g=0,f=0;let p=u.length>0?u.reduce(((t,e)=>t+e)):0,_=0,w=c.right,C=c.bottom,m=0,y=0;h.forEach(((t,e)=>{const o=u[e];p-=o,d.font=t.font()||d.font;const i=Nn(d,d.font).height,r=Vn(d,{bottom:c.top+c.height,height:c.height,left:c.left,right:c.left+c.width,top:c.top,width:c.width},o,i,{offset:n+1,padding:{bottom:g,left:_,right:p,top:f}});w=Math.floor(Math.min(w,r.x)),C=Math.floor(Math.min(C,r.y)),m=Math.ceil(Math.max(m,r.x+o)),y=Math.ceil(Math.max(y,r.y+i)),_+=o})),c=new Ie(Math.min(w,m),Math.min(C,y),Math.abs(m-w),Math.abs(y-C))}finally{d.restore()}}return c}text(t,e,{padding:o,offset:n=2,color:i,textAlign:r="left",textBaseline:s="middle",font:l,textOverflow:a="clip",icons:c}={}){let h=e.getRect();const{col:d,row:u}=e;i=Qa(this._grid,this.theme,d,u,i),l=tc(this._grid,this.theme,d,u,l),this.drawWithClip(e,(g=>{if(l=Ja(l,e.col,e.row,this._grid,g),o){const t=this.toBoxPixelArray(o,e,l),n=h.left+t[3],i=h.top+t[0],r=h.width-t[1]-t[3],s=h.height-t[0]-t[2];h=new Ie(n,i,r,s)}hc(this._grid,g,t,h,d,u,{color:i,font:l,icons:c,offset:n,textAlign:r,textBaseline:s,textOverflow:a})}))}multilineText(t,e,{padding:o,offset:n=2,color:i,textAlign:r="left",textBaseline:s="middle",font:l,lineHeight:a="1em",autoWrapText:c=!1,lineClamp:h=0,textOverflow:d="clip",icons:u}={}){let g=e.getRect();const{col:f,row:p}=e;i=Qa(this._grid,this.theme,f,p,i),l=tc(this._grid,this.theme,f,p,l),this.drawWithClip(e,(_=>{if(l=Ja(l,e.col,e.row,this._grid,_),o){const t=this.toBoxPixelArray(o,e,l),n=g.left+t[3],i=g.top+t[0],r=g.width-t[1]-t[3],s=g.height-t[0]-t[2];g=new Ie(n,i,r,s)}const w=this.createCalculator(e,l);a=w.calcHeight(a),dc(this._grid,_,t,g,f,p,{autoWrapText:c,color:i,font:l,icons:u,lineClamp:h,lineHeight:a,offset:n,textAlign:r,textBaseline:s,textOverflow:d})}))}fillText(t,e,o,n,{color:i,textAlign:r="left",textBaseline:s="top",font:l}={}){const{col:a,row:c}=n;i=Qa(this._grid,this.theme,a,c,i),l=tc(this._grid,this.theme,a,c,l);const h=n.getContext();h.save();try{l=Ja(l,n.col,n.row,this._grid,h),h.fillStyle=Za(i,a,c,this._grid,h),h.textAlign=r,h.textBaseline=s,h.font=l||h.font,h.fillText(t,e,o)}finally{h.restore()}}clearCell(t){const e=t.getRect();this.drawWithClip(t,(t=>{t.clearRect(e.left,e.top,e.width,e.height)}))}fillCell(t,{fillColor:e=this.theme.defaultBgColor,selectionColor:o}={}){const n=t.getRect();this.drawWithClip(t,(i=>{const r=t.col,s=t.row;i.fillStyle=Za(e,r,s,this._grid,i),i.beginPath(),i.clearRect(n.left,n.top,n.width,n.height),i.rect(n.left,n.top,n.width,n.height),i.fill(),o&&(i.fillStyle=Za(o,r,s,this._grid,i),i.fill())}))}fillCellWithState(t,e={}){e.fillColor=this.getFillColorState(t,e),e.isEditing?(delete e.selectionColor,delete e.isEditing):e.selectionColor=this.getSelectionColorState(t,e),this.fillCell(t,e)}fillRect(t,e,{fillColor:o=this.theme.defaultBgColor,selectionColor:n}={}){const i=e.getContext();i.save();try{const r=e.col,s=e.row;i.fillStyle=Za(o,r,s,this._grid,i),i.beginPath(),i.rect(t.left,t.top,t.width,t.height),i.fill(),n&&(i.fillStyle=Za(n,r,s,this._grid,i),i.fill())}finally{i.restore()}}fillRectWithState(t,e,o={}){o.fillColor=this.getFillColorState(e,o),o.selectionColor=this.getSelectionColorState(e,o),this.fillRect(t,e,o)}getSelectionColorState(t,e={}){const o=t.getSelection(),{col:n,row:i}=t;return e.selectionColor?e.selectionColor:o.dragged?this.theme.selectionDragBgColor:!v(t.range,o.select.col,o.select.row)&&v(o.range,n,i)?this.theme.selectionBgColor:v(t.range,o.select.col,o.select.row)&&v(o.range,n,i)?this.theme.focusBgColor:void 0}getFillColorState(t,e={}){const o=t.getSelection(),{col:n,row:i}=t;if(!v(t.range,o.select.col,o.select.row)&&v(o.range,n,i))return this.theme.selectionBgColor;if(e.fillColor)return e.fillColor;if(v(t.range,o.select.col,o.select.row))return this.theme.highlightBgColor;const r=this._grid.isFrozenCell(n,i);return r&&r.row?this.theme.frozenRowsBgColor:this.theme.defaultBgColor}border(t,{borderColor:e=this.theme.borderColor,lineWidth:o=1}={}){const n=t.getRect();this.drawBorderWithClip(t,(i=>{const r=t.col,s=t.row;let l=n.left,a=n.top,c=n.width,h=n.height;0===r&&(l+=o,c-=o),0===s&&(a+=o,h-=o);const d=Za(e,r,s,this._grid,i);if(1===o)i.lineWidth=1,pc(i,d,l-.5,a-.5,c,h);else if(2===o)i.lineWidth=2,pc(i,d,l,a,c-1,h-1);else{i.lineWidth=o;const t=o/2-1;pc(i,d,l+t,a+t,c-o+1,h-o+1)}}))}borderSelection(t,e={}){const o=t.col,n=t.row,i=t.getSelection().border,r=t.getRect(),s=t.getDrawRect()||r,l=this._grid.isFrozenCell(o,n);if(l&&l.row&&(e.borderColor=this.theme.frozenRowsBorderColor),e.lineWidth=1,this.border(t,e),e.isEditing)return;let a=1;void 0!==e.highlightBorderWidth&&(a=e.highlightBorderWidth),(i.top||i.right||i.bottom||i.left)&&this.drawBorderWithClip(t,(t=>{const e=Za(this.theme.highlightBorderColor,o,n,this._grid,t),l=T.toBoxArray(e);if(t.lineWidth=a,t.lineWidth>0){const e=t.lineWidth/2;0===n&&(r.top+=e),0===o&&(r.left+=e),i.top&&(t.strokeStyle=l[0]||t.strokeStyle,t.beginPath(),t.moveTo(r.left,r.top),t.lineTo(r.right-e,r.top),t.stroke()),i.right&&(t.strokeStyle=l[1]||t.strokeStyle,t.beginPath(),t.moveTo(r.right-e,r.top),t.lineTo(r.right-e,r.bottom-e),t.stroke()),i.bottom&&(t.strokeStyle=l[2]||t.strokeStyle,t.beginPath(),t.moveTo(r.right-e,r.bottom-e),t.lineTo(r.left,r.bottom-e),t.stroke()),i.left&&(t.strokeStyle=l[3]||t.strokeStyle,t.beginPath(),t.moveTo(r.left,r.bottom-e),t.lineTo(r.left,r.top),t.stroke())}if(i.right&&i.bottom&&this._grid.canDragSelection){const e=s.right,o=s.bottom;t.lineWidth=1,t.strokeStyle=l[1]||l[2]||t.strokeStyle,t.beginPath(),t.moveTo(e-8,o-3),t.lineTo(e-3,o-8),t.moveTo(e-5,o-3),t.lineTo(e-3,o-5),t.stroke()}}));const c=this._grid.selection.range;c.start.row<=n&&c.end.row>=n&&c.end.col===o-1?this.drawBorderWithClip(t,(t=>{const e=Za(this.theme.highlightBorderColor,o-1,n,this._grid,t),i=T.toBoxArray(e);t.lineWidth=1,t.strokeStyle=i[1]||t.strokeStyle,t.beginPath(),t.moveTo(r.left-.5,r.top),t.lineTo(r.left-.5,r.bottom),t.stroke()})):c.start.col<=o&&c.end.col>=o&&c.end.row===n-1&&this.drawBorderWithClip(t,(t=>{const e=Za(this.theme.highlightBorderColor,o,n-1,this._grid,t),i=T.toBoxArray(e);t.lineWidth=1,t.strokeStyle=i[0]||t.strokeStyle,t.beginPath(),t.moveTo(r.left,r.top-.5),t.lineTo(r.right,r.top-.5),t.stroke()}))}buildCheckBoxInline(t,e,o={}){const n=this,i=Ll.measureCheckbox(e.getContext()).width;return new Sa({color:void 0,draw:function(i){const r=e.col,s=e.row;uc(i.ctx,i.rect,r,s,t,n,o,{offset:i.offset+1,padding:{bottom:i.offsetBottom,left:i.offsetLeft+1,right:i.offsetRight,top:i.offsetTop}})},height:i+1,width:i+3})}buildSwitchBtnInline(t,e,o={}){const n=this,i=gc(e.getRect());return new Sa({color:void 0,draw:function(i){const r=e.col,s=e.row;fc(i.ctx,i.rect,r,s,t,n,o,{offset:i.offset+1,padding:{bottom:i.offsetBottom,left:i.offsetLeft+1,right:i.offsetRight,top:i.offsetTop}})},height:i.height+1,width:i.width+3})}checkbox(t,e,o={}){this.drawWithClip(e,(n=>{const{col:i,row:r}=e;uc(n,e.getRect(),i,r,t,this,o)}))}radioButton(t,e,o={}){this.drawWithClip(e,(n=>{const{col:i,row:r}=e;!function(t,e,o,n,i,r,{animElapsedTime:s=1,checkColor:l=r.theme.radioButton.checkColor,uncheckBorderColor:a=r.theme.radioButton.uncheckBorderColor,checkBorderColor:c=r.theme.radioButton.checkBorderColor,uncheckBgColor:h=r.theme.radioButton.uncheckBgColor,checkBgColor:d=r.theme.radioButton.checkBgColor,textAlign:u="center",textBaseline:g="middle"},f={}){const p=Ll.measureRadioButton(t).width;t.textAlign=u,t.textBaseline=g;const _=Vn(t,e,p+1,p+1,f);l=r.getColor(l,o,n,t),a=r.getColor(a,o,n,t),c=r.getColor(c,o,n,t),h=r.getColor(h,o,n,t),d=r.getColor(d,o,n,t);let w=i?c:a,C=i?d:h;0<s&&s<1&&(w=i?_l(a,c,s):_l(c,a,s),C=i?_l(h,d,s):_l(d,h,s)),Ll.drawRadioButton(t,_.x,_.y,i?s:1-s,{checkColor:l,borderColor:w,bgColor:C})}(n,e.getRect(),i,r,t,this,o)}))}switch(t,e,o={}){this.drawWithClip(e,(n=>{const i=e.col,r=e.row;fc(n,e.getRect(),i,r,t,this,o)}))}button(t,e,{bgColor:o=this.theme.button.bgColor,padding:n,offset:i=2,color:r=this.theme.button.color,textAlign:s="center",textBaseline:l="middle",shadow:a,font:c,textOverflow:h="clip",icons:d}={}){const u=e.getRect();this.drawWithClip(e,(g=>{c=Ja(c,e.col,e.row,this._grid,g);const f=e.col,p=e.row,_=this.toBoxPixelArray(n||u.height/8,e,c),w=u.left+_[3],C=u.top+_[0],m=u.width-_[1]-_[3],y=u.height-_[0]-_[2];o=Za(o,e.col,e.row,this._grid,g),Ll.drawButton(g,w,C,m,y,{bgColor:o,radius:u.height/8,shadow:a}),hc(this._grid,g,t,new Ie(w,C,m,y),f,p,{color:r,font:c,icons:d,offset:i,textAlign:s,textBaseline:l,textOverflow:h})}))}testFontLoad(t,e,o){return function(t,e,o,n){return!(t&&!Wa.check(t,e)&&(Wa.load(t,e,(()=>function(t,e){e.invalidateCell(t.col,t.row)}(o,n))),1))}(t,e,o,this._grid)}tree(t,e,{font:o,offset:n=2,color:r,lineColor:s=this.theme.tree.lineColor,buttonColor:l=this.theme.tree.buttonColor,buttonBgColor:a=this.theme.tree.buttonBgColor,buttonBorderColor:c=this.theme.tree.buttonBorderColor,icons:h,padding:d,textAlign:u="left",textBaseline:g="middle",textOverflow:f="clip",treeInfo:p,treeNodeSpace:_=0,isMultilineText:w=!1,autoWrapText:C=!1,lineHeight:m="1em",lineClamp:y=0}={}){let v=e.getRect();const b=e.col,x=e.row;r=Qa(this._grid,this.theme,b,x,r),o=tc(this._grid,this.theme,b,x,o),this.drawWithClip(e,(R=>{let E=v.left,L=0;if(p){const t=p,e=5,o=v.top,n=o+v.height/2,i=o+v.height;L=_,R.strokeStyle=this.getColor(s,b,x,R),R.beginPath();for(let r=0;r<t.level;r++){E+=L;const s=r===t.level-1,l=t.levelLast[r];!s&&l||(R.moveTo(E,o),l?R.lineTo(E,n):R.lineTo(E,i),s&&(R.moveTo(E,n),R.lineTo(E+L-e,n)))}if(R.stroke(),!t.isLeaf){R.beginPath(),R.strokeStyle=this.getColor(c,b,x,R),R.moveTo(E+L+e,n),R.arc(E+L,n,e,0,2*Math.PI),R.fillStyle=this.getColor(a,b,x,R),R.fill(),R.stroke(),t.expanded&&(R.beginPath(),R.strokeStyle=this.getColor(s,b,x,R),R.moveTo(E+L,n+e),R.lineTo(E+L,i),R.stroke());const o=e-2;R.beginPath(),R.lineWidth=2,R.strokeStyle=this.getColor(l,b,x,R),R.moveTo(E+L-o,n),R.lineTo(E+L+o,n),t.expanded||(R.moveTo(E+L,n-o),R.lineTo(E+L,n+o)),R.stroke()}}if(v.left=E+2*L,o=Ja(o,e.col,e.row,this._grid,R),d){const t=this.toBoxPixelArray(d,e,o),n=v.left+t[3],i=v.top+t[0],r=v.width-t[1]-t[3],s=v.height-t[0]-t[2];v=new Ie(n,i,r,s)}if(w){const s=(t=i(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n"),l=this.createCalculator(e,o);m=l.calcHeight(m),dc(this._grid,R,s,v,b,x,{autoWrapText:C,color:r,font:o,icons:h,lineClamp:y,lineHeight:m,offset:n,textAlign:u,textBaseline:g,textOverflow:f})}else hc(this._grid,R,t,v,b,x,{color:r,font:o,icons:h,offset:n,textAlign:u,textBaseline:g,textOverflow:f})}))}attachArea(t,e){this.drawWithClip(e,(o=>{const n=e.getSelection(),{col:i,row:r}=e;v(n.range,i,r)||o.setLineDash([4,4]),o.strokeStyle="#D9D9D9",o.lineWidth=1;const s=t.left,l=t.top,a=t.width,c=t.height;o.beginPath(),o.moveTo(s+2,l),o.arcTo(s+a,l,s+a,l+2,2),o.arcTo(s+a,l+c,s+a-2,l+c,2),o.arcTo(s,l+c,s,l+c-2,2),o.arcTo(s,l,s+2,l,2),o.stroke()}))}}class wc{constructor(t){this._grid=t}dispose(){this.detachTooltipElement(),this._tooltipElement&&this._tooltipElement.dispose(),delete this._tooltipElement}attachTooltipElement(t,e,o){this._getTooltipElement().attach(this._grid,t,e,o)}moveTooltipElement(t,e){this._getTooltipElement().move(this._grid,t,e)}detachTooltipElement(){this._getTooltipElement().detach()}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal())}}const Cc="kaka-grid__tooltip-element",mc=`${Cc}__content`,yc=`${Cc}--hidden`,vc=`${Cc}--shown`;class bc{constructor(){this._handler=new Lt,this._rootElement=this.createTooltipDomElement(),this._messageElement=this.createTooltipMessageElement(this._rootElement,mc)}dispose(){this.detach();const t=this._rootElement;t.parentElement&&t.parentElement.removeChild(t),this._handler.dispose(),this._messageElement=null}attach(t,e,o,n){const i=this._rootElement,r=this._messageElement;i.classList.remove(vc),i.classList.add(yc),r&&this.doSetContent(r,n),this._attachCell(t,e,o)?(i.classList.add(vc),i.classList.remove(yc)):this._detach()}move(t,e,o){const n=this._rootElement;this._attachCell(t,e,o)?(n.classList.add(vc),n.classList.remove(yc)):this._detach()}detach(){this._detach()}createTooltipDomElement(){Bt.inject("tooltipElement","@keyframes kaka-grid__tooltip-element--shown-animation {\n  0% {\n    opacity: 0;\n    transform: scale(0.8) translateX(-60%);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) translateX(-50%);\n  }\n}\n\n.kaka-grid__tooltip-element {\n  position: absolute;\n  box-sizing: border-box;\n  border-radius: 3px;\n  /* background-color: #232f34; */\n  background-color: #fff;\n  border: 1px solid #ccc;\n  box-shadow: 1px 1px 3px #ccc;\n  padding: 8px;\n  pointer-events: none;\n  user-select: none;\n  color: #333;\n}\n\n.kaka-grid__tooltip-element--hidden {\n  opacity: 0;\n  transform: translateX(-50%);\n  /* transition: opacity 75ms linear; */\n}\n\n.kaka-grid__tooltip-element--shown {\n  opacity: 1;\n  transform: translateX(-50%);\n  animation: kaka-grid__tooltip-element--shown-animation 150ms ease-out;\n}\n\n.kaka-grid__tooltip-element__content {\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  width: 100%;\n  display: block;\n  /* white-space: pre-wrap; */\n  margin: 0;\n  box-sizing: border-box;\n}\n");return wt("div",{classList:[Cc,yc]})}createTooltipMessageElement(t,e){const o=wt("pre",{classList:[e]});return t.appendChild(o),o}doSetContent(t,e){t.textContent=e}_detach(){const t=this._rootElement;t.parentElement&&(t.classList.remove(vc),t.classList.add(yc))}_attachCell(t,e,o){const n=this._rootElement,{element:i,rect:r}=t.getAttachCellsArea(t.getCellRange(e,o)),s=r.top,l=r.right,a=r.bottom,c=r.left,h=r.width,d=t.frozenRowCount,u=t.frozenColCount;if(o>=d&&d>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,d-1));if(a<o.bottom)return!1}else if(a<0)return!1;if(e>=u&&u>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(u-1,o));if(l<e.right)return!1}else if(l<0)return!1;const g=i.offsetHeight,f=i.offsetWidth;if(g<s)return!1;if(f<c)return!1;const p=a,_=c+h/2;n.style.top=`${p.toFixed()}px`,n.style.left=`${_.toFixed()}px`,n.style.minWidth=`${h.toFixed()}px`,n.parentElement!==i&&i.appendChild(n);const w=n.offsetHeight,C=n.offsetWidth;if(p+w>g){const t=s-w;n.style.top=`${t.toFixed()}px`}if(_-C/2<0){const t=C/2;n.style.left=`${t.toFixed()}px`}else if(_+C/2>f){const t=f-C/2;n.style.left=`${t.toFixed()}px`}return!0}}class xc extends wc{createTooltipElementInternal(){return new bc}}class Rc extends bc{createTooltipMessageElement(t,e){const o=wt("div",{classList:[e]});return t.appendChild(o),o}doSetContent(t,e){t.innerHTML=e}}class Ec extends wc{createTooltipElementInternal(){return new Rc}}const Lc={"overflow-html":t=>new Ec(t),"overflow-text":t=>new xc(t)};class Sc{constructor(t){this._grid=t,this._tooltipInstances={},this._bindGridEvent(t)}dispose(){const t=this._tooltipInstances;for(const e in t)t[e].dispose();this._attachInfo=null}_attach(t,e){const o=this._attachInfo,n=this._getTooltipInstanceInfo(t,e);if(!o||n&&o.instance===n.instance||(o.instance.detachTooltipElement(),this._attachInfo=null),!n)return;const{instance:i}=n;i.attachTooltipElement(t,e,n.content);const r=this._grid.getCellRange(t,e);this._attachInfo={range:r,instance:i}}_move(t,e){const o=this._attachInfo;if(!o||!v(o.range,t,e))return;const{instance:n}=o;n.moveTooltipElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachTooltipElement(),this._attachInfo=null}_isAttachCell(t,e){const o=this._attachInfo;return!!o&&v(o.range,t,e)}_bindGridEvent(t){t.listen(Fl.MOUSEOVER_CELL,(t=>{t.related&&this._isAttachCell(t.col,t.row)||this._attach(t.col,t.row)})),t.listen(Fl.MOUSEOUT_CELL,(t=>{t.related&&this._isAttachCell(t.related.col,t.related.row)||this._detach()})),t.listen(Fl.SELECTED_CELL,(t=>{this._isAttachCell(t.col,t.row)&&this._detach()})),t.listen(Fl.SCROLL,(()=>{const t=this._attachInfo;t&&this._move(t.range.start.col,t.range.start.row)})),t.listen(Fl.CHANGED_VALUE,(t=>{this._isAttachCell(t.col,t.row)&&(this._detach(),this._attach(t.col,t.row))}))}_getTooltipInstanceInfo(t,e){const o=this._grid,n=this._tooltipInstances,i=function(t,e,o){const n=t.getCellOverflowText(e,o);if(n)return{content:n,type:t.getCellOverflowType(e,o)||"overflow-text"};return null}(o,t,e);if(!i)return null;const r=i.type;return{instance:n[r]||(n[r]=Lc[r](o)),type:r,content:i.content}}}const kc=z("protected.list_grid");function Ic(t,e){if(t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}function Tc(t,e,o,n){const i=[];if(e<=o)for(let r=e;r<=o;r++)i.push(Ac(t,r,n));else for(let r=e;r>=o;r--)i.push(Ac(t,r,n));return i}function Bc(t,e,o){const{layoutMap:n}=t[kc];let i=n.getCellRange(e,o);const r=function(t,e,o){let n=null;const{spanBodyOptions:i,layoutMap:r}=t[kc];if(i&&o>=r.headerRowCount){let s=o,l=o;const{startCol:a,endCol:c}=i;if(a<=e&&e<=c||c<=e&&e<=a){const n=Tc(t,a,e,o);for(;s>r.headerRowCount&&Ic(n,Tc(t,a,e,s-1));)s--;for(;l<t.rowCount&&Ic(n,Tc(t,a,e,l+1));)l++}n={start:{col:e,row:Math.min(s,l)},end:{col:e,row:Math.max(s,l)}}}return n}(t,e,o);var s,l;r&&(s=i,l=r,i={start:{col:Math.min(s.start.col,s.end.col,l.start.col,l.end.col),row:Math.min(s.start.row,s.end.row,l.start.row,l.end.row)},end:{col:Math.max(s.start.col,s.end.col,l.start.col,l.end.col),row:Math.max(s.start.row,s.end.row,l.start.row,l.end.row)}});const a={get col(){return e},get row(){return o},cellRange:i};return t.fireListeners(Fl.CELL_RANGE,a),a.cellRange}function Ac(t,e,o){let n;if(o<t[kc].layoutMap.headerRowCount){const{caption:i}=t[kc].layoutMap.getHeader(e,o);n="function"==typeof i?i():i}else{const{field:i}=t[kc].layoutMap.getBody(e,o);n=Wc(t,i,o)}const i={get col(){return e},get row(){return o},cellValue:n};return t.fireListeners(Fl.CELL_VALUE,i),i.cellValue}function Mc(t,e,o){if(o<t[kc].layoutMap.headerRowCount)return null;{const n=t[kc].layoutMap.getBody(e,o);return n&&n.message?Wc(t,n.message,o):null}}function Oc(t,e){return"function"==typeof e?e(t.headerValues):t.headerValues.get(e)}function Dc(t,e){if(Array.isArray(e))return e.map((e=>Dc(t,e)));if(!S.isObject(e)||"function"==typeof e)return Oc(t,e);const o={},n=e;return ke.iconPropKeys.forEach((e=>{if(n[e]){const r=Oc(t,n[e]);i(r)?o[e]=r:function(t,e){let o=!1;return t[kc].layoutMap.headerObjects.forEach((t=>{t.field===e&&(o=!0)})),o}(t,n[e])||(o[e]=n[e])}})),o}function Fc(t,e,o){if(Array.isArray(e))return e.map((e=>Fc(t,e,o)));if(!S.isObject(e)||"function"==typeof e)return Wc(t,e,o);const n={},r=e;return ke.iconPropKeys.forEach((e=>{if(r[e]){const s=Wc(t,r[e],o);i(s)?n[e]=s:function(t,e,o){if(!i(e))return!1;if(o<t[kc].layoutMap.headerRowCount)return!1;{const n=Uc(t,o);return t[kc].dataSource.hasField(n,e)}}(t,r[e],o)||(n[e]=r[e])}})),n}function Wc(t,e,o){if(!i(e))return null;if(o<t[kc].layoutMap.headerRowCount)return null;{const n=Uc(t,o);return t[kc].dataSource.getField(n,e)}}function Pc(t,e,o,{col:n,row:i},r,s){const l=t[kc].gridCanvasHelper,a=!!Ot(t).cellRange,c=({bgColor:t}={})=>{const e={fillColor:t,isEditing:a};l.fillCellWithState(o,e)},h=()=>{if(o.col===t.frozenColCount-1){const e=o.getRect();l.drawWithClip(o,(n=>{const i=o.row>=t.frozenRowCount?l.theme.borderColor:l.theme.frozenRowsBorderColor,r=l.toBoxArray(l.getColor(i,o.col,o.row,n));r[1]&&(n.lineWidth=1,n.strokeStyle=r[1],n.beginPath(),n.moveTo(e.right-2.5,e.top),n.lineTo(e.right-2.5,e.bottom),n.stroke())}))}l.borderSelection(o,{isEditing:a,highlightBorderWidth:Vi(t.highlightBorderWidth,t[kc].calcWidthContext)})};return s(e,{getRecord:()=>t.getRowRecord(i),getIcon:()=>function(t,e,o){const n=t[kc].layoutMap.getBody(e,o).icon;return null==n?null:Fc(t,n,o)}(t,n,i),getMessage:()=>Mc(t,n,i),messageHandler:t[kc].messageHandler,style:r,clearCellBase:()=>{l.clearCell(o)},drawCellBase:({bgColor:t}={})=>{c({bgColor:t}),h()},drawCellBg:c,drawCellBorder:h,getCell:()=>({col:n,row:i}),getHeaderIcon:()=>function(t,e,o){const n=t[kc].layoutMap.getHeader(e,o).icon;return null==n?null:Dc(t,n)}(t,n,i),getContentHidden:()=>function(t,e,o){let n=!1;if(o>=t[kc].layoutMap.headerRowCount){const i=t[kc].layoutMap.getBody(e,o);i&&i.contentHidden&&(n=w(i.contentHidden,t.getRowRecord(o)))}return n}(t,n,i)},o,t)}function Hc(t){var e;const o=t[kc];o.headerEvents&&o.headerEvents.forEach((e=>t.unlisten(e)));const n=o.headerEvents=[];let i;n.forEach((e=>t.unlisten(e))),i=o.layout&&(!Array.isArray(o.layout)||o.layout.length>0)?o.layoutMap=new Dl(new Ol(o.layout)):o.layoutMap=new Dl(new Bl(null!==(e=o.header)&&void 0!==e?e:[])),i.hiddenHeader=o.hiddenHeader,t.hiddenHeader||i.headerObjects.forEach((e=>{const o=e.headerType.bindGridEvent(t,e.id);if(n.push(...o),e.style&&e.style instanceof Ls){const o=e.style.listen(Ls.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));n.push(o)}if(e.action&&e.action instanceof is){const o=e.action.bindGridEvent(t,e.id);n.push(...o)}})),i.columnObjects.forEach((e=>{if(e.action){const o=e.action.bindGridEvent(t,e.id);n.push(...o)}if(e.columnType){const o=e.columnType.bindGridEvent(t,e.id);n.push(...o)}if(e.style&&e.style instanceof Oi.style.BaseStyle){const o=e.style.listen(Oi.style.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));n.push(o)}}));for(let e=0;e<i.columnWidths.length;e++){const o=i.columnWidths[e],{width:n,minWidth:r,maxWidth:s,disableResize:l}=o;n&&(n>0||"string"==typeof n)&&t.setColWidth(e,n),r&&(r>0||"string"==typeof r)&&t.setMinColWidth(e,r),s&&(s>0||"string"==typeof s)&&t.setMaxColWidth(e,s),"boolean"==typeof l&&t.setColDisableResize(e,l)}if(!t.hiddenHeader){const e=t[kc].headerRowHeight;for(let o=0;o<i.headerRowCount;o++){const n=Array.isArray(e)?e[o]:e;n&&n>0&&t.setRowHeight(o,n)}}t.colCount=i.colCount,zc(t),t.frozenRowCount=i.headerRowCount}function zc(t){const{layoutMap:e}=t[kc];t.rowCount=t[kc].dataSource.length*e.bodyRowCount+e.headerRowCount}function Nc(t,e){t[kc].dataSourceEventIds&&t[kc].dataSourceEventIds.forEach((e=>t[kc].handler.off(e))),e(t),t[kc].dataSourceEventIds=[t[kc].handler.on(t[kc].dataSource,di.EVENT_TYPE.UPDATED_LENGTH,(()=>{zc(t),t.selection.fireSelectedEvent(),t.invalidate()})),t[kc].handler.on(t[kc].dataSource,di.EVENT_TYPE.UPDATED_ORDER,(()=>{t.selection.fireSelectedEvent(),t.invalidate()})),t[kc].handler.on(t[kc].dataSource,di.EVENT_TYPE.REFRESH_DATA,(()=>{t.selection.fireSelectedEvent(),t.invalidate()}))]}function Vc(t,e=[]){Nc(t,(()=>{t[kc].records=e;const o=t[kc].dataSource=Zr.ofArray(e);t.addDisposable(o)}))}function $c(t,e){Nc(t,(()=>{if(e)if(e instanceof di)t[kc].dataSource=e;else{const o=t[kc].dataSource=new Zr(e);t.addDisposable(o)}else t[kc].dataSource=di.EMPTY;t[kc].records=null}))}function Uc(t,e){const{layoutMap:o}=t[kc];return o.getRecordIndexByRow(e)}function Kc(t,e=(()=>!0)){var o;const{layoutMap:n}=this[kc],i=this.selection.range,{start:r}=this.getCellRange(i.start.col,i.start.row),{end:s}=this.getCellRange(i.end.col,i.end.row),l=cr(t),a=Math.min(Math.max(s.row-r.row+1,l.rowCount),this.rowCount-r.row),c=Math.min(Math.max(s.col-r.col+1,l.colCount),this.colCount-r.col);let h=!1;const d=[];for(let t=0;t<n.bodyRowCount;t++){const e=[];d.push(e);for(let i=0;i<c;i++){const s=n.getBody(r.col+i,t+n.headerRowCount);e[i]=s,!h&&(null===(o=s.action)||void 0===o?void 0:o.editable)&&(h=!0)}}if(!h)return;const u=n.getRecordStartRowByRecordIndex(n.getRecordIndexByRow(r.row));let g={},f=r.row-u,p=0;for(let t=0;t<a;t++){let o=0;for(let n=0;n<c;n++){const{action:i,id:s}=d[f][n];if(!g[s]&&(null==i?void 0:i.editable)){g[s]=!0;const a=r.col+n,c=r.row+t,h=l.getCellValue(o,p);m(this.getRowRecord(c),(t=>{m(Ac(this,a,c),(o=>{e({grid:this,record:t,col:a,row:c,value:h,oldValue:o})&&i.onPasteCellRangeBox(this,{col:a,row:c},h)}))}))}o++,o>=l.colCount&&(o=0)}f++,f>=n.bodyRowCount&&(f=0,g={}),p++,p>=l.rowCount&&(p=0)}const _={col:r.col+c-1,row:r.row+a-1};this.selection.range={start:r,end:_},this.invalidateCellRange(this.selection.range)}function Gc(){var t;const{layoutMap:e}=this[kc],o=this.selection.range,{start:n}=this.getCellRange(o.start.col,o.start.row),{end:i}=this.getCellRange(o.end.col,o.end.row),r=Math.min(i.row-n.row+1,this.rowCount-n.row),s=Math.min(i.col-n.col+1,this.colCount-n.col);let l=!1;const a=[];for(let o=0;o<e.bodyRowCount;o++){const i=[];a.push(i);for(let r=0;r<s;r++){const s=e.getBody(n.col+r,o+e.headerRowCount);i[r]=s,!l&&(null===(t=s.action)||void 0===t?void 0:t.editable)&&(l=!0)}}if(!l)return;const c=e.getRecordStartRowByRecordIndex(e.getRecordIndexByRow(n.row));let h={},d=n.row-c;for(let t=0;t<r;t++){for(let e=0;e<s;e++){const{action:o,id:i}=a[d][e];if(!h[i]&&(null==o?void 0:o.editable)){h[i]=!0;const r=n.col+e,s=n.row+t;m(this.getRowRecord(s),(t=>{m(Ac(this,r,s),(t=>{o.onDeleteCellRangeBox(this,{col:r,row:s})}))}))}}d++,d>=e.bodyRowCount&&(d=0,h={})}this.invalidateCellRange(o)}function jc(t,e,o){const n=t[e];return t[e]=o,n}const Yc={theme:function(t,e){return null!=e?jc(Ys,t,e):Ys[t]},icon:function(t,e){return null!=e?jc(ia,t,e):ia[t]},icons:function(t){return function(t,e){for(const o in e)t[o]=e[o]}(ia,t)}},Xc={version:"2.3.1",core:qr,tools:Sl,ListGrid:class extends Xr{constructor(t={}){var e;super(function(t,e){const o={};for(const n in t)e.indexOf(n)>=0||Object.defineProperty(o,n,{get:()=>t[n],set(e){t[n]=e},configurable:!0,enumerable:!0});return o}(t,["colCount","rowCount","frozenRowCount"])),this[kc]={};const o=this[kc];o.disabled=t.disabled||!1,o.readOnly=t.readonly||!1,o.header=t.header||[],o.layout=t.layout||[],o.headerRowHeight=t.headerRowHeight||[],o.hiddenHeader=!!t.hiddenHeader,o.spanBodyOptions=t.spanBodyOptions||void 0,o.handler=new Lt,o.sortState={col:-1,order:void 0,row:-1},o.gridCanvasHelper=new _c(this),o.theme=al.of(t.theme),o.messageHandler=new na(this,((t,e)=>Mc(this,t,e))),o.tooltipHandler=new Sc(this),t.dataSource?$c(this,t.dataSource):Vc(this,t.records),o.allowRangePaste=null!==(e=t.allowRangePaste)&&void 0!==e&&e,Hc(this),this.selection.fireSelectedEvent(),this.invalidate(),i(t.monitorResize)&&!0!==t.monitorResize||o.handler.on(window,"resize",(()=>this.resize()))}static get EVENT_TYPE(){return Fl}dispose(){const t=this[kc];t.handler.dispose(),t.messageHandler.dispose(),t.tooltipHandler.dispose(),super.dispose()}get header(){return this[kc].header}set header(t){this[kc].header=t,Hc(this);const e=this.selection.range,o=this.updateSelectionRange(this.selection.range);e.start.col===o.start.col&&e.end.col===o.end.col&&e.start.row===o.start.row&&e.end.row===o.end.row||(this.selection._forceUpdateRange(),this.selection.fireSelectedEvent())}get layout(){return this[kc].layout}set layout(t){this[kc].layout=t,Hc(this)}get recordRowCount(){return this[kc].layoutMap.bodyRowCount}get records(){return this[kc].records||null}set records(t){null!=t&&(Vc(this,t),zc(this),this.invalidate())}get dataSource(){return this[kc].dataSource}set dataSource(t){$c(this,t),zc(this),this.invalidate()}get theme(){return this[kc].theme}set theme(t){this[kc].theme=al.of(t),this.invalidate()}get allowRangePaste(){return this[kc].allowRangePaste}set allowRangePaste(t){this[kc].allowRangePaste=t}get sortState(){return this[kc].sortState}set sortState(t){const e=this.sortState;let o;e.col>=0&&e.row>=0&&(o=this.getHeaderField(e.col,e.row));const n=this[kc].sortState=i(t)?t:{col:-1,row:-1,order:void 0};let r;n.col>=0&&n.row>=0&&(r=this.getHeaderField(n.col,n.row)),i(o)&&o!==r&&this.setHeaderValue(e.col,e.row,void 0),i(r)&&this.setHeaderValue(n.col,n.row,n.order)}get headerValues(){return this[kc].headerValues||(this[kc].headerValues=new Map)}set headerValues(t){this[kc].headerValues=t||new Map}get hiddenHeader(){return this[kc].hiddenHeader}set hiddenHeader(t){this[kc].hiddenHeader=t,Hc(this),this.invalidate()}get disabled(){return this[kc].disabled}set disabled(t){this[kc].disabled=t}get readOnly(){return this[kc].readOnly}set readOnly(t){this[kc].readOnly=t}get readonly(){return window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly}set readonly(t){window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly=t}get spanBodyOptions(){var t;return null!==(t=this[kc].spanBodyOptions)&&void 0!==t?t:null}set spanBodyOptions(t){this[kc].spanBodyOptions=null!=t?t:void 0}getField(t,e){return this[kc].layoutMap.getBody(t,null!=e?e:this[kc].layoutMap.headerRowCount).field}getColumnDefine(t,e){return this[kc].layoutMap.getBody(t,null!=e?e:this[kc].layoutMap.headerRowCount).define}getColumnType(t,e){return this[kc].layoutMap.getBody(t,e).columnType}getHeaderField(t,e){return this[kc].layoutMap.getHeader(t,e).field}getHeaderDefine(t,e){return this[kc].layoutMap.getHeader(t,e).define}getColumn(t,e){return this[kc].layoutMap.getBody(t,e||0)}getRowRecord(t){return t<this[kc].layoutMap.headerRowCount?void 0:this[kc].dataSource.get(Uc(this,t))}getRecordIndexByRow(t){return Uc(this,t)}getRowRecordIndex(t){return window.console.warn("'getRowRecordIndex' is deprecated, please use 'getRecordIndexByRow' instead"),this.getRecordIndexByRow(t)}getRecordStartRowByRecordIndex(t){return this[kc].layoutMap.getRecordStartRowByRecordIndex(t)}getColumnIndexByField(t){var e;const o=this.getCellRangeByField(t,0);return null!==(e=null==o?void 0:o.start.col)&&void 0!==e?e:null}getCellRangeByField(t,e){const{layoutMap:o}=this[kc],n=o.columnObjects.find((e=>e.field===t));if(n){const t=o.getBodyLayoutRangeById(n.id),i=o.getRecordStartRowByRecordIndex(e);return{start:{col:t.start.col,row:i+t.start.row},end:{col:t.end.col,row:i+t.end.row}}}return null}focusGridCell(t,e){var o;const{start:{col:n,row:i},end:{col:r,row:s}}=this.selection.range,l=null===(o=this.getCellRangeByField(t,e))||void 0===o?void 0:o.start;null!=l&&(this.focusCell(l.col,l.row),this.selection.select=l,this.invalidateGridRect(n,i,r,s),this.invalidateCell(l.col,l.row))}makeVisibleGridCell(t,e){var o,n,i;const r=null===(o=this.getCellRangeByField(t,e))||void 0===o?void 0:o.start;this.makeVisibleCell(null!==(n=null==r?void 0:r.col)&&void 0!==n?n:0,null!==(i=null==r?void 0:r.row)&&void 0!==i?i:this[kc].layoutMap.headerRowCount)}selectCellRange(t,e,o,n){this.focusCell(t,e),this.selection.range=er(t,e,o,n);const{start:{col:i,row:r},end:{col:s,row:l}}=this.selection.range;this.invalidateGridRect(i,r,s,l)}getGridCanvasHelper(){return this[kc].gridCanvasHelper}getCellRange(t,e){return Bc(this,t,e)}getHeaderCellRange(t,e){return window.console.warn("'getHeaderCellRange' is deprecated, please use 'getCellRange' instead"),this.getCellRange(t,e)}getCopyCellValue(t,e,o){var n;const i=Bc(this,t,e),r=o?Math.max(o.start.col,i.start.col):i.start.col,s=o?Math.max(o.start.row,i.start.row):i.start.row;if(r!==t||s!==e)return"";const{layoutMap:l}=this[kc];let a=Ac(this,t,e);if(e>=l.headerRowCount){const o=l.getBody(t,e).columnType;a=null!==(n=o.getCopyCellValue(a,this,{col:t,row:e}))&&void 0!==n?n:a,a=o.convertCopyValue(a,{col:t,row:e},this)}return a}onDrawCell(t,e,o){const{layoutMap:n}=this[kc];let i,r;if(e<n.headerRowCount){const o=n.getHeader(t,e);i=o.headerType.onDrawCell,({style:r}=o)}else{const o=n.getBody(t,e);i=o.columnType.onDrawCell,({style:r}=o)}!function(t,e,o,n){n.setRectFilter((n=>{let{left:i,right:r,top:s,bottom:l}=n;const{start:{col:a,row:c},end:{col:h,row:d}}=Bc(t,e,o);for(let o=e-1;o>=a;o--)i-=t.getColWidth(o);for(let o=e+1;o<=h;o++)r+=t.getColWidth(o);for(let e=o-1;e>=c;e--)s-=t.getRowHeight(e);for(let e=o+1;e<=d;e++)l+=t.getRowHeight(e);return Ie.bounds(i,s,r,l)})),n.range=Bc(t,e,o)}(this,t,e,o);return Pc(this,Ac(this,t,e),o,{col:t,row:e},r,i)}doGetCellValue(t,e,o){if(e<this[kc].layoutMap.headerRowCount)return!1;{const n=Ac(this,t,e);if(C(n))return!1;o(n)}return!0}doChangeValue(t,e,o){if(e<this[kc].layoutMap.headerRowCount)return!1;{const n=this.getRowRecord(e);if(C(n))return!1;const i=Ac(this,t,e);if(C(i))return!1;const r=o(i);return void 0!==r&&m(function(t,e,o,n){if(o<t[kc].layoutMap.headerRowCount)return!1;{const{field:i}=t[kc].layoutMap.getBody(e,o);if(null==i)return!1;const r=Uc(t,o);return t[kc].dataSource.setField(r,i,n)}}(this,t,e,r),(o=>{if(o){const{field:o}=this[kc].layoutMap.getBody(t,e);this.fireListeners(Fl.CHANGED_VALUE,{col:t,row:e,field:o,record:n,value:r,oldValue:i})}return o}))}}doSetPasteValue(t,e){Kc.call(this,t,e)}getHeaderValue(t,e){const o=this.getHeaderField(t,e);return this.headerValues.get(o)}setHeaderValue(t,e,o){const n=this.getHeaderField(t,e),i=this.headerValues.get(n);this.headerValues.set(n,o),this.fireListeners(Fl.CHANGED_HEADER_VALUE,{col:t,field:n,oldValue:i,row:e,value:o})}getLayoutCellId(t,e){return this[kc].layoutMap.getCellId(t,e)}completeEdit(){this.focus()}bindEventsInternal(){this.listen(Fl.SELECTED_CELL,(t=>{if(t.selected){const e=Bc(this,t.before.col,t.before.row),{start:{col:o,row:n},end:{col:i,row:r}}=e;o===i&&n===r||this.invalidateGridRect(o,n,i,r);const s=Bc(this,t.col,t.row),{start:{col:l,row:a},end:{col:c,row:h}}=s;l===c&&a===h||this.invalidateGridRect(l,a,c,h)}})),this.listen(Fl.PASTE_CELL,(t=>{if(!this[kc].allowRangePaste)return;const{start:e,end:o}=this.selection.range;if(!t.multi&&y(e,o))return;const{layoutMap:n}=this[kc];e.row<n.headerRowCount||(I.cancel(t.event),Kc.call(this,t.normalizeValue))})),this.listen(Fl.DELETE_CELL,(t=>{const{start:e}=this.selection.range,{layoutMap:o}=this[kc];e.row<o.headerRowCount||(I.cancel(t.event),Gc.call(this))}))}getMoveLeftColByKeyDownInternal({col:t,row:e}){const{start:{col:o}}=Bc(this,t,e);return t=o,super.getMoveLeftColByKeyDownInternal({col:t,row:e})}getMoveRightColByKeyDownInternal({col:t,row:e}){const{end:{col:o}}=Bc(this,t,e);return t=o,super.getMoveRightColByKeyDownInternal({col:t,row:e})}getMoveUpRowByKeyDownInternal({col:t,row:e}){const{start:{row:o}}=Bc(this,t,e);return e=o,super.getMoveUpRowByKeyDownInternal({col:t,row:e})}getMoveDownRowByKeyDownInternal({col:t,row:e}){const{end:{row:o}}=Bc(this,t,e);return e=o,super.getMoveDownRowByKeyDownInternal({col:t,row:e})}getOffsetInvalidateCells(){return 1}getCopyRangeInternal(t){const{start:e}=this.getCellRange(t.start.col,t.start.row),{end:o}=this.getCellRange(t.end.col,t.end.row);return{start:e,end:o}}getAttachCellsAreaInternal(t){const e=super.getAttachCellsAreaInternal(t),{start:{col:o,row:n}}=this.getCellRange(t.start.col,t.start.row);if(n>=this[kc].layoutMap.headerRowCount){this[kc].layoutMap.getBody(o,n).columnType.reviseAttachCellsArea(e,n,this)}return e}getAttachCellsPaddingInternal(t){const e=super.getAttachCellsPaddingInternal(t),{start:{col:o,row:n}}=this.getCellRange(t.start.col,t.start.row);if(n>=this[kc].layoutMap.headerRowCount){this[kc].layoutMap.getBody(o,n).columnType.reviseAttachCellsPadding(e,n,this)}return e}getFocusRectInternal(t,e){const o=super.getFocusRectInternal(t,e);if(this[kc]&&e>=this[kc].layoutMap.headerRowCount){this[kc].layoutMap.getBody(t,e).columnType.reviseFocusRect(o,e,this)}return o}getCellOverflowTextInternal(t){const e=t.col,o=t.row;let n="";if(o>=this[kc].layoutMap.headerRowCount){const t=this[kc].layoutMap.getBody(e,o).tooltip,i=this.getRowRecord(o);i&&("function"==typeof t?n=t.call(this,i):"string"==typeof t&&(n=i[t]))}else{const t=this[kc].layoutMap.getHeader(e,o);if(t){const i=t.tooltip;"function"==typeof i?n=i.call(this,{cell:{col:e,row:o},field:this.getHeaderField(e,o)}):"string"==typeof i&&(n=i)}}return n||""}getCellOverflowTypeInternal(t){const e=t.col,o=t.row;let n="";if(o>=this[kc].layoutMap.headerRowCount){const t=this[kc].layoutMap.getBody(e,o).tooltipType,i=this.getRowRecord(o);i&&("function"==typeof t?n=t.call(this,i):"string"==typeof t&&(n=t))}else{const t=this[kc].layoutMap.getHeader(e,o);if(t){const i=t.tooltipType;"function"==typeof i?n=i.call(this,{cell:{col:e,row:o},field:this.getHeaderField(e,o)}):"string"==typeof i&&(n=i)}}return n||""}getDefaultRowHeight(){return this[kc]&&this[kc].gridCanvasHelper.theme.defaultRowHeight||super.getDefaultRowHeight()}getDefaultColWidth(){return this[kc]&&this[kc].gridCanvasHelper.theme.defaultColWidth||super.getDefaultColWidth()}getHighlightBorderWidth(){return this[kc]&&this[kc].gridCanvasHelper.theme.highlightBorderWidth||super.getHighlightBorderWidth()}updateSelectionRange(t){const e=t.start.col,o=t.start.row,n=t.end.col,i=t.end.row,r=Math.min(t.start.col,t.end.col),s=Math.min(t.start.row,t.end.row),l=Math.max(t.start.col,t.end.col),a=Math.max(t.start.row,t.end.row);let c=r,h=s,d=l,u=a;for(let t=s;t<=a;t++)for(let e=r;e<=l;e++){const o=this.getCellRange(e,t);c=Math.min(o.start.col,c),h=Math.min(o.start.row,h),d=Math.max(o.end.col,d),u=Math.max(o.end.row,u)}return c<r&&(t.start.col>t.end.col?t.end.col=c:t.start.col=c),h<s&&(t.start.row>t.end.row?t.end.row=h:t.start.row=h),d>l&&(t.start.col>t.end.col?t.start.col=d:t.end.col=d),u>a&&(t.start.row>t.end.row?t.start.row=u:t.end.row=u),e===t.start.col&&o===t.start.row&&n===t.end.col&&i===t.end.row||(t=this.updateSelectionRange(t)),t}getDefaultFont(){return this[kc].gridCanvasHelper.theme.font}getDefaultUnderlayBackgroundColor(){return this[kc].gridCanvasHelper.theme.underlayBackgroundColor}getDefaultBorderColor(){return this[kc].gridCanvasHelper.theme.gridBorderColor}getDefaultBorderWidth(){return this[kc].gridCanvasHelper.theme.gridBorderWidth}fireListeners(t,...e){return super.fireListeners(t,...e)}},columns:Oi,data:ns,headers:js,themes:al,GridCanvasHelper:_c,get icons(){return ua.get()},template:k.template,register:Yc};var qc;return function(t){t.version=Xc.version;class e extends Xc.ListGrid{}t.ListGrid=e,t.core=Xc.core,t.tools=Xc.tools,t.columns=Xc.columns,t.data=Xc.data,t.headers=Xc.headers,t.themes=Xc.themes,t.GridCanvasHelper=Xc.GridCanvasHelper,t.icons=Xc.icons,t.template=Xc.template,t.register=Xc.register}(qc||(qc={})),qc}));
//# sourceMappingURL=kakaGrid.min.js.map
