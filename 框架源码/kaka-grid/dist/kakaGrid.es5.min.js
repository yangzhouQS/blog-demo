/*!
* @mctech/kaka-grid v2.3.1
* Copyright 2021 ChenGang <10147817@qq.com>
* Licensed under MIT
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).kakaGrid=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function o(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],l=0,a=i.length;l<a;l++,r++)o[r]=i[l];return o}function r(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var i,l,a="undefined"==typeof window||void 0===window.window,s={get find(){return i||(i=Array.prototype.find?function(t,e){return Array.prototype.find.call(t,e)}:function(t,e){var n=s.findIndex(t,e);return n>=0?t[n]:void 0})},get findIndex(){return l||(l=Array.prototype.findIndex?function(t,e){return Array.prototype.findIndex.call(t,e)}:function(t,e){for(var n=t.length,o=0;o<n;o++){if(e(t[o],o,t))return o}return-1})}},c=function(t){return null!=t},u=function(t){return c(t)&&("string"!=typeof t||""!==t)};var h=function(){if(a)return{Chrome:!1,Edge:!1,Firefox:!1,IE:!1,Safari:!1};var t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}(),f=h.IE,d=h.Chrome,p=h.Firefox,g=h.Edge,v=h.Safari;function y(t,e){for(var n in t)e(t[n],n,t)}function _(t,e){var n=[],o={},r=function(r){n.push(r),Object.defineProperty(o,r,{get:function(){var n=t[r];return void 0===n?e[r]:n},set:function(e){t[r]=e},configurable:!0,enumerable:!0})};for(var i in t)r(i);var l=function(r){if(n.indexOf(r)>=0)return"continue";Object.defineProperty(o,r,{get:function(){var n=t[r];return void 0===n?e[r]:n},set:function(e){t[r]=e},configurable:!0,enumerable:!0})};for(var i in e)l(i);return o}function b(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n={};return t.forEach((function(t){var e=function(e){Object.defineProperty(n,e,{get:function(){return t[e]},set:function(n){t[e]=n},configurable:!0,enumerable:!0})};for(var o in t)e(o)})),n}function w(t,e){for(;e&&e.parentElement;){var n=e.parentElement;if(t===n)return!0;e=n}return!1}function m(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];for(var r=t,i=0;i<n.length&&c(r);i++)r=e(r,n[i]);return r}function C(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return m.apply(void 0,o([t,function(t,e){return t[e]}],e))}function x(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return"function"==typeof t?t.apply(void 0,e):t}function R(t){return Boolean(t&&"function"==typeof t.then)}function E(t,e){return R(t)?t.then((function(t){return e(t)})):e(t)}function O(t,e){return t.col===e.col&&t.row===e.row}function L(t,e,n){return t.start.col<=e&&e<=t.end.col&&t.start.row<=n&&n<=t.end.row}var k=f,S=g,I=d,T=v,P=d?33554431:p?17895588:10737433,B={setReadonly:function(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:n})},isObject:function(t){return t===Object(t)}},A={endsWith:function(t,e,n){var o=t.toString();("number"!=typeof n||!isFinite(n)||Math.floor(n)!==n||n>o.length)&&(n=o.length),n-=e.length;var r=o.lastIndexOf(e,n);return-1!==r&&r===n},genChars:function(t){var e=/([\uD800-\uDBFF][\uDC00-\uDFFF]|\r\n|[^\uD800-\uDFFF])([\u180B-\u180D]|[\uFE00-\uFE0F]|\uDB40[\uDD00-\uDDEF])?/g;return{next:function(){var n=e.exec(t);return null!==n?n[0]:null}}},genWords:function(t){var e=/[!-~]+|[^!-~\s]+|\s+/g;return{next:function(){var n=e.exec(t);return null!==n?n[0]:null}}},escape:function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},template:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var r=n[n.length-1]||{},i=[t[0]];return e.forEach((function(e,o){var l=(Number.isInteger?Number.isInteger(e):"number"==typeof e&&e!==1/0&&Math.floor(e)===e)?n[e]:r[e];i.push(l,t[o+1])})),i.join("")}}},M={getMouseButtons:function(t){return c(t.buttons)?t.buttons:c(t.which)?3===t.which||2===t.which?4:t.which:0===t.button||1===t.button?1:2===t.button?2:0},getKeyCode:function(t){return t.keyCode||t.which},isTouchEvent:function(t){return!!t.changedTouches},cancel:function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}},D={toBoxArray:function(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:t:[t,t,t,t]}},j=function(){};function F(t){if("number"==typeof t)return 0===t?1:0;if("string"==typeof t){if("false"===t)return"true";if("off"===t)return"on";if(/^0+$/.exec(t))return t.replace(/^(0*)0$/,"$11");if("true"===t)return"false";if("on"===t)return"off";if(/^0*1$/.exec(t))return t.replace(/^(0*)1$/,"$10")}return!t}var W=function(t,e,n){if("function"==typeof t){var o=e.getRowRecord(n);return!!R(o)||!!t(o)}return!!t},H=function(t,e,n){return W(e.disabled,e,n)||W(t,e,n)},z=function(t,e,n){return W(e.readOnly,e,n)||W(t,e,n)},N={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",DBLTAP_CELL:"dbltap_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",MOUSE_SELECTED_START:"mouse_selected_start",MOUSE_SELECTED_END:"mouse_selected_end",KEYDOWN:"keydown",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",MOUSEOVER_CELL:"mouseover_cell",MOUSEOUT_CELL:"mouseout_cell",CONTEXTMENU_CELL:"contextmenu_cell",INPUT_CELL:"input_cell",PASTE_CELL:"paste_cell",DELETE_CELL:"delete_cell",EDITABLEINPUT_CELL:"editableinput_cell",MODIFY_STATUS_EDITABLEINPUT_CELL:"modify_status_editableinput_cell",RESIZE_COLUMN:"resize_column",SCROLL:"scroll",FOCUS_GRID:"focus_grid",BLUR_GRID:"blur_grid",CAN_DRAG_SELECTION:"can_drag_selection",DRAG_SELECTION:"drag_selection",CLICK_UNDERLAY:"click_underlay",DBLCLICK_UNDERLAY:"dblclick_underlay",DBLTAP_UNDERLAY:"dbltap_underlay",COPY:"copydata",CUT:"cutdata",PASTE:"pastedata"},V=13,U=38,K=40;function G(t){return t||"_"}function Y(){return G("chkcol.stateID")}function X(){return G("rdcol.stateID")}function q(){return G("swtcol.stateID")}function $(){return G("btncol.stateID")}function Z(){return G("col.action.stateID")}function J(){return G("inline_input_editor.stateID")}function Q(){return G("inline_textarea_editor.stateID")}function tt(){return G("inline_lookup_editor.stateID")}function et(){return G("check_header.stateID")}function nt(){return G("switch_header.stateID")}var ot=Z();function rt(t,e,n){var o=n.action,r=n.mouseOver,i=n.mouseMove,l=n.mouseOut;function a(n,o){return t.getLayoutCellId(n,o)===e}t[ot]||B.setReadonly(t,ot,{});var s=t[ot];return[t.listen(N.CLICK_CELL,(function(e){a(e.col,e.row)&&(R(t.getRowRecord(e.row))||o({col:e.col,row:e.row}))})),t.listen(N.MOUSEMOVE_CELL,(function(e){if(a(e.col,e.row)&&!R(t.getRowRecord(e.row))){if(i&&!i({col:e.col,row:e.row},e.event))return t.getElement().style.cursor="",void(s.mouseActive=!1);t.getElement().style.cursor="pointer",s.mouseActive=!0}})),t.listen(N.MOUSEOVER_CELL,(function(e){if(a(e.col,e.row)&&!R(t.getRowRecord(e.row))){if(r&&!r({col:e.col,row:e.row},e.event))return t.getElement().style.cursor="",void(s.mouseActive=!1);t.getElement().style.cursor="pointer",s.mouseActive=!0}})),t.listen(N.MOUSEOUT_CELL,(function(e){a(e.col,e.row)&&(l&&l({col:e.col,row:e.row}),t.getElement().style.cursor="",s.mouseActive=!1)}))]}function it(t,e,n){var r=n.action,i=n.acceptKeys,l=void 0===i?[]:i;return l=o(l,[V,32]),[t.listen(N.KEYDOWN,(function(n){var o;if(-1!==l.indexOf(n.keyCode)&&(!(null===(o=t.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter)||n.keyCode!==V)){var i,a,s=t.selection.select;if(i=s.col,a=s.row,t.getLayoutCellId(i,a)===e)R(t.getRowRecord(s.row))||(r({col:s.col,row:s.row}),M.cancel(n.event))}}))]}var lt=function(){function t(t){void 0===t&&(t={}),this._disabled=t.disabled||!1}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled!==t&&(this._disabled=t,this.onChangeDisabledInternal())},enumerable:!1,configurable:!0}),t.prototype.onChangeDisabledInternal=function(){},t}(),at=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._action=e.action||j,n}return e(n,t),Object.defineProperty(n.prototype,"editable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){return{}},n.prototype.bindGridEvent=function(t,e){var n=this,r=this.getState(t),i=function(e){if(!H(n.disabled,t,e.row)){var o=t.getRowRecord(e.row);n._action.apply(n,[o,{cell:e,grid:t}])}},l=function(e,o){if(H(n.disabled,t,e.row))return!1;r.mouseRelativePos=t._getMouseRelativePoint(o),r.mouseActiveCell={col:e.col,row:e.row};var i=t.getCellRange(e.col,e.row);return t.invalidateCellRange(i),!c(r.mouseActive)||r.mouseActive};return o(rt(t,e,{action:function(t){r.mouseActive&&i(t)},mouseMove:l,mouseOut:function(e){delete r.mouseRelativePos,delete r.mouseActiveCell,delete r.mouseActive;var n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)},mouseOver:l}),it(t,e,{action:i}))},n.prototype.onPasteCellRangeBox=function(){},n.prototype.onDeleteCellRangeBox=function(){},n}(lt),st=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._readOnly=e.readOnly||e.readonly||!1,n}return e(n,t),Object.defineProperty(n.prototype,"editable",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this._readOnly},set:function(t){this._readOnly!==t&&(this._readOnly=t,this.onChangeReadOnlyInternal())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readonly",{get:function(){return window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly},set:function(t){window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly=t},enumerable:!1,configurable:!0}),n.prototype.onChangeReadOnlyInternal=function(){},n}(lt);function ct(t,e,n,o){var r=!1,i=t._getMouseRelativePoint(o),l=t.getAttachCellsArea(t.getCellRange(e,n)).rect;return i&&l.inPoint(i.x,i.y)&&(r=!0),r}var ut=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),n.prototype.open=function(t,e){var n=!z(this.readOnly,t,e.row)&&!H(this.disabled,t,e.row);return n&&this.onOpenCellInternal(t,e),n},n.prototype.onBeforeKeydownInternal=function(t,e,n,o){return!0},n.prototype.bindGridEvent=function(t,e){var n=this,o=function(e){return n.open(t,e)},r=function(e,o){z(n.readOnly,t,e.row)||H(n.disabled,t,e.row)||n.onInputCellInternal(t,e,o)};function i(n,o){return t.getLayoutCellId(n,o)===e}return[t.listen(N.INPUT_CELL,(function(t){i(t.col,t.row)&&r({col:t.col,row:t.row},t.value)})),t.listen(N.PASTE_CELL,(function(e){if(!e.multi){var n=t.selection.range;O(n.start,n.end)&&i(e.col,e.row)&&(M.cancel(e.event),r({col:e.col,row:e.row},e.normalizeValue))}})),t.listen(N.DBLCLICK_CELL,(function(e){i(e.col,e.row)&&ct(t,e.col,e.row,e.event)&&(o({col:e.col,row:e.row}),M.cancel(e.event))})),t.listen(N.DBLTAP_CELL,(function(e){i(e.col,e.row)&&ct(t,e.col,e.row,e.event)&&(o({col:e.col,row:e.row}),M.cancel(e.event))})),t.listen(N.KEYDOWN,(function(r){if(!(113!==r.keyCode&&r.keyCode!==V||r.keyCode===V&&r.event.shiftKey)){var l=t.selection.select;if(i(l.col,l.row))return!1!==n.onBeforeKeydownInternal(t,r.keyCode,r.event,e)&&void(r.event.ctrlKey||r.event.metaKey||o({col:l.col,row:l.row})&&(M.cancel(r.event),r.stopCellMoving()))}})),t.listen(N.SELECTED_CELL,(function(e){n.onChangeSelectCellInternal(t,{col:e.col,row:e.row},e.selected)})),t.listen(N.SCROLL,(function(){n.onGridScrollInternal(t)})),t.listen(N.EDITABLEINPUT_CELL,(function(e){return!!i(e.col,e.row)&&(!z(n.readOnly,t,e.row)&&!H(n.disabled,t,e.row))})),t.listen(N.MODIFY_STATUS_EDITABLEINPUT_CELL,(function(e){if(i(e.col,e.row)&&!z(n.readOnly,t,e.row)&&!H(n.disabled,t,e.row)){var o=t.getCellRange(e.col,e.row);if(o.start.col!==o.end.col||o.start.row!==o.end.row){var r=e.input,l=t.getCellRect(e.col,e.row),a=t.getCellRangeRect(o);r.style.top=(parseFloat(r.style.top)+(a.top-l.top)).toFixed()+"px",r.style.left=(parseFloat(r.style.left)+(a.left-l.left)).toFixed()+"px",r.style.width=a.width.toFixed()+"px",r.style.height=a.height.toFixed()+"px"}n.onSetInputAttrsInternal(t,{col:e.col,row:e.row},e.input)}}))]},n.prototype.onPasteCellRangeBox=function(t,e,n){z(this.readOnly,t,e.row)||H(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(function(){return n}))},n.prototype.onDeleteCellRangeBox=function(t,e){z(this.readOnly,t,e.row)||H(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(function(){return""}))},n}(st),ht=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._disableInput=e.disableInput||!1,n._disableAction=e.disableAction||!1,n._action=e.action,n}return e(n,t),Object.defineProperty(n.prototype,"disableInput",{get:function(){return this._disableInput},set:function(t){this._disableInput=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableAction",{get:function(){return this._disableAction},set:function(t){this._disableAction=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t},enumerable:!1,configurable:!0}),n.prototype.onBeforeKeydownInternal=function(t,e,n,o){var r,i,l=t.selection.select;if(z(this.readOnly,t,l.row)||H(this.disabled,t,l.row)||(r=l.col,i=l.row,t.getLayoutCellId(r,i)!==o)||!this._action||this.isDisabledAction(t,l))return!0;if(this.isDisabledInput(t,l)&&e===V&&!n.ctrlKey&&!n.metaKey||e===V&&(n.ctrlKey||n.metaKey)){var a=t.getRowRecord(l.row);if(this._action)return this._action.apply(this,[a,{cell:{col:l.col,row:l.row},grid:t}]),M.cancel(n),!1}return!0},n.prototype.bindGridEvent=function(e,n){var o=this,r=this.getState(e),i=function(t,n){if(z(o.readOnly,e,t.row)||H(o.disabled,e,t.row)||!o._action||o.isDisabledAction(e,t))return!1;r.mouseRelativePos=e._getMouseRelativePoint(n),r.mouseActiveCell={col:t.col,row:t.row};var i=e.getCellRange(t.col,t.row);return e.invalidateCellRange(i),!c(r.mouseActive)||r.mouseActive},l=t.prototype.bindGridEvent.call(this,e,n);return l=l.concat(rt(e,n,{action:function(t){if(!z(o.readOnly,e,t.row)&&!H(o.disabled,e,t.row)&&o._action&&!o.isDisabledAction(e,t)&&r.mouseActive){var n=e.getRowRecord(t.row);o._action&&o._action.apply(o,[n,{cell:t,grid:e}])}},mouseMove:i,mouseOut:function(t){delete r.mouseRelativePos,delete r.mouseActiveCell,delete r.mouseActive;var n=e.getCellRange(t.col,t.row);e.invalidateCellRange(n)},mouseOver:i}))},n.prototype.onInputCellInternal=function(t,e,n){this.isDisabledInput(t,e)||this.onActionInputCellInternal(t,e,n)},n.prototype.onOpenCellInternal=function(t,e){this.isDisabledInput(t,e)||this.onActionOpenCellInternal(t,e)},n.prototype.onActionInputCellInternal=function(t,e,n){throw new Error},n.prototype.onActionOpenCellInternal=function(t,e){throw new Error},n.prototype.isDisabledInput=function(t,e){return this.isDisabled(this._disableInput,t,e)},n.prototype.isDisabledAction=function(t,e){return this.isDisabled(this._disableAction,t,e)},n.prototype.isDisabled=function(t,e,n){var o=!1;if(t)if("function"==typeof t){var r=e.getRowRecord(n.row);t.apply(this,[r,{cell:n,grid:e}])&&(o=!0)}else o=!0;return o},n}(ut);function ft(t,e,n,o){var r;return t*=3,e*=3,n*=3,o*=3,function(i){var l,a,s,c,u,h;if(i<0||1<i)throw new Error(""+i);l=r||i;do{l+=.5*(h=i-(t*(s=(a=1-l)*a)*l+n*a*(c=l*l)+(u=c*l)))}while(1e-4<Math.abs(h));return r=l,e*s*l+o*a*c+u}}var dt={linear:function(t){return t},easeIn:ft(.42,0,1,1),easeOut:ft(0,0,.58,1),easeInOut:ft(.42,0,.58,1)},pt=a?function(){}:window.requestAnimationFrame||function(t){return setTimeout(t,1)};function gt(){return Date.now()}function vt(t,e,n){var o=gt(),r=null==n?dt.easeInOut:"string"==typeof n?dt[n]:n,i=!1,l=function(n,l){var a=function(){var s=gt()-o;i?l&&l():s>=t?(e(1),n&&n(void 0)):(e(r(s/t)),pt(a))};return a},a=function(){i=!0};if("undefined"!=typeof Promise){var s=new Promise((function(t,n){var o=l(t,n);e(0),o()}));return s.cancel=a,s}var c=l((function(){}),(function(){}));return e(0),c(),{cancel:a}}var yt=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),n.prototype.bindGridEvent=function(t,e){var n=this,r=this.getState(t),i=function(e){var o=t.getCellRange(e.col,e.row),i=o.start.col+":"+o.start.row;if(!(z(n.readOnly,t,e.row)||H(n.disabled,t,e.row)||r.block[i])){var l=t.doChangeValue(e.col,e.row,F);if(l){var a=function(){vt(200,(function(e){1===e?delete r.elapsed[i]:r.elapsed[i]=e,t.invalidateCellRange(o)}))};R(l)?(r.block[i]=!0,l.then((function(){delete r.block[i],a()}))):a()}}};function l(n,o){return t.getLayoutCellId(n,o)===e}return o(rt(t,e,{action:i,mouseOver:function(e){if(H(n.disabled,t,e.row))return!1;r.mouseActiveCell={col:e.col,row:e.row};var o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:function(e){delete r.mouseActiveCell;var n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),it(t,e,{action:function(e){for(var n=t.selection.range,o=t.selection.select.col,r=n.start.row;r<=n.end.row;r++)l(o,r)&&i({col:o,row:r})},acceptKeys:[V,32]}),[t.listen(N.PASTE_CELL,(function(e){if(!e.multi){var n=t.selection.range;if(O(n.start,n.end)&&l(e.col,e.row)){var o=e.normalizeValue.trim();t.doGetCellValue(e.col,e.row,(function(t){(""+F(t)).trim()===o&&(M.cancel(e.event),i({col:e.col,row:e.row}))}))}}}))])},n.prototype.onPasteCellRangeBox=function(t,e,n){if(!z(this.readOnly,t,e.row)&&!H(this.disabled,t,e.row)){var o=n.trim();t.doGetCellValue(e.col,e.row,(function(n){(""+F(n)).trim()===o&&t.doChangeValue(e.col,e.row,F)}))}},n.prototype.onDeleteCellRangeBox=function(){},n}(st),_t=$(),bt=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),n.prototype.getState=function(t){return t[_t]||B.setReadonly(t,_t,{}),t[_t]},n}(at),wt=Y(),mt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[wt];return e||(e={block:{},elapsed:{}},B.setReadonly(t,wt,e)),e},n}(yt),Ct=q(),xt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Ct];return e||(e={block:{},elapsed:{}},B.setReadonly(t,Ct,e)),e},n}(yt);function Rt(t,e){var n,o=void 0===e?{}:e,r=o.classList,i=o.text,l=o.html,a=document.createElement(t);return r&&(Array.isArray(r)?(n=a.classList).add.apply(n,r):a.classList.add(r)),i?a.textContent=i:l&&(a.innerHTML=l),a}function Et(t){for(var e;e=t.firstChild;)t.removeChild(e)}function Ot(t){if(Array.isArray(t)){var e=[];return t.forEach((function(t){e.push.apply(e,Ot(t))})),e}var n=function(t){if(function(t){return!(!t.nodeType||!t.nodeName)}(t))return t;var e=Rt("div",{html:t});return Array.prototype.slice.call(e.childNodes)}(t);return Array.isArray(n)?n:[n]}function Lt(t,e){Ot(e).forEach((function(e){t.appendChild(e)}))}function kt(t){t.dataset.disableBeforeTabIndex=""+t.tabIndex,t.tabIndex=-1,Array.prototype.slice.call(t.children||t.childNodes,0).forEach(kt)}function St(t){return c(t.tabIndex)&&t.tabIndex>-1}function It(t){for(var e=t.previousSibling;e&&!St(e);)e=e.previousSibling;return e}function Tt(t){for(var e=t.nextSibling;e&&!St(e);)e=e.nextSibling;return e}var Pt=1,Bt=function(){function t(){this._listeners={}}return t.prototype.on=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t.addEventListener&&t.addEventListener.apply(t,o([e,n],r));var l={target:t,type:e,listener:n,options:r},a=Pt++;return this._listeners[a]=l,a},t.prototype.once=function(t,e,n){for(var r=this,i=[],l=3;l<arguments.length;l++)i[l-3]=arguments[l];var a=this.on.apply(this,o([t,e,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.off(a),n.apply(void 0,t)}],i));return a},t.prototype.tryWithOffEvents=function(t,e,n){var r=[];try{y(this._listeners,(function(n){var i;n.target===t&&n.type===e&&(n.target.removeEventListener&&(i=n.target).removeEventListener.apply(i,o([n.type,n.listener],n.options)),r.push(n))})),n()}finally{r.forEach((function(t){var e;t.target.addEventListener&&(e=t.target).addEventListener.apply(e,o([t.type,t.listener],t.options))}))}},t.prototype.off=function(t){var e;if(null!=t){var n=this._listeners[t];n&&(delete this._listeners[t],n.target.removeEventListener&&(e=n.target).removeEventListener.apply(e,o([n.type,n.listener],n.options)))}},t.prototype.fire=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];y(this._listeners,(function(r){var i;r.target===t&&r.type===e&&(i=r.listener).call.apply(i,o([r.target],n))}))},t.prototype.hasListener=function(t,e){var n=!1;return y(this._listeners,(function(o){o.target===t&&o.type===e&&(n=!0)})),n},t.prototype.clear=function(){y(this._listeners,(function(t){var e;t.target.removeEventListener&&(e=t.target).removeEventListener.apply(e,o([t.type,t.listener],t.options))})),this._listeners={}},t.prototype.dispose=function(){this.clear()},t}();function At(t,e){if(e&&"undefined"!=typeof document){var n=void 0;if(t){var o=document.getElementById(t);o instanceof HTMLStyleElement&&(n=o)}if(!n)(n=document.createElement("style")).type="text/css",n.id=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(n);n.styleSheet?n.styleSheet.cssText=e:(n.innerHTML="",n.appendChild(document.createTextNode(e)))}}var Mt=0,Dt=function(){return!!window.PerfectScrollbar},jt=function(){var t="/**\n * core styles \n */\n.kaka-grid .grid-scrollable {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n.kaka-grid .grid-scroll-end-point {\n  position: relative;\n  opacity: 0;\n}\n.kaka-grid {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.kaka-grid > canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 0;\n}\n.kaka-grid .grid-focus-control {\n  position: relative !important;\n  width: 1px;\n  height: 1px;\n  opacity: 0;\n  padding: 0;\n  margin: 0;\n  border: 0;\n  box-sizing: border-box;\n  pointer-events: none;\n  max-width: 0;\n  max-height: 0;\n  float: none !important;\n}\n.kaka-grid input.grid-focus-control::-ms-clear {\n  visibility: hidden;\n}\n.kaka-grid input.grid-focus-control.composition {\n  opacity: 1;\n  max-width: none;\n  max-height: none;\n}\n";Dt()?t+="\n      .kaka-grid .grid-scroll-end-point {\n        width: 1px;\n        height: 1px;\n      }":t+="\n      .kaka-grid .grid-scrollable {\n        overflow: scroll;\n      }\n      .kaka-grid .grid-scroll-end-point {\n        width: "+(Mt=function(){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);var n=t.offsetWidth;e.style.overflow="scroll";var o=t.offsetWidth;return n===o&&(o=e.clientWidth),document.body.removeChild(e),n-o}()||10)+"px;\n        height: "+Mt+"px;\n      }\n      .kaka-grid > canvas {\n        width: -webkit-calc(100% - "+Mt+"px);\n        width: calc(100% - "+Mt+"px);\n        height: -webkit-calc(100% - "+Mt+"px);\n        height: calc(100% - "+Mt+"px);\n      }",At("style",t)},Ft={initDocument:function(){Ft.initDocument=function(){},jt()},getScrollBarSize:function(){return Mt},inject:At,isPerfectScrollbar:Dt};function Wt(t,e){if("number"===t.type&&"-"===e){t.type="";var n=new Bt,o=function(){n&&(n.dispose(),n=null)};n.once(t,"input",(function(e){t.type="number",o()})),n.once(t,"blur",(function(t){o()}))}t.value=null!=e?e:""}var Ht=G("col.inline_editing_stateID");function zt(t){var e=t[Ht];return e||(e={},B.setReadonly(t,Ht,e)),e}function Nt(t){if("string"==typeof t){if("false"===t)return!1;if("off"===t)return!1;if(/^0+$/.exec(t))return!1}return Boolean(t)}function Vt(t,e,n,o){var r,i=t.classList,l=t.type;i&&(r=n.classList).add.apply(r,i);try{n.type=o||l||""}catch(t){n.type=""}}var Ut=function(){function t(){this._enabledMouseWheel=!1,this._handler=new Bt,this._input=(Ft.inject("inlineInputElement",".kaka-grid__inline-input::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-input {\n  position: absolute;\n  box-sizing: border-box;\n  background-color: transparent;\n  padding: 0;\n  border: none;\n}\n"),Rt("input",{classList:"kaka-grid__inline-input"})),this._bindInputEvents()}return t.setInputAttrs=function(t,e,n,o){Vt(t,0,n,o)},t.prototype.dispose=function(){var t,e=this._input;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)},t.prototype.attach=function(t,e,n,o,r,i){var l,a=this,s=this._input;if(this._enabledMouseWheel=e.enabledMouseWheel,!s.parentElement){var u=this._handler;if(this._beforePropEditor){var h=this._beforePropEditor.classList;h&&(l=s.classList).remove.apply(l,h)}s.style.font=t.font||"16px sans-serif";var f=t.getAttachCellsArea(t.getCellRange(n,o)),d=f.element,p=f.rect,g=f.padding;s.style.top=p.top.toFixed()+"px",s.style.left=p.left.toFixed()+"px",s.style.width=p.width.toFixed()+"px",s.style.height=p.height.toFixed()+"px",s.style.paddingTop=g[0]+"px",s.style.paddingRight=g[1]+"px",s.style.paddingBottom=g[2]+"px",s.style.paddingLeft=g[3]+"px",d.appendChild(s),Vt(e,0,s),function(t,e,n,o){void 0===t&&(t=""),e.dataset.editor_type=t,"date"===t?n instanceof Date?"text"===e.type?e.value=n.toJSON().slice(0,10):e.valueAsDate=n:e.value="":"number"===t?e.value="number"==typeof n||"string"==typeof n?String(n):"":c(n)?e.value=n:e.value="",e.dataset.before_value=e.value,o&&Wt(e,o)}(e.type,s,r,i),this._activeData={grid:t,col:n,row:o,editor:e},this._beforePropEditor=e;var v=function(){u.tryWithOffEvents(s,"blur",(function(){!function(){s.focus();var t=s.value.length;try{if(void 0!==s.selectionStart)return s.selectionStart=t,void(s.selectionEnd=t)}catch(t){}if(document.selection){var e=s.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}()}));var e=zt(t);e.cellRange=t.getCellRange(n,o),t.invalidateCellRange(e.cellRange)};this._attaching=!0,setTimeout((function(){v(),a._attaching=!1}))}},t.prototype.detach=function(t){if(this._isActive()){var e=this._activeData,n=e.grid,o=e.col,r=e.row,i=this._input;this._handler.tryWithOffEvents(i,"blur",(function(){i.parentElement&&i.parentElement.removeChild(i)})),delete zt(n).cellRange;var l=n.getCellRange(o,r);n.invalidateCellRange(l),t&&n.focus()}delete this._activeData,this._enabledMouseWheel=!1},t.prototype.doChangeValue=function(){var t;if(this._isActive()&&(t=this._input).value!==t.dataset.before_value){var e=function(t){var e;switch(t.dataset.editor_type){case"date":e=/(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)/.test(t.value)?new Date(t.value):null;break;case"number":e=t.value?Number(t.value):null,isNaN(e)&&(e=null);break;default:e=t.value}return e}(this._input),n=this._activeData,o=n.grid,r=n.col,i=n.row;o.doChangeValue(r,i,(function(){return e}))}},t.prototype._isActive=function(){var t=this._input;return!(!t||!t.parentElement)&&!!this._activeData},t.prototype._bindInputEvents=function(){var t=this,e=this._handler,n=this._input,o=function(t){return t.stopPropagation()};e.on(n,"click",o),e.on(n,"mousedown",o),e.on(n,"touchstart",o),e.on(n,"dblclick",o),e.on(n,"mousewheel",(function(e){t._enabledMouseWheel||e.preventDefault()})),e.on(n,"compositionstart",(function(t){n.classList.add("composition")})),e.on(n,"compositionend",(function(t){n.classList.remove("composition")})),e.on(n,"keydown",(function(e){if(!n.classList.contains("composition")){var o=M.getKeyCode(e);27===o?(t.detach(!0),M.cancel(e)):o===V?t._onKeydownEnter(e):9===o&&t._onKeydownTab(e)}})),e.on(n,"blur",(function(e){t.doChangeValue(),t.detach()}))},t.prototype._onKeydownEnter=function(t){var e;if(this._isActive()&&!this._attaching){var n=this._activeData.grid;this.doChangeValue(),this.detach(!0),M.cancel(t),(null===(e=n.keyboardOptions)||void 0===e?void 0:e.moveCellOnEnter)&&n.onKeyDownMove(t)}},t.prototype._onKeydownTab=function(t){var e;if(this._isActive()&&!this._attaching){var n=this._activeData.grid;(null===(e=n.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)&&(this.doChangeValue(),this.detach(!0),n.onKeyDownMove(t))}},t}(),Kt=J(),Gt=null,Yt=0;function Xt(t,e,n,o,r){Gt||(Gt=new Ut);var i=n.getState(t);i.element||(i.element=Gt,Yt++,t.addDisposable({dispose:function(){!--Yt&&Gt&&(Gt.dispose(),Gt=null)}})),Gt.attach(t,n,e.col,e.row,o,r)}function qt(t){Gt&&Gt.detach(t)}function $t(t){Gt&&Gt.doChangeValue()}var Zt=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._classList=e.classList,n._type=e.type,n._enabledMouseWheel=!!e.enabledMouseWheel,n}return e(n,t),Object.defineProperty(n.prototype,"classList",{get:function(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]},set:function(t){this._classList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"enabledMouseWheel",{get:function(){return this._enabledMouseWheel},set:function(t){this._enabledMouseWheel=t},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.onActionInputCellInternal=function(t,e,n){var o=this;t.doGetCellValue(e.col,e.row,(function(r){Xt(t,e,o,r,n)}))},n.prototype.onActionOpenCellInternal=function(t,e){var n=this;t.doGetCellValue(e.col,e.row,(function(o){Xt(t,e,n,o)}))},n.prototype.onChangeSelectCellInternal=function(t,e,n){$t(),qt()},n.prototype.onGridScrollInternal=function(t){$t(),qt(!0)},n.prototype.onChangeDisabledInternal=function(){qt(!0)},n.prototype.onChangeReadOnlyInternal=function(){qt(!0)},n.prototype.onSetInputAttrsInternal=function(t,e,n){Ut.setInputAttrs(this,t,n,"text")},n.prototype.getState=function(t){return t[Kt]||B.setReadonly(t,Kt,{}),t[Kt]},n}(ht),Jt="kaka-grid__inline-lookup",Qt=Jt+"__input",te=Jt+"__dropdown",ee=te+"--hidden",ne=te+"--shown",oe=te+"--right",re=te+"--bottom",ie=te+"-item",le=ie+"--empty";function ae(t,e){var n=(e+"").replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1");return n?t.replace(new RegExp("("+n+")","gi"),"<b>$1</b>"):t}var se,ce,ue=function(){function t(){this._attaching=!1,this._handler=new Bt,this._lookup=function(){Ft.inject("InlineLookupElement",".kaka-grid__inline-lookup__input::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-lookup__input {\n  box-sizing: border-box;\n  background-color: transparent;\n  padding: 0;\n  border: none;\n}\n\n.kaka-grid__inline-lookup__dropdown {\n  position: absolute;\n  color: rgba(0, 0, 0, 0.87);\n  box-sizing: content-box;\n  margin: 0;\n  padding: 8px 0;\n  background-color: #fafafa;\n  list-style-type: none;\n  border-radius: 2px;\n  /* max-height: calc(50vh - 40px); */\n  overflow-y: auto;\n  min-width: 100%;\n}\n\n.kaka-grid__inline-lookup__dropdown--hidden {\n  transform: scale(0.9);\n  box-shadow: none;\n  opacity: 0;\n  pointer-events: none;\n  transition: all 50ms ease-out;\n}\n\n.kaka-grid__inline-lookup__dropdown--hidden * {\n  pointer-events: none;\n}\n\n.kaka-grid__inline-lookup__dropdown--shown {\n  transform: translateY(2px);\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  opacity: 1;\n  /* transition: all 150ms ease-out; */\n}\n.kaka-grid__inline-lookup__dropdown--shown.kaka-grid__inline-lookup__dropdown--right {\n  right: 0px;\n}\n.kaka-grid__inline-lookup__dropdown--shown.kaka-grid__inline-lookup__dropdown--bottom {\n  bottom: 100%;\n  transform: translateY(-2px);\n  box-shadow: 0 -3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 -2px 2px 0px rgba(0, 0, 0, 0.14), 0 -1px 5px 0px rgba(0, 0, 0, 0.12);\n}\n.kaka-grid__inline-lookup__dropdown-item {\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  outline: none;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n  padding: 0 16px;\n}\n\n.kaka-grid__inline-lookup__dropdown-item--empty {\n  color: rgba(0, 0, 0, 0.38);\n}\n\n.kaka-grid__inline-lookup__dropdown-item::before {\n  content: '';\n  position: absolute;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background-color: #000;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 15ms linear;\n}\n\n.kaka-grid__inline-lookup__dropdown-item:hover::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-lookup__dropdown-item[data-select]::before {\n  opacity: 0.12;\n}\n\n.kaka-grid__inline-lookup {\n  position: absolute;\n}\n");var t=Rt("div",{classList:Jt}),e=Rt("input",{classList:Qt}),n=Rt("ul",{classList:te});return n.tabIndex=-1,t.appendChild(e),t.appendChild(n),t}(),this._input=this._lookup.querySelector("."+Qt),this._dropdown=this._lookup.querySelector("."+te),this._bindInputEvents()}return t.setInputAttrs=function(t,e,n){n.type="text"},t.prototype.dispose=function(){var t,e=this._lookup;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)},t.prototype.attach=function(t,e,n,o,i,l,a){var s=this,h=this._handler,f=this._lookup,d=this._input;this._beforePropEditor&&this._unbindLookupProps(t,f,d,this._beforePropEditor);var p=t.getAttachCellsArea(t.getCellRange(n,o)),g=p.element,v=p.rect,y=p.padding;f.style.top=v.top.toFixed()+"px",f.style.left=v.left.toFixed()+"px",f.style.width=v.width.toFixed()+"px",f.style.height=v.height.toFixed()+"px",d.style.width=f.style.width,d.style.height=f.style.height,d.style.paddingTop=y[0]+"px",d.style.paddingRight=y[1]+"px",d.style.paddingBottom=y[2]+"px",d.style.paddingLeft=y[3]+"px",g.appendChild(f),d.style.font=t.font||"16px sans-serif";var _=e.valueField||"id",b=e.captionField||_,w=!u(e.filterFields)||Array.isArray(e.filterFields)&&0===e.filterFields.length?[_,b]:[];Array.isArray(e.filterFields)?e.filterFields.forEach((function(t){w.indexOf(t)<0&&t&&w.push(t)})):c(e.filterFields)&&w.indexOf(e.filterFields)<0&&e.filterFields&&w.push(e.filterFields);for(var m,C,R=t.getRowRecord(o),E=[],O="function"==typeof e.filter?e.filter:function(){return!0},L=0,k=l;L<k.length;L++){var S=k[L];O(S,R)&&(E.push(S),u(S[_])?S[_]===i&&(C=S):(m=S,u(i)||(C=S)))}var I=c(i)?i+"":"";C&&(I=C!==m?C[b]+""||I:"");var T=x(e.allowOtherInput,R),P={col:n,dropdownInfo:{allowOtherInput:T,beforeRecord:c(a)?void 0:C,captionField:b,disableFilterRecords:e.disableFilterRecords,disableFilterSort:e.disableFilterSort,dropdownEmptyTemplate:e.dropdownEmptyTemplate?e.dropdownEmptyTemplate:A.template(se||(se=r(["",""],["",""])),b),dropdownTemplate:e.dropdownTemplate?e.dropdownTemplate:A.template(ce||(ce=r(["",""],["",""])),b),emptyRecord:m,filterFields:w,records:E,valueField:_,valueType:e.valueType},editor:e,grid:t,row:o};!function(t,e,n,o,r){e.value=o,e.dataset.value_type=t,e.dataset.before_value=JSON.stringify(n),e.dataset.select_value=JSON.stringify(n),r&&(e.value=r)}(e.valueType,d,i,I,a),this._onInputValue(d,P),this._bindLookupProps(t,f,d,e),this._activeData=P,this._beforePropEditor=e;var B=function(){h.tryWithOffEvents(d,"blur",(function(){!function(){d.focus();var t=d.value.length;try{if(void 0!==d.selectionStart)return d.selectionStart=t,void(d.selectionEnd=t)}catch(t){}if(document.selection){var e=d.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}()}));var e=zt(t);e.cellRange=t.getCellRange(n,o),t.invalidateCellRange(e.cellRange)};this._attaching=!0,setTimeout((function(){B(),s._attaching=!1}))},t.prototype.detach=function(t){var e=this;if(this._isActive()){var n=this._lookup,o=this._input;this._handler.tryWithOffEvents(o,"blur",(function(){n.parentElement&&(e._onInputValue(o),n.parentElement.removeChild(n))}));var r=this._activeData,i=r.grid,l=r.col,a=r.row;delete zt(i).cellRange;var s=i.getCellRange(l,a);i.invalidateCellRange(s),t&&i.focus()}delete this._beforeValue,delete this._activeData},t.prototype.doChangeValue=function(t){var e;if(this._isActive()&&((!t||!this._activeData||this._activeData.dropdownInfo.allowOtherInput)&&(e=this._input).dataset.before_value!==e.dataset.select_value)){var n=function(t){var e=JSON.parse(t.dataset.select_value||"null");return"number"===t.dataset.value_type&&c(e)&&(e-=0,isNaN(e)&&(e=null)),e}(this._input),o=this._activeData,r=o.grid,i=o.col,l=o.row;r.doChangeValue(i,l,(function(){return n}))}},t.prototype._isActive=function(){var t=this._lookup;return!(!t||!t.parentElement)&&!!this._activeData},t.prototype._bindInputEvents=function(){var t=this,e=this._handler,n=this._dropdown,o=this._input,r=function(t){return t.stopPropagation()};e.on(o,"click",r),e.on(o,"mousedown",r),e.on(o,"touchstart",r),e.on(o,"dblclick",r),e.on(n,"mousedown",r),e.on(n,"touchstart",r),e.on(n,"dblclick",r),e.on(n,"click",(function(e){e.stopPropagation();var n=function(t){for(var e=t;!e.classList.contains(ie);)if(!(e=e.parentElement)||e.classList.contains(te))return;return e}(e.target);n?(t._selectNode(n),t.doChangeValue(),t.detach(!0)):t._input.focus()})),e.on(o,"compositionstart",(function(t){o.classList.add("composition")})),e.on(o,"compositionend",(function(e){o.classList.remove("composition"),t._onInputValue(o)}));var i=function(e){o.classList.contains("composition")||t._onInputValue(o)};e.on(o,"keyup",i),e.on(o,"keypress",i),e.on(o,"keydown",(function(e){if(!o.classList.contains("composition")){var n=M.getKeyCode(e);if(27===n)t.detach(!0),M.cancel(e);else if(n===V)t._onKeydownEnter(e);else if(9===n)t._onKeydownTab(e);else if(n===U){if(i=t._dropdown.querySelector("[data-select=true]")){if(t._selectNode(i,!1),!(l=It(i))){var r=t._dropdown.querySelectorAll("."+ie);St(l=r[r.length-1])||(l=It(l))}l&&(t._selectNode(l),M.cancel(e))}}else if(n===K){var i,l;if(i=t._dropdown.querySelector("[data-select=true]"))t._selectNode(i,!1),(l=Tt(i))||St(l=t._dropdown.querySelector("."+ie))||(l=Tt(l)),l&&(t._selectNode(l),M.cancel(e))}else t._onInputValue(o)}})),e.on(o,"blur",(function(){return setTimeout((function(){return t.detach()}),300)}))},t.prototype._onKeydownEnter=function(t){var e;if(this._isActive()&&!this._attaching){var n=this._activeData.grid;this.doChangeValue(),this.detach(!0),(null===(e=n.keyboardOptions)||void 0===e?void 0:e.moveCellOnEnter)?n.onKeyDownMove(t):M.cancel(t)}},t.prototype._onKeydownTab=function(t){var e;if(this._isActive()&&!this._attaching){var n=this._activeData.grid;(null===(e=n.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)&&(this.doChangeValue(),this.detach(!0),n.onKeyDownMove(t))}},t.prototype._onInputValue=function(t,e){var n=this._beforeValue,o=t.value;n!==o&&this._onInputValueChange(o,n,e),this._beforeValue=o},t.prototype._onInputValueChange=function(t,e,n){var o,r,i=(n=n||this._activeData).grid,l=n.dropdownInfo,a=!c(e),s=this._filterRecords(l.records,l.filterFields,t,l.valueField,l.disableFilterRecords,l.disableFilterSort,l.emptyRecord,a?l.beforeRecord:void 0),u=s.isAll,h=s.filterRecords,f=[],d=!1;if(l.allowOtherInput){var p=t,g=A.escape(t);if("number"===l.valueType?(p.trim()?(p=Number(t),isNaN(p)&&(p=null)):p=null,null===p&&(g=A.escape("<null>"),d=!0)):p||(g=A.escape("<Empty>"),d=!0),"number"===l.valueType&&(null!==p||u&&d&&!l.emptyRecord)||"number"!==l.valueType&&(p||d&&!l.emptyRecord)){var v=Rt("li",{classList:[ie,d?le:"kaka-grid__inline-lookup__dropdown-item--other"]});v.tabIndex=0,v.dataset.value=JSON.stringify(p),Lt(v,g),f.push(v)}}0!==f.length&&!d&&u||h.forEach((function(t){var e,n=[ie];t.__isEmpty?(n.push(le),e=l.dropdownEmptyTemplate(t)):e=l.dropdownTemplate(t);var i=Rt("li",{classList:n});t.__isBefore&&(o=i),!c(r)&&t.__isMatched&&(r=i),i.tabIndex=0,i.dataset.value=JSON.stringify(t.__value),Lt(i,e),f.push(i)})),Et(this._dropdown);var y=this._dropdown.scrollHeight+2;if(f.length>0){f[0].classList.add("kaka-grid__inline-lookup__dropdown-item--first");var _=void 0;_=a&&l.beforeRecord&&o?o:r||f[0],this._selectNode(_),this._dropdown.style.maxHeight="",Lt(this._dropdown,f),this._lookup.offsetTop+this._lookup.offsetHeight+this._dropdown.offsetHeight>i.getElement().clientHeight&&this._lookup.offsetTop>i.getElement().clientHeight-this._lookup.offsetTop-this._lookup.offsetHeight?(this._dropdown.classList.add(re),this._dropdown.style.maxHeight=this._lookup.offsetTop-y+"px"):(this._dropdown.style.maxHeight=i.getElement().clientHeight-this._lookup.offsetTop-this._lookup.offsetHeight-y+"px",this._dropdown.classList.remove(re)),this._lookup.offsetLeft+this._lookup.offsetWidth+this._dropdown.offsetWidth>i.getElement().clientWidth&&this._lookup.offsetLeft>i.getElement().clientWidth-this._lookup.offsetLeft-this._lookup.offsetWidth?this._dropdown.classList.add(oe):this._dropdown.classList.remove(oe),this._dropdown.classList.remove(ee),this._dropdown.classList.add(ne)}else this._selectNode(),this._dropdown.classList.remove(ne),this._dropdown.classList.add(ee)},t.prototype._selectNode=function(t,e){t?!1!==e?(t.dataset.select="true",this._input.dataset.select_value=t.dataset.value,t.parentElement&&(t.offsetTop<t.parentElement.scrollTop?t.parentElement.scrollTop=t.offsetTop:t.offsetTop+t.offsetHeight>t.parentElement.scrollTop+t.parentElement.clientHeight&&(t.parentElement.scrollTop=t.offsetTop+t.offsetHeight-t.parentElement.clientHeight))):(delete t.dataset.select,this._input.dataset.select_value=this._input.dataset.before_value):this._input.dataset.select_value=this._input.dataset.before_value},t.prototype._filterRecords=function(t,e,n,o,r,i,l,a){var s=[],u=[],h=[];t.forEach((function(t){var f={},d=!1;for(var p in t){var g=c(t[p])?t[p]+"":"";if(e.indexOf(p)>=0){var v=ae(g,n);f[p]=v,d=d||v!==g||!n}else f[p]=g}f.__isMatched=d,f.__value=t[o],f.__isBefore=a===t,f.__isEmpty=l===t,d||f.__isBefore||i?s.push(f):r&&h.push(f),u.push(f)}));var f=0===e.length||!n&&!a||0===s.length;if(!f&&r)for(var d=0,p=h;d<p.length;d++){var g=p[d];s.push(g)}return{filterRecords:f?u:s,isAll:f}},t.prototype._bindLookupProps=function(e,n,o,r){var i,l=r.classList;l&&(i=n.classList).add.apply(i,l),t.setInputAttrs(r,e,o)},t.prototype._unbindLookupProps=function(t,e,n,o){var r,i=o.classList;i&&(r=e.classList).remove.apply(r,i)},t}(),he=tt(),fe=null,de=0;function pe(t,e,n,o,r){fe||(fe=new ue);var i=n.getState(t);i.element||(i.element=fe,de++,t.addDisposable({dispose:function(){!--de&&fe&&(fe.dispose(),fe=null)}}));var l=x(n.records||[],t.getRowRecord(e.row));R(l)?l.then((function(i){fe&&fe.attach(t,n,e.col,e.row,o,i,r)})):fe.attach(t,n,e.col,e.row,o,l,r)}function ge(t){fe&&fe.detach(t)}function ve(){fe&&fe.doChangeValue(!0)}var ye=function(t){function n(e){void 0===e&&(e={});var n,o=t.call(this,e)||this;return o.action=o.action||(n=o,function(t,e){z(n.readOnly,e.grid,e.cell.row)||H(n.disabled,e.grid,e.cell.row)||n.onOpenCellInternal(e.grid,e.cell)}),o._classList=e.classList,o._records=e.records||[],o._valueField=e.valueField||"",o._valueType=e.valueType||"string",o._captionField=e.captionField||"",o._filterFields=e.filterFields||"",o._allowOtherInput=e.allowOtherInput||!1,o._disableFilterRecords=!!e.disableFilterRecords,o._disableFilterSort=!!e.disableFilterSort,c(e.disableDropdown)&&(o.disableDropdown=!!e.disableDropdown),o._filter=e.filter,o._dropdownTemplate=e.dropdownTemplate,o._dropdownEmptyTemplate=e.dropdownEmptyTemplate,o}return e(n,t),Object.defineProperty(n.prototype,"classList",{get:function(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]},set:function(t){this._classList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"records",{get:function(){return this._records},set:function(t){this._records=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"valueField",{get:function(){return this._valueField},set:function(t){this._valueField=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"valueType",{get:function(){return this._valueType},set:function(t){this._valueType=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"captionField",{get:function(){return this._captionField},set:function(t){this._captionField=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filterFields",{get:function(){return this._filterFields},set:function(t){this._filterFields=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"allowOtherInput",{get:function(){return this._allowOtherInput},set:function(t){this._allowOtherInput=t||!1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableFilterRecords",{get:function(){return this._disableFilterRecords},set:function(t){this._disableFilterRecords=!!t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableFilterSort",{get:function(){return this._disableFilterSort},set:function(t){this._disableFilterSort=!!t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableDropdown",{get:function(){return window.console.warn("'disableDropdown' is deprecated, please use 'disableInput' instead"),!!this.disableInput},set:function(t){window.console.warn("'disableDropdown' is deprecated, please use 'disableInput' instead"),this.disableInput=!!t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filter",{get:function(){return this._filter},set:function(t){this._filter=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropdownTemplate",{get:function(){return this._dropdownTemplate},set:function(t){this._dropdownTemplate=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dropdownEmptyTemplate",{get:function(){return this._dropdownEmptyTemplate},set:function(t){this._dropdownEmptyTemplate=t},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.onActionInputCellInternal=function(t,e,n){var o=this;t.doGetCellValue(e.col,e.row,(function(r){pe(t,e,o,r,n)}))},n.prototype.onActionOpenCellInternal=function(t,e){var n=this;t.doGetCellValue(e.col,e.row,(function(o){pe(t,e,n,o)}))},n.prototype.onChangeSelectCellInternal=function(t,e,n){ve(),ge()},n.prototype.onGridScrollInternal=function(t){ve(),ge(!0)},n.prototype.onChangeDisabledInternal=function(){ge(!0)},n.prototype.onChangeReadOnlyInternal=function(){ge(!0)},n.prototype.onSetInputAttrsInternal=function(t,e,n){ue.setInputAttrs(this,t,n)},n.prototype.bindGridEvent=function(e,n){var o=t.prototype.bindGridEvent.call(this,e,n),r=function(){ve(),ge(!0)};return o.push(e.listen(N.CLICK_UNDERLAY,r)),o.push(e.listen(N.DBLCLICK_UNDERLAY,r)),o.push(e.listen(N.DBLTAP_UNDERLAY,r)),o},n.prototype.getState=function(t){return t[he]||B.setReadonly(t,he,{}),t[he]},n}(ht);function _e(t){if(!t)return[];if(Array.isArray(t))return t.map((function(t){return function(t,e){var n={};for(var o in t)n[o]=t[o];for(var o in e)n[o]=e[o];return n}(t,{label:t.caption||t.label})}));if("string"==typeof t)return _e(JSON.parse(t));var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push({label:t[n],value:n});return e}var be={normalize:_e,normalizeToFn:function(t){return"function"==typeof t?function(e){return _e(t(e))}:function(){return _e(t)}}},we="kaka-grid__inline-menu",me=we+"__menu-item",Ce=we+"--hidden",xe=we+"--shown",Re=me+"--empty";function Ee(t){for(var e=t;!e.classList.contains(me);)if(!(e=e.parentElement)||e.classList.contains(we))return;return e}function Oe(t,e,n,o){n.style.top=e.top.toFixed()+"px",n.style.left=e.left.toFixed()+"px",n.style.width=o?"":e.width.toFixed()+"px",n.style.lineHeight=e.height.toFixed()+"px",t.appendChild(n)}function Le(t,e,n,o,r,i,l){var a,s=e.classList;l.classList.remove(xe),l.classList.add(Ce),Et(l),l.style.font=t.font||"16px sans-serif";var u=null,h=null;i.forEach((function(t,e){var n=function(t,e){var n,o=t.classList,r=t.label,i=t.value,l=t.html,a=Rt("li",{classList:me});if(a.tabIndex=0,a.setAttribute("data-value-index",e+""),o&&(n=a.classList).add.apply(n,Array.isArray(o)?o:[o]),r){var s=Rt("span",{text:r});a.appendChild(s)}else l&&Lt(a,l);return""!==i&&c(i)||a.classList.add(Re),a}(t,e);l.appendChild(n),t.value===r&&(h=n,n.dataset.select="select"),n.classList.contains(Re)&&(u=n)}));var f=h||u||(l.children||l.childNodes)[0];s&&(a=l.classList).add.apply(a,s);var d=Array.prototype.slice.call(l.children||l.childNodes,0),p=d.indexOf(f),g=t.getAttachCellsArea(t.getCellRange(n,o)),v=g.element,y=g.rect;y.width++,Oe(v,y,l,e.autoWidth);for(var _=0,b=0,w=0;w<d.length;w++){var m=d[w].offsetHeight;w<p&&(_+=m),b+=m}y.offsetTop(-_),l.style.transformOrigin="center "+(_+Math.ceil(d[p].offsetHeight/2))+"px 0px",Oe(v,y,l,e.autoWidth);var C=l.getBoundingClientRect(),x=(b-C.height)/2,R=C.top-x,E=R,O=E+b,L=window.innerHeight;O>L-20&&(E-=O-L+20);E<20&&(E=20),E!==R&&(y.offsetTop(-(R-E)),Oe(v,y,l,e.autoWidth)),f&&f.focus(),l.classList.remove(Ce),l.classList.add(xe)}var ke=function(){function t(){this._handler=new Bt,this._menu=(Ft.inject("inlineMenuElement",".kaka-grid__inline-menu {\n  position: absolute;\n  color: rgba(0, 0, 0, 0.87);\n  box-sizing: content-box;\n  margin: -1px auto auto -1px;\n  padding: 8px 0;\n  background-color: #fafafa;\n  list-style-type: none;\n  border-radius: 2px;\n  max-height: calc(100vh - 40px);\n  overflow-y: auto;\n  white-space: nowrap;\n}\n\n.kaka-grid__inline-menu--hidden {\n  transform: scale(0.9);\n  box-shadow: none;\n  opacity: 0;\n  pointer-events: none;\n  transition: all 50ms ease-out;\n}\n\n.kaka-grid__inline-menu--hidden * {\n  pointer-events: none;\n}\n\n.kaka-grid__inline-menu--shown {\n  transform: translateY(-7px);\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  opacity: 1;\n  transition: all 150ms ease-out;\n}\n\n.kaka-grid__inline-menu__menu-item {\n  height: 100%;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  outline: none;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n  padding: 0 16px;\n}\n\n.kaka-grid__inline-menu__menu-item--empty {\n  color: rgba(0, 0, 0, 0.38);\n}\n\n.kaka-grid__inline-menu__menu-item::before {\n  content: '';\n  position: absolute;\n  top: -50%;\n  left: -50%;\n  width: 200%;\n  height: 200%;\n  background-color: #000;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 15ms linear;\n}\n\n.kaka-grid__inline-menu__menu-item:hover::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-menu__menu-item[data-select]::before {\n  opacity: 0.04;\n}\n\n.kaka-grid__inline-menu__menu-item:focus::before {\n  opacity: 0.12;\n}\n"),Rt("ul",{classList:we})),this._bindMenuEvents()}return t.prototype.dispose=function(){var t,e=this._menu;this.detach(),this._handler.dispose(),this._beforePropEditor=null,null===(t=e.parentElement)||void 0===t||t.removeChild(e)},t.prototype.attach=function(t,e,n,o,r,i){var l,a=this,s=this._menu;if(this._beforePropEditor){var c=this._beforePropEditor.classList;c&&(l=s.classList).remove.apply(l,c)}var u=e.options(i);Le(t,e,n,o,r,u,s);for(var h=s,f=0;f<s.childNodes.length;f++){var d=s.childNodes[f];this._handler.on(d,"focus",(function(){h._focus=!0})),this._handler.on(d,"blur",(function(){h._focus=!1,setTimeout((function(){h._focus||a.detach()}),0)}))}this._activeData={grid:t,col:n,row:o,editor:e,options:u},this._beforePropEditor=e},t.prototype.detach=function(t){if(this._isActive()){var e=this._activeData,n=e.grid,o=e.col,r=e.row;!function(t,e,n,o){o.classList.remove(xe),o.classList.add(Ce),kt(o)}(0,0,0,this._menu);var i=n.getCellRange(o,r);n.invalidateCellRange(i),t&&n.focus()}this._activeData=null},t.prototype._doChangeValue=function(t){if(this._isActive()&&t){var e=this._activeData,n=e.grid,o=e.col,r=e.row,i=e.options[parseInt(t,10)];if(i){var l=i.value;n.doChangeValue(o,r,(function(){return l}))}}},t.prototype._isActive=function(){var t=this._menu;return!(!t||!t.parentElement)&&!!this._activeData},t.prototype._bindMenuEvents=function(){var t=this,e=this._handler,n=this._menu,o=function(t){return t.stopPropagation()};e.on(n,"mousedown",o),e.on(n,"touchstart",o),e.on(n,"dblclick",o),e.on(n,"click",(function(e){e.stopPropagation();var n=Ee(e.target);if(n){var o=n.getAttribute("data-value-index");t._doChangeValue(o),t.detach(!0)}})),e.on(n,"keydown",(function(e){var o=Ee(e.target);if(o&&t._isActive()){var r=M.getKeyCode(e);if(r===V)t._onKeydownEnter(n,o,e);else if(27===r)t.detach(!0),M.cancel(e);else if(r===U){(i=It(o))&&(i.focus(),M.cancel(e))}else if(r===K){var i;(i=Tt(o))&&(i.focus(),M.cancel(e))}else 9===r&&t._onKeydownTab(n,o,e)}}))},t.prototype._onKeydownEnter=function(t,e,n){var o,r=this._isActive()?this._activeData.grid:null,i=e.getAttribute("data-value-index");this._doChangeValue(i),this.detach(!0),M.cancel(n),r&&(null===(o=r.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter)&&r.onKeyDownMove(n)},t.prototype._onKeydownTab=function(t,e,n){var o;if(this._isActive()){var r=this._activeData.grid;if(null===(o=r.keyboardOptions)||void 0===o?void 0:o.moveCellOnTab){var i=e.getAttribute("data-value-index");return this._doChangeValue(i||""),this.detach(!0),void r.onKeyDownMove(n)}}if(n.shiftKey){if(!It(e)){var l,a=t.querySelectorAll("."+me);St(l=a[a.length-1])||(l=It(l)),l&&(l.focus(),M.cancel(n))}}else Tt(e)||(St(l=t.querySelector("."+me))||(l=Tt(l)),l&&(l.focus(),M.cancel(n)))},t}(),Se=["content","font","color","className","tagName","isLiga","width","src","svg","name","path"];var Ie={},Te={};function Pe(t){if(!t)return t;if(Array.isArray(t))return t;var e={},n=0;Se.forEach((function(e){var o=t[e];o&&(n=Array.isArray(o)?Math.max(n,o.length):Math.max(n,1))})),Se.forEach((function(o){var r=function(t,e){var n=[];if(Array.isArray(t)){n.push.apply(n,t);for(var o=t.length;o<e;o++)n.push(null)}else for(o=0;o<e;o++)n.push(t);return n}(t[o],n);e[o]=r}));for(var o=[],r=function(t){var n={};Se.forEach((function(o){var r=e[o][t];n[o]=r})),o.push(n)},i=0;i<n;i++)r(i);return o}function Be(t){var e={};for(var n in t)"className"!==n&&Ae(n)&&(e[n]=t[n]);if(t.className){var o=function(t,e){var n=Te[t]||(Te[t]={});if(n[e])return n[e];var o=Ie[t]||(Ie[t]=document.createElement(t));o.className=e,document.body.appendChild(o);try{var r=(document.defaultView||window).getComputedStyle(o,"::before"),i=r.getPropertyValue("content");"none"===i&&(i=""),i.length>=3&&('"'===i[0]||"'"===i[0])&&i[0]===i[i.length-1]&&(i=i.substr(1,i.length-2));var l=r.getPropertyValue("font");l||(l=r.getPropertyValue("font-style")+" "+r.getPropertyValue("font-variant")+" "+r.getPropertyValue("font-weight")+" "+r.getPropertyValue("font-size")+"/"+r.getPropertyValue("line-height")+" "+function(t){for(var e=[],n=t.split(/,\s*/),o=0;o<n.length;o++){var r=n[o].replace(/['"]/g,"");-1!==r.indexOf(" ")||/^\d/.test(r)?e.push("'"+r+"'"):e.push(r)}return e.join(",")}(r.getPropertyValue("font-family")));var a=r.getPropertyValue("color"),s=o.clientWidth,c=(r.getPropertyValue("font-feature-settings")||"").indexOf("liga")>-1;return n[e]={color:a,content:i,font:l,isLiga:c,width:s}}finally{document.body.removeChild(o)}}(t.tagName||"i",t.className);for(var n in o)Ae(n)&&(c(t[n])||(e[n]=o[n]))}return e}function Ae(t){return Se.indexOf(t)>=0}var Me,De={toNormarizeArray:function(t){var e=Pe(t);return e?e.map((function(t){return Be(t)})):e},iconPropKeys:Se},je=function(){function t(t,e,n,o){this._left=t,this._top=e,this._width=n,this._height=o,this._right=void 0}return t.bounds=function(e,n,o,r){return new t(e,n,o-e,r-n)},t.max=function(e,n){return t.bounds(Math.min(e.left,n.left),Math.min(e.top,n.top),Math.max(e.right,n.right),Math.max(e.bottom,n.bottom))},Object.defineProperty(t.prototype,"left",{get:function(){return this._left},set:function(t){var e=this.right;this._left=t,this.right=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},set:function(t){var e=this.bottom;this._top=t,this.bottom=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._right=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._bottom=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return void 0!==this._right?this._right:this._right=this.left+this.width},set:function(t){this._right=t,this.width=t-this.left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return void 0!==this._bottom?this._bottom:this._bottom=this.top+this.height},set:function(t){this._bottom=t,this.height=t-this.top},enumerable:!1,configurable:!0}),t.prototype.offsetLeft=function(t){this._left+=t,this._right=void 0},t.prototype.offsetTop=function(t){this._top+=t,this._bottom=void 0},t.prototype.copy=function(){return new t(this.left,this.top,this.width,this.height)},t.prototype.intersection=function(e){var n=Math.max(this.left,e.left),o=Math.min(this.left+this.width,e.left+e.width);if(n<=o){var r=Math.max(this.top,e.top),i=Math.min(this.top+this.height,e.top+e.height);if(r<=i)return t.bounds(n,r,o,i)}return null},t.prototype.contains=function(t){return this.left<=t.left&&this.left+this.width>=t.left+t.width&&this.top<=t.top&&this.top+this.height>=t.top+t.height},t.prototype.inPoint=function(t,e){return this.left<=t&&this.left+this.width>=t&&this.top<=e&&this.top+this.height>=e},t}();function Fe(t,e,n,o){var r=void 0;if(t)if(R(t))t.then((function(t){Fe(t,e.toCurrentContext(),n,o)}));else{var i=De.toNormarizeArray(t);i.forEach((function(t){t.font&&t.content&&n.testFontLoad(t.font,t.content,e)})),r=i}o(r,e)}function We(t,e,n){var o=n.font,r=n.padding,i=n.appearance,l=e.toBoxPixelArray(r||0,t,o).slice(0);return"none"!==i&&u(i)&&(l[1]+=26),l}function He(t,e,n,o,r){var i=r.textBaseline,l=r.font,a=r.padding,s=r.appearance,c=r.color,h=!1,f=t[n];if(f&&f.mouseActiveCell&&L(e.range,f.mouseActiveCell.col,f.mouseActiveCell.row)&&f.mouseRelativePos){var d=e.getRect();h=(d=new je(d.left+d.width-32,d.top,32,d.height)).left<=f.mouseRelativePos.x&&d.right>=f.mouseRelativePos.x&&d.top<=f.mouseRelativePos.y&&d.bottom>=f.mouseRelativePos.y,f.mouseActive=h}if("none"!==s&&u(s)){var p=o.toBoxPixelArray(a||0,e,l).slice(0);p[1]+=8;var g=void 0;if("menulist-button"===s?g={color:h?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M0 2 5 7 10 2z",width:10}:"lookup-button"===s?g={color:h?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M4.7997924,9.6 C2.15326327,9.6 0,7.44655046 0,4.79937714 C0,2.15261906 2.15326327,0 4.7997924,0 C7.44673673,0 9.6,2.15261906 9.6,4.79937714 C9.6,7.44655046 7.44673673,9.6 4.7997924,9.6 Z M4.79959481,0.9 C2.64922597,0.9 0.9,2.64900249 0.9,4.79918953 C0.9,6.95018703 2.64922597,8.7 4.79959481,8.7 C6.95036883,8.7 8.7,6.95018703 8.7,4.79918953 C8.7,2.64940773 6.95036883,0.9 4.79959481,0.9 Z M11.579002,12 C11.4749824,12 11.3709629,11.9593028 11.289322,11.8774707 L7.93168591,8.56830498 C7.76260228,8.39851441 7.75555713,8.11713467 7.91510908,7.93902961 C8.07631871,7.76136216 8.34237677,7.75261007 8.51104597,7.92065022 L11.8686821,11.2315664 C12.0373513,11.4004817 12.0443964,11.6822991 11.8848445,11.8608417 C11.8019603,11.9527387 11.6904812,12 11.579002,12 Z",width:12}:"clear-button"===s?g={color:h?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M5.26896659,6.00000686 L0.152356675,11.1166168 C-0.048420546,11.317394 -0.0501211184,11.6463861 0.151753253,11.8482467 C0.355026465,12.05152 0.681179729,12.0498468 0.883383238,11.8476433 L5.99999314,6.73103342 L11.1166168,11.8476433 C11.317394,12.0484205 11.6463861,12.0501211 11.8482467,11.8482467 C12.05152,11.6449735 12.0498468,11.3188203 11.8476433,11.1166168 L6.73103341,6.00000686 L11.8476433,0.883383238 C12.0484205,0.682606017 12.0501074,0.3536139 11.8482467,0.151753253 C11.6449598,-0.0515199596 11.3188065,-0.0498468209 11.1166168,0.152356675 L6.00000686,5.2689803 L0.883383238,0.152356688 C0.682606017,-0.0484205326 0.3536139,-0.0501073814 0.151753253,0.151753266 C-0.0515199596,0.355040202 -0.0498468209,0.681193466 0.152356675,0.883383252 L5.26896659,6.00000686 Z",width:12}:"date-button"===s?g={color:h?"rgba(0, 0, 0, .9)":"rgba(0, 0, 0, .54)",path:"M5.6,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C6.8,6.2,6.7,6,6.4,6c0,0,0,0,0,0H5.6C5.3,6,5.1,6.2,5.1,6.4c0,0,0,0,0,0C5.1,6.7,5.3,6.8,5.6,6.8L5.6,6.8z M5.6,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H5.6c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C5.1,8.4,5.3,8.6,5.6,8.6L5.6,8.6z M10.3,0.9H8.6V0.4C8.6,0.2,8.4,0,8.1,0c0,0,0,0,0,0C7.9,0,7.7,0.2,7.7,0.4c0,0,0,0,0,0v0.4H4.3V0.4C4.3,0.2,4.1,0,3.9,0c0,0,0,0,0,0C3.6,0,3.4,0.2,3.4,0.4c0,0,0,0,0,0v0.4H1.7C0.8,0.9,0,1.6,0,2.6v6.8c0,0.9,0.8,1.7,1.7,1.7h8.6c0.9,0,1.7-0.8,1.7-1.7V2.6C12,1.6,11.2,0.9,10.3,0.9L10.3,0.9z M11.1,9.4c0,0.5-0.4,0.9-0.9,0.9H1.7c-0.5,0-0.9-0.4-0.9-0.9V4.3h10.3V9.4z M11.1,3.4H0.9V2.6c0-0.5,0.4-0.9,0.9-0.9h1.7v0.4c0,0.2,0.2,0.4,0.4,0.4s0.4-0.2,0.4-0.4V1.7h3.4v0.4c0,0.2,0.2,0.4,0.4,0.4c0.2,0,0.4-0.2,0.4-0.4V1.7h1.7c0.5,0,0.9,0.4,0.9,0.9L11.1,3.4L11.1,3.4z M3,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H3c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C2.6,8.4,2.8,8.6,3,8.6z M8.1,6.8H9c0.2,0,0.4-0.2,0.4-0.4C9.4,6.2,9.2,6,9,6c0,0,0,0,0,0H8.1C7.9,6,7.7,6.2,7.7,6.4c0,0,0,0,0,0C7.7,6.7,7.9,6.8,8.1,6.8L8.1,6.8z M3,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C4.3,6.2,4.1,6,3.9,6c0,0,0,0,0,0H3C2.8,6,2.6,6.2,2.6,6.4c0,0,0,0,0,0C2.6,6.7,2.8,6.8,3,6.8z M8.1,8.6H9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H8.1c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C7.7,8.4,7.9,8.6,8.1,8.6z",width:12}:"function"==typeof s?g=s(h):B.isObject(s)?g=s:window.console.warn("unsupported appearance:"+s),g){var v=t.getCellOverflowText(e.col,e.row)||"";o.text("",e,{color:c,font:l,icons:[g],padding:p,textAlign:"right",textBaseline:i}),t.setCellOverflowText(e.col,e.row,v)}}}function ze(t,e,n,o,r,i){var l=!1;if(e){var a={grid:r,record:i,rect:o.getRect(),row:o.row,col:o.col,selection:o.getSelection()};t.drawWithClip(o,(function(t){l=!1===e(n,t,a)}))}return l}function Ne(t,e){var n,o=!1;return(n="function"==typeof e?e(t):e)&&"dashed"===n.innerBox&&(o=!0),o}function Ve(t,e,n,o){Ne(n.getRowRecord(e),o)&&(t.left+=4,t.top+=4,t.right-=4,t.bottom-=4)}function Ue(t,e,n,o){Ne(n.getRowRecord(e),o)&&(t[3]-=4,t[3]<0&&(t[3]=0),t[1]-=4,t[1]<0&&(t[1]=0))}function Ke(t,e,n,o,r){if(Ne(e,r)){var i=n.getRect();i.top+=4,i.right-=4,i.bottom-=4,i.left+=4,o.attachArea(i,n)}}var Ge=G("protected.event_target"),Ye=1,Xe=function(){function t(){this[Me]={listeners:{},listenerData:{}}}return t.prototype.listen=function(t,e){var n=this,o=this[Ge].listeners[t]||(this[Ge].listeners[t]=[]);o.push(e);var r=Ye++;return this[Ge].listenerData[r]={listener:e,remove:function(){delete n[Ge].listenerData[r];var i=o.indexOf(e);o.splice(i,1),n[Ge].listeners[t].length||delete n[Ge].listeners[t]},type:t},r},t.prototype.unlisten=function(t){this[Ge]&&this[Ge].listenerData[t].remove()},t.prototype.addEventListener=function(t,e){this.listen(t,e)},t.prototype.removeEventListener=function(t,e){var n=this;this[Ge]&&y(this[Ge].listenerData,(function(o,r){o.type===t&&o.listener===e&&n.unlisten(r)}))},t.prototype.hasListeners=function(t){return!!this[Ge].listeners[t]},t.prototype.fireListeners=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this[Ge].listeners[t];return i?i.map((function(t){return t.call.apply(t,o([e],n))})).filter(c):[]},t.prototype.dispose=function(){},t}();Me=Ge;var qe,$e,Ze,Je,Qe,tn,en,nn,on={CHANGE_STYLE:"change_style"},rn=function(t){function n(e){var n=(void 0===e?{}:e).bgColor,o=t.call(this)||this;return o._bgColor=n,o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return on},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DEFAULT",{get:function(){return qe||(qe=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.doChangeStyle=function(){this.fireListeners(on.CHANGE_STYLE)},n.prototype.clone=function(){return new n(this)},n}(Xe),ln=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._textAlign=e.textAlign||"left",n._textBaseline=e.textBaseline||"middle",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return $e||($e=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textAlign",{get:function(){return this._textAlign},set:function(t){this._textAlign=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(rn),an=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"center"}))||this,o=e.uncheckBgColor,r=e.checkBgColor,i=e.borderColor;return n._uncheckBgColor=o,n._checkBgColor=r,n._borderColor=i,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Ze||(Ze=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uncheckBgColor",{get:function(){return this._uncheckBgColor},set:function(t){this._uncheckBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkBgColor",{get:function(){return this._checkBgColor},set:function(t){this._checkBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(ln),sn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._color=e.color,n._font=e.font,n._padding=e.padding,n._inputPadding=e.inputPadding,n._textOverflow=e.textOverflow||"clip",n._appearance=e.appearance||"none",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Je||(Je=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputPadding",{get:function(){return this._inputPadding},set:function(t){this._inputPadding=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textOverflow",{get:function(){return this._textOverflow},set:function(t){this._textOverflow=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appearance",{get:function(){return this._appearance},set:function(t){this._appearance=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(ln),cn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"center"}))||this;return n._buttonBgColor=e.buttonBgColor,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Qe||(Qe=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buttonBgColor",{get:function(){return this._buttonBgColor},set:function(t){this._buttonBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),un=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return tn||(tn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(an),hn=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return en||(en=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(an);var fn,dn,pn,gn,vn,yn,_n,bn,wn,mn,Cn=function(t){function n(e){return void 0===e&&(e={}),t.call(this,function(t){return t.textAlign=t.textAlign||"right",t}(e))||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return nn||(nn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),xn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._appearance=e.appearance||"none",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return fn||(fn=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appearance",{get:function(){return this._appearance},set:function(t){this._appearance=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(rn),Rn=function(t){function n(e){return void 0===e&&(e={}),t.call(this,_(e,{textAlign:"center"}))||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return dn||(dn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),En=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"center"}))||this;return n._imageSizing=e.imageSizing,n._margin=e.margin||4,n._appearance=e.appearance||"none",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return pn||(pn=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"imageSizing",{get:function(){return this._imageSizing},set:function(t){this._imageSizing=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appearance",{get:function(){return this._appearance},set:function(t){this._appearance=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(ln),On=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"left"}))||this;return n.appearance=e.appearance||"menulist-button",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return gn||(gn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),Ln=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n.appearance=e.appearance||"menulist-button",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return vn||(vn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),kn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textBaseline:"middle",textOverflow:"ellipsis"}))||this;return n._lineHeight=e.lineHeight||"1em",n._autoWrapText=e.autoWrapText||!1,n._lineClamp=e.lineClamp||"auto",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return yn||(yn=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineClamp",{get:function(){return this._lineClamp},set:function(t){this._lineClamp=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"autoWrapText",{get:function(){return this._autoWrapText},set:function(t){this._autoWrapText=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n}(sn),Sn=function(t){function n(e){return void 0===e&&(e={}),t.call(this,_(e,{textAlign:"right"}))||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return _n||(_n=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),In=function(t){return t>80?"#20a8d8":t>50?"#4dbd74":t>20?"#ffc107":"#f86c6b"},Tn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._barColor=e.barColor||In,n._barBgColor=e.barBgColor||"#f0f3f5",n._barHeight=e.barHeight||3,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return bn||(bn=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"barColor",{get:function(){return this._barColor},set:function(t){this._barColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"barBgColor",{get:function(){return this._barBgColor},set:function(t){this._barBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"barHeight",{get:function(){return this._barHeight},set:function(t){this._barHeight=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),Pn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"center"}))||this,o=e.checkColor,r=e.uncheckBorderColor,i=e.checkBorderColor,l=e.uncheckBgColor,a=e.checkBgColor;return n._checkColor=o,n._uncheckBorderColor=r,n._checkBorderColor=i,n._uncheckBgColor=l,n._checkBgColor=a,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return wn||(wn=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkColor",{get:function(){return this._checkColor},set:function(t){this._checkColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uncheckBorderColor",{get:function(){return this._uncheckBorderColor},set:function(t){this._uncheckBorderColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkBorderColor",{get:function(){return this._checkBorderColor},set:function(t){this._checkBorderColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uncheckBgColor",{get:function(){return this._uncheckBgColor},set:function(t){this._uncheckBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkBgColor",{get:function(){return this._checkBgColor},set:function(t){this._checkBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(ln);var Bn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,function(t){return t.textAlign=t.textAlign||"left",t}(e))||this;return n._lineColor=e.lineColor,n._buttonColor=e.buttonColor,n._buttonBgColor=e.buttonBgColor,n._buttonBorderColor=e.buttonBorderColor,n._linkColor=e.linkColor,n._lineHeight=e.lineHeight||"1em",n._autoWrapText=e.autoWrapText||!1,n._lineClamp=e.lineClamp||"auto",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return mn||(mn=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineColor",{get:function(){return this._lineColor},set:function(t){this._lineColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(t){this._buttonColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buttonBgColor",{get:function(){return this._buttonBgColor},set:function(t){this._buttonBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buttonBorderColor",{get:function(){return this._buttonBorderColor},set:function(t){this._buttonBorderColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"linkColor",{get:function(){return this._linkColor},set:function(t){this._linkColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineClamp",{get:function(){return this._lineClamp},set:function(t){this._lineClamp=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"autoWrapText",{get:function(){return this._autoWrapText},set:function(t){this._autoWrapText=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(sn),An=rn.EVENT_TYPE;function Mn(t,e,n){return void 0===n&&(n=sn),t?t instanceof rn?t:"function"==typeof t?Mn(t(e),e,n):"string"==typeof t&&e&&t in e?Mn(e[t],e,n):new n(t):n.DEFAULT}var Dn=G("col.fadein_stateID");function jn(t){var e=t[Dn];return e||(e={cells:{}},B.setReadonly(t,Dn,e)),e}function Fn(t,e,n,o,r,i){return function(l){var a=jn(t),s=e+":"+n;1===l?delete a.cells[s]:a.cells[s]={opacity:l},i(),r();var c=a.cells[s];if(c){var u=o.getContext();u.globalAlpha=1-c.opacity;try{i()}finally{u.globalAlpha=1}}}}var Wn=function(t,e,n,o,r,i){var l=jn(t),a=[Fn(t,e,n,o,r,i)];l.activeFadeins=a,vt(500,(function(t){a.forEach((function(e){return e(t)})),1===t&&delete l.activeFadeins}))},Hn=function(t,e,n,o,r,i){var l=jn(t);l.activeFadeins?l.activeFadeins.push(Fn(t,e,n,o,r,i)):r()},zn=function(){function t(t){void 0===t&&(t={}),this.onDrawCell=this.onDrawCell.bind(this),this._convert=t.convert,this._convertCopy=t.convertCopy,this._hidden=t.hidden,this._fadeinWhenCallbackInPromise=t.fadeinWhenCallbackInPromise||!1}return Object.defineProperty(t.prototype,"StyleClass",{get:function(){return rn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fadeinWhenCallbackInPromise",{get:function(){return this._fadeinWhenCallbackInPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"convert",{get:function(){return this._convert},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"convertCopy",{get:function(){return this._convertCopy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hidden},set:function(t){this._hidden=t},enumerable:!1,configurable:!0}),t.prototype.reviseAttachCellsArea=function(t,e,n){},t.prototype.reviseAttachCellsPadding=function(t,e,n){var o=zt(n);o.inputPadding&&(t[0]+=o.inputPadding[0],t[1]+=o.inputPadding[1],t[2]+=o.inputPadding[2],t[3]+=o.inputPadding[3])},t.prototype.reviseFocusRect=function(t,e,n){},t.prototype.onDrawCell=function(t,e,n,o){var r=this,i=e.style,l=e.getRecord,a=e.clearCellBase,s=e.drawCellBase,u=e.getCell,h=e.getContentHidden,f=l(),d=o.getGridCanvasHelper(),p=zt(o);if(p.cellRange&&L(p.cellRange,n.col,n.row)){s({bgColor:"#FFF"});var g=Mn(i,f,this.StyleClass);this.drawEditingInternal(n,g,d,o,e)}else{if(!p.cellRange){var v=n.getSelection(),y=n.col,_=n.row;if(!v.dragged&&L(n.range,v.select.col,v.select.row)&&L(v.range,y,_))(g=Mn(i,f,this.StyleClass))instanceof sn&&g.inputPadding?p.inputPadding=d.toBoxPixelArray(g.inputPadding,n,g.font):delete p.inputPadding}var b;if(a(),f){if(R(f)?b=f.then((function(){return t})):R(t)&&(b=t),b){var w=Date.now();return b.then((function(t){if(n.toCurrentContext().getDrawRect()){var a=Date.now()-w,f=function(){var a=n.toCurrentContext();if(a.getDrawRect()){var c=l();if(!R(c)){var f=Mn(i,c,r.StyleClass);f.bgColor?s({bgColor:f.bgColor}):s(),r.isContentHidden(c,h)||(r.drawInternal(r.doConvertInternal(t,u(),o),a,f,d,o,e),r.drawMessageInternal(e.getMessage(),n,f,d,o,e))}}},p=r._fadeinWhenCallbackInPromise;if(c(p)||(p=!!o.configure("fadeinWhenCallbackInPromise")),p){var g=n.col,v=n.row;a<80?Hn(o,g,v,n,f,s):Wn(o,g,v,n,f,s)}else f()}}))}if((g=Mn(i,f,this.StyleClass)).bgColor?s({bgColor:g.bgColor}):s(),!this.isContentHidden(f,h)){this.drawInternal(this.doConvertInternal(t,u(),o),n,g,d,o,e),this.drawMessageInternal(e.getMessage(),n,g,d,o,e);var m=(y=n.col)+":"+(_=n.row),C=o[Dn]&&o[Dn][m];if(C){var x=n.getContext();x.globalAlpha=1-C.opacity;try{s()}finally{x.globalAlpha=1}}}}}},t.prototype.drawMessageInternal=function(t,e,n,o,r,i){i.messageHandler.drawCellMessage(t,e,n,o,r,i)},t.prototype.bindGridEvent=function(t,e){return[]},t.prototype.getCopyCellValue=function(t,e,n){return t},t.prototype.convertCopyValue=function(t,e,n){var o=this.convertCopyInternal(t);return this.convertCopy&&(o=this.convertCopy(t,o,e,n)),o},t.prototype.doConvertInternal=function(t,e,n){var o=this.convertInternal(t);return this.convert&&(o=this.convert(t,o,e,n)),o},t.prototype.convertInternal=function(t){return c(t)?t:""},t.prototype.convertCopyInternal=function(t){return this.convertInternal(t)},t.prototype.drawEditingInternal=function(t,e,n,o,r){},t.prototype.isContentHidden=function(t,e){var n=x(this.hidden,t);return c(n)||(n=e()),n},t}(),Nn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._options=be.normalize(e.options),n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Ln},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.withOptions=function(t){var e=this.clone();return e._options=be.normalize(t),e},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.getCell,a=i.getIcon,s=n.textAlign,u=n.textBaseline,h=n.font,f=n.padding,d=n.textOverflow,p=n.appearance,g=n.color,v=this._convertInternal(t,l(),r);o.testFontLoad(h,v,e),Fe(a(),e,o,(function(n,r){var i=o.toBoxPixelArray(f||0,e,h),l=i.slice(0);l[1]+=26;var a=i.slice(0);a[1]+=8,c(g)||c(t)&&""!==t||(g="rgba(0, 0, 0, .38)"),o.text(v,r,{color:g,font:h,icons:n,padding:l,textAlign:s,textBaseline:u,textOverflow:d}),"menulist-button"===p?o.text("",e,{color:g,font:h,icons:[{color:"rgba(0, 0, 0, .54)",path:"M0 2 5 7 10 2z",width:10}],padding:a,textAlign:"right",textBaseline:u}):"none"!==p&&window.console.warn("unsupported appearance:"+p)}))},n.prototype.convertInternal=function(t){return t},n.prototype._convertInternal=function(e,n,o){for(var r=0,i=this._options;r<i.length;r++){var l=i[r];if(l.value===e){e=l.label;break}}return t.prototype.doConvertInternal.call(this,e,n,o)},n.prototype.getCopyCellValue=function(t,e,n){return this._convertInternal(t,n,e)},n}(zn),Vn=G("inline_menu_editor.stateID"),Un=null,Kn=0;function Gn(t,e,n,o,r){var i=function(t){var e=t[Vn];return e||(e={},B.setReadonly(t,Vn,e)),e}(t);Un||(Un=new ke),i.element||(i.element=Un,Kn++,t.addDisposable({dispose:function(){!--Kn&&Un&&(Un.dispose(),Un=null)}})),Un.attach(t,n,e.col,e.row,o,r)}function Yn(t){Un&&Un.detach(t)}var Xn=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._classList=e.classList||"",n._options=be.normalizeToFn(e.options),n._autoWidth=e.autoWidth||!1,n}return e(n,t),n.prototype.dispose=function(){},Object.defineProperty(n.prototype,"classList",{get:function(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]},set:function(t){this._classList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},set:function(t){this._options=be.normalizeToFn(t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"autoWidth",{get:function(){return this._autoWidth},set:function(t){this._autoWidth=t},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.onChangeDisabledInternal=function(){Yn(!0)},n.prototype.onChangeReadOnlyInternal=function(){Yn(!0)},n.prototype.bindGridEvent=function(t,e){var n=this,o=function(e){var o=!z(n.readOnly,t,e.row)&&!H(n.disabled,t,e.row);return o&&t.doGetCellValue(e.col,e.row,(function(o){var r=t.getRowRecord(e.row);R(r)||Gn(t,e,n,o,r)})),o};function r(n,o){return t.getLayoutCellId(n,o)===e}return[t.listen(N.CLICK_CELL,(function(t){r(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(N.KEYDOWN,(function(e){if(!(113!==e.keyCode&&e.keyCode!==V||e.keyCode===V&&e.event.shiftKey)){var n=t.selection.select;r(n.col,n.row)&&o({col:n.col,row:n.row})&&(M.cancel(e.event),e.stopCellMoving())}})),t.listen(N.SELECTED_CELL,(function(t){Yn()})),t.listen(N.SCROLL,(function(){Yn(!0)})),t.listen(N.MOUSEOVER_CELL,(function(e){r(e.col,e.row)&&(z(n.readOnly,t,e.row)||H(n.disabled,t,e.row)||(t.getElement().style.cursor="pointer"))})),t.listen(N.MOUSEMOVE_CELL,(function(e){r(e.col,e.row)&&(z(n.readOnly,t,e.row)||H(n.disabled,t,e.row)||t.getElement().style.cursor||(t.getElement().style.cursor="pointer"))})),t.listen(N.MOUSEOUT_CELL,(function(e){r(e.col,e.row)&&(t.getElement().style.cursor="")})),t.listen(N.PASTE_CELL,(function(e){if(!e.multi){var o=t.selection.range;if(O(o.start,o.end)&&r(e.col,e.row)&&!z(n.readOnly,t,e.row)&&!H(n.disabled,t,e.row)){var i=t.getRowRecord(e.row);if(!R(i)){var l=n._pasteDataToOptionValue(e.normalizeValue,t,e,i);l&&(M.cancel(e.event),E(t.doChangeValue(e.col,e.row,(function(){return l.value})),(function(){var n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)})))}}}}))]},n.prototype.onPasteCellRangeBox=function(t,e,n){if(!z(this.readOnly,t,e.row)&&!H(this.disabled,t,e.row)){var o=t.getRowRecord(e.row);if(!R(o)){var r=this._pasteDataToOptionValue(n,t,e,o);r&&t.doChangeValue(e.col,e.row,(function(){return r.value}))}}},n.prototype.onDeleteCellRangeBox=function(t,e){if(!z(this.readOnly,t,e.row)&&!H(this.disabled,t,e.row)){var n=t.getRowRecord(e.row);if(!R(n)){var o=this._pasteDataToOptionValue("",t,e,n);o&&t.doChangeValue(e.col,e.row,(function(){return o.value}))}}},n.prototype._pasteDataToOptionValue=function(t,e,n,o){var r=this._options(o),i=qn(t,r);if(i)return i;var l=e.getColumnType(n.col,n.row);if(function(t){if(t instanceof Nn)return!0;if(Array.isArray(t.options))return!0;return!1}(l)){var a=$n(t),c=s.find(l.options,(function(t){return $n(t.label)===a}));if(c)return qn(c.value,r)}},n}(st);function qn(t,e){var n=$n(t),o=s.find(e,(function(t){return $n(t.value)===n}));if(o)return o}function $n(t){return null==t?"":(""+t).trim()}function Zn(t){var e=t.style.minHeight;t.style.minHeight="0px",t.style.height="0px",t.style.height=t.scrollHeight+"px",t.style.minHeight=e}var Jn=function(){function t(){this._attaching=!1,this._handler=new Bt,this._input=(Ft.inject("InlineTextAreaElement",".kaka-grid__inline-textarea::-ms-clear {\n  visibility: hidden;\n}\n\n.kaka-grid__inline-textarea {\n  position: absolute;\n  box-sizing: border-box;\n  overflow: hidden;\n  padding: 0;\n  border: none;\n}\n"),Rt("textarea",{classList:"kaka-grid__inline-textarea"})),this._bindInputEvents()}return t.setInputAttrs=function(t,e,n){var o,r=t.classList;r&&(o=n.classList).add.apply(o,r)},t.prototype.dispose=function(){this.detach(),this._handler.dispose(),delete this._beforePropEditor},t.prototype.attach=function(e,n,o,r,i,l){var a,s=this,u=this._input;if(!u.parentElement){var h=this._handler;if(this._beforePropEditor){var f=this._beforePropEditor.classList;f&&(a=u.classList).remove.apply(a,f)}u.style.font=e.font||"16px sans-serif";var d=e.getAttachCellsArea(e.getCellRange(o,r)),p=d.element,g=d.rect,v=d.padding;u.style.top=g.top.toFixed()+"px",u.style.left=g.left.toFixed()+"px",u.style.minWidth=g.width.toFixed()+"px",u.style.width=u.style.minWidth,u.style.minHeight=g.height.toFixed()+"px",u.style.height=u.style.minHeight,u.style.paddingTop=v[0]+"px",u.style.paddingRight=v[1]+"px",u.style.paddingBottom=v[2]+"px",u.style.paddingLeft=v[3]+"px",p.appendChild(u),t.setInputAttrs(n,e,u),function(t,e,n){c(e)?t.value=e:t.value="",t.dataset.before_value=t.value,n&&(t.value=n),Zn(t)}(u,i,l),this._activeData={grid:e,col:o,row:r,editor:n},this._beforePropEditor=n;var y=function(){h.tryWithOffEvents(u,"blur",(function(){!function(){u.focus();var t=u.value.length;try{if(void 0!==u.selectionStart)return u.selectionStart=t,void(u.selectionEnd=t)}catch(t){}if(document.selection){var e=u.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}}()}));var t=zt(e);t.cellRange=e.getCellRange(o,r),e.invalidateCellRange(t.cellRange)};this._attaching=!0,setTimeout((function(){y(),s._attaching=!1}))}},t.prototype.detach=function(t){if(this._isActive()){var e=this._activeData,n=e.grid,o=e.col,r=e.row,i=this._input;this._handler.tryWithOffEvents(i,"blur",(function(){i.parentElement&&i.parentElement.removeChild(i)})),delete zt(n).cellRange;var l=n.getCellRange(o,r);n.invalidateCellRange(l),t&&n.focus()}delete this._activeData},t.prototype.doChangeValue=function(){var t;if(this._isActive()&&(t=this._input).value!==t.dataset.before_value){var e=function(t){return t.value}(this._input),n=this._activeData,o=n.grid,r=n.col,i=n.row;o.doChangeValue(r,i,(function(){return e}))}},t.prototype._isActive=function(){var t=this._input;return!(!t||!t.parentElement)&&!!this._activeData},t.prototype._bindInputEvents=function(){var t=this,e=this._handler,n=this._input,o=function(t){return t.stopPropagation()};e.on(n,"click",o),e.on(n,"mousedown",o),e.on(n,"touchstart",o),e.on(n,"dblclick",o),e.on(n,"compositionstart",(function(t){n.classList.add("composition")})),e.on(n,"compositionend",(function(t){n.classList.remove("composition")})),e.on(n,"keydown",(function(e){if(!n.classList.contains("composition")){var o=M.getKeyCode(e);27===o?(t.detach(!0),M.cancel(e)):o===V?t._onKeydownEnter(e,n):9===o&&t._onKeydownTab(e)}})),e.on(n,"blur",(function(e){t.doChangeValue(),t.detach()})),e.on(n,"input",(function(t){Zn(n)}))},t.prototype._onKeydownEnter=function(t,e){var n;if(this._isActive()&&!this._attaching)if(t.altKey||t.ctrlKey)e.setRangeText("\n"),e.selectionStart++,setTimeout((function(){Zn(e)}),0),M.cancel(t);else{var o=this._activeData.grid;this.doChangeValue(),this.detach(!0),(null===(n=o.keyboardOptions)||void 0===n?void 0:n.moveCellOnEnter)&&o.onKeyDownMove(t),M.cancel(t)}},t.prototype._onKeydownTab=function(t){var e;if(this._isActive()&&!this._attaching){var n=this._activeData.grid;(null===(e=n.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab)||(this.doChangeValue(),this.detach(!0),n.onKeyDownMove(t))}},t}(),Qn=Q(),to=null,eo=0;function no(t,e,n,o,r){to||(to=new Jn);var i=n.getState(t);i.element||(i.element=to,eo++,t.addDisposable({dispose:function(){!--eo&&to&&(to.dispose(),to=null)}})),to.attach(t,n,e.col,e.row,o,r)}function oo(t){to&&to.detach(t)}function ro(t){to&&to.doChangeValue()}var io=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._classList=e.classList||"",n}return e(n,t),Object.defineProperty(n.prototype,"classList",{get:function(){return this._classList&&(Array.isArray(this._classList)?this._classList:[this._classList])},set:function(t){this._classList=t},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.onActionInputCellInternal=function(t,e,n){var o=this;t.doGetCellValue(e.col,e.row,(function(r){no(t,e,o,r,n)}))},n.prototype.onActionOpenCellInternal=function(t,e){var n=this;t.doGetCellValue(e.col,e.row,(function(o){no(t,e,n,o)}))},n.prototype.onChangeSelectCellInternal=function(t,e,n){ro(),oo()},n.prototype.onGridScrollInternal=function(t){ro(),oo(!0)},n.prototype.onChangeDisabledInternal=function(){oo(!0)},n.prototype.onChangeReadOnlyInternal=function(){oo(!0)},n.prototype.onSetInputAttrsInternal=function(t,e,n){Jn.setInputAttrs(this,t,n)},n.prototype.getState=function(t){return t[Qn]||B.setReadonly(t,Qn,{}),t[Qn]},n}(ht),lo=X(),ao=function(t){for(var e=t.grid,n=t.col,o=t.row,r=e.getLayoutCellId(n,o),i=o-e.getRecordStartRowByRecordIndex(e.getRecordIndexByRow(o)),l=[],a=e.rowCount,s=e.recordRowCount,c=e.frozenRowCount+i;c<a;c+=s)e.getLayoutCellId(n,c)===r&&l.push({col:n,row:c});return l},so=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._group=e.group||ao,n}return e(n,t),n.prototype.clone=function(){return new n(this)},Object.defineProperty(n.prototype,"group",{get:function(){return this._group},set:function(t){this._group=t},enumerable:!1,configurable:!0}),n.prototype.bindGridEvent=function(t,e){var n=this,r=t[lo];r||(r={block:{},elapsed:{}},B.setReadonly(t,lo,r));var i=r,l=function(e){n._action(t,e)};return o(rt(t,e,{action:l,mouseOver:function(e){if(H(n.disabled,t,e.row))return!1;i.mouseActiveCell={col:e.col,row:e.row};var o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:function(e){delete i.mouseActiveCell;var n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),it(t,e,{action:l}),[t.listen(N.PASTE_CELL,(function(n){if(!n.multi){var o,r,i=t.selection.range;if(O(i.start,i.end))if(o=n.col,r=n.row,t.getLayoutCellId(o,r)===e)Nt(n.normalizeValue.trim())&&(M.cancel(n.event),l({col:n.col,row:n.row}))}}))])},n.prototype.onPasteCellRangeBox=function(t,e,n){z(this.readOnly,t,e.row)||H(this.disabled,t,e.row)||Nt(n.trim())&&this._action(t,{col:e.col,row:e.row})},n.prototype.onDeleteCellRangeBox=function(){},n.prototype._action=function(t,e){var n=this,o=t[lo],r=t.getCellRange(e.col,e.row),i=r.start.col+":"+r.start.row;z(this.readOnly,t,e.row)||H(this.disabled,t,e.row)||o.block[i]||t.doGetCellValue(e.col,e.row,(function(r){Nt(r)||n._group({grid:t,col:e.col,row:e.row}).forEach((function(r){var i=r.col,l=r.row,a=t.getCellRange(i,l),s=a.start.col+":"+a.start.row;z(n.readOnly,t,e.row)||H(n.disabled,t,e.row)||o.block[s]||function(t,e,n,o){t.doGetCellValue(e,n,(function(r){if(Nt(r)!==o){var i=t[lo],l=t.getCellRange(e,n),a=l.start.col+":"+l.start.row,s=t.doChangeValue(e,n,F);if(s){var c=function(){vt(200,(function(e){1===e?delete i.elapsed[a]:i.elapsed[a]=e,t.invalidateCellRange(l)}))};R(s)?(i.block[a]=!0,s.then((function(){delete i.block[a],c()}))):c()}}}))}(t,i,l,i===e.col&&l===e.row)}))}))},n}(st);var co="kaka-grid__small-dialog-input",uo=co+"__input",ho=co+"--hidden",fo=co+"--shown";function po(t,e){e.tryWithOffEvents(t,"blur",(function(){!function(){t.focus();var e=t.value.length;try{if(void 0!==t.selectionStart)return t.selectionStart=e,void(t.selectionEnd=e)}catch(t){}if(document.selection){var n=t.createTextRange();n.collapse(),n.moveEnd("character",e),n.moveStart("character",e),n.select()}}()}))}function go(t,e,n){var o=t.type;n.type=o||""}var vo=function(){function t(){this._handler=new Bt,this._dialog=function(){Ft.inject("smallDialogInputElement",".kaka-grid__small-dialog-input__input::-ms-clear {\n  visibility: hidden;\n}\n\n@keyframes kaka-grid__small-dialog-input--hidden-animation {\n  0% {\n    opacity: 1;\n  }\n  99% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.kaka-grid__small-dialog-input {\n  position: absolute;\n  box-sizing: content-box;\n  margin: -1px auto auto -1px;\n  border-radius: 3px;\n  background-color: #fafafa;\n  transition: padding 150ms ease-out, box-shadow 150ms ease-out;\n}\n\n.kaka-grid__small-dialog-input--hidden {\n  box-shadow: none;\n  padding: 0;\n  pointer-events: none;\n  animation: kaka-grid__small-dialog-input--hidden-animation 150ms ease-out;\n  opacity: 0;\n}\n\n.kaka-grid__small-dialog-input--shown {\n  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2),\n    0 2px 2px 0px rgba(0, 0, 0, 0.14), 0 1px 5px 0px rgba(0, 0, 0, 0.12);\n  padding: 8px 24px;\n}\n\n.kaka-grid__small-dialog-input__input {\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  padding: 3px 2px 0 4px;\n  border: none;\n  border-bottom: solid 1px rgba(0, 0, 0, 0.87);\n  outline: none;\n  background-color: transparent;\n  transition: all 300ms ease-out;\n}\n\n.kaka-grid__small-dialog-input__input:focus {\n  border-bottom: solid 1px #2196f3;\n  box-shadow: 0 1px 0 0 #2196f3;\n}\n\n.kaka-grid__small-dialog-input::after {\n  content: '';\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  display: block;\n  width: 100%;\n  padding-top: 8px;\n}\n\n.kaka-grid__small-dialog-input.helper-text--right-justified::after {\n  text-align: right;\n}\n\n.kaka-grid__small-dialog-input[data-helper-text]::after {\n  content: attr(data-helper-text);\n  color: rgba(0, 0, 0, 0.87);\n}\n\n.kaka-grid__small-dialog-input[data-error-message] input {\n  border-bottom: solid 1px #ff1744;\n  box-shadow: 0 1px 0 0 #ff1744;\n}\n\n.kaka-grid__small-dialog-input[data-error-message]::after {\n  content: attr(data-error-message);\n  color: #ff1744;\n  text-align: left;\n}\n");var t=Rt("div",{classList:[co,ho]}),e=Rt("input",{classList:uo});return e.tabIndex=-1,t.appendChild(e),t}(),this._input=this._dialog.querySelector("."+uo),this._bindDialogEvents()}return t.setInputAttrs=function(t,e,n){go(t,0,n)},t.prototype.dispose=function(){var t=this._dialog;this.detach(),this._handler.dispose(),this._beforePropEditor=null,t.parentElement&&t.parentElement.removeChild(t)},t.prototype.attach=function(t,e,n,o,r){var i=this,l=this._handler,a=this._dialog,s=this._input;this._beforePropEditor&&function(t,e,n,o){var r,i=o.classList;i&&(r=e.classList).remove.apply(r,i),delete e.dataset.helperText,n.type=""}(0,a,s,this._beforePropEditor),delete a.dataset.errorMessage,a.classList.remove(fo),a.classList.add(ho),s.tabIndex=0;var c=t.getAttachCellsArea(t.getCellRange(n,o)),u=c.element,h=c.rect;a.style.top=h.top.toFixed()+"px",a.style.left=h.left.toFixed()+"px",a.style.width=h.width.toFixed()+"px",s.style.height=h.height.toFixed()+"px",u.appendChild(a),Wt(s,r),s.style.font=t.font||"16px sans-serif";var f={grid:t,col:n,row:o,editor:e};this._onInputValue(s,f),k?setTimeout((function(){return po(s,l)})):po(s,l),a.classList.add(fo),a.classList.remove(ho),function(t,e,n,o){var r,i=o.classList,l=o.helperText;i&&(r=e.classList).add.apply(r,i),l&&"function"!=typeof l&&(e.dataset.helperText=l),go(o,0,n)}(0,a,s,e),this._activeData=f,this._beforePropEditor=e,this._attaching=!0,setTimeout((function(){delete i._attaching}))},t.prototype.detach=function(t){if(this._isActive()){var e=this._dialog,n=this._input;e.classList.remove(fo),e.classList.add(ho),n.tabIndex=-1;var o=this._activeData,r=o.grid,i=o.col,l=o.row,a=r.getCellRange(i,l);r.invalidateCellRange(a),t&&r.focus()}this._activeData=null,this._beforeValue=null},t.prototype._doChangeValue=function(){var t=this;if(!this._isActive())return!1;var e=this._input,n=e.value;return E(this._validate(n),(function(o){if(o&&n===e.value){var r=t._activeData,i=r.grid,l=r.col,a=r.row;return i.doChangeValue(l,a,(function(){return n})),!0}return!1}))},t.prototype._isActive=function(){var t=this._dialog;return!(!t||!t.parentElement)&&!!this._activeData},t.prototype._bindDialogEvents=function(){var t=this,e=this._handler,n=this._dialog,o=this._input,r=function(t){return t.stopPropagation()};e.on(n,"click",r),e.on(n,"dblclick",r),e.on(n,"mousedown",r),e.on(n,"touchstart",r),e.on(o,"compositionstart",(function(t){o.classList.add("composition")})),e.on(o,"compositionend",(function(e){o.classList.remove("composition"),t._onInputValue(o)}));var i=function(e){o.classList.contains("composition")||t._onInputValue(o)};e.on(o,"keyup",i),e.on(o,"keypress",i),e.on(o,"keydown",(function(e){if(!o.classList.contains("composition")){var n=M.getKeyCode(e);27===n?(t.detach(!0),M.cancel(e)):n===V?t._onKeydownEnter(e):9===n?t._onKeydownTab(e):t._onInputValue(o)}}))},t.prototype._onKeydownEnter=function(t){var e=this;if(!this._attaching){var n=this._input,o=n.value;E(this._doChangeValue(),(function(r){var i;if(r&&o===n.value){var l=e._isActive()?e._activeData.grid:null;e.detach(!0),(null===(i=null==l?void 0:l.keyboardOptions)||void 0===i?void 0:i.moveCellOnEnter)&&l.onKeyDownMove(t)}})),M.cancel(t)}},t.prototype._onKeydownTab=function(t){var e,n=this;if(this._isActive()&&!this._attaching){var o=this._activeData.grid;if(null===(e=o.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab){var r=this._input,i=r.value;E(this._doChangeValue(),(function(e){e&&i===r.value&&(n.detach(!0),o.onKeyDownMove(t))})),M.cancel(t)}}},t.prototype._onInputValue=function(t,e){var n=this._beforeValue,o=t.value;n!==o&&this._onInputValueChange(o,e),this._beforeValue=o},t.prototype._onInputValueChange=function(t,e){e=e||this._activeData;var n=this._dialog,o=e.grid,r=e.col,i=e.row,l=e.editor;if("function"==typeof l.helperText){var a=l.helperText(t,{grid:o,col:r,row:i});a?n.dataset.helperText=a:delete n.dataset.helperText}"errorMessage"in n.dataset&&this._validate(t,!0)},t.prototype._validate=function(t,e){var n=this._dialog,o=this._input,r=this._activeData,i=r.grid,l=r.col,a=r.row,s=r.editor,c="";return s.inputValidator&&(c=s.inputValidator(t,{grid:i,col:l,row:a})),E(c,(function(r){return r||!s.validator||e||(r=s.validator(t,{grid:i,col:l,row:a})),E(r,(function(e){return e&&t===o.value?n.dataset.errorMessage=e:delete n.dataset.errorMessage,!e}))}))},t}(),yo=G("small_dialog_input_editor.stateID"),_o=null,bo=0;function wo(t,e,n,o){var r=function(t){var e=t[yo];return e||(e={},B.setReadonly(t,yo,e)),e}(t);_o||(_o=new vo),r.element||(r.element=_o,bo++,t.addDisposable({dispose:function(){!--bo&&_o&&(_o.dispose(),_o=null)}})),_o.attach(t,n,e.col,e.row,o)}function mo(t){_o&&_o.detach(t)}var Co=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._helperText=e.helperText,n._inputValidator=e.inputValidator,n._validator=e.validator,n._classList=e.classList||"",n._type=e.type||"",n}return e(n,t),n.prototype.dispose=function(){},Object.defineProperty(n.prototype,"classList",{get:function(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]},set:function(t){this._classList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"helperText",{get:function(){return this._helperText},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputValidator",{get:function(){return this._inputValidator},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"validator",{get:function(){return this._validator},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.onInputCellInternal=function(t,e,n){wo(t,e,this,n)},n.prototype.onOpenCellInternal=function(t,e){var n=this;t.doGetCellValue(e.col,e.row,(function(o){wo(t,e,n,o)}))},n.prototype.onChangeSelectCellInternal=function(t,e,n){mo()},n.prototype.onGridScrollInternal=function(t){mo(!0)},n.prototype.onChangeDisabledInternal=function(){mo(!0)},n.prototype.onChangeReadOnlyInternal=function(){mo(!0)},n.prototype.onSetInputAttrsInternal=function(t,e,n){vo.setInputAttrs(this,t,n)},n}(ut),xo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!1,configurable:!0}),n}(mt),Ro=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!1,configurable:!0}),n}(so),Eo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!1,configurable:!0}),n}(Co),Oo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!1,configurable:!0}),n}(xt),Lo={CHECK:new xo,RADIO:new Ro,INPUT:new Eo,SWITCH:new Oo};var ko,So=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._draw=e.draw,n}return e(n,t),Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.getRecord,a=n.textAlign,s=n.textBaseline,u=n.borderColor,h=n.checkBgColor,f=n.uncheckBgColor;if(!ze(o,this.draw,t,e,r,l())){var d=e.col,p=e.row,g=r.getCellRange(d,p),v=g.start.col+":"+g.start.row,y=this.getState(r),_=null==y?void 0:y.elapsed[v],b={borderColor:u,checkBgColor:h,textAlign:a,textBaseline:s,uncheckBgColor:f};c(_)&&(b.animElapsedTime=_),this.doDrawInternal(o,t,e,b)}},n.prototype.convertInternal=function(t){return Nt(t)},n}(zn),Io=function(t,e){switch(e%3){case 0:return"#979797";case 1:return"#008fb5";case 2:return"#f1c109"}return"#979797"},To=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._branchColors=e.branchColors||Io,n._margin=e.margin||4,n._circleSize=e.circleSize||16,n._branchLineWidth=e.branchLineWidth||4,n._mergeStyle="straight"===e.mergeStyle?"straight":"bezier",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return ko||(ko=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"branchColors",{get:function(){return this._branchColors},set:function(t){this._branchColors=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"circleSize",{get:function(){return this._circleSize},set:function(t){this._circleSize=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"branchLineWidth",{get:function(){return this._branchLineWidth},set:function(t){this._branchLineWidth=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mergeStyle",{get:function(){return this._mergeStyle},set:function(t){this._mergeStyle=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(rn),Po=function(t){var e=t.fromIndex,n=t.toIndex,o=t.colorIndex,r=t.point;this.fromIndex=e,this.toIndex=n,this.colorIndex=o,this.point=r},Bo=function(){function t(t){var e=t.index,n=t.commit,o=void 0!==n&&n,r=t.lines,i=void 0===r?[]:r,l=t.tag;this.index=e,this.commit=o,this.lines=i,this.tag=l}return t.mergeLines=function(t){var e=t.filter((function(t){return c(t.fromIndex)&&c(t.toIndex)})),n=t.filter((function(t){return c(t.fromIndex)&&!c(t.toIndex)})),o=t.filter((function(t){return!c(t.fromIndex)&&c(t.toIndex)}));return n.forEach((function(t){for(var n=0;n<o.length;n++){var r=o[n];if(!r.point&&t.colorIndex===r.colorIndex){t.toIndex=r.toIndex,o.splice(n,1);break}}e.push(t)})),e.concat(o)},t.merge=function(e,n){return e?new t({commit:e.commit||n.commit,index:e.index,lines:t.mergeLines(e.lines.concat(n.lines)),tag:e.tag||n.tag}):n},t}(),Ao=G("branch_graph_col.stateID");function Mo(t,e){for(var n=o(t).reverse(),r=0;r<n.length;r++){var i=n[r][e];if(i){i.lines=Bo.mergeLines(i.lines.concat([new Po({colorIndex:e,toIndex:e})]));for(var l=0;l<r;l++){n[l][e]=new Bo({index:e,lines:[new Po({colorIndex:e,fromIndex:e,toIndex:e})]})}return!0}}return!1}function Do(t,e){var n=t.timeline,r=[];(Array.isArray(e)?e:[e]).forEach((function(e){if(e){var n;if("branch"===e.command){var i=B.isObject(e.branch)?e.branch.from:null,l=B.isObject(e.branch)?e.branch.to:e.branch;n=function(t,e,n){var o=t.timeline,r=t.branches,i=null!=e?r.indexOf(e):-1,l=r.indexOf(n);if(l<0&&(l=r.length,r.push(n)),i<0)return new Bo({index:l});var a=function(){for(var t=o.length-1;t>=0;t--){var e=o[t][i];if(e&&e.commit)return t}return-1}();if(-1===a)return null;var s=a+1,c=new Bo({index:l,lines:[new Po({colorIndex:l,fromIndex:i})]}),u=void 0,h=null;if(s<o.length){var f=o[s];u=f[l]=Bo.merge(f[l],c)}else u=c,h=c;var d=o[a][i];return d.lines=Bo.mergeLines(d.lines.concat([new Po({colorIndex:l,point:u,toIndex:l})])),h}(t,i,l)}else if("commit"===e.command)n=function(t,e){var n=t.timeline,o=t.branches.indexOf(e);if(o<0)return null;var r=new Bo({commit:!0,index:o});return Mo(n,o)&&(r.lines=Bo.mergeLines(r.lines.concat([new Po({colorIndex:o,fromIndex:o})]))),r}(t,e.branch);else if("merge"===e.command){i=e.branch.from,l=e.branch.to;n=function(t,e,n){var r=t.timeline,i=t.branches,l=i.indexOf(e),a=i.indexOf(n);if(a<0||l<0)return new Bo({index:a,commit:!0});var s=new Bo({index:a,commit:!0,lines:[new Po({colorIndex:l,fromIndex:l}),new Po({colorIndex:a,fromIndex:a})]}),c=o(r),u=c.pop();return u&&(u[l]=Bo.merge(u[l],new Bo({index:a,lines:[new Po({colorIndex:l,toIndex:a})]}))),Mo(c,l)&&u&&(u[l].lines=Bo.mergeLines(u[l].lines.concat([new Po({colorIndex:l,fromIndex:l})]))),Mo(r,a),s}(t,i,l)}else"tag"===e.command&&(n=function(t,e,n){var o=t.branches,r=o.indexOf(e);return r<0&&(r=o.length,o.push(e)),new Bo({index:r,tag:n})}(t,e.branch,e.tag));n&&n.index>-1&&(r[n.index]=Bo.merge(r[n.index],n))}})),n.push(r)}function jo(t,e,n){var r={branches:[],timeline:[]};return function(t,e,n){for(var o,r=t.dataSource,i=[],l=function(t){var n=r.getField(t,e);if(R(n)){var l=i.length;i.push(void 0),o=o?o.then((function(){return n})).then((function(t){i[l]=t})):n.then((function(t){i[l]=t}))}else i.push(n)},a=0;a<r.length;a++)l(a);o?o.then((function(){return n(i)})):n(i)}(e,n,(function(e){"top"!==t&&(e=o(e).reverse()),e.forEach((function(t){Do(r,t)}))})),r}var Fo,Wo=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._start=e.start||"bottom",n._cache=!!c(e.cache)&&e.cache,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return To},enumerable:!1,configurable:!0}),n.prototype.clearCache=function(t){delete t[Ao]},n.prototype.onDrawCell=function(e,n,o,r){if(this._cache){var i=r[Ao]||(r[Ao]=new Map),l=o.col,a=o.row,s=r.getField(l,a);i.has(s)||i.set(s,jo(this._start,r,s))}return t.prototype.onDrawCell.call(this,e,n,o,r)},n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l,a,s=e.col,u=e.row,h=r.getField(s,u),f=null!==(a=this._cache?null===(l=r[Ao])||void 0===l?void 0:l.get(h):null)&&void 0!==a?a:jo(this._start,r,h),d=f.timeline,p=f.branches,g="top"!==this._start?{upLineIndexKey:"toIndex",downLineIndexKey:"fromIndex"}:{upLineIndexKey:"fromIndex",downLineIndexKey:"toIndex"},v=g.upLineIndexKey,y=g.downLineIndexKey,_="top"!==this._start?d[d.length-(u-r.frozenRowCount)-1]:d[u-r.frozenRowCount],b=n.branchColors,w=n.branchLineWidth,m=n.circleSize,C=n.mergeStyle,R=n.margin,E=e.getRect(),O=m/2,L=E.width-2*R;o.drawWithClip(e,(function(t){t.textAlign="left",t.textBaseline="middle";var e=function(t,e,n,o,r,i){var l=Math.max(n/r.length+1,5);i.forEach((function(e){e.forEach((function(e,r){if(!(r<=0)&&e.tag){var i=t.measureText(e.tag).width;l*r+2*o+4+i>n&&(l=Math.max((n-2*o-4-i)/r,5))}}))}));var a=[],s=e;return r.forEach((function(){a.push(Math.ceil(s+o)),s+=l})),a}(t,E.left+R,L,O,p,d),n=E.top+E.height/2;_.map((function(t,e){return t?t.lines.map((function(t){return{colorIndex:t.colorIndex,downLineIndex:t[y],pointIndex:e,upLineIndex:t[v]}})):[]})).reduce((function(t,e){return t.concat(e)}),[]).sort((function(t,e){return e.colorIndex-t.colorIndex})).forEach((function(o){var i=e[o.pointIndex];!function(t,e,n,o,r,i,l,a,s){var u=a.branchXPoints,h=a.branchColors,f=a.branchLineWidth,d=a.mergeStyle,p=s.col,g=s.row,v=s.branches;if(c(r)||c(i)){if(e.strokeStyle=x(h,v[l],l),e.lineWidth=f,e.lineCap="round",e.beginPath(),c(r)){var y=u[r],_=t.getCellRelativeRect(p,g-1),b=_.top+_.height/2;e.moveTo(y,b),"bezier"===d?e.bezierCurveTo(y,(o+b)/2,n,(o+b)/2,n,o):e.lineTo(n,o)}else e.moveTo(n,o);if(c(i)){var w=u[i],m=t.getCellRelativeRect(p,g+1),C=m.top+m.height/2;"bezier"===d?e.bezierCurveTo(n,(o+C)/2,w,(o+C)/2,w,C):e.lineTo(w,C)}e.stroke()}}(r,t,i,n,o.upLineIndex,o.downLineIndex,o.colorIndex,{branchColors:b,branchLineWidth:w,branchXPoints:e,margin:R,mergeStyle:C},{branches:p,col:s,row:u,width:L})})),_.forEach((function(o,r){if(o&&o.commit){var i=e[r];t.fillStyle=x(b,p[r],r),t.beginPath(),t.arc(i,n,O,0,2*Math.PI,!0),t.fill(),t.closePath()}})),_.forEach((function(o,r){o&&o.tag&&(t.fillStyle=x(b,p[r],r),t.fillText(o.tag,e[r]+O+4,n))}))}))},n}(zn),Ho=J(),zo=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._draw=e.draw,n._cellStyle=e.cellStyle,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return sn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cellStyle",{get:function(){return this._cellStyle},enumerable:!1,configurable:!0}),n.prototype.reviseAttachCellsArea=function(t,e,n){Ve(t,e,n,this._cellStyle)},n.prototype.reviseAttachCellsPadding=function(e,n,o){t.prototype.reviseAttachCellsPadding.call(this,e,n,o),Ue(e,n,o,this._cellStyle)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=this,a=i.getIcon,s=i.getRecord,c=n.textAlign,u=n.textBaseline,h=n.color,f=n.font,d=n.textOverflow;o.testFontLoad(f,t,e),Fe(a(),e,o,(function(i,a){ze(o,l.draw,t,e,r,s())||o.text(t,a,{color:h,font:f,icons:i,padding:We(e,o,n),textAlign:c,textBaseline:u,textOverflow:d}),He(r,e,Ho,o,n),Ke(0,s(),e,o,l._cellStyle)}))},n}(zn),No=$(),Vo=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._caption=e.caption,n._linkButton=!!e.linkButton,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return cn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"caption",{get:function(){return this._caption},enumerable:!1,configurable:!0}),n.prototype.withCaption=function(t){var e=this.clone();return e._caption=t,e},n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=this,a=i.getIcon,s=n.textAlign,c=n.textBaseline,u=n.color,h=n.buttonBgColor,f=n.font,d=n.padding,p=n.textOverflow;o.testFontLoad(f,t,e);var g=e.col,v=e.row,y=r.getCellRange(g,v),_=!1,b=!1,w=r[No];if(w){w.mouseActiveCell&&L(y,w.mouseActiveCell.col,w.mouseActiveCell.row)&&(_=!0);var m=e.getSelection().select;L(y,m.col,m.row)&&(b=!0)}Fe(a(),e,o,(function(e,n){if(l._linkButton){if(_&&w&&w.mouseRelativePos){var r=o.getTextRect(t,n,{font:f,icons:e,padding:d,textAlign:s,textBaseline:c,textOverflow:p});_=r.left<=w.mouseRelativePos.x&&r.right>=w.mouseRelativePos.x&&r.top<=w.mouseRelativePos.y&&r.bottom>=w.mouseRelativePos.y,w.mouseActive=_}o.text(t,n,{color:_?h||o.theme.button.bgColor:u,font:f,icons:e,padding:d,textAlign:s,textBaseline:c,textOverflow:p})}else _&&(w.mouseActive=_),o.button(t,n,{bgColor:h,color:u,font:f,icons:e,padding:d,shadow:_||b?{blur:6,color:"rgba(0, 0, 0, 0.48)",offsetY:3}:{},textAlign:s,textBaseline:c,textOverflow:p})}))},n.prototype.convertInternal=function(e){return this._caption||t.prototype.convertInternal.call(this,e)},n}(zo),Uo=Y(),Ko=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return un},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Uo];return e||(e={block:{},elapsed:{}},B.setReadonly(t,Uo,e)),e},n.prototype.doDrawInternal=function(t,e,n,o){t.checkbox(e,n,o)},n}(So),Go=q(),Yo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return hn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Go];return e||(e={block:{},elapsed:{}},B.setReadonly(t,Go,e)),e},n.prototype.doDrawInternal=function(t,e,n,o){t.switch(e,n,o)},n}(So),Xo=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._format=e.format,n}return e(n,t),Object.defineProperty(n,"defaultFormat",{get:function(){return Fo||(Fo=new Intl.DateTimeFormat)},set:function(t){Fo=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Cn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"format",{get:function(){return this._format},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.withFormat=function(t){var e=this.clone();return e._format=t,e},n.prototype.convertInternal=function(t){return t instanceof Date?(this._format||n.defaultFormat).format(t):""},n}(zo),qo=J(),$o=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._draw=e.draw,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return xn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.getRecord;ze(o,this.draw,t,e,r,l()),He(r,e,qo,o,n)},n}(zn);var Zo=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._tagName=e.tagName||"i",n._className=e.className,n._content=e.content,n._name=e.name,n._iconWidth=e.iconWidth,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Rn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(e,n,o,r,i,l){var a=Number(e);if(isNaN(a))l.getIcon=function(){return null};else{var s={};De.iconPropKeys.forEach((function(t){s[t]=o[t]})),s.className=this._className,s.tagName=this._tagName,s.content=this._content,s.name=this._name,this._iconWidth&&(s.width=this._iconWidth),l.getIcon=function(){return function(t,e){e===1/0&&(e=0);for(var n=[],o=0;o<e;o++)n.push(t);return n}(s,a)}}t.prototype.drawInternal.call(this,"",n,o,r,i,l)},n}(zo),Jo={};function Qo(t,e){var n=e||t.font;if(Jo[n])return Jo[n];var o=t.font;try{t.font=n;var r=t.measureText("哦").width;return Jo[n]={height:r,width:r}}finally{t.font=o}}function tr(t,e,n,o,r){var i=void 0===r?{}:r,l=i.offset,a=void 0===l?0:l,s=i.padding,c=void 0===s?{}:s,u=c.left,h=void 0===u?0:u,f=c.right,d=void 0===f?0:f,p=c.top,g=void 0===p?0:p,v=c.bottom,y=void 0===v?0:v,_=t.textAlign||"left",b=t.textBaseline||"middle";t.textAlign=_,t.textBaseline=b;var w=e.left+a+h;"right"===_||"end"===_?w=e.right-n-a-d:"center"===_&&(w=e.left+(e.width-n+h-d)/2);var m=e.top+a+g;return"bottom"===b||"alphabetic"===b||"ideographic"===b?m=e.bottom-o-a-y:"middle"===b&&(m=e.top+(e.height-o+g-y)/2),{x:w,y:m}}var er=function(){function t(t){this._list=[],this._map={},this._cacheSize=t||50}return t.prototype.get=function(t){var e=this._map[t];if(e){var n=this._list,o=n.indexOf(t);n.splice(o,1),n.push(t)}return e},t.prototype.put=function(t,e){var n=this._list,o=this._map;if(o[t]){var r=n.indexOf(t);n.splice(r,1)}(o[t]=e,n.push(t),n.length>this._cacheSize)&&delete o[n.shift()||""]},t}(),nr={};function or(t,e){return E(e,(function(e){var n=t.get(e);if(n)return n;var o=function(t){if("undefined"==typeof Promise)return window.console.error("Promise is not loaded. load Promise before this process."),{then:function(){return this}};var e=new Image,n=new Promise((function(t){e.onload=function(){t(e)}}));return e.onerror=function(){var e=t.length>200?t.substr(0,200)+"...":t;throw console.warn("cannot load: "+e),new Error("IMAGE LOAD ERROR: "+e)},e.src=t,n}(e).then((function(n){return t.put(e,n),n}));return t.put(e,o),o}))}function rr(t,e,n){return or(nr[t]||(nr[t]=new er(e)),n)}var ir=J();var lr,ar=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return En},enumerable:!1,configurable:!0}),n.prototype.onDrawCell=function(e,n,o,r){var i=e?rr("ImageColumn",50,e):"";return t.prototype.onDrawCell.call(this,i,n,o,r)},n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=n.textAlign,a=n.textBaseline,s=n.margin;t&&o.drawWithClip(e,(function(r){r.textAlign=l,r.textBaseline=a;var i=e.getRect().copy(),c=We(e,o,n);if(i.width-=c[1],i.width<0&&(i.width=0),"keep-aspect-ratio"===n.imageSizing){var u=function(t,e,n,o){var r=t,i=e;return r>n&&(i=(r=n)*e/t),i>o&&(r=(i=o)*t/e),{height:i,width:r}}(t.width,t.height,i.width-2*s,i.height-2*s),h=u.width,f=u.height,d=tr(r,i,h,f,{offset:s});r.drawImage(t,0,0,t.width,t.height,d.x,d.y,h,f)}else r.drawImage(t,0,0,t.width,t.height,i.left+s,i.top+s,i.width-2*s,i.height-2*s)})),He(r,e,ir,o,n)},n}(zn),sr=tt(),cr="",ur=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._lookupMap={},n._records=e.records,n._valueField=e.valueField,n._captionField=e.captionField,n._draw=e.draw,n._cellStyle=e.cellStyle,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return On},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"records",{get:function(){return this._records},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"valueField",{get:function(){return this._valueField},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"captionField",{get:function(){return this._captionField},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cellStyle",{get:function(){return this._cellStyle},enumerable:!1,configurable:!0}),n.prototype.reviseAttachCellsArea=function(t,e,n){Ve(t,e,n,this._cellStyle)},n.prototype.reviseAttachCellsPadding=function(e,n,o){t.prototype.reviseAttachCellsPadding.call(this,e,n,o),Ue(e,n,o,this._cellStyle)},n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=this,a=i.getIcon,s=i.getCell,u=i.getRecord,h=x(this.records||[],u());if(R(h)){var f=s(),d=f.col,p=f.row;if(!cr)return void h.then(function(t,e,n){return function(o){cr=String(e);try{t._mergeRecords(o);var i=r.getCellRange(e,n);r.invalidateCellRange(i)}finally{cr=""}}}(this,d,p))}else this._mergeRecords(h);var g=n.textAlign,v=n.textBaseline,y=n.font,_=n.textOverflow,b=n.color,w=this._convertInternal(t,s(),r);o.testFontLoad(y,w,e),Fe(a(),e,o,(function(i,a){ze(o,l.draw,w,e,r,u())||(c(b)||c(t)&&""!==t||(b="rgba(0, 0, 0, .38)"),o.text(w,a,{color:b,font:y,icons:i,padding:We(a,o,n),textAlign:g,textBaseline:v,textOverflow:_})),He(r,a,sr,o,n),Ke(0,u(),e,o,l._cellStyle)}))},n.prototype.convertCopyInternal=function(t){return c(t)?this._convertInternalValue(t):""},n.prototype.convertInternal=function(t){return t},n.prototype.doConvertInternal=function(t,e,n){return this.convertInternal(t)},n.prototype._convertInternalValue=function(t){var e=c(t)?t+"":"",n=this._lookupMap[e];return c(n)||(n=e),n},n.prototype._convertInternal=function(t,e,n){var o=this._convertInternalValue(t);return this.convert&&(o=this.convert(t,o,e,n)),this.doConvertInternal(o,e,n)},n.prototype._mergeRecords=function(t){void 0===t&&(t=[]);for(var e=this.valueField||"id",n=this.captionField||e,o=0,r=t;o<r.length;o++){var i=r[o],l=i[e];l=c(l)?l+"":"";var a=i[n];a=c(a)?a+"":"",this._lookupMap[l]=a}},n}(zn),hr=Q(),fr=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._draw=e.draw,n._cellStyle=e.cellStyle,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return kn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cellStyle",{get:function(){return this._cellStyle},enumerable:!1,configurable:!0}),n.prototype.reviseAttachCellsArea=function(t,e,n){Ve(t,e,n,this._cellStyle)},n.prototype.reviseAttachCellsPadding=function(e,n,o){t.prototype.reviseAttachCellsPadding.call(this,e,n,o),Ue(e,n,o,this._cellStyle)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=this,a=i.getIcon,s=i.getRecord,u=n.textAlign,h=n.textBaseline,f=n.color,d=n.font,p=n.lineHeight,g=n.autoWrapText,v=n.lineClamp,y=n.textOverflow,_=c(t)?t+"":"",b=_.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");o.testFontLoad(d,_,e),Fe(a(),e,o,(function(t,i){ze(o,l.draw,b,e,r,s())||o.multilineText(b,i,{autoWrapText:g,color:f,font:d,icons:t,lineClamp:v,lineHeight:p,padding:We(e,o,n),textAlign:u,textBaseline:h,textOverflow:y}),He(r,e,hr,o,n),Ke(0,s(),e,o,l._cellStyle)}))},n}(zn),dr=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._format=e.format,n}return e(n,t),Object.defineProperty(n,"defaultFormat",{get:function(){return lr||(lr=new Intl.NumberFormat)},set:function(t){lr=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Sn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"format",{get:function(){return this._format},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.withFormat=function(t){var e=this.clone();return e._format=t,e},n.prototype.convertInternal=function(t){var e=(t+"").trim();return e&&(e-=0,e=isNaN(e)?"":(this._format||n.defaultFormat).format(e)),e},n}(zo),pr=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._min=e.min||0,n._max=e.max||n._min+100,n._formatter=e.formatter||function(t){return t},n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Tn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(e,n,o,r,i,l){t.prototype.drawInternal.call(this,this._formatter(e),n,o,r,i,l);var a=o.barColor,s=o.barBgColor,c=o.barHeight,u=""+e;A.endsWith(u,"%")&&(u=u.substr(0,u.length-1));var h=Number(u),f=h<this._min?0:h>this._max?1:(h-this._min)/(this._max-this._min);r.drawWithClip(n,(function(t){var e=n.getRect(),o=e.width-4-1,r=e.bottom-2-c-1,i=e.left+2;t.fillStyle=x(s,100*f)||"#f0f3f5",t.beginPath(),t.rect(i,r,o,c),t.fill();var l=Math.min(o*f,o);t.fillStyle=x(a,100*f)||"#20a8d8",t.beginPath(),t.rect(i,r,l,c),t.fill()}))},n}(zo);function gr(t,e,n){return new Promise((function(o){for(var r=[],i=new Array(n),l=function(e){var n=t(e),o={v:n,f:n};i[e]=o,R(n)&&r.push(n.then((function(t){o.v=t,o.f=t})))},a=0;a<n;a++)l(a);Promise.all(r).then((function(){return null==e?i:function(t,e){return new Promise((function(n){for(var o=t.length,r=[],i=function(n){var o=t[n],i=e(o.v);R(i)?r.push(i.then((function(t){o.f=t}))):o.f=i},l=0;l<o;l++)i(l);Promise.all(r).then((function(){return n(t)}))}))}(i,e)})).then(o)}))}function vr(t,e,n,o,r){var i=function(t,e){for(var n=new Array(e),o=0;o<e;o++)n[o]=t(o);return n}(t,n);null!=r?i.sort((function(t,e){return o(r(t),r(e))})):i.sort(o);for(var l=0;l<n;l++)e(l,i[l])}function yr(t){if(B.isObject(t)){var e=t;if(e.get&&e.set)return!0}return!1}var _r={REFRESH_DATA:"refresh_data",UPDATED_LENGTH:"updated_length",UPDATED_ORDER:"updated_order",UPDATE_LENGTH:"update_length"};function br(t,e){var n=x(t);if(R(n)){var o=n.then((function(t){return e(t),t}));return e(o),o}return n}function wr(t,e,n){if(c(t)){if(R(t))return t.then((function(t){return wr(t,e,n)}));var r=yr(e)?e.get:e;if("string"==typeof r&&r in t)return br(t[r],n);if("function"==typeof r)return br(r(t),n);var i=(""+r).split(".");return i.length<=1?br(t[r],n):br(m.apply(void 0,o([t,function(t,e){return wr(t,e,j)}],i)),n)}}function mr(t,e,n){if(null==t)return!1;var o=yr(e)?e.set:e;if("string"==typeof o&&o in t)t[o]=n;else{if("function"==typeof o)return o(t,n);if("string"==typeof o)for(var r=(""+o).split("."),i=t,l=r.length,a=0;a<l;a++){var s=r[a];a===l-1?i[s]=n:i=i[s]||(i[s]={})}else t[o]=n}return!0}function Cr(t,e){if(!t)return e;var n=t[e];return c(n)?n:e}var xr=function(t){function n(e){var n,o=t.call(this)||this;return o._sortedIndexMap=null,o._get=(null==e?void 0:e.get.bind(e))||void 0,o._length=(null==e?void 0:e.length)||0,o._source=null!==(n=null==e?void 0:e.source)&&void 0!==n?n:e,o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return _r},enumerable:!1,configurable:!0}),n.ofArray=function(t){return new n({get:function(e){return t[e]},length:t.length,source:t})},Object.defineProperty(n.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),n.prototype.get=function(t){return this.getOriginal(Cr(this._sortedIndexMap,t))},n.prototype.getField=function(t,e){return this.getOriginalField(Cr(this._sortedIndexMap,t),e)},n.prototype.hasField=function(t,e){return this.hasOriginalField(Cr(this._sortedIndexMap,t),e)},n.prototype.setField=function(t,e,n){return this.setOriginalField(Cr(this._sortedIndexMap,t),e,n)},n.prototype.sort=function(t,e){var n=this,o=new Array(this._length),r="desc"!==e?function(t,e){return t===e?0:t>e?1:-1}:function(t,e){return t===e?0:t<e?1:-1};return function(t,e,n,o,r){if("undefined"!=typeof Promise)return gr(t,r,n).then((function(t){t.sort((function(t,e){return o(t.f,e.f)}));for(var r=0;r<n;r++)e(r,t[r].v)}));vr(t,e,n,o,r);var i={then:function(t){return t(),i},catch:function(){return i}};return i}((function(t){return c(o[t])?o[t]:o[t]=t}),(function(t,e){o[t]=e}),this._length,r,(function(e){return n.getOriginalField(e,t)})).then((function(){n._sortedIndexMap=o,n.fireListeners(_r.UPDATED_ORDER)}))},Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(t){this._length!==t&&this.setLength(t)},enumerable:!1,configurable:!0}),n.prototype.refresh=function(){this.refreshInternal(),this.fireListeners(_r.REFRESH_DATA)},Object.defineProperty(n.prototype,"dataSource",{get:function(){return this},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){t.prototype.dispose.call(this)},n.prototype.getOriginal=function(t){var e=this;return br(this._get(t),(function(n){e.recordPromiseCallBackInternal(t,n)}))},n.prototype.getOriginalField=function(t,e){var n=this;if(c(e))return wr(this.getOriginal(t),e,(function(o){n.fieldPromiseCallBackInternal(t,e,o)}))},n.prototype.hasOriginalField=function(t,e){if(!c(e))return!1;if("function"==typeof e)return!0;var n=this.getOriginal(t);return Boolean(n&&"string"==typeof e&&e in n)},n.prototype.setOriginalField=function(t,e,n){if(!c(e))return!1;var o=this.getOriginal(t);return R(o)?o.then((function(t){return mr(t,e,n)})):mr(o,e,n)},n.prototype.fieldPromiseCallBackInternal=function(t,e,n){},n.prototype.recordPromiseCallBackInternal=function(t,e){},n.prototype.refreshInternal=function(){},n.prototype.setLength=function(t){var e=this.fireListeners(_r.UPDATE_LENGTH,t);s.findIndex(e,(function(t){return!t}))>=0||(this._length=t,this.fireListeners(_r.UPDATED_LENGTH,this._length))},n.EMPTY=new n({get:function(){},length:0}),n}(Xe);function Rr(t,e,n){var o=e[t.options.keyField];t._levelMap[o]=n;for(var r=0,i=t._pIdMap[o]||[];r<i.length;r++){Rr(t,i[r],n+1)}}function Er(t,e){if(e&&e.length>0){var n=e[e.length-1][t.options.keyField];t._lastMap[n]=!0}}function Or(t,e){var n=e[t.options.keyField],o=t._pIdMap[n]||[];if(o.length>0){t._expandMap[n]=!0;for(var r=0,i=o;r<i.length;r++){Or(t,i[r])}}}function Lr(t,e){var n=[],o=e[t.options.keyField];if(t._expandMap[o])for(var r=0,i=t._pIdMap[o]||[];r<i.length;r++){var l=i[r];n.push(l),n=n.concat(Lr(t,l))}return n}function kr(t,e){for(var n=t._records[e][t.options.keyField],o=t._levelMap[n],r=0,i=e+1;i<t._records.length;i++){var l=t._records[i][t.options.keyField];if(!(o<t._levelMap[l]))break;r++}return r}function Sr(t,e,n,r,i){var l,a;if(e){var s=t._records.indexOf(e),c=e[t._options.keyField];t._pIdMap[c]?(t._expandMap[c]?n&&(Or(t,e),(a=t._records).splice.apply(a,o([s+1,kr(t,s)],Lr(t,e)))):(n?Or(t,e):t._expandMap[c]=!0,(l=t._records).splice.apply(l,o([s+1,0],Lr(t,e)))),0===r&&(t.length=t._records.length)):i&&i(t,e,n,r)}}function Ir(t,e){var n=e[t.options.keyField];delete t._expandMap[n];for(var o=0,r=t._pIdMap[n]||[];o<r.length;o++){Ir(t,r[o])}}function Tr(t,e){return t._idMap[e][t.options.parentKeyField]}function Pr(t,e){var n;for(var o in t._levelMap={},t._lastMap={},t._rootRecords=[],t._records=[],t._pIdMap)if(t._pIdMap.hasOwnProperty(o)){var r=t._pIdMap[o];if(t._idMap[o])Er(t,r);else for(var i=0,l=r;i<l.length;i++){var a=l[i];Rr(t,a,0),t._rootRecords.push(a),t._records.push(a),(n=t._records).push.apply(n,Lr(t,a))}}for(var s in Er(t,t._rootRecords),t._expandMap)t._pIdMap[s]||delete t._expandMap[s];0===e&&(t.length=t._records.length)}function Br(t,e,n,o){for(var r=!1,i=0,l=e;i<l.length;i++){var a=l[i],s=a[t._options.keyField];if(!t._idMap[s]){r=!0;var c=a[t._options.parentKeyField];t._idMap[s]=a,t._pIdMap[c]=t._pIdMap[c]||[],t._pIdMap[c].push(a),n&&Array.isArray(n)&&n.indexOf(s)>=0&&(t._expandMap[s]=!0)}}r&&Pr(t,o)}function Ar(t,e,n,o,r){if(t._options.hasChildren&&t._options.getChildren&&t._options.hasChildren(e)){var i=t._options.getChildren(e,n);R(i)?i.then((function(i){var l=Array.isArray(i)?i:i.records,a=Array.isArray(i)?void 0:i.expandedKeys;Br(t,l,a,o),r&&r(t,e,n,o)})):(Br(t,i,null,o),r&&r(t,e,n,o))}}var Mr=function(t){function n(e,n){var o=t.call(this,e)||this;o._idMap={},o._pIdMap={},o._levelMap={},o._lastMap={},o._rootRecords=[],o._records=[],o._updateLengthSilentCounter=0,o._dataSource=e,o._options=n,o._expandMap={};for(var r=0,i=n.expandedKeys||[];r<i.length;r++){var l=i[r];o._expandMap[l]=!0}return o.refreshInternal(),o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return xr.EVENT_TYPE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"expandedKeys",{get:function(){return Object.keys(this._expandMap)},enumerable:!1,configurable:!0}),n.prototype.getOriginal=function(t){return this._records[t]},n.prototype.getTreeInfo=function(t){var e=this.getOriginal(t);if(e){for(var n=e[this._options.keyField],o=Tr(this,n),r=!!this._expandMap[n],i=!this._pIdMap[n],l=!!this._lastMap[n],a=this._levelMap[n],s=[],c=n,u=0;u<a;u++)s.unshift(!!this._lastMap[c]),c=Tr(this,c);return i&&this._options.hasChildren&&(i=!this._options.hasChildren(e)),{expanded:r,isLast:l,isLeaf:i,key:n,level:a,levelLast:s,parentKey:o}}},n.prototype.getIndexByKey=function(t){return this._records.indexOf(this._idMap[t])},n.prototype.expandAll=function(){var t;this._records.length=0;for(var e=0,n=this._rootRecords;e<n.length;e++){var o=n[e];Or(this,o),this._records.push(o),(t=this._records).push.apply(t,Lr(this,o))}this.length=this._records.length},n.prototype.expand=function(t,e){void 0===e&&(e=!1),Sr(this,this.getOriginal(t),e,this._updateLengthSilentCounter,(function(t,e,n,o){Ar(t,e,n,o,(function(t,e,n,o){Sr(t,e,n,o)}))}))},n.prototype.expandToKey=function(t){for(var e=[],n=t,o=this._idMap[n];o;)n=o[this._options.parentKeyField],(o=this._idMap[n])&&e.unshift(n);this._updateLengthSilentCounter++;try{for(var r=0,i=e;r<i.length;r++){var l=i[r];this.expand(this._records.indexOf(this._idMap[l]))}}finally{this._updateLengthSilentCounter--,0===this._updateLengthSilentCounter&&(this.length=this._records.length)}return this.getIndexByKey(t)},n.prototype.expandToLevel=function(t){var e=[];if(t>0){this._updateLengthSilentCounter++;try{for(var n in this._levelMap)this._levelMap.hasOwnProperty(n)&&(t===this._levelMap[n]||t>this._levelMap[n]&&this._lastMap[n])&&e.push(this.expandToKey(n))}finally{this._updateLengthSilentCounter--,0===this._updateLengthSilentCounter&&(this.length=this._records.length)}}return e},n.prototype.collapseAll=function(){var t;this._records.length=0,(t=this._records).push.apply(t,this._rootRecords),this._expandMap={},this.length=this._records.length},n.prototype.collapse=function(t,e){var n=this.getOriginal(t);if(n){var o=n[this._options.keyField];this._pIdMap[o]&&(this._expandMap[o]?(e?Ir(this,n):delete this._expandMap[o],this._records.splice(t+1,kr(this,t)),this.length=this._records.length):e&&Ir(this,n))}},n.prototype.toggle=function(t,e){var n=this.getOriginal(t);if(n){var o=n[this._options.keyField];this._expandMap[o]?this.collapse(t,e):this.expand(t,e)}},Object.defineProperty(n.prototype,"source",{get:function(){return this._dataSource.source},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!1,configurable:!0}),n.prototype.refreshInternal=function(){this._idMap={},this._pIdMap={};for(var t=0;t<this._dataSource.length;t++){var e=this._dataSource.getField(t,this._options.keyField),n=this._dataSource.getField(t,this._options.parentKeyField),o=this._dataSource.get(t);this._idMap[e]=o,this._pIdMap[n]=this._pIdMap[n]||[],this._pIdMap[n].push(o)}Pr(this,this._updateLengthSilentCounter),0===this.length&&Ar(this,null,!1,this._updateLengthSilentCounter)},n}(xr),Dr=J(),jr=$(),Fr=Z();function Wr(t,e){var n=void 0;if(t.dataSource instanceof Mr){var o=t.getRecordIndexByRow(e);o>=0&&(n=t.dataSource.getTreeInfo(o))}return n}function Hr(t){var e=0;return t&&(e+=16*t.level+32),e}function zr(t,e,n,o){var r=!1,i=t._getMouseRelativePoint(o);if(i){var l=t.getCellRelativeRect(e,n),a=Wr(t,n);if(a&&!a.isLeaf){var s=Hr(a);s&&i.x-l.left<s&&(r=!0)}}return r}var Nr=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._canToggle=e.canToggle,n._toggled=e.toggled,n._draw=e.draw,n._cellStyle=e.cellStyle,n._multilineText=e.multilineText,n}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Bn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canToggle",{get:function(){return this._canToggle},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"toggled",{get:function(){return this._toggled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"draw",{get:function(){return this._draw},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cellStyle",{get:function(){return this._cellStyle},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"multilineText",{get:function(){return this._multilineText},enumerable:!1,configurable:!0}),n.prototype.reviseAttachCellsArea=function(t,e,n){Ve(t,e,n,this._cellStyle)},n.prototype.reviseAttachCellsPadding=function(e,n,o){t.prototype.reviseAttachCellsPadding.call(this,e,n,o);var r=Wr(o,n);e[3]+=Hr(r),Ue(e,n,o,this._cellStyle)},n.prototype.reviseFocusRect=function(t,e,n){var o=Wr(n,e);t.left+=Hr(o)},n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=this,a=i.getIcon,s=i.getRecord,c=n.textAlign,u=n.textBaseline,h=n.color,f=n.font,d=n.textOverflow,p=n.lineColor,g=n.buttonColor,v=n.buttonBgColor,y=n.buttonBorderColor,_=n.linkColor,b=n.autoWrapText,w=n.lineHeight,m=n.lineClamp;o.testFontLoad(f,t,e);var C=Wr(r,e.row),R=!1,E=r[jr];if(E){var O=r.getCellRange(e.col,e.row);E.mouseActiveCell&&L(O,E.mouseActiveCell.col,E.mouseActiveCell.row)&&(R=!0)}Fe(a(),e,o,(function(a,O){if(!ze(o,l.draw,t,e,r,s())){var L=We(e,o,n);if(R&&E&&E.mouseRelativePos){var k=o.getTextRect(t,O,{font:f,icons:a,padding:L,textAlign:c,textBaseline:u,textOverflow:d}),S=Hr(C);k.left=Math.max(e.getRect().left+S,k.left+S),k.right+=S,R=k.left<=E.mouseRelativePos.x&&k.right>=E.mouseRelativePos.x&&k.top<=E.mouseRelativePos.y&&k.bottom>=E.mouseRelativePos.y,E.mouseActive=R}var I=i.getRecord(),T=x(l.multilineText,I);o.tree(t,O,{color:R?_||o.theme.tree.linkColor:h,lineColor:p,buttonColor:g,buttonBgColor:v,buttonBorderColor:y,icons:a,padding:L,textAlign:c,textBaseline:u,textOverflow:d,treeInfo:C,treeNodeSpace:16,isMultilineText:T,autoWrapText:b,lineHeight:w,lineClamp:m})}He(r,e,Dr,o,n),Ke(0,s(),e,o,l._cellStyle)}))},n.prototype.bindGridEvent=function(t,e){var n=this,o=function(e,n){if(t.dataSource instanceof Mr){var o=t.getRecordIndexByRow(e.row);t.dataSource.toggle(o,n)}};function r(n,o){return t.getLayoutCellId(n,o)===e}var i=function(e){if(r(e.col,e.row)&&!R(t.getRowRecord(e.row))){if(n._canToggle){var o=Wr(t,e.row);if(o&&!1===n._canToggle({col:e.col,event:e.event,row:e.row,treeInfo:o,type:"over"}))return}var i=t[jr],l=t[Fr];t.getElement().style.cursor=zr(t,e.col,e.row,e.event)||i&&i.mouseActive||l&&l.mouseActive?"pointer":""}},l=function(e){r(e.col,e.row)&&(t.getElement().style.cursor="")};return[t.listen(N.CLICK_CELL,(function(e){if(r(e.col,e.row)&&!R(t.getRowRecord(e.row))&&zr(t,e.col,e.row,e.event)){var i=Wr(t,e.row);if(i){var l=e.event.shiftKey,a=i.expanded?l?"collapseAll":"collapse":l?"expandAll":"expand",s={col:e.col,event:e.event,row:e.row,treeInfo:i,type:a};if(!n._canToggle||!1!==n._canToggle(s))return t.selectCellRange(e.col,e.row,e.col,e.row),o({col:e.col,row:e.row},l),n._toggled&&n._toggled(s),M.cancel(e.event),!1}}})),t.listen(N.MOUSEENTER_CELL,i),t.listen(N.MOUSEOVER_CELL,i),t.listen(N.MOUSEMOVE_CELL,i),t.listen(N.MOUSELEAVE_CELL,l),t.listen(N.MOUSEOUT_CELL,l),t.listen(N.KEYDOWN,(function(e){if(-1!==[K,V,37,39,U].indexOf(e.keyCode)&&(e.event.ctrlKey||e.event.metaKey)){var i=t.selection.select,l={col:i.col,row:i.row};if(r(l.col,l.row)&&!R(t.getRowRecord(l.row))){var a=Wr(t,l.row);if(a){var s;s=e.keyCode===K||39===e.keyCode?e.keyCode===K?"expandAll":"expand":e.keyCode===U||37===e.keyCode?e.keyCode===U?"collapseAll":"collapse":a.expanded?e.event.shiftKey?"collapseAll":"collapse":e.event.shiftKey?"expandAll":"expand";var c={col:l.col,event:e.event,row:l.row,treeInfo:a,type:s};if(!n._canToggle||!1!==n._canToggle(c))return e.keyCode===K||39===e.keyCode?function(e,n){if(t.dataSource instanceof Mr){var o=t.getRecordIndexByRow(e.row);t.dataSource.expand(o,n)}}(l,e.keyCode===K):e.keyCode===U||37===e.keyCode?function(e,n){if(t.dataSource instanceof Mr){var o=t.getRecordIndexByRow(e.row);t.dataSource.collapse(o,n)}}(l,e.keyCode===U):o(l,e.event.shiftKey),n._toggled&&n._toggled(c),M.cancel(e.event),a.isLeaf}}}}))]},n.prototype.drawEditingInternal=function(e,n,o,r,i){t.prototype.drawEditingInternal.call(this,e,n,o,r,i);var l=n.textAlign,a=n.textBaseline,s=n.color,c=Wr(r,e.row),u=n.textOverflow,h=n.autoWrapText,f=n.lineHeight,d=n.lineClamp,p=i.getRecord(),g=x(this.multilineText,p);o.tree("",e,{color:s,padding:We(e,o,n),textAlign:l,textBaseline:a,textOverflow:u,treeInfo:c,treeNodeSpace:16,isMultilineText:g,autoWrapText:h,lineHeight:f,lineClamp:d})},n}(zn),Vr=X(),Ur=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Pn},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.convertInternal=function(t){return Nt(t)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l,a=n.textAlign,s=n.textBaseline,u=n.checkColor,h=n.uncheckBorderColor,f=n.checkBorderColor,d=n.uncheckBgColor,p=n.checkBgColor,g=e.col,v=e.row,y=r.getCellRange(g,v),_=y.start.col+":"+y.start.row,b=null===(l=r[Vr])||void 0===l?void 0:l.elapsed[_],w={textAlign:a,textBaseline:s,checkColor:u,uncheckBorderColor:h,checkBorderColor:f,uncheckBgColor:d,checkBgColor:p};c(b)&&(w.animElapsedTime=b),o.radioButton(t,e,w)},n}(zn),Kr={DEFAULT:new zo,NUMBER:new dr,CHECK:new Ko,RADIO:new Ur,BUTTON:new Vo,IMAGE:new ar,MULTILINETEXT:new fr,DATE:new Xo,LOOKUP:new ur,SWITCH:new Yo,TREE:new Nr,DRAW:new $o};var Gr={action:{ACTIONS:Lo,BaseAction:lt,Editor:st,BaseCheckEditor:yt,BaseInputEditor:ut,BaseActionInput:ht,Action:at,CheckEditor:mt,RadioEditor:so,SwitchEditor:xt,ButtonAction:bt,SmallDialogInputEditor:Co,InlineInputEditor:Zt,InlineTextAreaEditor:io,InlineLookupEditor:ye,InlineMenuEditor:Xn,of:function t(e){if(e){if("string"==typeof e){var n=e.toUpperCase();return Lo[n]||t(null)}return e}}},type:{TYPES:Kr,BaseColumn:zn,BaseCheckColumn:So,Column:zo,NumberColumn:dr,CheckColumn:Ko,RadioColumn:Ur,SwitchColumn:Yo,ButtonColumn:Vo,ImageColumn:ar,PercentCompleteBarColumn:pr,IconColumn:Zo,BranchGraphColumn:Wo,MenuColumn:Nn,MultilineTextColumn:fr,DateColumn:Xo,LookupColumn:ur,TreeColumn:Nr,DrawColumn:$o,of:function t(e){if(e){if("string"==typeof e){var n=e.toUpperCase();return Kr[n]||t(null)}return e}return Kr.DEFAULT}},style:{EVENT_TYPE:An,BaseStyle:rn,BaseStdStyle:ln,BaseCheckStyle:an,Style:sn,NumberStyle:Sn,CheckStyle:un,RadioStyle:Pn,SwitchStyle:hn,ButtonStyle:cn,ImageStyle:En,IconStyle:Rn,PercentCompleteBarStyle:Tn,MultilineTextStyle:kn,MenuStyle:Ln,DateStyle:Cn,LookupStyle:On,TreeStyle:Bn,DrawStyle:xn,of:Mn}},Yr="p";function Xr(t){return new Error("calc parse error: "+t)}var qr={"*":3,"/":3,"+":2,"-":2};function $r(t,e){var n;function o(t){var n=t.pop(),o=t.pop(),r=t.pop();if(!(r&&r.nodeType&&o&&"o"===o.type&&n&&n.nodeType))throw Xr(e);return{nodeType:"b",left:r,op:o,right:n}}for(var r=[],i=function(){var i=t.shift();if(i.type===Yr&&"("===i.value){var l=0,a=s.findIndex(t,(function(t){if(t.type===Yr&&"("===t.value)l++;else if(t.type===Yr&&")"===t.value){if(!l)return!0;l--}return!1}));if(-1===a)throw Xr(e);r.push($r(t.slice(0,a),e)),t.splice(0,a+1)}else if("o"===i.type){if(r.length>=3){var c=r[r.length-2].value;qr[i.value]<=qr[c]&&r.push(o(r))}r.push(i)}else if("u"===i.type){var u=i.value,h=parseFloat(u),f=(null===(n=/[a-z%]+/i.exec(u))||void 0===n?void 0:n[0])||"";r.push({nodeType:"u",value:h,unit:f})}else"n"===i.type&&r.push({nodeType:"n",value:parseFloat(i.value)})};t.length;)i();for(;r.length>1;)r.push(o(r));return r[0]}function Zr(t){return $r(function(t){for(var e,n=t.replace(/calc\(/g,"("),o=/^[-+]?(\d*\.\d+|\d+)[a-z%]+/i,r=/^[-+]?(\d*\.\d+|\d+)/i,i=/^[-+*/]/,l=[];n=n.trim();)if("("===n[0]||")"===n[0])l.push({value:n[0],type:Yr}),n=n.slice(1);else if(e=o.exec(n))l.push({value:e[0],type:"u"}),n=n.slice(e[0].length);else if(e=r.exec(n))l.push({value:e[0],type:"n"}),n=n.slice(e[0].length);else{if(!(e=i.exec(n)))throw Xr(t);l.push({value:e[0],type:"o"}),n=n.slice(e[0].length)}return l}(t),t)}function Jr(t,e){if("b"===t.nodeType){var n=Jr(t.left,e),o=Jr(t.right,e);switch(t.op.value){case"+":return n+o;case"-":return n-o;case"*":return n*o;case"/":return n/o;default:throw new Error("calc error. unknown operator: "+t.op.value)}}else if("u"===t.nodeType)switch(t.unit){case"%":return t.value*e.full/100;case"em":return t.value*e.em;case"px":return t.value;default:throw new Error("calc error. unknown unit: "+t.unit)}else if("n"===t.nodeType)return t.value;throw new Error("calc error.")}function Qr(t,e){return Jr(Zr(t),e)}function ti(t,e){return"string"==typeof t?Qr(t.trim(),e):t-0}var ei,ni=new Bt;function oi(){a?ei=1:(ei=Math.ceil(window.devicePixelRatio||1))>1&&ei%2!=0&&(ei+=1)}oi(),a||ni.on(window,"resize",oi);var ri=function(t){var e,n=t.getContext("2d"),o=t.getAttribute,r=t.setAttribute;if(t.getAttribute=(e=t,function(t){var n=o.apply(e,[t]);return"width"!==t&&"height"!==t||(n/=ei),n}),t.setAttribute=function(t){return function(e,o){var i="width"===e||"height"===e;i&&(o=ei*Number(o)+"");var l=r.apply(t,[e,o]);return i&&n&&n.scale(ei,ei),l}}(t),Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return t.getAttribute("width")},set:function(e){t.setAttribute("width",Math.floor(e)+"")}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return t.getAttribute("height")},set:function(e){t.setAttribute("height",Math.floor(e)+"")}}),n){var i=n.drawImage;n.drawImage=function(e){return function(n){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];if(n!==t||1===ei)return i.apply(e,[n].concat(o));e.save();try{return e.scale(1/ei,1/ei),o.length>4?(o[4]*=ei,o[5]*=ei):(o[0]*=ei,o[1]*=ei),i.apply(e,[n].concat(o))}finally{e.restore()}}}(n)}return t},ii=function(){function t(){this._keys=[],this._vals={},this._sorted=!1}return t.prototype.put=function(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e},t.prototype.get=function(t){return this._vals[t]},t.prototype.has=function(t){return null!==this._vals[t]},t.prototype.each=function(t,e,n){var o=this._keys,r=o.length;this._sorted||(o.sort((function(t,e){return t<e?-1:t>e?1:0})),this._sorted=!0);for(var i=function(t,e){for(var n=0,o=t.length-1;n<=o;){var r=Math.floor((n+o)/2);if(t[r]===e)return r;t[r]>e?o=r-1:n=r+1}return o<0?0:o}(o,t);i<r;i++){var l=o[i];if(t<=l&&l<=e)n(this.get(l),l);else if(e<l)return}},t}(),li=P-1e3,ai=function(){function t(){var t=this;this._handler=new Bt,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._perfectScrollbar=new window.PerfectScrollbar(this._scrollable,{minScrollbarLength:24}),this._handler.on(this._scrollable,"click",(function(e){e.target!==t._scrollable&&M.cancel(e)})),this._p=1,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}return t.prototype.calcTop=function(t){var e=t-this.scrollTop;return this._scrollable.scrollTop+e},t.prototype.getElement=function(){return this._scrollable},t.prototype.setScrollSize=function(t,e){this._width=t,this._height=e,this._update()},Object.defineProperty(t.prototype,"scrollWidth",{get:function(){return this._width},set:function(t){this._width=t,this._update()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollHeight",{get:function(){return this._height},set:function(t){this._height=t,this._update()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollLeft",{get:function(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)},set:function(t){this._scrollable.scrollLeft=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollTop",{get:function(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)},set:function(t){this._scrollable.scrollTop=t*this._p},enumerable:!1,configurable:!0}),t.prototype.onScroll=function(t){this._handler.on(this._scrollable,"scroll",t)},t.prototype.dispose=function(){this._handler.dispose()},t.prototype.update=function(){this._update()},t.prototype._update=function(){var t;if(this._height>li){var e=Ft.getScrollBarSize(),n=this._scrollable.offsetHeight,o=li-n+e,r=this._height-n+e;this._p=o/r,t=li}else this._p=1,t=this._height;t-=1;var i=this._width-1;this._endPointElement.style.top=t.toFixed()+"px",this._endPointElement.style.left=i.toFixed()+"px",this._perfectScrollbar.update()},t}(),si=P-1e3,ci=function(){function t(t){this._canvas=t,this._handler=new Bt,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._p=1,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}return t.prototype.calcTop=function(t){var e=t-this.scrollTop;return this._scrollable.scrollTop+e},t.prototype.getElement=function(){return this._scrollable},t.prototype.setScrollSize=function(t,e){this._width=t,this._height=e,this._update()},Object.defineProperty(t.prototype,"scrollWidth",{get:function(){return this._width},set:function(t){this._width=t,this._update()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollHeight",{get:function(){return this._height},set:function(t){this._height=t,this._update()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollLeft",{get:function(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)},set:function(t){this._scrollable.scrollLeft=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollTop",{get:function(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)},set:function(t){this._scrollable.scrollTop=t*this._p},enumerable:!1,configurable:!0}),t.prototype.onScroll=function(t){this._handler.on(this._scrollable,"scroll",t)},t.prototype.dispose=function(){this._handler.dispose()},t.prototype.update=function(){this._update()},t.prototype._update=function(){var t,e=Ft.getScrollBarSize();if(this._height>si){var n=this._scrollable.offsetHeight,o=si-n+e,r=this._height-n+e;this._p=o/r,t=si}else this._p=1,t=this._height;var i=this._width,l=t>this._canvas.height?t:t-e,a=i>this._canvas.width?i:i-e;this._endPointElement.style.top=l.toFixed()+"px",this._endPointElement.style.left=a.toFixed()+"px";var s=Math.max(0,l-this._canvas.height);this._scrollable.scrollTop>s&&(this._scrollable.scrollTop=s);var c=Math.max(0,a-this._canvas.width);this._scrollable.scrollLeft>c&&(this._scrollable.scrollLeft=c)},t}(),ui=function(){function t(t){this._grid=t,this._handler=new Bt,this._events={},this._started=!1,this._moved=!1,this._mouseEndPoint=null}return Object.defineProperty(t.prototype,"grid",{get:function(){return this._grid},enumerable:!1,configurable:!0}),t.prototype.moving=function(t){return!!this._started},t.prototype.lastMoving=function(t){if(this.moving(t))return!0;var e=this._mouseEndPoint;if(!e)return!1;var n=this._grid._getMouseAbstractPoint(t);return!!n&&n.x===e.x&&n.y===e.y},t.prototype.dispose=function(){this._handler.dispose()},t.prototype._bindMoveAndUp=function(t){var e=this,n=this._events,o=this._handler;M.isTouchEvent(t)?(n.touchmove=o.on(document.body,"touchmove",(function(t){return e._mouseMove(t)}),{passive:!1}),n.touchend=o.on(document.body,"touchend",(function(t){return e._mouseUp(t)})),n.touchcancel=o.on(document.body,"touchcancel",(function(t){return e._mouseUp(t)}))):(n.mousemove=o.on(document.body,"mousemove",(function(t){return e._mouseMove(t)})),n.mouseup=o.on(document.body,"mouseup",(function(t){return e._mouseUp(t)}))),this._started=!0,this._moved=!1},t.prototype._mouseMove=function(t){M.isTouchEvent(t)||1===M.getMouseButtons(t)?(this._moved=this._moveInternal(t)||this._moved,M.cancel(t)):this._mouseUp(t)},t.prototype._mouseUp=function(t){var e=this,n=this._events,o=this._handler;o.off(n.mousemove),o.off(n.touchmove),o.off(n.mouseup),o.off(n.touchend),o.off(n.touchcancel),this._upInternal(t),this._moved?(this._mouseEndPoint=this._grid._getMouseAbstractPoint(t),setTimeout((function(){e._mouseEndPoint=null,e._started=!1}),10)):this._started=!1,M.cancel(t)},t.prototype._upInternal=function(t){},t.prototype._vibrate=function(t){navigator.vibrate&&M.isTouchEvent(t)&&navigator.vibrate(50)},t}(),hi=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._cell={col:-1,row:-1},e}return e(n,t),n.prototype.start=function(t){var e=this._getTargetCell(t);if(!e)return this.grid._forceFocusCell(),void M.cancel(t);this.grid.fireListeners(N.MOUSE_SELECTED_START,t),this.grid._moveFocusCell(e.col,e.row,t.shiftKey),this._bindMoveAndUp(t),this._cell=e,M.cancel(t),this._vibrate(t)},n.prototype.select=function(t){var e=this._getTargetCell(t);e&&(this.grid._moveFocusCell(e.col,e.row,t.shiftKey),this._cell=e)},n.prototype._upInternal=function(t){this.grid.fireListeners(N.MOUSE_SELECTED_END,t)},n.prototype._moveInternal=function(t){var e=this._getTargetCell(t);if(!e)return!1;var n=this._cell.col,o=this._cell.row,r=e.col,i=e.row;if(n===r&&o===i)return!1;var l=this.grid;l._moveFocusCell(r,i,!0,!0);var a=r<n&&0<r?r-1:n<r&&r+1<l.colCount?r+1:r,s=i<o&&0<i?i-1:o<i&&i+1<l.rowCount?i+1:i;return a===r&&s===i||l.makeVisibleCell(a,s),this._cell=e,!0},n.prototype._getTargetCell=function(t){var e=this.grid,n=e._getMouseAbstractPoint(t);if(!n)return null;var o=e.getCellAt(n.x,n.y);return o.col<0||o.row<0?null:o},n}(ui),fi=function(t){function n(e){var n=t.call(this,e)||this;return n._targetCol=-1,n._x=0,n._preX=0,n._invalidateAbsoluteLeft=0,n}return e(n,t),n.prototype.start=function(t,e){var n;n=M.isTouchEvent(e)?e.changedTouches[0].pageX:e.pageX,this._x=n,this._preX=0,this.grid._resetColWidthOffset(t),this._bindMoveAndUp(e),this._targetCol=t,M.cancel(e),this._vibrate(e)},n.prototype._moveInternal=function(t){var e=(M.isTouchEvent(t)?t.changedTouches[0].pageX:t.pageX)-this._x,n=e-this._preX;this._preX=e;var o=this.grid.getColWidth(this._targetCol),r=this.grid._adjustColWidth(this._targetCol,o+n);r<10&&n<0&&(r=10),this.grid._storeAutoColWidthExprs(),this.grid.setColWidth(this._targetCol,r);var i=this.grid._getVisibleRect();return i.left=this._invalidateAbsoluteLeft,this.grid._invalidateRect(i),this.grid.fireListeners(N.RESIZE_COLUMN,{col:this._targetCol}),!0},n.prototype._upInternal=function(t){this.grid.updateScroll()&&this.grid.invalidate()},n}(ui);function di(t,e,n,o){return{start:{col:t,row:e},end:{col:n,row:o}}}var pi=function(){function t(t,e,n,o,r,i,l,a){this._rectFilter=null,this._col=t,this._row=e,this._mode=0,this._range=di(t,e,t,e),this._ctx=n,this._rect=o,this._drawRect=r,this._drawing=i,this._selection=l,this._drawLayers=a,this._childContexts=[]}return Object.defineProperty(t.prototype,"drawing",{get:function(){return 0!==this._mode||this._drawing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:!1,configurable:!0}),t.prototype.cancel=function(){this._cancel=!0,this._childContexts.forEach((function(t){t.cancel()}))},t.prototype.getSelection=function(){return{border:this._selection.border(this._col,this._row),dragged:this._selection.drag.inDrag(this._col,this._row),select:this._selection.drag.select,range:this._selection.range}},t.prototype.getContext=function(){return 0===this._mode?this._ctx:this._grid._getInitContext()},t.prototype.getRect=function(){var t=this._rectFilter;return t?t(this._getRectInternal()):this._getRectInternal()},t.prototype.setRectFilter=function(t){this._rectFilter=t},t.prototype.getDrawRect=function(){if(this._cancel)return null;if(0===this._mode)return this._drawRect;if(this._isOutOfRange())return null;var t=this._grid.getCellRect(this._col,this._row);return this._toRelativeDrawRect(t)},t.prototype.toCurrentContext=function(){if(0===this._mode)return this;var e=this._grid.getCellRect(this._col,this._row),n=this._grid._toRelativeRect(e),o=this._isOutOfRange()?null:this._toRelativeDrawRect(e),r=new t(this._col,this._row,this.getContext(),n,o,this.drawing,this._selection,this._drawLayers);return r.toCurrentContext=this.toCurrentContext.bind(this),this._childContexts.push(r),this._cancel&&r.cancel(),r._rectFilter=this._rectFilter,r},t.prototype.addLayerDraw=function(t,e){this._drawLayers.addDraw(t,e)},t.prototype._delayMode=function(t,e){this._mode=1,this._ctx=null,this._rect=null,this._drawRect=null,this._grid=t,this._onTerminate=e},t.prototype.terminate=function(){var t;0!==this._mode&&(null===(t=this._onTerminate)||void 0===t||t.call(this))},t.prototype._getRectInternal=function(){return 0===this._mode||this._rect?this._rect:this._grid.getCellRelativeRect(this._col,this._row)},t.prototype._isOutOfRange=function(){var t=this._grid,e=t.colCount,n=t.rowCount;return e<=this._col||n<=this._row},t.prototype._toRelativeDrawRect=function(t){var e=this._grid,n=e._getVisibleRect(),o=t.copy();if(!o.intersection(n))return null;var r=e.isFrozenCell(this._col,this._row);if(e.frozenColCount>=0&&(!r||!r.col)){var i=e.getCellRect(e.frozenColCount-1,this._row);o=je.bounds(Math.max(o.left,i.right),o.top,o.right,o.bottom)}if(e.frozenRowCount>=0&&(!r||!r.row)){i=e.getCellRect(this._col,e.frozenRowCount-1);o=je.bounds(o.left,Math.max(o.top,i.bottom),o.right,o.bottom)}return o.intersection(n)?(o.offsetLeft(-n.left),o.offsetTop(-n.top),o):null},t}(),gi=function(){function t(t){this._level=t,this._list=[]}return Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),t.prototype.addDraw=function(t){this._list.push(t)},t.prototype.draw=function(t){this._list.forEach((function(e){t.save();try{e(t)}finally{t.restore()}}))},t}(),vi=function(){function t(){this._layers={}}return t.prototype.addDraw=function(t,e){(this._layers[t]||(this._layers[t]=new gi(t))).addDraw(e)},t.prototype.draw=function(t){var e=[];for(var n in this._layers)this._layers.hasOwnProperty(n)&&e.push(this._layers[n]);e.sort((function(t,e){return t.level-e.level})),e.forEach((function(e){return e.draw(t)}))},t}();function yi(t,e){var n=t.type;t.type="",t.value=e,n&&(t.type=n)}var _i=function(t){function n(e,n,o){var r=t.call(this)||this;r._isComposition=!1,r._grid=e,r._scrollable=o;var i,l=r._handler=new Bt,a=r._input=document.createElement("input");a.classList.add("grid-focus-control"),a.readOnly=!0,n.appendChild(a),l.on(a,"compositionstart",(function(t){a.classList.add("composition"),a.style.font=e.font||"16px sans-serif",r._isComposition=!0,r._compositionEnd&&(clearTimeout(r._compositionEnd),delete r._compositionEnd),e.focus()}));var u=function(){i=a.value,r._isComposition||""!==i&&yi(a,"")},h=function(){r._isComposition=!1,a.classList.remove("composition"),a.style.font="";var t=a.value;u(),a.readOnly||r.fireListeners("input",t),r._compositionEnd&&(clearTimeout(r._compositionEnd),delete r._compositionEnd)};l.on(a,"compositionend",(function(t){r._compositionEnd=setTimeout(h,0)})),l.on(a,"keypress",(function(t){if(!r._isComposition){if(!a.readOnly&&t.key&&1===t.key.length)if(t.ctrlKey||t.metaKey)"c"===t.key||"v"===t.key||t.key;else{if(" "===t.key)return;r.fireListeners("input",t.key),M.cancel(t)}u()}})),l.on(a,"keydown",(function(t){var e;if(r._isComposition)r._compositionEnd&&(h(),M.cancel(t));else{var n=M.getKeyCode(t),o=!1,l={keyCode:n,event:t,stopCellMoving:function(){o=!0}},c=r.fireListeners("keydown",l);s.findIndex(c,(function(t){return!1===t}))>=0||(!a.readOnly&&i&&T&&r.fireListeners("input",i),o||r.fireKeyDownMove(n,t),!(null===(e=r._grid.keyboardOptions)||void 0===e?void 0:e.deleteCellValueOnDel)||46!==n&&8!==n||r.fireListeners("delete",t),u())}})),l.on(a,"keyup",(function(t){r._isComposition&&r._compositionEnd&&h(),u()})),l.on(a,"input",(function(t){" "!==t.data&&"　"!==t.data||r.fireListeners("input",t.data),u()})),k&&l.on(document,"keydown",(function(t){if(t.target===a){var e=M.getKeyCode(t);67===e&&t.ctrlKey?(yi(a,"dummy"),a.select(),setTimeout((function(){yi(a,"")}),100)):86===e&&t.ctrlKey&&a.readOnly&&(a.readOnly=!1,setTimeout((function(){a.readOnly=!0,yi(a,"")}),10))}})),S&&l.once(document,"keydown",(function(t){if(w(n,t.target)){var o=document.createElement("input");e.getElement().appendChild(o),o.focus(),a.focus(),o.parentElement&&o.parentElement.removeChild(o)}})),l.on(document,"paste",(function(t){if(!r._isComposition&&w(n,t.target)){var e;if(setTimeout((function(){u()}),100),k)e=window.clipboardData.getData("Text");else{var o=t.clipboardData;o&&(o.items?e=o.getData("text/plain"):-1!==Array.prototype.indexOf.call(o.types,"text/plain")&&(e=o.getData("Text")))}c(e)&&e.length&&r.fireListeners("paste",{value:e,event:t})}}));var f=function(t,e){var n;c(t)&&(M.cancel(e),k?(n=window.clipboardData)&&n.setData("Text",t):(n=e.clipboardData)&&n.setData("text/plain",t))};return l.on(document,"copy",(function(t){if(!r._isComposition&&w(n,t.target)){yi(a,"");var e=s.find(r.fireListeners("copy",t),c);f(e,t)}})),l.on(document,"cut",(function(t){if(!r._isComposition&&w(n,t.target)){yi(a,"");var e=s.find(r.fireListeners("cut",t),c);f(e,t)}})),l.on(a,"focus",(function(t){r.fireListeners("focus",t)})),l.on(a,"blur",(function(t){r.fireListeners("blur",t)})),r}return e(n,t),n.prototype.fireKeyDownMove=function(t,e){var n,o,r,i=this._keyDownMoveCallback;i&&(this._isComposition||(37===t||t===U||39===t||t===K||36===t||35===t||(null===(n=this._grid.keyboardOptions)||void 0===n?void 0:n.moveCellOnTab)&&9===t||(null===(o=this._grid.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter)&&t===V||(null===(r=this._grid.keyboardOptions)||void 0===r?void 0:r.selectAllOnCtrlA)&&65===t&&(e.ctrlKey||e.metaKey))&&i(e))},n.prototype.onKeyDownMove=function(t){this._keyDownMoveCallback=t},n.prototype.onKeyDown=function(t){return this.listen("keydown",t)},n.prototype.onInput=function(t){return this.listen("input",t)},n.prototype.onDelete=function(t){return this.listen("delete",t)},n.prototype.onCopy=function(t){return this.listen("copy",t)},n.prototype.onPaste=function(t){return this.listen("paste",t)},n.prototype.onCut=function(t){return this.listen("cut",t)},n.prototype.onFocus=function(t){return this.listen("focus",t)},n.prototype.onBlur=function(t){return this.listen("blur",t)},n.prototype.focus=function(){this._input.focus()},n.prototype.setFocusRect=function(t){var e=this._input,n=this._scrollable.calcTop(t.top);e.style.top=(n-Ft.getScrollBarSize()).toFixed()+"px",e.style.left=t.left.toFixed()+"px",e.style.width=t.width.toFixed()+"px",e.style.height=t.height.toFixed()+"px"},Object.defineProperty(n.prototype,"editMode",{get:function(){return!this._input.readOnly},set:function(t){this._input.readOnly=!t},enumerable:!1,configurable:!0}),n.prototype.resetInputStatus=function(){var t,e=this._input;if(e.classList.contains("grid-focus-control--stored-status")){for(var n=e.classList.contains("composition"),o=e.attributes,r=[],i=0,l=o.length;i<l;i++){var a=o[i];(null===(t=this._inputStatus)||void 0===t?void 0:t.hasOwnProperty(a.nodeName))||r.push(a.name)}for(var s in r.forEach((function(t){e.removeAttribute(t)})),this._inputStatus)this._inputStatus.hasOwnProperty(s)&&e.setAttribute(s,this._inputStatus[s]);n?(e.classList.add("composition"),e.style.font=this._grid.font||"16px sans-serif"):e.classList.remove("composition"),e.classList.remove("grid-focus-control--stored-status")}},n.prototype.storeInputStatus=function(){var t=this._input;if(!t.classList.contains("grid-focus-control--stored-status")){for(var e=this._inputStatus={},n=t.attributes,o=0,r=n.length;o<r;o++){var i=n[o];e[i.name]=i.value}t.classList.add("grid-focus-control--stored-status")}},n.prototype.setDefaultInputStatus=function(){},Object.defineProperty(n.prototype,"input",{get:function(){return this._input},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){t.prototype.dispose.call(this),this._handler.dispose()},n}(Xe),bi=function(t){function n(e,n){var o=t.call(this)||this;return o._isWraped=!1,o._grid=e,o._sel={col:0,row:0},o._focus={col:0,row:0},o._start={col:0,row:0},o._end={col:0,row:0},o._updateRange=n,o}return e(n,t),Object.defineProperty(n.prototype,"range",{get:function(){var t=this._start,e=this._end,n=Math.min(t.col,e.col),o=Math.min(t.row,e.row);return{end:{col:Math.max(t.col,e.col),row:Math.max(t.row,e.row)},start:{col:n,row:o}}},set:function(t){var e=this,n=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),r=Math.max(t.start.col,t.end.col),i=Math.max(t.start.row,t.end.row);this._wrapFireSelectedEvent((function(){e._setSelectCell(n,o),e._setFocusCell(r,i,!0),e._grid._updatedSelection()}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"focus",{get:function(){return{col:this._focus.col,row:this._focus.row}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"select",{get:function(){return{col:this._sel.col,row:this._sel.row}},set:function(t){var e=this;this._wrapFireSelectedEvent((function(){var n=t||{},o=n.col,r=void 0===o?0:o,i=n.row,l=void 0===i?0:i;e._setSelectCell(r,l),e._setFocusCell(r,l,!0),e._grid._updatedSelection()}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dragging",{get:function(){return!!this._drag},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"drag",{get:function(){var t=this;return{get select(){var e=t._drag?t._drag.sel:t._sel;return{col:e.col,row:e.row}},get range(){var e=t._drag?t._drag.start:t._start,n=t._drag?t._drag.end:t._end,o=Math.min(e.col,n.col),r=Math.min(e.row,n.row);return{end:{col:Math.max(e.col,n.col),row:Math.max(e.row,n.row)},start:{col:o,row:r}}},inRange:function(t,e){var n=this.range.start.col,o=this.range.start.row,r=this.range.end.col,i=this.range.end.row;return n<=t&&t<=r&&o<=e&&e<=i},inDrag:function(e,n){var o=this.inRange(e,n),r=t.inRange(e,n);return o&&!r||!o&&r}}},enumerable:!1,configurable:!0}),n.prototype.inRange=function(t,e){var n=Math.min(this._start.col,this._end.col),o=Math.min(this._start.row,this._end.row),r=Math.max(this._start.col,this._end.col),i=Math.max(this._start.row,this._end.row);return n<=t&&t<=r&&o<=e&&e<=i},n.prototype.border=function(t,e){var n=this.range,o=n.start.col<=t&&t<=n.end.col&&n.start.row<=e&&e<=n.end.row;return{bottom:!!o&&n.end.row===e,left:!!o&&n.start.col===t,right:!!o&&n.end.col===t,top:!!o&&n.start.row===e}},n.prototype.fireSelectedEvent=function(){this._wrapFireSelectedEvent((function(){}))},n.prototype.startDrag=function(){this._drag={end:this._end,focus:this._focus,sel:this._sel,start:this._start}},n.prototype.stopDrag=function(){if(this._drag){this.fireListeners(N.SELECTED_CELL,{after:{col:this._sel.col,row:this._sel.row},col:this._drag.sel.col,row:this._drag.sel.row,selected:!1}),this.fireListeners(N.SELECTED_CELL,{before:{col:this._drag.sel.col,row:this._drag.sel.row},col:this._sel.col,row:this._sel.row,selected:!0});var t=this.drag.range.start.col,e=this.drag.range.start.row,n=this.drag.range.end.col,o=this.drag.range.end.row,r=this.range.start.col,i=this.range.start.row,l=this.range.end.col,a=this.range.end.row;delete this._drag,this._grid.invalidateGridRect(t,e,n,o),this._grid.invalidateGridRect(r,i,l,a)}},n.prototype._updateGridRange=function(){for(var t=this._grid,e=t.rowCount,n=t.colCount,o=[this._sel,this._focus,this._start,this._end],r=!1,i=0,l=o;i<l.length;i++){var a=l[i];if(n<=a.col||e<=a.row){r=!0;break}}return!!(r&&e&&n)&&(this._wrapFireSelectedEvent((function(){o.forEach((function(t){t.col=Math.min(n-1,t.col),t.row=Math.min(e-1,t.row)}))})),!0)},n.prototype._setFocusCell=function(t,e,n){var o=this;this._wrapFireSelectedEvent((function(){!n||o._grid.singleSelection?o._setSelectCell(t,e):o._setSelectCell(o._sel.col,o._sel.row),o._focus={col:t,row:e},o._end={col:t,row:e}}))},n.prototype._forceUpdateRange=function(){var t=this._updateRange(this.range);t&&(this._start=t.start,this._end=t.end)},n.prototype._setSelectCell=function(t,e){var n=this;this._wrapFireSelectedEvent((function(){n._sel={col:t,row:e},n._start={col:t,row:e}}))},n.prototype._wrapFireSelectedEvent=function(t){if(this._isWraped)t();else{this._isWraped=!0;try{var e={end:{col:this._end.col,row:this._end.row},focus:{col:this._focus.col,row:this._focus.row},sel:{col:this._sel.col,row:this._sel.row},start:{col:this._start.col,row:this._start.row}},n={col:this._sel.col,row:this._sel.row,selected:!1};t(),this._forceUpdateRange();var o={before:{col:n.col,row:n.row},col:this._sel.col,row:this._sel.row,selected:!0};if(n.after={col:o.col,row:o.row},!this.dragging){var r=this.fireListeners(N.SELECTED_CELL,n);s.findIndex(r,(function(t){return!1===t}))>=0?(this._end=e.end,this._focus=e.focus,this._sel=e.sel,this._start=e.start):this.fireListeners(N.SELECTED_CELL,o)}}finally{this._isWraped=!1}}},n}(Xe),wi=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._oldRange=di(-1,-1,-1,-1),e._newRange=di(-1,-1,-1,-1),e._cell={col:-1,row:-1},e}return e(n,t),n.prototype.start=function(t){var e=this._getTargetCellAndRange(t);if(!e)return!1;this._oldRange=this.grid.selection.range,this.grid.selection.startDrag(),this._bindMoveAndUp(t),this._newRange=e.range,this._cell=e.cell,M.cancel(t),this._vibrate(t)},n.prototype.canStart=function(){return s.find(this.grid.fireListeners(N.CAN_DRAG_SELECTION,this.grid.selection.range),(function(t){return!0===t}))},n.prototype._moveInternal=function(t){var e=this._getTargetCellAndRange(t);if(!e||!this._oldRange)return!1;var n=e.range,o=e.cell;if(n.start.col===this._newRange.start.col&&n.start.row===this._newRange.start.row&&n.end.col===this._newRange.end.col&&n.end.row===this._newRange.end.row)return!1;if(!1===s.find(this.grid.fireListeners(N.DRAG_SELECTION,{dragDone:!1,newRange:n,oldRange:this._oldRange}),(function(t){return!1===t})))return!1;var r=this._cell.col,i=this._cell.row,l=o.col,a=o.row;if(r===l&&i===a)return!1;var c=this.grid;c._moveFocusCell(n.start.col,n.start.row,!1,!0),c._moveFocusCell(n.end.col,n.end.row,!0,!0);var u=l<r&&0<l?l-1:r<l&&l+1<c.colCount?l+1:l,h=a<i&&0<a?a-1:i<a&&a+1<c.rowCount?a+1:a;return u===l&&h===a||c.makeVisibleCell(u,h),this._newRange=n,this._cell=o,!0},n.prototype._upInternal=function(t){this.grid.fireListeners(N.DRAG_SELECTION,{dragDone:!0,newRange:this._newRange,oldRange:this._oldRange}),this.grid.selection.stopDrag()},n.prototype._getTargetCellAndRange=function(t){var e=this.grid,n=e._getMouseAbstractPoint(t);if(!n)return null;if(!this._oldRange)return null;var o=this._oldRange.start.col,r=this._oldRange.start.row,i=this._oldRange.end.col,l=this._oldRange.end.row,a=n.x,s=n.y,c=e.getCellAt(a,s);if(c.col<0||c.row<0)return null;var u=e.getCellRect(this._oldRange.start.col,this._oldRange.start.row),h=e.getCellRect(this._oldRange.end.col,this._oldRange.end.row),f=u.top,d=u.left,p=h.right,g=h.bottom,v=d,y=f,_=p,b=g,w=(y-b)*a+(_-v)*s+v*b-_*y<=0,m=((y=f)-(b=g))*a+((_=d)-(v=p))*s+v*b-_*y>0;return c.row>=r&&c.row<=l&&c.col>=o&&c.col<=i?w?l=c.row:i=c.col:w&&m?r=c.row:w&&!m?i=c.col:!w&&m?o=c.col:l=c.row,{cell:c,range:di(o,r,i,l)}},n}(ui);function mi(t){var e=t.replace(/\r?\n$/,"").split(/(?:\r?\n)|[\u2028\u2029]/g).map((function(t){return t.split(/\t/g)}));return{colCount:e.reduce((function(t,e){return Math.max(t,e.length)}),0),rowCount:e.length,getCellValue:function(t,n){var o;return(null===(o=e[n])||void 0===o?void 0:o[t])||""}}}var Ci=G("protected.draw_grid");function xi(t){var e=this,n=this.getTargetRowAtInternal(t);if(c(n))return n;var o=Math.min(Math.ceil(t/this.defaultRowHeight),this.rowCount-1),r=Yi.call(this,0,o);return t>=r?function(n,o){for(var r=o-Gi.call(e,n),i=e[Ci].rowCount,l=n;l<i;l++){var a=r+Gi.call(e,l);if(r<=t&&t<a)return{row:l,top:r};r=a}return null}(o,r):function(n,o){for(var r=o,i=n;i>=0;i--){var l=r-Gi.call(e,i);if(l<=t&&t<r)return{row:i,top:l};r=l}return null}(o,r)}function Ri(t){for(var e=0,n=this[Ci].colCount,o=0;o<n;o++){var r=e+Ui.call(this,o);if(r>t)return{col:o,left:e};e=r}return null}function Ei(t){if(!this[Ci].frozenRowCount)return null;for(var e=this[Ci].scroll.top,n=this[Ci].frozenRowCount,o=0;o<n;o++){var r=e+Gi.call(this,o);if(r>t)return{row:o,top:e};e=r}return null}function Oi(t){if(!this[Ci].frozenColCount)return null;for(var e=this[Ci].scroll.left,n=this[Ci].frozenColCount,o=0;o<n;o++){var r=e+Ui.call(this,o);if(r>t)return{col:o,left:e};e=r}return null}function Li(){if(!this[Ci].frozenRowCount)return null;for(var t=this[Ci].scroll.top,e=0,n=this[Ci].frozenRowCount,o=0;o<n;o++)e+=Gi.call(this,o);return new je(this[Ci].scroll.left,t,this[Ci].canvas.width,e)}function ki(){if(!this[Ci].frozenColCount)return null;for(var t=this[Ci].scroll.left,e=0,n=this[Ci].frozenColCount,o=0;o<n;o++)e+=Ui.call(this,o);return new je(t,this[Ci].scroll.top,e,this[Ci].canvas.height)}function Si(t,e){return this[Ci].drawCells[e]?this[Ci].drawCells[e][t]:null}function Ii(t,e,n){this[Ci].drawCells[e]||(this[Ci].drawCells[e]={}),this[Ci].drawCells[e][t]=n}function Ti(t,e){this[Ci].drawCells[e]&&(delete this[Ci].drawCells[e][t],0===Object.keys(this[Ci].drawCells[e]).length&&delete this[Ci].drawCells[e])}function Pi(t,e,n,o,r,i,l,a,s,c,u){var h=this,f=new je(n-a.left,i-a.top,o,l),d=je.bounds(Math.max(n,c)-a.left,Math.max(i,s)-a.top,f.right,f.bottom);if(d.height>0&&d.width>0){t.save();try{var p=Si.call(this,e,r);p&&p.cancel();var g=new pi(e,r,t,f,d,!!p,this[Ci].selection,u),v=this.onDrawCell(e,r,g);if(R(v)){Ii.call(this,e,r,g);var y=e;g._delayMode(this,(function(){Ti.call(h,y,r)})),v.then((function(){g.terminate()}))}}finally{t.restore()}}}function Bi(t,e,n,o,r,i,l,a,s,c){var u=this,h=this[Ci].colCount,f=function(e,n){if(e>=h-1&&u[Ci].canvas.width>n-a.left){var o=n-a.left;"transparent"===u.underlayBackgroundColor?t.clearRect(o,i-a.top,u[Ci].canvas.width-o,l):(t.save(),t.beginPath(),t.fillStyle=u.underlayBackgroundColor||"#F6F6F6",t.rect(o,i-a.top,u[Ci].canvas.width-o,l),t.fill(),t.restore())}},d=0;if(e){for(var p=e.left,g=this[Ci].frozenColCount,v=e.col;v<g;v++){var y=Ui.call(this,v);if(Pi.call(this,t,v,p,y,r,i,l,a,s,0,c),o<=(p+=y))return void f(v,p)}d=p}if(n){var _=n.left;for(v=n.col;v<h;v++){y=Ui.call(this,v);if(Pi.call(this,t,v,_,y,r,i,l,a,s,d,c),o<=(_+=y))return void f(v,_)}f(h-1,_)}}var Ai=!1;function Mi(t,e){var n=ti(e,t[Ci].calcWidthContext);return Ai?n:Math.floor(n)}function Di(t,e){try{return Ai=!0,t.getColWidth(e)}finally{Ai=!1}}function ji(t,e){return this._adjustColWidth(t,e)}function Fi(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}function Wi(t){var e=this[Ci].colWidthsMap.get(t);return e||this.defaultColWidth}function Hi(t){var e=this[Ci].colWidthsLimit[t];if(!e)return null;var n={};return e.min&&(n.min=Mi(this,e.min),n.minDef=e.min),e.max&&(n.max=Mi(this,e.max),n.maxDef=e.max),n}function zi(t){return!(!t||"string"!=typeof t||"auto"!==t.toLowerCase())}function Ni(){for(var t=[],e=0,n=[],o=0;o<this[Ci].colCount;o++){var r=Wi.call(this,o),i=Hi.call(this,o);if(zi(r))i&&n.push(i),e++;else{var l="number"==typeof r?r+"px":r;if(i){var a=Mi(this,l),s=Fi(i,a);a!==s&&(l=s+"px")}t.push(l)}}if(n.length&&t.length){for(var c=Mi(this,"calc(100% - ("+t.join(" + ")+"))")/e,u=0;u<n.length;u++){(i=n[u]).min&&c<i.min?(t.push("number"==typeof i.minDef?i.minDef+"px":i.minDef),e--):i.max&&i.max<c&&(t.push("number"==typeof i.maxDef?i.maxDef+"px":i.maxDef),e--)}if(e<=0)return c+"px"}return t.length?"calc((100% - ("+t.join(" + ")+")) / "+e+")":100/e+"%"}function Vi(t){return zi(t)?Mi(this,Ni.call(this)):Mi(this,t)}function Ui(t){var e=Wi.call(this,t);return ji.call(this,t,Vi.call(this,e))}function Ki(t,e){this[Ci].colWidthsMap.put(t,e)}function Gi(t){var e=this.getRowHeightInternal(t);if("number"==typeof e)return Number(e);var n=this[Ci].rowHeightsMap.get(t);return n||this.defaultRowHeight}function Yi(t,e){var n=this,o=this.getRowsHeightInternal(t,e);if("number"==typeof o)return Number(o);var r=e-t+1,i=this.defaultRowHeight*r;return this[Ci].rowHeightsMap.each(t,e,(function(t){i+=t-n.defaultRowHeight})),i}function Xi(t,e){this[Ci].rowHeightsMap.put(t,e)}function qi(){for(var t=this.getElement().clientWidth,e=0;e<this.frozenColCount;e++)t-=this.getColWidth(e);t<0&&(t=0);var n=0;if(this.underlayColCount>=0)n="auto"===this.underlayColWidth?this.underlayColCount*Mi(this,this.defaultColWidth):this.underlayColCount*this.underlayColWidth;else if(n=t,"auto"===this.underlayColWidth)for(e=Math.max(this.colCount+this.underlayColCount,this.frozenColCount,0);e<this.colCount;e++)n-=this.getColWidth(e);else n+=this.underlayColCount*this.underlayColWidth;return n<0?n=0:n>t&&(n=t),n}function $i(){return this._getColsWidth(0,this[Ci].colCount-1)+qi.call(this)}function Zi(){for(var t=this.getElement().clientHeight,e=0;e<this.frozenRowCount;e++)t-=this.getRowHeight(e);t<0&&(t=0);var n=0;if(this.underlayRowCount>=0)n="auto"===this.underlayRowHeight?this.underlayRowCount*this.defaultRowHeight:this.underlayRowCount*this.underlayRowHeight;else if(n=t,"auto"===this.underlayRowHeight)for(e=Math.max(this.rowCount+this.underlayRowCount,this.frozenRowCount,0);e<this.rowCount;e++)n-=this.getRowHeight(e);else n+=this.underlayRowCount*this.underlayRowHeight;return n<0?n=0:n>t&&(n=t),n}function Ji(){var t=this,e=this.getScrollHeightInternal(this[Ci].rowCount);if("number"==typeof e)return Number(e);var n=this.defaultRowHeight*this[Ci].rowCount;this[Ci].rowHeightsMap.each(0,this[Ci].rowCount-1,(function(e){n+=e-t.defaultRowHeight}));var o=Zi.call(this);return n+o}function Qi(t){var e=this[Ci].scroll.left,n=this[Ci].scroll.top,o=this[Ci].scrollable.scrollLeft-e,r=this[Ci].scrollable.scrollTop-n;this[Ci].scroll={left:this[Ci].scrollable.scrollLeft,top:this[Ci].scrollable.scrollTop};var i=this._getVisibleRect();if(Math.abs(o)>=i.width||Math.abs(r)>=i.height)this._invalidateRect(i);else{var l=this[Ci].context;if(l&&l.drawImage(this[Ci].canvas,-o,-r),0!==o){var a=i.copy();if(o<0){if(a.width=-o,this[Ci].frozenColCount>0)(s=ki.call(this))&&(a.width+=s.width)}else o>0&&(a.left=a.right-o);if(this._invalidateRect(a),o>0)if(this[Ci].frozenColCount>0)(s=ki.call(this))&&this._invalidateRect(s)}if(0!==r){var s;a=i.copy();if(r<0){if(a.height=-r,this[Ci].frozenRowCount>0)(s=Li.call(this))&&(a.height+=s.height)}else r>0&&(a.top=a.bottom-r);if(this._invalidateRect(a),r>0)if(this[Ci].frozenRowCount>0)(s=Li.call(this))&&this._invalidateRect(s)}}}function tl(t){var e=this,n=e.selection.focus,o=t?e.getMoveLeftColByKeyDownInternal(n):e.getMoveRightColByKeyDownInternal(n);0<=o&&o<e.colCount?e._moveFocusCell(o,n.row,!1):0>o?e._moveFocusCell(e.colCount-1,n.row,!1):e._moveFocusCell(0,n.row,!1)}function el(t){var e=this,n=e.selection.focus,o=t?e.getMoveUpRowByKeyDownInternal(n):e.getMoveDownRowByKeyDownInternal(n);0<=o&&o<e.rowCount&&e._moveFocusCell(n.col,o,!1)}function nl(t){var e,n,o,r,i,l,a,s,c,u,h,f,d,p,g,v=t.shiftKey,y=t.ctrlKey,_=t.metaKey,b=t.altKey,w=M.getKeyCode(t);if(!b){var m=v?this.selection.focus:this.selection.select;if(37===w){if(y||_)R(this,null,"W");else if(!O.call(this,"W"))return;M.cancel(t)}else if(w===U){if(t.ctrlKey||t.metaKey)R(this,"N",null);else if(!E.call(this,"N"))return;M.cancel(t)}else if(39===w){if(t.ctrlKey||t.metaKey)R(this,null,"E");else if(!O.call(this,"E"))return;M.cancel(t)}else if(w===K){if(t.ctrlKey||t.metaKey)R(this,"S",null);else if(!E.call(this,"S"))return;M.cancel(t)}else if(36===w)t.ctrlKey||t.metaKey?R(this,"N","W"):R(this,null,"W"),M.cancel(t);else if(35===w)t.ctrlKey||t.metaKey?R(this,"S","E"):R(this,null,"E"),M.cancel(t);else if(9===w&&(null===(e=this.keyboardOptions)||void 0===e?void 0:e.moveCellOnTab))tl.call(this,v),M.cancel(t);else if(w===V&&(null===(n=this.keyboardOptions)||void 0===n?void 0:n.moveCellOnEnter))el.call(this,v),M.cancel(t);else if(65===w&&(null===(o=this.keyboardOptions)||void 0===o?void 0:o.selectAllOnCtrlA)&&(y||_)){var C=0,x=0;v?((null===(l=null===(i=null===(r=this.keyboardOptions)||void 0===r?void 0:r.selectAllOptions)||void 0===i?void 0:i.shiftCtrlA)||void 0===l?void 0:l.excludeFrozenCol)&&(C=this.frozenRowCount),(null===(c=null===(s=null===(a=this.keyboardOptions)||void 0===a?void 0:a.selectAllOptions)||void 0===s?void 0:s.shiftCtrlA)||void 0===c?void 0:c.excludeFrozenRow)&&(x=this.frozenRowCount)):((null===(f=null===(h=null===(u=this.keyboardOptions)||void 0===u?void 0:u.selectAllOptions)||void 0===h?void 0:h.ctrlA)||void 0===f?void 0:f.excludeFrozenCol)&&(C=this.frozenRowCount),(null===(g=null===(p=null===(d=this.keyboardOptions)||void 0===d?void 0:d.selectAllOptions)||void 0===p?void 0:p.ctrlA)||void 0===g?void 0:g.excludeFrozenRow)&&(x=this.frozenRowCount)),this.selection.range={start:{col:C,row:x},end:{col:this.colCount-1,row:this.rowCount-1}},this.invalidate(),M.cancel(t)}}function R(t,e,n){var o="S"===e?t.rowCount-1:"N"===e?0:m.row,r="E"===n?t.colCount-1:"W"===n?0:m.col;t._moveFocusCell(r,o,v)}function E(t){var e;if("S"===t){if(e=this.getMoveDownRowByKeyDownInternal(m),this.rowCount<=e)return!1}else if((e=this.getMoveUpRowByKeyDownInternal(m))<0)return!1;var n=m.col;return this._moveFocusCell(n,e,v),!0}function O(t,e){var n;if(void 0===e&&(e=v),"E"===t){if(n=this.getMoveRightColByKeyDownInternal(m),this.colCount<=n)return!1}else if((n=this.getMoveLeftColByKeyDownInternal(m))<0)return!1;var o=m.row;return this._moveFocusCell(n,o,e),!0}}function ol(){var t=this,e=this[Ci],n=e.handler,o=e.element,r=e.scrollable,i=function(e){var n=t._getMouseAbstractPoint(e);if(!n)return{};var o=t.getCellAt(n.x,n.y);return o.col<0||o.row<0?{abstractPos:n,cell:o}:{abstractPos:n,cell:o,eventArgs:{col:o.col,event:e,row:o.row}}},l=function(e){var n=t[Ci].colWidthsLimit[e],o=!0!==t.disableColumnResize;return n&&o&&(o=!0!==n.disableResize)&&n.min&&n.max&&(o=n.max!==n.min),o};n.on(o,"mousedown",(function(e){var n=i(e),o=n.abstractPos,r=n.eventArgs;if(o){if(r){var a=t.fireListeners(N.MOUSEDOWN_CELL,r);if(s.findIndex(a,(function(t){return!t}))>=0)return}if(1===M.getMouseButtons(e))if(rl.call(t,o.x,o.y))t[Ci].selectionResizer.start(e);else{var c=il.call(t,o.x,o.y);c>=0&&l(c)?t[Ci].columnResizer.start(c,e):t[Ci].cellSelector.start(e)}}})),n.on(o,"mouseup",(function(e){if(t.hasListeners(N.MOUSEUP_CELL)){var n=i(e).eventArgs;n&&t.fireListeners(N.MOUSEUP_CELL,n)}}));var a=null,u=null;function h(t){u&&(clearTimeout(u),u=null)}n.on(o,"touchstart",(function(e){if(a){var n=i(e).eventArgs;if(n&&n.col===a.col&&n.row===a.row?t.fireListeners(N.DBLTAP_CELL,n):n||t.fireListeners(N.DBLTAP_UNDERLAY),a=null,e.defaultPrevented)return}else a=i(e).eventArgs,setTimeout((function(){a=null}),350);u=setTimeout((function(){u=null;var n=t._getMouseAbstractPoint(e);if(n)if(rl.call(t,n.x,n.y))t[Ci].selectionResizer.start(e);else{var o=il.call(t,n.x,n.y,15);o>=0&&l(o)?t[Ci].columnResizer.start(o,e):t[Ci].cellSelector.start(e)}}),500)})),n.on(o,"touchcancel",h),n.on(o,"touchmove",h),n.on(o,"touchend",(function(e){u&&(clearTimeout(u),t[Ci].cellSelector.select(e),u=null)}));var f=!1,d=null,p=null,g=function(e,n){t.fireListeners(N.MOUSEENTER_CELL,{col:e.col,row:e.row,event:e.event,related:n}),d=e},v=function(e){var n=d;return d=null,n&&t.fireListeners(N.MOUSELEAVE_CELL,{col:n.col,row:n.row,related:e}),n||void 0},y=function(e,n){t.fireListeners(N.MOUSEOVER_CELL,{col:e.col,row:e.row,event:e.event,related:n}),p=e},_=function(e){var n=p;return p=null,n&&t.fireListeners(N.MOUSEOUT_CELL,{col:n.col,row:n.row,related:e}),n||void 0},b=r.getElement();n.on(b,"mouseover",(function(t){f=!0})),n.on(b,"mouseout",(function(t){f=!1,_()})),n.on(o,"mouseleave",(function(t){v()})),n.on(o,"mousemove",(function(e){var n=i(e),r=n.abstractPos,a=n.eventArgs;if(a){var s=d;if(s)if(t.fireListeners(N.MOUSEMOVE_CELL,a),s.col!==a.col||s.row!==a.row){var c={col:a.col,row:a.row},u=_(c),h=v(c);g(a,h),f&&y(a,u)}else f&&!p&&y(a);else g(a),f&&y(a),t.fireListeners(N.MOUSEMOVE_CELL,a)}else _(),v();if(!(t[Ci].columnResizer.moving(e)||t[Ci].selectionResizer.moving(e)||t[Ci].cellSelector.moving(e))){var b=o.style;if(r)if(rl.call(t,r.x,r.y))b.cursor="crosshair";else{var w=il.call(t,r.x,r.y);w>=0&&l(w)?b.cursor="col-resize":"col-resize"!==b.cursor&&"crosshair"!==b.cursor||(b.cursor="")}else"col-resize"!==b.cursor&&"crosshair"!==b.cursor||(b.cursor="")}})),n.on(o,"click",(function(e){if(!(t[Ci].columnResizer.lastMoving(e)||t[Ci].selectionResizer.moving(e)||t[Ci].cellSelector.lastMoving(e))&&(t.hasListeners(N.CLICK_CELL)||t.hasListeners(N.CLICK_UNDERLAY))&&(!I||e.eventPhase!==Event.AT_TARGET)){var n=i(e).eventArgs;n?t.fireListeners(N.CLICK_CELL,n):t.fireListeners(N.CLICK_UNDERLAY)}})),n.on(o,"contextmenu",(function(e){if(t.hasListeners(N.CONTEXTMENU_CELL)){var n=i(e).eventArgs;n&&t.fireListeners(N.CONTEXTMENU_CELL,n)}})),n.on(o,"dblclick",(function(e){if(t.hasListeners(N.DBLCLICK_CELL)||t.hasListeners(N.DBLCLICK_UNDERLAY)){var n=i(e).eventArgs;n?t.fireListeners(N.DBLCLICK_CELL,n):t.fireListeners(N.DBLCLICK_UNDERLAY)}})),this[Ci].focusControl.onKeyDown((function(e){var n=t.fireListeners(N.KEYDOWN,e);if(s.findIndex(n,(function(t){return!1===t}))>=0)return!1})),this[Ci].selection.listen(N.SELECTED_CELL,(function(e){var n=t.fireListeners(N.SELECTED_CELL,e,e.selected);if(s.findIndex(n,(function(t){return!1===t}))>=0)return!1})),r.onScroll((function(e){Qi.call(t,e),t.fireListeners(N.SCROLL,{event:e})})),this[Ci].focusControl.onKeyDownMove((function(e){nl.call(t,e)}));var w=function(){for(var e="",n=t[Ci].selection.range,o=t.getCopyRangeInternal(n),r=o.start.row;r<=o.end.row;r++){for(var i=o.start.col;i<=o.end.col;i++){var l=t.getCopyCellValue(i,r,o);if(R(l));else{var a=""+l;/^\[object .*\]$/.exec(a)||(e+=a)}i<o.end.col&&(e+="\t")}r<o.end.row&&(e+="\n")}return e};this[Ci].focusControl.onCopy((function(e){var n=w(),o=s.find(t.fireListeners(N.COPY,e),c);return c(o)&&(n=o),n})),this[Ci].focusControl.onCut((function(e){var n=w(),o=s.find(t.fireListeners(N.CUT,e),c);return c(o)&&(n=o),n})),this[Ci].focusControl.onPaste((function(e){var n=e.value,o=e.event,r=t.hasListeners(N.PASTE)?s.find(t.fireListeners(N.PASTE,n,o),c):n;if(c(r)){var i=r.replace(/\r?\n$/,""),l=t[Ci].selection.select,a=l.col,u=l.row,h=/[\r\n\u2028\u2029\t]/.test(i),f=null,d={col:a,row:u,value:r,normalizeValue:i,multi:h,get rangeBoxValues(){return null!=f?f:f=mi(i)},event:o};t.fireListeners(N.PASTE_CELL,d)}})),this[Ci].focusControl.onInput((function(e){var n=t[Ci].selection.select.col,o=t[Ci].selection.select.row;t.fireListeners(N.INPUT_CELL,{col:n,row:o,value:e})})),this[Ci].focusControl.onDelete((function(e){var n=t[Ci].selection.select,o=n.col,r=n.row;t.fireListeners(N.DELETE_CELL,{col:o,row:r,event:e})})),this[Ci].focusControl.onFocus((function(e){t.fireListeners(N.FOCUS_GRID,e),t[Ci].focusedGrid=!0;var n=t[Ci].selection.select.col,o=t[Ci].selection.select.row;t.invalidateCell(n,o)})),this[Ci].focusControl.onBlur((function(e){t.fireListeners(N.BLUR_GRID,e),t[Ci].focusedGrid=!1;var n=t[Ci].selection.select.col,o=t[Ci].selection.select.row;t.invalidateCell(n,o)}))}function rl(t,e,n){void 0===n&&(n=7);var o=this.selection.range,r=this.getCellRect(o.end.col,o.end.row);return!!(r.bottom-n<=e&&e<=r.bottom&&r.right-n<=t&&t<=r.right&&this.canDragSelection)}function il(t,e,n){void 0===n&&(n=5);var o=this;if(o[Ci].frozenRowCount<=0)return-1;var r=Li.call(this);if(r&&!r.inPoint(t,e))return-1;var i=o.getCellAt(t,e),l=o.getCellRect(i.col,i.row);return t<l.left+n?i.col-1:l.right-n<t?i.col:-1}function ll(){var t=0;this[Ci].frozenColCount>0&&((e=ki.call(this))&&(t=e.width));var e,n=0;this[Ci].frozenRowCount>0&&((e=Li.call(this))&&(n=e.height));return new je(this[Ci].scrollable.scrollLeft+t,this[Ci].scrollable.scrollTop+n,this[Ci].canvas.width-t,this[Ci].canvas.height-n)}var al=function(t){function n(e){var n,o;void 0===e&&(e={});var r,i=t.call(this)||this,l=e.rowCount,a=void 0===l?10:l,s=e.colCount,c=void 0===s?10:s,u=e.frozenColCount,h=void 0===u?0:u,f=e.frozenRowCount,d=void 0===f?0:f,p=e.defaultRowHeight,g=e.defaultColWidth,v=e.highlightBorderWidth,y=e.font,_=e.underlayRowCount,b=void 0===_?0:_,w=e.underlayColCount,m=void 0===w?0:w,C=e.underlayRowHeight,x=void 0===C?"auto":C,R=e.underlayColWidth,E=void 0===R?"auto":R,O=e.underlayBackgroundColor,L=e.borderMode,k=void 0===L?"none":L,S=e.borderColor,I=void 0===S?"":S,T=e.borderWidth,P=void 0===T?0:T,B=e.keyboardOptions,A=e.parentElement,M=e.singleSelection,D=e.disableColumnResize,j=i[Ci]={};return Ft.initDocument(),j.element=((r=document.createElement("div")).classList.add("kaka-grid"),r),j.canvas=ri(document.createElement("canvas")),j.context=j.canvas.getContext("2d",{alpha:!1}),j.scrollable=Ft.isPerfectScrollbar()?new ai:new ci(j.canvas),j.handler=new Bt,j.selection=new bi(i,(function(t){return i.updateSelectionRange(t)})),j.focusControl=new _i(i,j.scrollable.getElement(),j.scrollable),j.rowCount=a,j.colCount=c,j.frozenColCount=h,j.frozenRowCount=d,j.underlayRowCount=b,j.underlayColCount=m,j.underlayRowHeight=x,j.underlayColWidth=E,j.borderMode=k,j.borderColor=I,j.borderWidth=P,j.defaultRowHeight=p,j.defaultColWidth=g,j.highlightBorderWidth=v,j.font=y,j.underlayBackgroundColor=O,j.keyboardOptions=B||{},j.keyboardOptions.moveCellOnEnter=null===(n=j.keyboardOptions.moveCellOnEnter)||void 0===n||n,j.keyboardOptions.moveCellOnTab=null===(o=j.keyboardOptions.moveCellOnTab)||void 0===o||o,j.singleSelection=!!M,j.disableColumnResize=!!D||!!e.disableColResize,j.rowHeightsMap=new ii,j.colWidthsMap=new ii,j.colWidthsLimit={},j.colWidthsOffset={},j.calcWidthContext={_:j,get full(){return this._.canvas.width},get em(){return Qo(this._.context,this._.font).width}},j.columnResizer=new fi(i),j.selectionResizer=new wi(i),j.cellSelector=new hi(i),j.drawCells={},j.cellTextOverflows={},j.cellTypeOverflows={},j.focusedGrid=!1,j.element.appendChild(j.canvas),j.element.appendChild(j.scrollable.getElement()),j.scroll={left:0,top:0},i.updateScroll(),A?(A.appendChild(j.element),i.updateSize()):i.updateSize(),ol.call(i),i.bindEventsInternal(),i}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return N},enumerable:!1,configurable:!0}),n.prototype.getElement=function(){return this[Ci].element},Object.defineProperty(n.prototype,"canvas",{get:function(){return this[Ci].canvas},enumerable:!1,configurable:!0}),n.prototype.focus=function(){var t=this[Ci].selection.select,e=t.col,n=t.row;this.focusCell(e,n)},n.prototype.hasFocusGrid=function(){return this[Ci].focusedGrid},Object.defineProperty(n.prototype,"selection",{get:function(){return this[Ci].selection},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rowCount",{get:function(){return this[Ci].rowCount},set:function(t){if(this[Ci].rowCount=t,this.updateScroll(),this[Ci].selection._updateGridRange()){var e=this[Ci].selection.focus,n=e.col,o=e.row;this.makeVisibleCell(n,o),this.setFocusCursor(n,o)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"colCount",{get:function(){return this[Ci].colCount},set:function(t){if(this[Ci].colCount=t,this.updateScroll(),this[Ci].selection._updateGridRange()){var e=this[Ci].selection.focus,n=e.col,o=e.row;this.makeVisibleCell(n,o),this.setFocusCursor(n,o)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"frozenColCount",{get:function(){return this[Ci].frozenColCount},set:function(t){this[Ci].frozenColCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"frozenRowCount",{get:function(){return this[Ci].frozenRowCount},set:function(t){this[Ci].frozenRowCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"defaultRowHeight",{get:function(){return this[Ci].defaultRowHeight||this.getDefaultRowHeight()},set:function(t){this[Ci].defaultRowHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"defaultColWidth",{get:function(){return this[Ci].defaultColWidth||this.getDefaultColWidth()},set:function(t){this[Ci].defaultColWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"highlightBorderWidth",{get:function(){return this[Ci].highlightBorderWidth||this.getHighlightBorderWidth()},set:function(t){this[Ci].highlightBorderWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"font",{get:function(){return this[Ci].font||this.getDefaultFont()},set:function(t){this[Ci].font=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlayRowCount",{get:function(){return this[Ci].underlayRowCount},set:function(t){this[Ci].underlayRowCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlayColCount",{get:function(){return this[Ci].underlayColCount},set:function(t){this[Ci].underlayColCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlayRowHeight",{get:function(){return this[Ci].underlayRowHeight},set:function(t){this[Ci].underlayRowHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlayColWidth",{get:function(){return this[Ci].underlayColWidth},set:function(t){this[Ci].underlayColWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"underlayBackgroundColor",{get:function(){return this[Ci].underlayBackgroundColor||this.getDefaultUnderlayBackgroundColor()},set:function(t){this[Ci].underlayBackgroundColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"borderColor",{get:function(){return this[Ci].borderColor||this.getDefaultBorderColor()},set:function(t){this[Ci].borderColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"borderWidth",{get:function(){return this[Ci].borderWidth||this.getDefaultBorderWidth()},set:function(t){this[Ci].borderWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"borderMode",{get:function(){return this[Ci].borderMode||this.getDefaultBorderMode()},set:function(t){this[Ci].borderMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"keyboardOptions",{get:function(){var t;return null!==(t=this[Ci].keyboardOptions)&&void 0!==t?t:null},set:function(t){this[Ci].keyboardOptions=null!=t?t:void 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"singleSelection",{get:function(){return this[Ci].singleSelection},set:function(t){this[Ci].singleSelection=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableColumnResize",{get:function(){return this[Ci].disableColumnResize},set:function(t){this[Ci].disableColumnResize=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disableColResize",{get:function(){return window.console.warn("'disableColResize' is deprecated, please use 'disableColumnResize' instead"),this.disableColumnResize},set:function(t){window.console.warn("'disableColResize' is deprecated, please use 'disableColumnResize' instead"),this.disableColumnResize=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canDragSelection",{get:function(){return this[Ci].selectionResizer.canStart()},enumerable:!1,configurable:!0}),n.prototype.configure=function(t,e){var n=this[Ci].config||(this[Ci].config={});return c(e)&&(n[t]=e),n[t]},n.prototype.updateSize=function(){var t=this[Ci].canvas;t.style.width="",t.style.height="";var e=t.offsetWidth;if(!e){var n=t.parentElement;null!==n&&(e=n.offsetWidth-Ft.getScrollBarSize())}e=Math.floor(e);var o=t.offsetHeight;if(!o){var r=t.parentElement;null!==r&&(o=r.offsetHeight-Ft.getScrollBarSize())}o=Math.floor(o),t.width=e,t.height=o,t.style.width=e+"px",t.style.height=o+"px";var i=this[Ci].selection.select;this[Ci].focusControl.setFocusRect(this.getFocusRectInternal(i.col,i.row))},n.prototype.updateScroll=function(){!function(t){for(var e={},n=0,o=0;o<t.colCount;o++){var r=t.getColWidth(o),i=Di(t,o);r!==i&&(n+=i-r,e[o]=0)}if((n=Math.round(n))>0)for(var o in e)if(e.hasOwnProperty(o)&&(e[o]+=1,!--n))break;t[Ci].colWidthsOffset=e}(this);var t=this[Ci].scrollable,e=Ji.call(this),n=$i.call(this);return e===t.scrollHeight&&n===t.scrollWidth?(t.update(),!1):(t.setScrollSize(n,e),this[Ci].scroll={left:t.scrollLeft,top:t.scrollTop},!0)},n.prototype.getRowHeight=function(t){return Gi.call(this,t)},n.prototype.setRowHeight=function(t,e){Xi.call(this,t,e)},n.prototype.getColWidth=function(t){return Ui.call(this,t)},n.prototype.setColWidth=function(t,e){Ki.call(this,t,e)},n.prototype.getMaxColWidth=function(t){var e=this[Ci].colWidthsLimit[t];return e&&e.max||void 0},n.prototype.setMaxColWidth=function(t,e){(this[Ci].colWidthsLimit[t]||(this[Ci].colWidthsLimit[t]={})).max=e},n.prototype.getMinColWidth=function(t){var e=this[Ci].colWidthsLimit[t];return e&&e.min||void 0},n.prototype.setMinColWidth=function(t,e){(this[Ci].colWidthsLimit[t]||(this[Ci].colWidthsLimit[t]={})).min=e},n.prototype.getColDisableResize=function(t){var e=this[Ci].colWidthsLimit[t];return e&&e.disableResize||void 0},n.prototype.setColDisableResize=function(t,e){(this[Ci].colWidthsLimit[t]||(this[Ci].colWidthsLimit[t]={})).disableResize=e},n.prototype.getCellRect=function(t,e){var n=this.isFrozenCell(t,e),o=this._getColsWidth(0,t-1),r=Ui.call(this,t);n&&n.col&&(o+=this[Ci].scroll.left);var i=Yi.call(this,0,e-1),l=Gi.call(this,e);return n&&n.row&&(i+=this[Ci].scroll.top),new je(o,i,r,l)},n.prototype.getCellRelativeRect=function(t,e){return this._toRelativeRect(this.getCellRect(t,e))},n.prototype.getCellsRect=function(t,e,n,o){var r=this.isFrozenCell(t,e),i=this.isFrozenCell(n,o),l=this._getColsWidth(0,t-1),a=this._getColsWidth(t,n);if(r&&r.col){var s=this[Ci].scroll.left;l+=s,i&&i.col||(a-=s,a=Math.max(a,this._getColsWidth(t,this.frozenColCount-1)))}var c=Yi.call(this,0,e-1),u=Yi.call(this,e,o);if(r&&r.row){var h=this[Ci].scroll.top;c+=h,i&&i.row||(u-=h,u=Math.max(u,this._getColsWidth(e,this.frozenRowCount-1)))}return new je(l,c,a,u)},n.prototype.getCellRangeRect=function(t){return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row)},n.prototype.isFrozenCell=function(t,e){var n=this[Ci],o=n.frozenRowCount,r=n.frozenColCount,i=o>0&&e<o,l=r>0&&t<r;return i||l?{col:l,row:i}:null},n.prototype.getRowAt=function(t){var e=Ei.call(this,t);if(e)return e.row;var n=xi.call(this,t);return n?n.row:-1},n.prototype.getColAt=function(t){var e=Oi.call(this,t);if(e)return e.col;var n=Ri.call(this,t);return n?n.col:-1},n.prototype.getCellAt=function(t,e){return{col:this.getColAt(t),row:this.getRowAt(e)}},n.prototype.makeVisibleCell=function(t,e){var n=this.isFrozenCell(t,e);if(!(n&&n.col&&n.row)){var o=this.getCellRect(t,e),r=ll.call(this);if(!r.contains(o)){var i=this[Ci].scrollable;n&&n.col||(o.left<r.left?i.scrollLeft-=r.left-o.left:r.right<o.right&&(i.scrollLeft-=r.right-o.right)),n&&n.row||(o.top<r.top?i.scrollTop-=r.top-o.top:r.bottom<o.bottom&&(i.scrollTop-=r.bottom-o.bottom))}}},n.prototype.setFocusCursor=function(t,e){var n=this[Ci].focusControl,o=n.editMode;n.setFocusRect(this.getFocusRectInternal(t,e)),this._updatedSelection(),o&&!n.editMode&&n.resetInputStatus()},n.prototype._updatedSelection=function(){var t=this[Ci].focusControl,e=this[Ci].selection.select,n=e.col,o=e.row,r=this.fireListeners(N.EDITABLEINPUT_CELL,{col:n,row:o}),i=s.findIndex(r,(function(t){return!!t}))>=0;t.editMode=i,i&&(t.storeInputStatus(),t.setDefaultInputStatus(),this.fireListeners(N.MODIFY_STATUS_EDITABLEINPUT_CELL,{col:n,row:o,input:t.input}))},n.prototype.focusCell=function(t,e){var n=this.selection.range.start.col,o=this.selection.range.start.row,r=this.selection.range.end.col,i=this.selection.range.end.row;this.setFocusCursor(t,e),this._forceFocusCell(),this.selection.select={col:t,row:e},this.invalidateGridRect(n,o,r,i),this.invalidateCell(t,e)},n.prototype.invalidateCell=function(t,e){this.invalidateGridRect(t,e)},n.prototype.invalidateGridRect=function(t,e,n,o){void 0===n&&(n=t),void 0===o&&(o=e);var r=this.getOffsetInvalidateCells();r>0&&(t-=r,e-=r,n+=r,o+=r);var i=this._getVisibleRect(),l=this.getCellsRect(t,e,n,o),a=i.intersection(l);if(a){var s,c=this[Ci],u=c.frozenColCount,h=c.frozenRowCount;if(u>0&&n>=u)(s=ki.call(this))&&s.intersection(a)&&(a.left=Math.min(s.right-1,s.left));if(h>0&&o>=h)(s=Li.call(this))&&s.intersection(a)&&(a.top=Math.min(s.bottom-1,a.top));this._invalidateRect(a)}},n.prototype.invalidateCellRange=function(t){this.invalidateGridRect(t.start.col,t.start.row,t.end.col,t.end.row)},n.prototype.invalidate=function(){var t=this._getVisibleRect();this._invalidateRect(t)},Object.defineProperty(n.prototype,"visibleRowCount",{get:function(){var t=this.frozenRowCount,e=this._getVisibleRect(),n=t>0?e.top+Yi.call(this,0,t-1):e.top,o=xi.call(this,n);if(!o)return 0;for(var r=Math.max(o.top>=n?o.row:o.row+1,t),i=Yi.call(this,0,r-1),l=0,a=this.rowCount,s=r;s<a;s++){var c=i+Gi.call(this,s);if(e.bottom<c)break;l++,i=c}return l},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"visibleColCount",{get:function(){var t=this.frozenColCount,e=this._getVisibleRect(),n=t>0?e.left+this._getColsWidth(0,t-1):e.left,o=Ri.call(this,n);if(!o)return 0;for(var r=Math.max(o.left>=n?o.col:o.col+1,t),i=this._getColsWidth(0,r-1),l=0,a=this.colCount,s=r;s<a;s++){var c=i+Ui.call(this,s);if(e.right<c)break;l++,i=c}return l},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"topRow",{get:function(){var t=this.frozenRowCount,e=this._getVisibleRect(),n=t>0?e.top+Yi.call(this,0,t-1):e.top,o=xi.call(this,n);return o?Math.max(o.top>=n?o.row:o.row+1,t):0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leftCol",{get:function(){var t=this.frozenColCount,e=this._getVisibleRect(),n=t>0?e.left+this._getColsWidth(0,t-1):e.left,o=Ri.call(this,n);return o?Math.max(o.left>=n?o.col:o.col+1,t):0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scrollTop",{get:function(){return this[Ci].scrollable.scrollTop},set:function(t){this[Ci].scrollable.scrollTop=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scrollLeft",{get:function(){return this[Ci].scrollable.scrollLeft},set:function(t){this[Ci].scrollable.scrollLeft=t},enumerable:!1,configurable:!0}),n.prototype.getCellOverflowText=function(t,e){var n=this.getCellOverflowTextInternal({col:t,row:e})||null;if(!n){var o=t+":"+e;n=this[Ci].cellTextOverflows[o]||null}return n},n.prototype.setCellOverflowText=function(t,e,n){var o=t+":"+e;n?this[Ci].cellTextOverflows[o]="string"==typeof n?n.trim():"":delete this[Ci].cellTextOverflows[o]},n.prototype.getCellOverflowType=function(t,e){var n=this.getCellOverflowTypeInternal({col:t,row:e})||null;if(!n){var o=t+":"+e;n=this[Ci].cellTypeOverflows[o]||null}return n},n.prototype.setCellOverflowType=function(t,e,n){var o=t+":"+e;n?this[Ci].cellTypeOverflows[o]="string"==typeof n?n.trim():"":delete this[Ci].cellTypeOverflows[o]},n.prototype.addDisposable=function(t){if(!t||!t.dispose||"function"!=typeof t.dispose)throw new Error("not disposable!");(this[Ci].disposables=this[Ci].disposables||[]).push(t)},n.prototype.dispose=function(){t.prototype.dispose.call(this);var e=this[Ci];e.handler.dispose(),e.scrollable.dispose(),e.focusControl.dispose(),e.columnResizer.dispose(),e.selectionResizer.dispose(),e.cellSelector.dispose(),e.disposables&&(e.disposables.forEach((function(t){return t.dispose()})),e.disposables=null);var n=e.element.parentElement;n&&n.removeChild(e.element)},n.prototype.getAttachCellsArea=function(t){return{element:this.getElement(),rect:this.getAttachCellsAreaInternal(t),padding:this.getAttachCellsPaddingInternal(t)}},n.prototype.onKeyDownMove=function(t){nl.call(this,t)},n.prototype._getMouseAbstractPoint=function(t){var e,n=(e=M.isTouchEvent(t)?t.changedTouches[0]:t).clientX||e.pageX+window.scrollX,o=e.clientY||e.pageY+window.scrollY,r=this[Ci].canvas.getBoundingClientRect();return r.right<=n||r.bottom<=o?null:{x:n-r.left+this[Ci].scroll.left,y:o-r.top+this[Ci].scroll.top}},n.prototype._getMouseRelativePoint=function(t){var e=this._getMouseAbstractPoint(t);return e?{x:e.x-this[Ci].scroll.left,y:e.y-this[Ci].scroll.top}:null},n.prototype._getColsWidth=function(t,e){var n=this,o=Vi.call(this,this.defaultColWidth),r=o*(e-t+1);this[Ci].colWidthsMap.each(t,e,(function(t,e){r+=ji.call(n,e,Vi.call(n,t))-o}));for(var i=t;i<=e;i++)if(!this[Ci].colWidthsMap.has(i)){var l=ji.call(this,i,o);l!==o&&(r+=l-o)}return r},n.prototype._moveFocusCell=function(t,e,n,o){var r=this.getOffsetInvalidateCells();function i(t){return r>0&&(t.start.col-=r,t.start.row-=r,t.end.col+=r,t.end.row+=r),t}var l=i(this.selection.range),a=this.getCellRangeRect(l);this.selection._setFocusCell(t,e,n),o||this.makeVisibleCell(t,e),this.setFocusCursor(t,e),this._forceFocusCell();var s=i(this.selection.range),c=this.getCellRangeRect(s);if(c.intersection(a)){var u=je.max(c,a);this._invalidateRect(u)}else this._invalidateRect(a),this._invalidateRect(c)},n.prototype._forceFocusCell=function(){this[Ci].focusControl.focus()},n.prototype._resetColWidthOffset=function(t){delete this[Ci].colWidthsOffset[t]},n.prototype._adjustColWidth=function(t,e){var n=this[Ci].colWidthsOffset[t]||0,o=Hi.call(this,t);return Math.max(Fi(o,e),0)+n},n.prototype._getVisibleRect=function(){var t=this[Ci].scroll.left,e=this[Ci].scroll.top,n=this[Ci].canvas.width,o=this[Ci].canvas.height;return new je(t,e,n,o)},n.prototype._invalidateRect=function(t){var e=this,n=this._getInitContext();if(n){var o=this._getVisibleRect(),r=this[Ci].rowCount,i=xi.call(this,Math.max(o.top,t.top))||{row:r,top:Yi.call(this,0,r-1)},l=Ri.call(this,Math.max(o.left,t.left))||{col:this[Ci].colCount,left:this._getColsWidth(0,this[Ci].colCount-1)},a=Math.min(o.bottom,t.bottom),s=Math.min(o.right,t.right),c=Ei.call(this,Math.max(o.top,t.top)),u=Oi.call(this,Math.max(o.left,t.left)),h=new vi,f=function(){var t="content-border"===e.borderMode;if("grid-border"===e.borderMode||t){var i=e[Ci].canvas.width,l=e[Ci].canvas.height;if(t){var a=e._getColsWidth(0,e[Ci].colCount-1)-o.left,s=Yi.call(e,0,r-1)-o.top;i=Math.min(e[Ci].canvas.width,a),l=Math.min(e[Ci].canvas.height,s)}n.save();try{n.beginPath(),n.lineWidth=e.borderWidth||0,n.strokeStyle=e.borderColor||"transparent",n.rect(0+n.lineWidth/2,0+n.lineWidth/2,i-n.lineWidth,l-n.lineWidth),n.stroke()}finally{n.restore()}}},d=function(t,i){if(t>=r-1&&e[Ci].canvas.height>i-o.top){var l=i-o.top;"transparent"===e.underlayBackgroundColor?n.clearRect(0,l,e[Ci].canvas.width,e[Ci].canvas.height-l):(n.save(),n.beginPath(),n.fillStyle=e.underlayBackgroundColor||"#F6F6F6",n.rect(0,l,e[Ci].canvas.width,e[Ci].canvas.height-l),n.fill(),n.restore())}},p=0;if(c){for(var g=c.top,v=this[Ci].frozenRowCount,y=c.row;y<v;y++){var _=Gi.call(this,y);if(Bi.call(this,n,u,l,s,y,g,_,o,0,h),a<=(g+=_))return d(y,g),f(),void h.draw(n)}p=g}var b=i.top;for(y=i.row;y<r;y++){_=Gi.call(this,y);if(Bi.call(this,n,u,l,s,y,b,_,o,p,h),a<=(b+=_))return d(y,b),f(),void h.draw(n)}d(r-1,b),f(),h.draw(n)}},n.prototype._getInitContext=function(){var t=this[Ci].context;return t&&(t.fillStyle="white",t.strokeStyle="black",t.textAlign="left",t.textBaseline="top",t.lineWidth=1,t.font=this.font||"16px sans-serif"),t},n.prototype._toRelativeRect=function(t){var e=t.copy(),n=this._getVisibleRect();return e.offsetLeft(-n.left),e.offsetTop(-n.top),e},n.prototype._storeAutoColWidthExprs=function(){for(var t=null,e=0;e<this[Ci].colCount;e++){zi(Wi.call(this,e))&&Ki.call(this,e,t||(t=Ni.call(this)))}},n.prototype.resize=function(){this.getElement().offsetParent&&(this.updateSize(),this.updateScroll(),this.invalidate())},n.prototype.getCopyCellValue=function(t,e,n){},n.prototype.bindEventsInternal=function(){},n.prototype.getTargetRowAtInternal=function(t){},n.prototype.getRowsHeightInternal=function(t,e){},n.prototype.getRowHeightInternal=function(t){},n.prototype.getScrollHeightInternal=function(t){},n.prototype.getMoveLeftColByKeyDownInternal=function(t){return t.col-1},n.prototype.getMoveRightColByKeyDownInternal=function(t){return t.col+1},n.prototype.getMoveUpRowByKeyDownInternal=function(t){return t.row-1},n.prototype.getMoveDownRowByKeyDownInternal=function(t){return t.row+1},n.prototype.getOffsetInvalidateCells=function(){return 0},n.prototype.getCopyRangeInternal=function(t){return t},n.prototype.getAttachCellsAreaInternal=function(t){return this._toRelativeRect(this.getCellRangeRect(t))},n.prototype.getAttachCellsPaddingInternal=function(t){return[0,3,0,3]},n.prototype.getFocusRectInternal=function(t,e){return this.getCellRect(t,e)},n.prototype.getDefaultRowHeight=function(){return 40},n.prototype.getDefaultColWidth=function(){return 80},n.prototype.getHighlightBorderWidth=function(){return 2},n.prototype.updateSelectionRange=function(t){return t},n.prototype.getCellOverflowTextInternal=function(t){return""},n.prototype.getCellOverflowTypeInternal=function(t){return""},n.prototype.getDefaultBorderMode=function(){return"none"},n.prototype.fireListeners=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return t.prototype.fireListeners.apply(this,o([e],n))},n}(Xe),sl={DrawGrid:al,EVENT_TYPE:N};var cl,ul=function(t){function n(e){var n=t.call(this,e)||this;return n._rCache={},n._fCache={},n}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return xr.EVENT_TYPE},enumerable:!1,configurable:!0}),n.ofArray=function(t){return new n({get:function(e){return t[e]},length:t.length,source:t})},n.prototype.getOriginal=function(e){return this._rCache&&this._rCache[e]?this._rCache[e]:t.prototype.getOriginal.call(this,e)},n.prototype.getOriginalField=function(e,n){var o=this._fCache&&this._fCache[e];if(o){var r=o.get(n);if(r)return r}return t.prototype.getOriginalField.call(this,e,n)},n.prototype.setOriginalField=function(e,n,o){var r=this._fCache;return r&&r[e]&&delete r[e],t.prototype.setOriginalField.call(this,e,n,o)},n.prototype.clearCache=function(){this._rCache&&(this._rCache={}),this._fCache&&(this._fCache={})},n.prototype.fieldPromiseCallBackInternal=function(t,e,n){!function(t,e,n,o){(t[e]||(t[e]=new Map)).set(n,o)}(this._fCache,t,e,n)},n.prototype.recordPromiseCallBackInternal=function(t,e){this._rCache[t]=e},n.prototype.dispose=function(){t.prototype.dispose.call(this)},n}(xr),hl=function(){function t(t){this._dataSource=t,this._curIndex=-1,this._data=[]}return t.prototype.hasNext=function(){var t=this._curIndex+1;return this._dataSource.length>t},t.prototype.next=function(){var t=this._curIndex+1,e=this._getIndexData(t);return this._curIndex=t,e},t.prototype.movePrev=function(){this._curIndex--},t.prototype._getIndexData=function(t,e){var n=this._dataSource,o=this._data;if(t<o.length)return o[t];if(!(n.length<=t)){var r=this._dataSource.get(t);if(o[t]=r,R(r)&&(r.then((function(e){o[t]=e})),!e))for(var i=1;i<=100;i++)this._getIndexData(t+i,!0);return r}},t}(),fl=function(){function t(t,e,n){this._cancel=!1,this._owner=t,this._dataSourceItr=new hl(e),this._filter=n,this._filteredList=[],this._queues=[]}return Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!1,configurable:!0}),t.prototype.get=function(t){if(!this._cancel){var e=this._filteredList;if(t<e.length)return e[t];var n=this._queues,o=n[t];return o||(n[t]||this._findIndex(t))}},t.prototype.cancel=function(){this._cancel=!0},t.prototype._findIndex=function(t){if(window.Promise){var e=Date.now()+100,n=0;return this._findIndexWithTimeout(t,(function(){return++n>=100&&(n=0,e<Date.now())}))}return this._findIndexWithTimeout(t,(function(){return!1}))},t.prototype._findIndexWithTimeout=function(t,e){for(var n=this,o=this._filteredList,r=this._filter,i=this._dataSourceItr,l=this._queues;i.hasNext();){if(this._cancel)return;var a=i.next();if(R(a))return i.movePrev(),l[t]=a.then((function(e){return l[t]=null,n.get(t)}));if(r(a)&&(o.push(a),t<o.length))return o[t];if(e()){var s=new Promise((function(t){setTimeout((function(){t(void 0)}),300)})).then((function(){return l[t]=null,n.get(t)}));return l[t]=s,s}}this._owner.length=o.length},t}(),dl=function(t){function n(e,r){var i=t.call(this,e)||this;i._filterData=null,i._dataSource=e,i.filter=r;var l=i._handler=new Bt;l.on(e,n.EVENT_TYPE.UPDATED_ORDER,(function(){i.filter=i.filter}));var a=function(t){if(n.EVENT_TYPE.hasOwnProperty(t)){var r=n.EVENT_TYPE[t];l.on(e,r,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i.fireListeners.apply(i,o([r],t))}))}};for(var s in n.EVENT_TYPE)a(s);return i}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return xr.EVENT_TYPE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filter",{get:function(){var t;return(null===(t=this._filterData)||void 0===t?void 0:t.filter)||null},set:function(t){this._filterData&&this._filterData.cancel(),this._filterData=t?new fl(this,this._dataSource,t):null,this.setLength(this._dataSource.length)},enumerable:!1,configurable:!0}),n.prototype.getOriginal=function(e){return this._filterData?this._filterData.get(e):t.prototype.getOriginal.call(this,e)},n.prototype.sort=function(t,e){return this._dataSource.sort(t,e)},Object.defineProperty(n.prototype,"source",{get:function(){return this._dataSource.source},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this._handler.dispose(),t.prototype.dispose.call(this)},n.prototype.refreshInternal=function(){this.filter=this.filter},n}(xr);function pl(t,e,n){for(var o=[],r=0,i=e;r<i.length;r++){var l=i[r],a=l.field,s=JSON.stringify(t[l.field])||"";n[a]=n[a]||{},n[a][s]=!0,o.push(s)}return o.join("_")}!function(t){t[t.count=0]="count",t[t.sum=1]="sum",t[t.avg=2]="avg",t[t.max=3]="max",t[t.min=4]="min"}(cl||(cl={}));var gl=function(t){function n(e,n){var o=t.call(this,e)||this;return o._records=[],o._keysMap={},o._distinctMap={},o._dataSource=e,o._options=n,o.refresh(),o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return xr.EVENT_TYPE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),n.prototype.getOriginal=function(t){return this._records[t]},n.prototype.refresh=function(){this._keysMap={};for(var t={},e=this._options.rowPivots||[],n=this._options.colPivots||[],o=new Date,r=0;r<this._dataSource.length;r++){var i=this._dataSource.get(r),l=pl(i,e,t),a=pl(i,n,t);this._keysMap[l]=this._keysMap[l]||{},this._keysMap[l][a]=this._keysMap[l][a]||[],this._keysMap[l][a].push(i)}for(var s in this._distinctMap={},t)if(t.hasOwnProperty(s)){this._distinctMap[s]=[];var c=t[s];for(var u in c)c.hasOwnProperty(u)&&this._distinctMap[s].push(u)}var h=new Date,f=Number(h)-Number(o);window.console.log(f),this._records=[],this.length=this._records.length},n}(xr),vl={CachedDataSource:ul,DataSource:xr,FilterDataSource:dl,PivotDataSource:gl,TreeDataSource:Mr},yl=function(){function t(t){void 0===t&&(t={}),this._disabled=t.disabled||!1}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled!==t&&(this._disabled=t,this.onChangeDisabledInternal())},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this)},t.prototype.bindGridEvent=function(t,e){return[]},t.prototype.onChangeDisabledInternal=function(){},t}();function _l(t,e,n){var o,r=n.action,i=n.mouseOver,l=n.mouseOut;function a(n,o){return t.getLayoutCellId(n,o)===e}return[t.listen(N.CLICK_CELL,(function(t){a(t.col,t.row)&&r({col:t.col,row:t.row})})),t.listen(N.MOUSEOVER_CELL,(function(e){a(e.col,e.row)&&(i&&!i({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer",o=!0))})),t.listen(N.MOUSEMOVE_CELL,(function(e){a(e.col,e.row)&&o&&!t.getElement().style.cursor&&(t.getElement().style.cursor="pointer")})),t.listen(N.MOUSEOUT_CELL,(function(e){a(e.col,e.row)&&(l&&l({col:e.col,row:e.row}),t.getElement().style.cursor="",o=!1)}))]}function bl(t,e,n){var r=n.action,i=n.acceptKeys,l=void 0===i?[]:i;return l=o(l,[V,32]),[t.listen(N.KEYDOWN,(function(n){var o;if(-1!==l.indexOf(n.keyCode)&&(!(null===(o=t.keyboardOptions)||void 0===o?void 0:o.moveCellOnEnter)||n.keyCode!==V)){var i,a,s=t.selection.select;if(i=s.col,a=s.row,t.getLayoutCellId(i,a)===e)r({col:s.col,row:s.row}),M.cancel(n.event)}}))]}var wl=function(t,e,n){return"function"==typeof t?!!t(e,n):!!t},ml=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.bindGridEvent=function(t,e){var n=this,r=this.getState(t),i=function(e){var o=e.col,i=e.row,l=t.getCellRange(o,i),a=l.start.col+":"+l.start.row;if(!wl(n.disabled,t,{col:l.start.col,row:l.start.row})&&!r.block[a]){var s=t.getHeaderValue(l.start.col,l.start.row);t.setHeaderValue(l.start.col,l.start.row,!s);vt(200,(function(e){1===e?delete r.elapsed[a]:r.elapsed[a]=e,t.invalidateCellRange(l)}))}};return o(_l(t,e,{action:i,mouseOver:function(e){var o=t.getCellRange(e.col,e.row);return!wl(n.disabled,t,{col:o.start.col,row:o.start.row})&&(r.mouseActiveCell={col:e.col,row:e.row},t.invalidateCellRange(o),!0)},mouseOut:function(e){delete r.mouseActiveCell;var n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),bl(t,e,{action:i,acceptKeys:[V,32]}))},n}(yl),Cl=et(),xl=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Cl];return e||(e={elapsed:{},block:{}},B.setReadonly(t,Cl,e)),e},n}(ml),Rl=nt(),El=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Rl];return e||(e={elapsed:{},block:{}},B.setReadonly(t,Rl,e)),e},n}(ml),Ol=function(t){function n(e){var n;void 0===e&&(e={});var o=t.call(this,e)||this;return o._sort=null===(n=e.sort)||void 0===n||n,o}return e(n,t),Object.defineProperty(n.prototype,"sort",{get:function(){return this._sort},set:function(t){this._sort=t,this.onChangeDisabledInternal()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype._executeSort=function(t,e){if("function"==typeof this._sort)this._sort({order:t.order||"asc",col:t.col,row:t.row,grid:e});else{var n=Math.min(e.recordRowCount-1,t.row)+e.frozenRowCount,o=e.getField(t.col,n);if(null==o)return;e.dataSource.sort(o,t.order||"asc")}},n.prototype.bindGridEvent=function(t,e){var n=this;return o(_l(t,e,{action:function(o){if(!wl(n.disabled,t,o)){var r,i,l,a=t.sortState,s=t.getCellRange(o.col,o.row);i=a.col,l=o.row,r=t.getLayoutCellId(i,l)===e?{col:s.start.col,order:"asc"===a.order?"desc":"asc",row:s.start.row}:{col:s.start.col,order:"asc",row:s.start.row},t.sortState=r,n._executeSort(r,t),t.invalidateGridRect(0,0,t.colCount-1,t.rowCount-1)}},mouseOver:function(e){return!wl(n.disabled,t,e)}}))},n}(yl),Ll=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),n}(xl),kl=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),n}(Ol),Sl=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),n}(El),Il={SORT:new kl,CHECK:new Ll,SWITCH:new Sl};function Tl(t){if(t){if("string"==typeof t){var e=t.toUpperCase();return Il[e]||Tl(null)}return t}}var Pl,Bl,Al,Ml,Dl,jl,Fl,Wl,Hl={CHANGE_STYLE:"change_style"},zl=function(t){function n(e){var n=(void 0===e?{}:e).bgColor,o=t.call(this)||this;return o._bgColor=n,o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return Hl},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DEFAULT",{get:function(){return Pl||(Pl=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.doChangeStyle=function(){this.fireListeners(Hl.CHANGE_STYLE)},n.prototype.clone=function(){return new n(this)},n}(Xe),Nl=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._textAlign=e.textAlign||"left",n._textBaseline=e.textBaseline||"middle",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Bl||(Bl=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textAlign",{get:function(){return this._textAlign},set:function(t){this._textAlign=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(zl),Vl=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._color=e.color,n._font=e.font,n._padding=e.padding,n._textOverflow=e.textOverflow||"ellipsis",n._lineHeight=e.lineHeight||"1em",n._autoWrapText=e.autoWrapText||!1,n._lineClamp=e.lineClamp||"auto",n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Al||(Al=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"textOverflow",{get:function(){return this._textOverflow},set:function(t){this._textOverflow=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lineClamp",{get:function(){return this._lineClamp},set:function(t){this._lineClamp=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"autoWrapText",{get:function(){return this._autoWrapText},set:function(t){this._autoWrapText=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Nl),Ul=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,_(e,{textAlign:"center"}))||this;return n._uncheckBgColor=e.uncheckBgColor,n._checkBgColor=e.checkBgColor,n._borderColor=e.borderColor,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Ml||(Ml=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uncheckBgColor",{get:function(){return this._uncheckBgColor},set:function(t){this._uncheckBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"checkBgColor",{get:function(){return this._checkBgColor},set:function(t){this._checkBgColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Vl),Kl=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Dl||(Dl=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Ul),Gl=function(t){function n(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n._sortArrowColor=e.sortArrowColor,n}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return jl||(jl=new n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortArrowColor",{get:function(){return this._sortArrowColor},set:function(t){this._sortArrowColor=t,this.doChangeStyle()},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Vl),Yl=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Fl||(Fl=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Ul),Xl=function(t){function n(e){return void 0===e&&(e={}),t.call(this,e)||this}return e(n,t),Object.defineProperty(n,"DEFAULT",{get:function(){return Wl||(Wl=new n)},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n}(Vl);function ql(t,e,n){return t?t instanceof zl?t:"function"==typeof t?ql(t(e),e,n):"string"==typeof t?e&&t in e?ql(e[t],e,n):new n({}):new n(t):n.DEFAULT}var $l=function(){function t(t){this.onDrawCell=this.onDrawCell.bind(this)}return Object.defineProperty(t.prototype,"StyleClass",{get:function(){return zl},enumerable:!1,configurable:!0}),t.prototype.onDrawCell=function(t,e,n,o){var r=e.style,i=e.drawCellBase,l=o.getGridCanvasHelper();i(),this.drawInternal(this.convertInternal(t),n,ql(r,o.headerValues,this.StyleClass),l,o,e)},t.prototype.convertInternal=function(t){return"function"==typeof t&&(t=t()),c(t)?""+t:""},t.prototype.bindGridEvent=function(t,e){return[]},t}(),Zl=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.drawCellBase,a=n.textAlign,s=n.textBaseline,u=n.borderColor,h=n.checkBgColor,f=n.uncheckBgColor,d=n.bgColor,p=n.color,g=n.font,v=n.textOverflow;d&&l({bgColor:d});var y=e.col,_=e.row,b=r.getCellRange(y,_),w=b.start.col+":"+b.start.row,m=this.getState(r),C=null==m?void 0:m.elapsed[w],x=r.getHeaderValue(b.start.col,b.start.row),R={textAlign:a,textBaseline:s,borderColor:u,checkBgColor:h,uncheckBgColor:f};c(C)&&(R.animElapsedTime=C);var E=this.getInlineCheck(o,!!x,e,R);o.text([E,t],e,{color:p,font:g,textAlign:a,textBaseline:s,textOverflow:v})},n}($l),Jl=et(),Ql=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Kl},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[Jl];return e||(e={elapsed:{},block:{}},B.setReadonly(t,Jl,e)),e},n.prototype.getInlineCheck=function(t,e,n,o){return t.buildCheckBoxInline(e,n,o)},n}(Zl),ta=function(t,e,n,o){if(t){var r=De.toNormarizeArray(t);r.forEach((function(t){n.testFontLoad(t.font,t.content,e)})),t=r}o(t,e)},ea=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Vl},enumerable:!1,configurable:!0}),n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.drawCellBase,a=i.getHeaderIcon,s=n.textAlign,u=n.textBaseline,h=n.color,f=n.font,d=n.bgColor,p=n.textOverflow,g=n.padding,v=n.lineHeight,y=n.autoWrapText,_=n.lineClamp;d&&l({bgColor:d});var b=(c(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");o.testFontLoad(f,t,e),ta(a(),e,o,(function(e,n){b.length>1?o.multilineText(b,n,{color:h,font:f,icons:e,textAlign:s,textBaseline:u,textOverflow:p,padding:g,lineHeight:v,autoWrapText:y,lineClamp:_}):o.text(t,n,{color:h,font:f,icons:e,padding:g,textAlign:s,textBaseline:u,textOverflow:p})}))},n}($l),na=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Gl},enumerable:!1,configurable:!0}),n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.drawCellBase,a=n.textAlign,s=n.textBaseline||"middle",u=n.color,h=n.bgColor,f=n.padding,d=n.lineHeight,p=n.autoWrapText,g=n.lineClamp,v=n.font,y=n.textOverflow,_=n.sortArrowColor;h&&l({bgColor:h});var b=r.sortState,w=void 0,m=e.col,C=e.row;L(r.getCellRange(m,C),b.col,b.row)&&(w=b.order);var x=e.getContext(),R=1.2*Qo(x,v).width,E=(c(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n"),O=[{color:o.getColor(_||o.theme.header.sortArrowColor,m,C,x)||"rgba(0, 0, 0, 0.38)",name:c(w)?"asc"===w?"arrowDownward":"arrowUpward":void 0,width:R}];E.length>1?o.multilineText(E,e,{autoWrapText:p,color:u,font:v,icons:O,lineClamp:g,lineHeight:d,padding:f,textAlign:a,textBaseline:s,textOverflow:y}):o.text(E,e,{color:u,font:v,icons:O,padding:f,textAlign:a,textBaseline:s,textOverflow:y})},n}($l),oa=nt(),ra=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Yl},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.getState=function(t){var e=t[oa];return e||(e={elapsed:{},block:{}},B.setReadonly(t,oa,e)),e},n.prototype.getInlineCheck=function(t,e,n,o){return t.buildSwitchBtnInline(e,n,o)},n}(Zl),ia=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"StyleClass",{get:function(){return Xl},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this)},n.prototype.drawInternal=function(t,e,n,o,r,i){var l=i.drawCellBase,a=n.textAlign,s=n.textBaseline,c=n.color,u=n.font,h=n.bgColor,f=n.lineHeight,d=n.autoWrapText,p=n.lineClamp,g=n.textOverflow;h&&l({bgColor:h});var v=t.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");o.testFontLoad(u,t,e),o.multilineText(v,e,{textAlign:a,textBaseline:s,color:c,font:u,lineHeight:f,autoWrapText:d,lineClamp:p,textOverflow:g})},n}($l),la={DEFAULT:new ea,SORT:new na,CHECK:new Ql,SWITCH:new ra,MULTILINETEXT:new ia};function aa(t){if(t){if("string"==typeof t){var e=t.toUpperCase();return la[e]||aa(null)}return t}return la.DEFAULT}var sa={action:{ACTIONS:Il,BaseAction:yl,BaseCheckAction:ml,SortHeaderAction:Ol,CheckHeaderAction:xl,SwitchHeaderAction:El,of:Tl,ofCell:function(t){if(t.sort){if("function"==typeof t.sort){var e=t.sort;return new kl({sort:function(n){var o=n.order,r=n.col,i=n.grid;return e.call(t,o,r,i)}})}return Il.SORT}return Tl(t.headerAction)}},style:{BaseStyle:zl,BaseStdStyle:Nl,BaseCheckStyle:Ul,Style:Vl,SortHeaderStyle:Gl,CheckHeaderStyle:Kl,SwitchHeaderStyle:Yl,MultilineTextHeaderStyle:Xl,of:ql},type:{TYPES:la,BaseHeader:$l,BaseCheckHeader:Zl,Header:ea,SortHeader:na,CheckHeader:Ql,SwitchHeader:ra,MultilineTextHeader:ia,of:aa,ofCell:function(t){return t.sort?la.SORT:aa(t.headerType)}}},ca={};var ua={};var ha={borderColor:"#000",button:{bgColor:"#2196F3",color:"#FFF"},checkbox:{borderColor:"#000",checkBgColor:"rgb(76, 73, 72)",uncheckBgColor:"#FFF"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"#000",uncheckBorderColor:"#000",uncheckBgColor:"#FFF",checkBgColor:"#FFF"},color:"#000",defaultBgColor:function(t){var e=t.row,n=t.grid;return e<n.frozenRowCount?"#FFF":1&n.getRecordIndexByRow(e)?"#F6F6F6":"#FFF"},frozenRowsBgColor:function(t){var e=t.col,n=t.grid,o=t.grid.frozenRowCount,r=t.context,i=n.getCellRelativeRect(e,0),l=i.left;return function(t,e,n,o,r,i){var l=[];for(var a in i)i.hasOwnProperty(a)&&l.push(a+"@"+i[a]);var s=e+"/"+n+"/"+o+"/"+r+"/"+l.join(","),c=ua[s];if(c)return c;var u=t.createLinearGradient(e,n,e,r);for(var h in i)i.hasOwnProperty(h)&&u.addColorStop(Number(h),i[h]);return ua[s]=u}(r,l,i.top,l,n.getCellRelativeRect(e,o-1).bottom,{0:"#FFF",1:"#D3D3D3"})},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},highlightBorderColor:"#5E9ED6",selectionBgColor:"#CCE0FF",selectionDragBgColor:"#EAF2FF",switch:{borderColor:"#000",checkBgColor:"#008CD6",uncheckBgColor:"#FFF"},tree:{lineColor:"rgb(76, 73, 72)",buttonColor:"rgb(76, 73, 72)",buttonBgColor:"transparent",buttonBorderColor:"rgb(76, 73, 72)",linkColor:"rgb(76, 73, 72)"},underlayBackgroundColor:"#F6F6F6"};var fa={borderColor:function(t){var e=t.col,n=t.row,o=t.grid,r=o.colCount,i=o.frozenColCount,l=o.recordRowCount,a="#ccc7c7",s="#ccc7c7";if(l>1){var c=o.getRecordStartRowByRecordIndex(o.getRecordIndexByRow(n));c!==n&&(a=null),c+l-1!==n&&(s=null)}return i-1===e||r-1===e?[a,"#f2f2f2",s,null]:[a,null,s,null]},button:{bgColor:"#2196F3",color:"#FFF"},checkbox:{borderColor:"rgba(0, 0, 0, 0.26)",checkBgColor:"rgb(76, 73, 72)"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"rgb(76, 73, 72)",uncheckBorderColor:"rgb(189, 189, 189)"},color:"rgba(0, 0, 0, 0.87)",defaultBgColor:"#FFF",frozenRowsBorderColor:function(t){var e=t.row;return t.grid.frozenRowCount-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]},frozenRowsColor:"rgba(0, 0, 0, 0.54)",header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},highlightBorderColor:"#5E9ED6",selectionBgColor:"#CCE0FF",selectionDragBgColor:"#EAF2FF",switch:{borderColor:"#BFBFBF",checkBgColor:"#008CD6"},tree:{lineColor:"rgba(0, 0, 0, 0.3)",buttonColor:"rgba(0, 0, 0, 0.45)",buttonBgColor:"transparent",buttonBorderColor:"rgba(0, 0, 0, 0.3)",linkColor:"rgba(0, 0, 0, 0.3)"},underlayBackgroundColor:"#FFF"},da=G("protected.theme");function pa(t,e,n,r){return C.apply(void 0,o([t],n))||C.apply(void 0,o([e],n))||r&&C.apply(void 0,o([t],r))||r&&C.apply(void 0,o([e],r))}var ga=function(){function t(t,e){this._checkbox=null,this._radioButton=null,this._button=null,this._header=null,this._switch=null,this._tree=null,this[da]={obj:t,superTheme:e}}return Object.defineProperty(t.prototype,"underlayBackgroundColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["underlayBackgroundColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return pa(this[da].obj,this[da].superTheme,["font"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsFont",{get:function(){return pa(this[da].obj,this[da].superTheme,["frozenRowsFont"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return pa(this[da].obj,this[da].superTheme,["color"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["frozenRowsColor"],["color"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBgColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["defaultBgColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsBgColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["frozenRowsBgColor"],["defaultBgColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusBgColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["focusBgColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionBgColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["selectionBgColor"],["defaultBgColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionDragBgColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["selectionDragBgColor"],["selectionBgColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBgColor",{get:function(){var t=this;if(this.hasProperty(["highlightBgColor"])){var e=this[da];return pa(e.obj,e.superTheme,["highlightBgColor"])}return function(e){var n=e.row<e.grid.frozenRowCount?t.frozenRowsBgColor:t.defaultBgColor;return"function"==typeof n?n(e):n}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borderColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["borderColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsBorderColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["frozenRowsBorderColor"],["borderColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBorderColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["highlightBorderColor"],["borderColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridBorderColor",{get:function(){return pa(this[da].obj,this[da].superTheme,["gridBorderColor"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridBorderWidth",{get:function(){return pa(this[da].obj,this[da].superTheme,["gridBorderWidth"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultRowHeight",{get:function(){return pa(this[da].obj,this[da].superTheme,["defaultRowHeight"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultColWidth",{get:function(){return pa(this[da].obj,this[da].superTheme,["defaultColWidth"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBorderWidth",{get:function(){return pa(this[da].obj,this[da].superTheme,["highlightBorderWidth"])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"checkbox",{get:function(){var t=this[da].obj,e=this[da].superTheme;return this._checkbox||(this._checkbox={get uncheckBgColor(){return pa(t,e,["checkbox","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return pa(t,e,["checkbox","checkBgColor"],["color"])},get borderColor(){return pa(t,e,["checkbox","borderColor"])}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radioButton",{get:function(){var t=this[da],e=t.obj,n=t.superTheme;return this._radioButton||(this._radioButton={get checkColor(){return pa(e,n,["radioButton","checkColor"],["color"])},get uncheckBorderColor(){return pa(e,n,["radioButton","uncheckBorderColor"],["borderColor"])},get checkBorderColor(){return pa(e,n,["radioButton","checkBorderColor"],["borderColor"])},get uncheckBgColor(){return pa(e,n,["radioButton","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return pa(e,n,["radioButton","checkBgColor"],["defaultBgColor"])}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){var t=this[da].obj,e=this[da].superTheme;return this._button||(this._button={get color(){return pa(t,e,["button","color"],["color"])},get bgColor(){return pa(t,e,["button","bgColor"],["defaultBgColor"])}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){var t=this[da].obj,e=this[da].superTheme;return this._header||(this._header={get sortArrowColor(){return pa(t,e,["header","sortArrowColor"])}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"switch",{get:function(){var t=this[da].obj,e=this[da].superTheme;return this._switch||(this._switch={get uncheckBgColor(){return pa(t,e,["switch","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return pa(t,e,["switch","checkBgColor"],["color"])},get borderColor(){return pa(t,e,["switch","borderColor"])}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tree",{get:function(){var t=this[da].obj,e=this[da].superTheme;return this._tree||(this._tree={get lineColor(){return pa(t,e,["tree","lineColor"])},get buttonColor(){return pa(t,e,["tree","buttonColor"],["color"])},get buttonBgColor(){return pa(t,e,["tree","buttonBgColor"],["defaultBgColor"])},get buttonBorderColor(){return pa(t,e,["tree","buttonBorderColor"])},get linkColor(){return pa(t,e,["tree","linkColor"])}})},enumerable:!1,configurable:!0}),t.prototype.hasProperty=function(t){var e=this[da],n=e.obj,o=e.superTheme;return va(n,t)||va(o,t)},t.prototype.extends=function(e){return new t(e,this)},t}();function va(t,e){if(t instanceof ga)return t.hasProperty(e);var n=t;if(!n)return!1;for(var o=0;o<e.length;o++){if(!(n=n[e[o]]))return!1}return!!n}var ya=new ga(ha),_a=new ga(fa),ba={BASIC:ya,MATERIAL_DESIGN:_a},wa=_a;function ma(t){if(!t)return null;if("string"==typeof t){var e=function(t,e){if(t[e])return t[e];var n=e.toLowerCase();if(t[n])return t[n];var o=e.toLowerCase();if(t[o])return t[o];for(var r in t)if(r.toLowerCase()===n)return t[r]}(Ca(),t);return e||null}return t instanceof ga?t:new ga(t)}function Ca(){return b(ba,ca)}var xa={BASIC:ya,MATERIAL_DESIGN:_a,theme:{Theme:ga},of:ma,getDefault:function(){return wa},setDefault:function(t){wa=ma(t)||wa},getChoices:Ca},Ra={};function Ea(t){return parseInt(t,16)}function Oa(t,e,n,o){return void 0===o&&(o=1),{r:t,g:e,b:n,a:o}}function La(t){var e=t.r,n=t.g,o=t.b,r=t.a;return 0<=e&&e<=255&&0<=n&&n<=255&&0<=o&&o<=255&&0<=r&&r<=1}function ka(t){return Math.ceil(255*t/100)}function Sa(t){if(/^#[0-9a-f]{3}$/i.exec(t))return function(t){var e=t[1],n=t[2],o=t[3];return Oa(Ea(e+e),Ea(n+n),Ea(o+o))}(t);if(/^#[0-9a-f]{6}$/i.exec(t))return function(t){var e=t[1],n=t[2],o=t[3],r=t[4],i=t[5],l=t[6];return Oa(Ea(e+n),Ea(o+r),Ea(i+l))}(t);var e,n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(t);if(n&&La(e=Oa(Number(n[1]),Number(n[2]),Number(n[3]))))return e;if((n=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t))&&La(e=Oa(Number(n[1]),Number(n[2]),Number(n[3]),Number(n[4]))))return e;if((n=/^rgb\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*\)$/i.exec(t))&&La(e=Oa(ka(Number(n[1])),ka(Number(n[3])),ka(Number(n[5])))))return e;if((n=/^rgba\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t))&&La(e=Oa(ka(Number(n[1])),ka(Number(n[3])),ka(Number(n[5])),Number(n[7]))))return e;return null}function Ia(t){return"string"!=typeof t?Oa(0,0,0,0):(t=t.toLowerCase().trim(),Ra[t]?Ra[t]:Sa(t)||(Ra[t]=function(t){var e=document.createElement("div"),n=e.style;n.color=t,n.position="fixed",n.height="1px",n.width="1px",n.opacity="0",document.body.appendChild(e);var o=(document.defaultView||window).getComputedStyle(e,"").color;return document.body.removeChild(e),Sa(o||"")}(t)))}function Ta(t,e,n){var o=Ia(t),r=Ia(e),i=function(t){var e=o[t],i=r[t];if(n>=1)return i;if(n<=0)return e;var l=e-i;return Math.ceil(e-l*n)};return"rgb("+i("r")+", "+i("g")+", "+i("b")+")"}var Pa=Math.ceil,Ba=Math.PI;function Aa(t,e,n,o,r,i){t.beginPath(),t.arc(e+i,n+i,i,-Ba,-.5*Ba,!1),t.arc(e+o-i,n+i,i,-.5*Ba,0,!1),t.arc(e+o-i,n+r-i,i,0,.5*Ba,!1),t.arc(e+i,n+r-i,i,.5*Ba,Ba,!1),t.closePath()}function Ma(t,e,n,o,r,i){Aa(t,e,n,o,r,i),t.fill()}function Da(t,e,n,o,r,i){Aa(t,e,n,o,r,i),t.stroke()}function ja(t,e,n,o,r){var i=Math.min(o,r)/2;t.beginPath(),t.arc(e+i,n+i,i,0,2*Math.PI),t.closePath(),t.fill()}function Fa(t,e,n,o,r){var i=Math.min(o,r)/2;t.beginPath(),t.arc(e+i,n+i,i,0,2*Math.PI),t.closePath(),t.stroke()}function Wa(t){return{width:Qo(t,null).width}}function Ha(t){return{width:Qo(t,null).width}}var za={drawButton:function(t,e,n,o,r,i){void 0===i&&(i={});var l=i.backgroundColor,a=void 0===l?"#FFF":l,s=i.bgColor,c=void 0===s?a:s,u=i.radius,h=void 0===u?4:u,f=i.shadow,d=void 0===f?{}:f;t.save();try{if(t.fillStyle=c,d){var p=d.color,g=void 0===p?"rgba(0, 0, 0, 0.24)":p,v=d.blur,y=void 0===v?1:v,_=d.offsetX,b=void 0===_?0:_,w=d.offsetY,m=void 0===w?2:w,C=d.offset,x=void 0===C?{}:C,R=x.x,E=void 0===R?b:R,O=x.y,L=void 0===O?m:O;t.shadowColor=g,t.shadowBlur=y,t.shadowOffsetX=E,t.shadowOffsetY=L}Ma(t,Pa(e),Pa(n),Pa(o),Pa(r),h)}finally{t.restore()}},drawCheckbox:function(t,e,n,o,r){var i=void 0===r?{}:r,l=i.uncheckBgColor,a=void 0===l?"#FFF":l,s=i.checkBgColor,c=void 0===s?"rgb(76, 73, 72)":s,u=i.borderColor,h=void 0===u?"#000":u,f=i.boxSize,d=void 0===f?Wa(t).width:f,p="number"==typeof o?o>1?1:o:1;t.save();try{t.fillStyle=o?c:a;var g=Pa(e),v=Pa(n),y=Pa(d);if(Ma(t,g-1,v-1,y+1,y+1,d/5),t.lineWidth=1,t.strokeStyle=h,Da(t,g-.5,v-.5,y,y,d/5),o){t.lineWidth=Pa(d/10),t.strokeStyle=a;var _=d/4,b=d/2*.9,w=e+.2*d,m=n+d/2;p<.5&&(_*=2*p),t.beginPath(),t.moveTo(w,m),t.lineTo(w+_,m+_),p>.5&&(p<1&&(b*=2*(p-.5)),t.lineTo(w+_+b,m+_-b)),t.stroke()}}finally{t.restore()}},drawInlineImageRect:function(t,e,n,o,r,i,l,a,s,c,u,h,f){var d=void 0===f?{}:f,p=d.offset,g=void 0===p?2:p,v=d.padding,y={bottom:c+h,height:h,left:s,right:s+u,top:c,width:u};t.save();try{t.beginPath(),t.rect(y.left,y.top,y.width,y.height),t.clip();var _=tr(t,y,l,a,{offset:g,padding:v});t.drawImage(e,n,o,r||l,i||a,_.x,_.y,l,a)}finally{t.restore()}},drawRadioButton:function(t,e,n,o,r){var i=void 0===r?{}:r,l=i.checkColor,a=void 0===l?"rgb(76, 73, 72)":l,s=i.borderColor,c=void 0===s?"#000":s,u=i.bgColor,h=void 0===u?"#FFF":u,f=i.boxSize,d=void 0===f?Ha(t).width:f,p="number"==typeof o?o>1?1:o:1;t.save();try{t.fillStyle=h;var g=Pa(e),v=Pa(n),y=Pa(d);if(ja(t,g-1,v-1,y+1,y+1),t.lineWidth=1,t.strokeStyle=c,Fa(t,g-.5,v-.5,y,y),o){var _=y*p/2,b=(y-_)/2;t.fillStyle=a,ja(t,Pa(100*(g-.5+b))/100,Pa(100*(v-.5+b))/100,Pa(100*_)/100,Pa(100*_)/100)}}finally{t.restore()}},drawSwitchButton:function(t,e,n,o,r,i){var l=void 0===i?{}:i,a=l.uncheckBgColor,s=void 0===a?"#FFF":a,c=l.checkBgColor,u=void 0===c?"#008CD6":c,h=l.borderColor,f=void 0===h?"#BFBFBF":h,d=l.btnSize,p=void 0===d?{width:44,height:22}:d;r=r>1?1:r<0?0:r;var g=2*p.height/22,v=12*p.height/22,y=14*p.height/22;t.save();try{var _=void 0,b=void 0,w=void 0;0<r&&r<1?(_=o?Ta(f,u,r):Ta(u,f,r),b=o?Ta(f,s,r):Ta(s,f,r),w=o?Ta(s,u,r):Ta(u,s,r)):(_=o?u:f,b=o?s:f,w=o?u:s);var m=e,C=n,x=p.width,R=p.height;t.fillStyle=_,Ma(t,m,C,x,R,R/2),t.textAlign="center",t.textBaseline="middle",t.font=v+"px sans-serif",t.fillStyle=b,t.fillText("是",m+y,C+R/2),t.fillStyle=w,t.fillText("否",m+x-y,C+R/2);var E=R-2*g,O=E,L=m+g+(x-2*g-E)*(o?r:1-r),k=C+g;t.fillStyle=s,Ma(t,L,k,E,O,O/2)}finally{t.restore()}},drawSwitchBtn:function(t,e,n,o,r,i){var l=void 0===i?{}:i,a=l.uncheckBgColor,s=void 0===a?"#FFF":a,c=l.checkBgColor,u=void 0===c?"#3BCD4F":c,h=l.borderColor,f=void 0===h?"#D9D9D9":h,d=l.btnSize,p=void 0===d?{width:52,height:32}:d;r=r>1?1:r<0?0:r;var g=.078125*p.height;t.save();try{t.fillStyle=o?u:f;var v=Pa(e)-1,y=Pa(n)-1,_=Pa(p.width+1),b=Pa(p.height+1);Ma(t,v,y,_,b,b/2);var w=o?1-r:r;t.fillStyle=s;var m=(_-2*g)*w,C=(b-2*g)*w;Ma(t,v+_/2-m/2,y+b/2-C/2,m,C,C/2);var x=o?r:1-r;t.shadowColor=f,t.shadowOffsetX=0,t.shadowOffsetY=2,t.shadowBlur=3;var R=b-2*g;Ma(t,v+g+(_-2*g-R)*x,y+g,R,R,R/2)}finally{t.restore()}},fillRoundRect:Ma,fillTextRect:function(t,e,n,o,r,i,l){var a=void 0===l?{}:l,s=a.offset,c=void 0===s?2:s,u=a.padding,h={bottom:o+i,height:i,left:n,right:n+r,top:o,width:r};t.save();try{t.beginPath(),t.rect(h.left,h.top,h.width,h.height),t.clip();var f=function(t,e,n){var o=void 0===n?{}:n,r=o.offset,i=void 0===r?0:r,l=o.padding,a=void 0===l?{}:l,s=a.left,c=void 0===s?0:s,u=a.right,h=void 0===u?0:u,f=a.top,d=void 0===f?0:f,p=a.bottom;return tr(t,e,0,0,{offset:i,padding:{bottom:void 0===p?0:p,left:c,right:h,top:d}})}(t,h,{offset:c,padding:u});t.fillText(e,f.x,f.y)}finally{t.restore()}},measureCheckbox:Wa,measureRadioButton:Ha,roundRect:Aa,strokeColorsRect:function(t,e,n,o,r,i){e[0]===e[1]&&e[0]===e[2]&&e[0]===e[3]?e[0]&&(t.strokeStyle=e[0],t.strokeRect(n,o,r,i)):function(n){for(var o=0;o<e.length;o++){var r=e[o],i=e[o-1];if(r){if(i!==r){i&&(t.strokeStyle=i,t.stroke());var l=n[o];t.beginPath(),t.moveTo(l.x,l.y)}var a=n[o+1];t.lineTo(a.x,a.y)}else i&&(t.strokeStyle=i,t.stroke())}var s=e[e.length-1];s&&(t.strokeStyle=s,t.stroke())}([{x:n,y:o},{x:n+r,y:o},{x:n+r,y:o+i},{x:n,y:o+i},{x:n,y:o}])},strokeRoundRect:Da,fillCircle:ja,strokeCircle:Fa},Na={canvasHelper:za},Va=-1;var Ua=function(){function t(){this.headers=[],this.columns=[]}return t.prototype.getHeader=function(t,e){var n=this.headers[e]||(this.headers[e]=[]);return n[t]||(n[t]={id:Va--,define:{},headerType:sa.type.of(null)})},t.prototype.getBody=function(t,e){var n=this.columns[e]||(this.columns[e]=[]);return n[t]||(n[t]={id:Va--,define:{},columnType:Gr.type.of(null),style:null})},t}(),Ka=0,Ga=function(){function t(t){this.bodyRowCount=1,this._emptyDataCache=new Ua,this._columns=[],this._headerCellIds=[],this._headerObjects=this._addHeaders(0,t,[]),this._headerObjectMap=this._headerObjects.reduce((function(t,e){return t[e.id]=e,t}),{}),this._setupHeaderSpan()}return Object.defineProperty(t.prototype,"columnWidths",{get:function(){return this._columns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerRowCount",{get:function(){return this._headerCellIds.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colCount",{get:function(){return this._columns.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerObjects",{get:function(){return this._headerObjects},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columnObjects",{get:function(){return this._columns},enumerable:!1,configurable:!0}),t.prototype.getCellId=function(t,e){return this.headerRowCount<=e?this._columns[t].id:this._headerCellIds[e][t]},t.prototype.getHeader=function(t,e){var n=this.getCellId(t,e);return this._headerObjectMap[n]||this._emptyDataCache.getHeader(t,e)},t.prototype.getBody=function(t,e){return this._columns[t]||this._emptyDataCache.getBody(t,0)},t.prototype.getBodyLayoutRangeById=function(t){for(var e=0;e<this.colCount;e++)if(t===this._columns[e].id)return{start:{col:e,row:0},end:{col:e,row:0}};throw new Error("can not found body layout @id="+t)},t.prototype.getCellRange=function(t,e){var n={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerRowCount<=e)return n;for(var o=this.getCellId(t,e),r=t-1;r>=0&&o===this.getCellId(r,e);r--)n.start.col=r;for(r=t+1;r<this.colCount&&o===this.getCellId(r,e);r++)n.end.col=r;for(var i=e-1;i>=0&&o===this.getCellId(t,i);i--)n.start.row=i;for(i=e+1;i<this.headerRowCount&&o===this.getCellId(t,i);i++)n.end.row=i;return n},t.prototype.getRecordIndexByRow=function(t){return t<this.headerRowCount?-1:t-this.headerRowCount},t.prototype.getRecordStartRowByRecordIndex=function(t){return this.headerRowCount+t},t.prototype._addHeaders=function(t,e,n){var r=this,i=[],l=this._headerCellIds[t]||this._newRow(t);return e.forEach((function(e){var a=r._columns.length,s=Ka++,c={id:s,caption:e.caption,field:e.headerField||e.field,style:e.headerStyle,headerType:sa.type.ofCell(e),action:sa.action.ofCell(e),define:e,icon:e.headerIcon,tooltip:e.headerTooltip,tooltipType:e.headerTooltipType};i[s]=c,l[a]=s;for(var u=t-1;u>=0;u--)r._headerCellIds[u][a]=n[u];if(e.columns)r._addHeaders(t+1,e.columns,o(n,[s])).forEach((function(t){return i.push(t)}));else{var h=e;r._columns.push({id:Ka++,field:h.field,width:h.width,minWidth:h.minWidth,maxWidth:h.maxWidth,icon:h.icon,message:h.message,columnType:Gr.type.of(h.columnType),action:Gr.action.of(h.action),style:h.style,define:h,contentHidden:h.contentHidden,disableResize:h.disableResize,tooltip:h.tooltip,tooltipType:h.tooltipType});for(u=t+1;u<r._headerCellIds.length;u++)r._headerCellIds[u][a]=s}})),i},t.prototype._newRow=function(t){var e=this._headerCellIds[t]=[];if(!this._columns.length)return e;for(var n=this._headerCellIds[t-1],o=0;o<n.length;o++)e[o]=n[o];return e},t.prototype._setupHeaderSpan=function(){for(var t={},e=0;e<this._headerCellIds.length;e++)for(var n=this._headerCellIds[e],o=0;o<n.length;o++){var r=n[o];if(!t[r]){t[r]=!0;var i=this._headerObjectMap[r],l=void 0;"headerRowSpan"in i.define&&(window.console.warn("'headerRowSpan' is deprecated, please use 'rowSpan' instead"),l=i.define.headerRowSpan);var a=void 0;"headerColSpan"in i.define&&(window.console.warn("'headerColSpan' is deprecated, please use 'colSpan' instead"),a=i.define.headerColSpan);var s=Number(i.define.rowSpan||l||1),c=Number(i.define.colSpan||a||1);if(s>1||c>1)for(var u=e;u<e+s;u++)for(var h=o;h<o+c;h++)this._headerCellIds[u][h]=r}}},t}();var Ya=0,Xa=function(){function t(t,e){var n=this;this.objects=[],this.objectGrid=[],this.objectMap={},this.columnCount=0,this.columnWidths=[],t.forEach((function(t,o){var r=0;t.forEach((function(t){var i,l,a=Ya++,s=e(t,a);n.objects.push(s),n.objectMap[a]=s,r=n._findStartCell(r,o);for(var c=Number(null!==(i=t.rowSpan)&&void 0!==i?i:1),u=Number(null!==(l=t.colSpan)&&void 0!==l?l:1),h=o+c,f=r+u,d=o;d<h;d++)for(var p=n._getObjectGridRow(d),g=r;g<f;g++)p[g]=s;1===u&&n._setWidthDataIfAbsent(r,t),n._useColumnIndex(f-1),r=f}))}))}return Object.defineProperty(t.prototype,"rowCount",{get:function(){return this.objectGrid.length},enumerable:!1,configurable:!0}),t.prototype._findStartCell=function(t,e){for(var n=this._getObjectGridRow(e),o=t;o<n.length;o++)if(!n[o])return o;return n.length},t.prototype._getObjectGridRow=function(t){return this.objectGrid[t]||(this.objectGrid[t]=[])},t.prototype._useColumnIndex=function(t){this.columnCount>t||(this.columnCount=t+1)},t.prototype._setWidthDataIfAbsent=function(t,e){this.columnWidths[t]||null==e.width&&null==e.maxWidth&&null==e.minWidth||(this.columnWidths[t]={width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth})},t}(),qa=function(){function t(t){this._columnWidths=[],this._emptyDataCache=new Ua;for(var e=function(t){return Array.isArray(t)?{header:t,body:t}:t}(t),n=this._header=new Xa(e.header,(function(t,e){return{id:e,caption:t.caption,field:t.headerField||t.field,style:t.headerStyle,headerType:sa.type.ofCell(t),action:sa.action.ofCell(t),define:t,icon:t.headerIcon,tooltip:t.headerTooltip,tooltipType:t.headerTooltipType}})),o=this._body=new Xa(e.body,(function(t,e){return{id:e,field:t.field,width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth,icon:t.icon,message:t.message,columnType:Gr.type.of(t.columnType),action:Gr.action.of(t.action),style:t.style,define:t,contentHidden:t.contentHidden,disableResize:t.disableResize,tooltip:t.tooltip,tooltipType:t.tooltipType}})),r=this._columnCount=Math.max(n.columnCount,o.columnCount),i=0;i<r;i++){var l=n.columnWidths[i]||o.columnWidths[i]||{};this._columnWidths[i]=l}}return Object.defineProperty(t.prototype,"columnWidths",{get:function(){return this._columnWidths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerRowCount",{get:function(){return this._header.rowCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bodyRowCount",{get:function(){return this._body.rowCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colCount",{get:function(){return this._columnCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerObjects",{get:function(){return this._header.objects},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columnObjects",{get:function(){return this._body.objects},enumerable:!1,configurable:!0}),t.prototype.getCellId=function(t,e){var n,o,r,i;if(this.headerRowCount<=e){var l=(e-this.headerRowCount)%this.bodyRowCount;return null===(o=null===(n=this._body.objectGrid[l])||void 0===n?void 0:n[t])||void 0===o?void 0:o.id}return null===(i=null===(r=this._header.objectGrid[e])||void 0===r?void 0:r[t])||void 0===i?void 0:i.id},t.prototype.getHeader=function(t,e){var n=this.getCellId(t,e);return this._header.objectMap[n]||this._emptyDataCache.getHeader(t,e)},t.prototype.getBody=function(t,e){var n=this.getCellId(t,e);return this._body.objectMap[n]||this._emptyDataCache.getBody(t,e)},t.prototype.getBodyLayoutRangeById=function(t){for(var e,n=0;n<this.bodyRowCount;n++){var o=this._body.objectGrid[n];if(o)for(var r=0;r<this.colCount;r++)if(t===(null===(e=o[r])||void 0===e?void 0:e.id))return this._getCellRange(this._body,r,n,0)}throw new Error("can not found body layout @id="+t)},t.prototype.getCellRange=function(t,e){if(this.headerRowCount<=e){var n=this.getRecordIndexByRow(e),o=this.getRecordStartRowByRecordIndex(n),r=(e-this.headerRowCount)%this.bodyRowCount;return this._getCellRange(this._body,t,r,o)}return this._getCellRange(this._header,t,e,0)},t.prototype.getRecordIndexByRow=function(t){if(t<this.headerRowCount)return-1;var e=t-this.headerRowCount;return Math.floor(e/this.bodyRowCount)},t.prototype.getRecordStartRowByRecordIndex=function(t){return this.headerRowCount+t*this.bodyRowCount},t.prototype._getCellRange=function(t,e,n,o){var r,i,l,a,s,c,u,h,f,d,p={start:{col:e,row:n+o},end:{col:e,row:n+o}},g=t.objectGrid,v=null===(i=null===(r=g[n])||void 0===r?void 0:r[e])||void 0===i?void 0:i.id;if(null==v)return p;for(var y=e-1;y>=0&&v===(null===(a=null===(l=g[n])||void 0===l?void 0:l[y])||void 0===a?void 0:a.id);y--)p.start.col=y;for(y=e+1;y<t.columnCount&&v===(null===(c=null===(s=g[n])||void 0===s?void 0:s[y])||void 0===c?void 0:c.id);y++)p.end.col=y;for(var _=n-1;_>=0&&v===(null===(h=null===(u=g[_])||void 0===u?void 0:u[e])||void 0===h?void 0:h.id);_--)p.start.row=_+o;for(_=n+1;_<t.rowCount&&v===(null===(d=null===(f=g[_])||void 0===f?void 0:f[e])||void 0===d?void 0:d.id);_++)p.end.row=_+o;return p},t}(),$a=function(){function t(t){this._layoutMap=t}return Object.defineProperty(t.prototype,"headerRowCount",{get:function(){return this.hiddenHeader?0:this._layoutMap.headerRowCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bodyRowCount",{get:function(){return this._layoutMap.bodyRowCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colCount",{get:function(){return this._layoutMap.colCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columnWidths",{get:function(){return this._layoutMap.columnWidths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerObjects",{get:function(){return this._layoutMap.headerObjects},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columnObjects",{get:function(){return this._layoutMap.columnObjects},enumerable:!1,configurable:!0}),t.prototype.getHeader=function(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getHeader(t,e)},t.prototype.getBody=function(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getBody(t,e)},t.prototype.getCellId=function(t,e){return this.hiddenHeader&&(e+=this._layoutMap.headerRowCount),this._layoutMap.getCellId(t,e)},t.prototype.getCellRange=function(t,e){this.hiddenHeader&&(e+=this._layoutMap.headerRowCount);var n=this._layoutMap.getCellRange(t,e);return this.hiddenHeader&&(n.start.row-=this._layoutMap.headerRowCount,n.end.row-=this._layoutMap.headerRowCount),n},t.prototype.getBodyLayoutRangeById=function(t){return this._layoutMap.getBodyLayoutRangeById(t)},t.prototype.getRecordIndexByRow=function(t){return this.hiddenHeader&&(t+=this._layoutMap.headerRowCount),this._layoutMap.getRecordIndexByRow(t)},t.prototype.getRecordStartRowByRecordIndex=function(t){var e=this._layoutMap.getRecordStartRowByRecordIndex(t);return this.hiddenHeader&&(e-=this._layoutMap.headerRowCount),e},t}(),Za=n(n({},N),{CHANGED_HEADER_VALUE:"changed_header_value",CHANGED_VALUE:"changed_value",CELL_RANGE:"cell_range",CELL_VALUE:"cell_value"}),Ja=function(){function t(t){this._grid=t}return t.prototype.dispose=function(){this.detachMessageElement(),this._messageElement&&this._messageElement.dispose(),delete this._messageElement},t.prototype.drawCellMessageInternal=function(t,e,n,o,r,i){},t.prototype.attachMessageElement=function(t,e,n){this._getMessageElement().attach(this._grid,t,e,n)},t.prototype.moveMessageElement=function(t,e){this._getMessageElement().move(this._grid,t,e)},t.prototype.detachMessageElement=function(){this._getMessageElement().detach()},t.prototype.drawCellMessage=function(t,e,n,o,r,i){this.drawCellMessageInternal(t,e,n,o,r,i)},t.prototype._getMessageElement=function(){return this._messageElement||(this._messageElement=this.createMessageElementInternal())},t}(),Qa="kaka-grid__message-element",ts=Qa+"__message",es=Qa+"--hidden",ns=Qa+"--shown";var os=function(){function t(){this._handler=new Bt;var t=this._rootElement=function(){Ft.inject("messageElement",".kaka-grid__message-element {\n  position: absolute;\n  margin-top: -2px;\n  box-sizing: border-box;\n  border-radius: 0 0 3px 3px;\n  background-color: rgba(250, 250, 250, 0.85);\n  padding: 8px 2px;\n  pointer-events: none;\n  user-select: none;\n  border-top: solid 1px rgba(0, 0, 0, 0.87);\n  color: rgba(0, 0, 0, 0.87);\n}\n\n.kaka-grid__message-element--hidden {\n  display: none;\n}\n\n.kaka-grid__message-element--shown {\n  display: block;\n}\n\n.kaka-grid__message-element__message {\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  display: block;\n  width: 100%;\n}\n");var t=Rt("div",{classList:[Qa,es]}),e=Rt("span",{classList:[ts]});return t.appendChild(e),t}();this._messageElement=t.querySelector("."+ts)}return t.prototype.dispose=function(){this.detach(),this._handler.dispose()},t.prototype.attach=function(t,e,n,o){var r=this._rootElement,i=this._messageElement;r.classList.remove(ns),r.classList.add(es),this._attachCell(t,e,n)?(r.classList.add(ns),r.classList.remove(es),i.textContent=o.message):this._detach()},t.prototype.move=function(t,e,n){var o=this._rootElement;o&&this._attachCell(t,e,n)?(o.classList.add(ns),o.classList.remove(es)):this._detach()},t.prototype.detach=function(){this._detach()},t.prototype._detach=function(){var t=this._rootElement;t&&t.parentElement&&(t.parentElement.removeChild(t),t.classList.remove(ns),t.classList.add(es))},t.prototype._attachCell=function(t,e,n){var o=this._rootElement,r=t.getAttachCellsArea(t.getCellRange(e,n)),i=r.element,l=r.rect,a=l.bottom,s=l.left,c=l.width,u=t.frozenRowCount,h=t.frozenColCount;if(n>=u&&u>0){if(a<t.getAttachCellsArea(t.getCellRange(e,u-1)).rect.bottom)return!1}else if(a<0)return!1;if(e>=h&&h>0){if(s<t.getAttachCellsArea(t.getCellRange(h-1,n)).rect.right)return!1}else if(s<0)return!1;var f=i.offsetHeight,d=i.offsetWidth;return!(f<a)&&(!(d<s)&&(o.style.top=a.toFixed()+"px",o.style.left=s.toFixed()+"px",o.style.width=c.toFixed()+"px",o.parentElement!==i&&i.appendChild(o),!0))},t}(),rs="kaka-grid__error-message-element",is=function(t){function n(){var e=t.call(this)||this;return Ft.inject("errorMessageElement",".kaka-grid__error-message-element {\n  border-top: solid 1px #ff1744;\n  color: #ff1744;\n}\n"),e._rootElement.classList.add(rs),e._messageElement.classList.add("kaka-grid__error-message-element__message"),e}return e(n,t),n}(os);function ls(t,e,n){var o=e.bgColor,r=e.color,i=t.getContext(),l=t.getRect();i.fillStyle=o;var a=l.copy();a.left=a.right-24,i.fillRect(a.left,a.top,a.width,a.height-1);var s=r,c=a.left+(a.width-4)/2,u=a.top+(a.height-20)/2;n.fillRectWithState(new je(c,u,4,12),t,{fillColor:s}),n.fillRectWithState(new je(c,u+16,4,4),t,{fillColor:s})}var as=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createMessageElementInternal=function(){return new is},n.prototype.drawCellMessageInternal=function(t,e,n,o,r,i){var l=n.bgColor,a=e.getSelection().select;L(r.getCellRange(e.col,e.row),a.col,a.row)&&r.hasFocusGrid()||o.drawBorderWithClip(e,(function(t){ls(e,{bgColor:"#ff8a80",color:l},o)}))},n}(Ja),ss=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createMessageElementInternal=function(){return new os},n.prototype.drawCellMessageInternal=function(t,e,n,o,r,i){var l=n.bgColor,a=e.getSelection().select;L(r.getCellRange(e.col,e.row),a.col,a.row)&&r.hasFocusGrid()||o.drawBorderWithClip(e,(function(t){!function(t,e,n){var o=e.bgColor,r=e.color,i=t.getContext(),l=t.getRect();i.fillStyle=o;var a=l.copy();a.left=a.right-24,i.fillRect(a.left,a.top,a.width,a.height-1);var s=r,c=a.left+(a.width-4)/2,u=a.top+(a.height-20)/2;n.fillRectWithState(new je(c,u,4,4),t,{fillColor:s}),n.fillRectWithState(new je(c,u+8,4,12),t,{fillColor:s})}(e,{bgColor:"#e0e0e0",color:l},o)}))},n}(Ja),cs="kaka-grid__warning-message-element",us=function(t){function n(){var e=t.call(this)||this;return Ft.inject("warningMessageElement",".kaka-grid__warning-message-element {\n  border-top: solid 1px #dd2c00;\n  color: #dd2c00;\n}\n"),e._rootElement.classList.add(cs),e._messageElement.classList.add("kaka-grid__warning-message-element__message"),e}return e(n,t),n}(os),hs=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createMessageElementInternal=function(){return new us},n.prototype.drawCellMessageInternal=function(t,e,n,o,r,i){var l=n.bgColor,a=e.getSelection().select;L(r.getCellRange(e.col,e.row),a.col,a.row)&&r.hasFocusGrid()||o.drawBorderWithClip(e,(function(t){ls(e,{bgColor:"#ff9e80",color:l},o)}))},n}(Ja),fs={type:"error",message:null},ds={error:function(t){return new as(t)},info:function(t){return new ss(t)},warning:function(t){return new hs(t)}};function ps(t){if(!t||R(t))return fs;if("string"==typeof t)return{message:t,original:t,type:"error"};var e=t.type||"error";return e&&e in ds?{type:e.toLowerCase(),message:""+t.message,original:t}:{type:"error",message:""+t,original:t}}function gs(t){return!!ps(t).message}var vs=function(){function t(t,e){this._attachInfo=null,this._grid=t,this._messageInstances={},this._bindGridEvent(t,e)}return t.prototype.dispose=function(){var t,e=this._messageInstances;for(var n in e)null===(t=e[n])||void 0===t||t.dispose()},t.prototype.drawCellMessage=function(t,e,n,o,r,i){gs(t)&&this._getMessageInstanceOfMessage(t).drawCellMessage(ps(t),e,n,o,r,i)},t.prototype._attach=function(t,e,n){var o=this._attachInfo,r=this._getMessageInstanceOfMessage(n);o&&o.instance!==r&&o.instance.detachMessageElement(),r.attachMessageElement(t,e,ps(n)),this._attachInfo={col:t,row:e,instance:r}},t.prototype._move=function(t,e){var n=this._attachInfo;n&&n.col===t&&n.row===e&&n.instance.moveMessageElement(t,e)},t.prototype._detach=function(){var t=this._attachInfo;t&&(t.instance.detachMessageElement(),this._attachInfo=null)},t.prototype._bindGridEvent=function(t,e){var n=this,o=function(t){var o=e(t.col,t.row);gs(o)?n._attach(t.col,t.row,o):n._detach()};t.listen(Za.SELECTED_CELL,(function(t){t.selected&&(t.before.col===t.col&&t.before.row===t.row||o(t))})),t.listen(Za.SCROLL,(function(){var e=t.selection.select;n._move(e.col,e.row)})),t.listen(Za.CHANGED_VALUE,(function(e){var n=t.selection.select;n.col===e.col&&n.row===e.row&&o(e)})),t.listen(Za.FOCUS_GRID,(function(e){var n=t.selection.select;o(n)})),t.listen(Za.BLUR_GRID,(function(t){n._detach()}))},t.prototype._getMessageInstanceOfMessage=function(t){var e=this._messageInstances,n=ps(t).type;return e[n]||(e[n]=ds[n](this._grid))},t}(),ys={},_s=new DOMParser;function bs(t,e){for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];if(1===o.nodeType){if(e(o))return o;var r=bs(o,e);if(r)return r}}return null}var ws=function(){function t(t){var e=_s.parseFromString(t,"image/svg+xml");this._svg=e.documentElement,this._glyphs={},this._glyphUnis={}}return Object.defineProperty(t.prototype,"svg",{get:function(){return this._svg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFaceElement",{get:function(){return this._fontFace||(this._fontFace=this.findElement((function(t){return"font-face"===t.tagName.toLowerCase()}))),this._fontFace},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontElement",{get:function(){return this._font||(this._font=this.findElement((function(t){return"font"===t.tagName.toLowerCase()}))),this._font},enumerable:!1,configurable:!0}),t.prototype.findElement=function(t){return bs(this.svg,t)},t.prototype.findGlyph=function(t){return this._glyphs[t]||(this._glyphs[t]=this.findElement((function(e){return e.getAttribute("glyph-name")===t})))},t.prototype.findGlyphByUnicode=function(t){return this._glyphUnis[t]||(this._glyphUnis[t]=this.findElement((function(e){return e.getAttribute("unicode")===t})))},t.prototype.walkAllGlyph=function(t){var e=this,n=function(t,o){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];if(1===i.nodeType){var l=i.getAttribute("unicode");if(l&&i.getAttribute("d")){e._glyphUnis[l]||(e._glyphUnis[l]=i);var a=i.getAttribute("glyph-name");a&&!e._glyphs[a]&&(e._glyphs[a]=i),o(i)}else n(i,o)}}};n(this.svg,t)},t}();function ms(t){var e="";switch(t.tagName.toLowerCase()){case"path":case"glyph":e=function(t){return"none"===t.getAttribute("fill")?"":t.getAttribute("d").replace(/[\n\r]/g,"")}(t);break;case"circle":e=function(t){for(var e=Number(t.getAttribute("cx")),n=Number(t.getAttribute("cy")),o=Number(t.getAttribute("r")),r=2*Math.PI/8,i=function(t){return o*Math.cos(t)},l=function(t){return o*Math.sin(t)},a=function(t){return i(t)+o*Math.tan(r/2)*Math.cos(t-Math.PI/2)},s=function(t){return l(t)+o*Math.tan(r/2)*Math.sin(t-Math.PI/2)},c="M"+(e+o)+" "+n,u=1;u<=8;u++){var h=u*r;c+="Q"+(a(h)+e)+" "+(s(h)+n)+" "+(i(h)+e)+" "+(l(h)+n)}return c}(t);break;case"polygon":e="M"+t.getAttribute("points")+"z";break;case"polyline":e="M"+t.getAttribute("points");break;case"g":for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];1===o.nodeType&&(o.getAttribute("fill")||o.setAttribute("fill",t.getAttribute("fill")),e+=ms(o))}break;default:window.console.warn("unsupported:"+t.tagName,"@ "+t.innerHTML)}return e}function Cs(t){void 0===t&&(t={});var e={d:t.d||"",html:t.html||"",height:t.height||0,width:t.width||0};return t.isGlyph&&(e.ud=!0),void 0!==t.offsetX&&(e.offsetX=t.offsetX),void 0!==t.offsetY&&(e.offsetY=t.offsetY),e}var xs=function(t,e){return void 0===e&&(e={}),e.glyphName||e.unicode?function(t,e){var n=new ws(t),o=n.fontFaceElement||{getAttribute:function(t){return null}},r=n.fontElement||{getAttribute:function(t){return null}},i=e.glyphName?n.findGlyph(e.glyphName):e.unicode?n.findGlyphByUnicode(e.unicode):void 0,l=Number(r.getAttribute("horiz-adv-x"))||0,a=Number(r.getAttribute("vert-adv-x"))||0,s=Number(i.getAttribute("horiz-adv-x"))||l||0,c=Number(i.getAttribute("vert-adv-x"))||a||0,u=Number(o.getAttribute("units-per-em"))||1e3,h=u,f=c||u,d=s||u;s>h&&(h=s),c>h&&(h=c);var p=0,g=-(Number(o.getAttribute("descent"))||c);return p+=Math.round((h-d)/2),g+=Math.round((h-f)/2),Cs({d:ms(i),height:h,html:i.outerHTML,isGlyph:!0,offsetX:p,offsetY:g,width:h})}(t,e):function(t){for(var e=new ws(t).svg,n=(e.getAttribute("viewBox")||"").split(" "),o=Number(e.getAttribute("width")||n[2])||0,r=Number(e.getAttribute("height")||n[3])||0,i=0-Number(n[0])||0,l=0-Number(n[1])||0,a="",s=0;s<e.childNodes.length;s++){var c=e.childNodes[s];1===c.nodeType&&(a+=ms(c))}return Cs({d:a,height:r,html:t,offsetX:i,offsetY:l,width:o})}(t)},Rs={add:xs('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M38 26H26v12h-4V26H10v-4h12V10h4v12h12v4z"/></svg>'),arrowDownward:xs('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path fill="#010101" d="M40 24l-2.82-2.82L26 32.34V8h-4v24.34L10.84 21.16 8 24l16 16 16-16z"/></svg>'),arrowUpward:xs('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M8 24l2.83 2.83L22 15.66V40h4V15.66l11.17 11.17L40 24 24 8 8 24z"/></svg>'),edit:xs('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M6 34.5V42h7.5l22.13-22.13-7.5-7.5L6 34.5zm35.41-20.41c.78-.78.78-2.05 0-2.83l-4.67-4.67c-.78-.78-2.05-.78-2.83 0l-3.66 3.66 7.5 7.5 3.66-3.66z"/></svg>'),star:xs('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'),starBorder:xs('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/></svg>'),starHalf:xs('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4V6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"/></svg>')},Es=function(){return b(Rs,ys)};function Os(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function Ls(t,e){var n,o,r,i=1;return t[0]*e[1]-t[1]*e[0]<0&&(i=-1),i*Math.acos((n=function(t,e){return function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e)/(Os(t)*Os(e))}(t,e),o=-1,r=1,Math.min(Math.max(n,o),r)))}function ks(t,e,n,o,r,i,l,a,s,c){if(0!==o&&0!==r){i*=Math.PI/180,o=Math.abs(o),r=Math.abs(r);var u,h,f=function(t,e){var n=Math.cos(e),o=Math.sin(e);return[n*t[0]+o*t[1],-1*o*t[0]+n*t[1]]}([((u=[e,n])[0]-(h=[s,c])[0])/2,(u[1]-h[1])/2],i),d=function(t,e){return[t[0]*e[0],t[1]*e[1]]}(f,f),p=Math.pow(o,2),g=Math.pow(r,2),v=Math.sqrt(d[0]/p+d[1]/g);v>1&&(o*=v,r*=v,p=Math.pow(o,2),g=Math.pow(r,2));var y=Math.sqrt(Math.abs(p*g-p*d[1]-g*d[0])/(p*d[1]+g*d[0]));l===a&&(y*=-1);var _=function(t,e){return[t*e[0],t*e[1]]}(y,[o*f[1]/r,-r*f[0]/o]),b=function(t,e){return[t[0]+e[0],t[1]+e[1]]}(function(t,e){var n=Math.cos(e),o=Math.sin(e);return[n*t[0]-o*t[1],o*t[0]+n*t[1]]}(_,i),function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}([e,n],[s,c])),w=[(f[0]-_[0])/o,(f[1]-_[1])/r],m=[(-1*f[0]-_[0])/o,(-1*f[1]-_[1])/r],C=Ls([1,0],w),x=C,R=C+Ls(w,m);t.save(),t.translate(b[0],b[1]),t.rotate(i),t.scale(o,r),t.arc(0,0,1,x,R,!a),t.restore()}else t.lineTo(s,c)}var Ss=function(t){var e,n,o,r=this,i=0,l=0,a="";function s(){return"CcSsQqTt".indexOf(a)<0?{x:i,y:l}:o}this.M=function(o,s){return t.moveTo(o,s),e=o,n=s,i=o,l=s,a="M",r},this.m=function(t,e){return r.M(t+i,e+l)},this.L=function(e,n){return t.lineTo(e,n),i=e,l=n,a="L",r},this.l=function(t,e){return r.L(t+i,e+l)},this.H=function(t){return r.L(t,l)},this.h=function(t){return r.H(t+i)},this.V=function(t){return r.L(i,t)},this.v=function(t){return r.V(t+l)},this.Z=function(){return t.closePath(),i=e,l=n,a="Z",r},this.z=function(){return r.Z()},this.C=function(e,n,s,c,u,h){return t.bezierCurveTo(e,n,s,c,u,h),i=u,l=h,o={x:2*u-s,y:2*h-c},a="C",r},this.c=function(t,e,n,o,a,s){return r.C(t+i,e+l,n+i,o+l,a+i,s+l)},this.S=function(t,e,n,o){var i=s(),l=i.x,a=i.y;return r.C(l,a,t,e,n,o)},this.s=function(t,e,n,o){return r.S(t+i,e+l,n+i,o+l)},this.Q=function(e,n,s,c){return t.quadraticCurveTo(e,n,s,c),i=s,l=c,o={x:2*s-e,y:2*c-n},a="Q",r},this.q=function(t,e,n,o){return r.Q(t+i,e+l,n+i,o+l)},this.T=function(t,e){var n=s(),o=n.x,i=n.y;return r.Q(o,i,t,e)},this.t=function(t,e){return r.T(t+i,e+l)},this.A=function(e,n,o,s,c,u,h){return ks(t,i,l,e,n,o,s,c,u,h),i=u,l=h,a="A",r},this.a=function(t,e,n,o,a,s,c){return r.A(t,e,n,o,a,s+i,c+l)}};function Is(t,e,n){return"M"===e.toUpperCase()||"L"===e.toUpperCase()||"T"===e.toUpperCase()?(t.command(e,n.next(),n.next()),"M"===e?"L":"m"===e?"l":e):"H"===e.toUpperCase()||"V"===e.toUpperCase()?(t.command(e,n.next()),e):"Z"===e.toUpperCase()?(t.command(e),e):"C"===e.toUpperCase()?(t.command(e,n.next(),n.next(),n.next(),n.next(),n.next(),n.next()),e):"S"===e.toUpperCase()||"Q"===e.toUpperCase()?(t.command(e,n.next(),n.next(),n.next(),n.next()),e):"A"===e.toUpperCase()?(t.command(e,n.next(),n.next(),n.next(),n.next(),n.next(),n.next(),n.next()),e):(console.warn("unsupported:"+e),null)}var Ts=new(function(){function t(){var t=this;this._ops=[],this._commands=new Ss(this);var e=function(e){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t._ops.push({op:e,args:n})}};this.moveTo=e("moveTo"),this.lineTo=e("lineTo"),this.closePath=e("closePath"),this.bezierCurveTo=e("bezierCurveTo"),this.quadraticCurveTo=e("quadraticCurveTo"),this.save=e("save"),this.translate=e("translate"),this.rotate=e("rotate"),this.scale=e("scale"),this.arc=e("arc"),this.restore=e("restore"),this.arcTo=e("arcTo"),this.ellipse=e("ellipse"),this.rect=e("rect")}return t.prototype.command=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var o=e||[],r=0;r<e.length;r++)o[r]-=0;var i=this._commands[t];i.apply(this,o)},t.prototype.parse=function(t){var e=this._ops=[],n=function(t){var e=0;return{next:function(){for(var n="";t.length>e;){var o=t[e];if(e++," ,\n\r\t".indexOf(o)>-1){if(n)return n}else{if("str"==(".+-1234567890".indexOf(o)>-1?"num":"str"))return n?(e--,n):o;if("-+".indexOf(o)>-1&&n)return e--,n;if("."===o&&n.indexOf(".")>-1)return e--,n;n+=o}}return n||null}}}(t);try{for(var o,r="Z",i=function(){if(isNaN(Number(o)))r=Is(l,o,n)||"Z";else{var t=!0;r=Is(l,r,{next:function(){return t?(t=!1,o):n.next()}})||"Z"}},l=this;o=n.next();)i()}catch(e){throw console.log("Error: "+t),e}return e},t}()),Ps=function(){function t(t){if(this._ops=[],void 0!==t)if("string"==typeof t)this._ops=Ts.parse(t);else{if(!t.hasOwnProperty("_ops"))throw new Error("Error: "+typeof t+" is not a valid argument to Path");this._ops=o(t._ops)}}return t.prototype.arc=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"arc",args:t})},t.prototype.arcTo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"arcTo",args:t})},t.prototype.bezierCurveTo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"bezierCurveTo",args:t})},t.prototype.closePath=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"closePath",args:t})},t.prototype.ellipse=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"ellipse",args:t})},t.prototype.lineTo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"lineTo",args:t})},t.prototype.moveTo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"moveTo",args:t})},t.prototype.quadraticCurveTo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"quadraticCurveTo",args:t})},t.prototype.rect=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ops.push({op:"rect",args:t})},t}(),Bs=window.CanvasRenderingContext2D,As=Bs.prototype.fill;function Ms(){return"undefined"==typeof Path2D||S?Ps:Path2D}Bs.prototype.fill=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(e[0]instanceof Ps){var o=e[0];this.beginPath(),o._ops.forEach((function(e){t[e.op].apply(t,e.args)})),As.apply(this,Array.prototype.slice.call(e,1))}else As.apply(this,e)};var Ds={fill:function(t,e,n,o,r,i){e.save();try{var l=t.width,a=t.height,s=t.ud,c=t.x||0,u=t.y||0,h=(r=r||l)/l,f=(i=i||a)/(s?-a:a);n=n||0,o=s?(o||0)+-a*f:o||0,e.translate(n,o),e.scale(h,f),0===c&&0===u||e.translate(c,u);var d=Ms();t.path2d=t.path2d||new d(t.d),e.fill(t.path2d)}finally{e.restore()}},getPath2D:Ms};function js(t,e){return t.measureText(e).width}function Fs(t,e,n,o,r){for(var i=[],l=n.next(),a=0;a<o&&null!==l;a++,l=n.next())i.push(l);var s=js(t,i.join(""));if(s>r)for(;i.length;){if((s-=js(t,i.pop()))<=r)break}else if(s<r)for(;null!==l;){var c=js(t,l);if(s+c>r)break;i.push(l),s+=c,l=n.next()}var u=i.join("").replace(/\s+$/,""),h=e.slice(u.length).replace(/^\s+/,"");return{after:h?new Ws(h):null,before:u?new Ws(u):null}}var Ws=function(){function t(t){this._content=c(t)?String(t):""}return t.prototype.width=function(t){return js(t.ctx,this._content)},t.prototype.font=function(){return null},t.prototype.color=function(){return null},t.prototype.canDraw=function(){return!0},t.prototype.onReady=function(t){},t.prototype.draw=function(t){var e=t.ctx,n=t.canvasHelper,o=t.rect,r=t.offset,i=t.offsetLeft,l=t.offsetRight,a=t.offsetTop,s=t.offsetBottom;n.fillTextRect(e,this._content,o.left,o.top,o.width,o.height,{offset:r+1,padding:{bottom:s,left:i,right:l,top:a}})},t.prototype.canBreak=function(){return!!this._content},t.prototype.splitIndex=function(e){for(var n=this._content,o=A.genChars(n),r=[],i=o.next(),l=0;l<e&&null!==i;l++,i=o.next())r.push(i);var a=r.join(""),s=n.slice(a.length);return{after:s?new t(s):null,before:a?new t(a):null}},t.prototype.breakWord=function(t,e){var n=this._content,o=this.width({ctx:t}),r=Math.floor(this._content.length*e/o);return Fs(t,n,A.genWords(n),r,e)},t.prototype.breakAll=function(t,e){var n=this._content,o=this.width({ctx:t}),r=Math.floor(this._content.length*e/o);return Fs(t,n,A.genChars(n),r,e)},t.prototype.toString=function(){return this._content},t}(),Hs=function(t){function n(e){var n=e.draw,o=e.width,r=e.color,i=t.call(this)||this;return i._draw=n,i._width=o,i._color=r,i}return e(n,t),n.prototype.width=function(t){return this._width},n.prototype.font=function(){return null},n.prototype.color=function(){var t;return null!==(t=this._color)&&void 0!==t?t:null},n.prototype.canDraw=function(){return!0},n.prototype.onReady=function(t){},n.prototype.draw=function(t){var e=t.ctx,n=t.canvasHelper,o=t.rect,r=t.offset,i=t.offsetLeft,l=t.offsetRight,a=t.offsetTop,s=t.offsetBottom;this._draw({ctx:e,canvasHelper:n,rect:o,offset:r,offsetLeft:i,offsetRight:l,offsetTop:a,offsetBottom:s})},n.prototype.canBreak=function(){return!1},n.prototype.toString=function(){return""},n}(Ws);var zs=function(){function t(t,e){var n=document.createElement("span");n.setAttribute("aria-hidden","true"),n.textContent=e||"BESbswy",function(t){return[{display:"block",position:"absolute",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0","white-space":"nowrap",font:t},{"font-variant":"normal","font-size":"300px","font-style":"normal","font-weight":"400","line-height":"normal"}]}(t).forEach((function(t){for(var e in t){var o=e;n.style[o]=t[o]}})),document.body.appendChild(n),this._el=n}return t.prototype.getWidth=function(){return this._el.offsetWidth},t.prototype.remove=function(){document.body.removeChild(this._el)},t}(),Ns={SERIF:"serif",SANS_SERIF:"sans-serif"},Vs={},Us=function(){function t(t,e){this.activeCallbacks=[],this.inactiveCallbacks=[],this.status=null,this.lastResortWidths_={},this.fontRulerA_=new zs(t+","+Ns.SERIF,e),this.fontRulerB_=new zs(t+","+Ns.SANS_SERIF,e);var n=new zs("4px "+Ns.SERIF,e),o=new zs("4px "+Ns.SANS_SERIF,e);this.lastResortWidths_[Ns.SERIF]=n.getWidth(),this.lastResortWidths_[Ns.SANS_SERIF]=o.getWidth(),n.remove(),o.remove(),this.started_=Date.now(),this.check_()}return t.load=function(e,n,o,r){var i=Vs[e]||(Vs[e]={});(i[n+=""]?i[n]:i[n]=new t(e,n)).then(o,r)},t.prototype.then=function(t,e){this.status?"ng"!==this.status?t():e():(this.activeCallbacks.push(t),this.inactiveCallbacks.push(e))},t.prototype.check_=function(){var t=this,e=this.fontRulerA_.getWidth(),n=this.fontRulerB_.getWidth();this.isFallbackFont_(e,n)||this.isLastResortFont_(e,n)?Date.now()-this.started_>=3e3?this.isLastResortFont_(e,n)?(this.finish_(this.activeCallbacks),this.status="ok"):(this.finish_(this.inactiveCallbacks),this.status="ng"):setTimeout((function(){t.check_()}),50):(this.finish_(this.activeCallbacks),this.status="ok")},t.prototype.isFallbackFont_=function(t,e){return this.widthMatches_(t,Ns.SERIF)&&this.widthMatches_(e,Ns.SANS_SERIF)},t.prototype.widthsMatchLastResortWidths_=function(t,e){for(var n in Ns)if(Ns.hasOwnProperty(n)&&this.widthMatches_(t,Ns[n])&&this.widthMatches_(e,Ns[n]))return!0;return!1},t.prototype.widthMatches_=function(t,e){return t===this.lastResortWidths_[e]},t.prototype.isLastResortFont_=function(t,e){return function(){if(null===Ks){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Ks=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return Ks}()&&this.widthsMatchLastResortWidths_(t,e)},t.prototype.finish_=function(t){var e=this;setTimeout((function(){e.fontRulerA_.remove(),e.fontRulerB_.remove(),t.forEach((function(t){return t()}))}),0)},t}(),Ks=null;var Gs,Ys,Xs={all:!1};if(a)Gs=function(t,e,n){n()},Ys=function(){return!1};else{var qs=!document.fonts;Gs=qs?function(t,e,n){Xs[t+" @ "+e]?n():Us.load(t,e,(function(){Xs[t+" @ "+e]=!0,n()}),(function(){Xs[t+" @ "+e]=!0,n()}))}:function(t,e,n){Xs.all||Xs[t]?n():(document.fonts.ready.then((function(){Xs.all=!0})),document.fonts.load(t).then((function(){Xs[t]=!0,n()})))},Ys=qs?function(t,e){return!!Xs[t+" @ "+e]||(Gs(t,e,(function(){})),!1)}:function(t,e){return!(!Xs.all&&!Xs[t])||(!!document.fonts.check(t)||(Gs(t,e,(function(){})),!1))}}var $s={check:Ys,load:Gs},Zs=function(t){function n(e){var n=t.call(this)||this;return n._icon=e||{},n}return e(n,t),n.prototype.width=function(t){var e=t.ctx,n=this._icon;if(n.width)return n.width;if(n.font&&$s.check(n.font,n.content||"")){e.save(),e.canvas.style.letterSpacing="normal";try{return e.font=n.font||e.font,e.measureText(n.content||"").width}finally{e.canvas.style.letterSpacing="",e.restore()}}return 0},n.prototype.font=function(){var t;return null!==(t=this._icon.font)&&void 0!==t?t:null},n.prototype.color=function(){var t;return null!==(t=this._icon.color)&&void 0!==t?t:null},n.prototype.canDraw=function(){var t=this._icon;return!t.font||$s.check(t.font,t.content||"")},n.prototype.onReady=function(t){var e=this._icon;e.font&&!$s.check(e.font,e.content||"")&&$s.load(e.font,e.content||"",t)},n.prototype.draw=function(t){var e=t.ctx,n=t.canvasHelper,o=t.rect,r=t.offset,i=t.offsetLeft,l=t.offsetRight,a=t.offsetTop,s=t.offsetBottom,c=this._icon;if(c.content){e.canvas.style.letterSpacing="normal";try{e.font=e.font,n.fillTextRect(e,c.content,o.left,o.top,o.width,o.height,{offset:r+1,padding:{bottom:s,left:i,right:l,top:a}})}finally{e.canvas.style.letterSpacing=""}}},n.prototype.canBreak=function(){return!1},n.prototype.toString=function(){return""},n}(Ws),Js=function(t){function n(e){var n=e.src,o=e.width,r=e.height,i=e.imageLeft,l=e.imageTop,a=e.imageWidth,s=e.imageHeight,c=t.call(this)||this;return c._inlineImgPromise=null,c._inlineImg=null,c._src=n,c._width=o,c._height=r,c._imageLeft=i,c._imageTop=l,c._imageWidth=a,c._imageHeight=s,c._onloaded=[],R(n)?n.then((function(t){c._src=t,c._loadImage(t)})):c._loadImage(n),c}return e(n,t),n.prototype.width=function(t){var e,n;return this._width||(null!==(n=null===(e=this._inlineImg)||void 0===e?void 0:e.width)&&void 0!==n?n:0)},n.prototype.font=function(){return null},n.prototype.color=function(){return null},n.prototype.canDraw=function(){return!!this._inlineImg},n.prototype.onReady=function(t){(R(this._src)||R(this._inlineImgPromise))&&this._onloaded.push((function(){return t()}))},n.prototype.draw=function(t){var e=t.ctx,n=t.canvasHelper,o=t.rect,r=t.offset,i=t.offsetLeft,l=t.offsetRight,a=t.offsetTop,s=t.offsetBottom,c=this._inlineImg;n.drawInlineImageRect(e,c,this._imageLeft||0,this._imageTop||0,this._imageWidth||c.width,this._imageHeight||c.height,this._width||c.width,this._height||c.height,o.left,o.top,o.width,o.height,{offset:r+1,padding:{bottom:s,left:i,right:l,top:a}})},n.prototype.canBreak=function(){return!1},n.prototype.toString=function(){return""},n.prototype._loadImage=function(t){var e=this,n=this._inlineImgPromise=rr("InlineImage",50,t);R(n)?n.then((function(t){e._inlineImg=t,e._onloaded.forEach((function(t){return t()}))})):this._inlineImg=n},n}(Ws),Qs=function(t){function n(e){var n=e.path,o=e.width,r=e.height,i=e.color,l=t.call(this)||this,a=Ds.getPath2D();return l._path=new a(n),l._width=o,l._height=r,l._color=i,l}return e(n,t),n.prototype.width=function(t){return this._width},n.prototype.font=function(){return null},n.prototype.color=function(){var t;return null!==(t=this._color)&&void 0!==t?t:null},n.prototype.canDraw=function(){return!0},n.prototype.onReady=function(t){},n.prototype.draw=function(t){var e=t.ctx,n=(t.canvasHelper,t.rect),o=t.offset,r=t.offsetLeft,i=t.offsetRight,l=t.offsetTop;o++;var a={bottom:t.offsetBottom,left:r,right:i,top:l};e.save();try{e.beginPath(),e.rect(n.left,n.top,n.width,n.height),e.clip();var s=tr(e,n,this._width,this._height,{offset:o,padding:a});e.translate(s.x,s.y),e.fill(this._path)}finally{e.restore()}},n.prototype.canBreak=function(){return!1},n.prototype.toString=function(){return""},n}(Ws);function tc(t){var e="string"==typeof t?t:(new XMLSerializer).serializeToString(t);return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e)}function ec(t){var e;if("string"==typeof t){var n=(new DOMParser).parseFromString(t,"image/svg+xml"),o=n.children||n.childNodes;e=o[0];for(var r=0;r<o.length;r++)if(o[r]instanceof SVGElement){e=o[r];break}}else e=t;return e}var nc=function(t){function n(e){var n,o,r=e.svg,i=e.width,l=e.height,a=E(r,ec),s=R(a)?void 0:null!==(n=a.getAttribute("width"))&&void 0!==n?n:void 0,c=R(a)?void 0:null!==(o=a.getAttribute("height"))&&void 0!==o?o:void 0,u={full:0,em:0},h=null!=s?ti(s,u):void 0,f=null!=c?ti(c,u):void 0;return t.call(this,{src:E(r,tc),width:i||h,height:l||f,imageWidth:h,imageHeight:f})||this}return e(n,t),n.prototype.canBreak=function(){return!1},n.prototype.toString=function(){return""},n}(Js);function oc(t){if(t instanceof Ws)return t;if(!t)return null;if(function(t){return!(!t.font||!t.content)}(t))return new Zs(t);if(function(t){return!!t.src}(t))return new Js({height:t.width,src:t.src,width:t.width});if(t.svg)return new nc({height:t.width,svg:t.svg,width:t.width});if(function(t){return!!t.path}(t))return new Qs({color:t.color,height:t.width,path:t.path,width:t.width});var e=Es();if(t.name&&e[t.name]){var n=e[t.name],o=t.width||Math.max(n.width,n.height);return new Hs({draw:function(t){var e=t.ctx,r=t.rect,i=t.offset,l=t.offsetLeft,a=t.offsetRight,s=t.offsetTop,c=t.offsetBottom;!function(t,e,n,o,r,i,l,a,s){var c=void 0===s?{}:s,u=c.offset,h=void 0===u?2:u,f=c.padding,d={bottom:i+a,height:a,left:r,right:r+l,top:i,width:l};t.save();try{t.beginPath(),t.rect(d.left,d.top,d.width,d.height),t.clip();var p=tr(t,d,n,o,{offset:h,padding:f});Ds.fill(e,t,p.x,p.y,n,o)}finally{t.restore()}}(e,n,o,o,r.left,r.top,r.width,r.height,{offset:i+1,padding:{bottom:c,left:l,right:a,top:s}})},color:t.color,height:o,width:o})}return new Zs(t)}function rc(t){return c(t)?t instanceof Ws?t:new Ws(t):null}function ic(t,e){var n=[];if(t&&n.push.apply(n,t.map((function(t){return oc(t)})).filter(c)),Array.isArray(e))n.push.apply(n,e.map((function(t){return rc(t)})).filter(c));else{var o=rc(e);o&&n.push(o)}return n}function lc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=C.apply(void 0,o([t.theme],e));return c(i)?"function"!=typeof i?i:function(t){var n=i(t);return c(n)?n:x(r=r||C.apply(void 0,o([xa.getDefault()],e)),t)}:C.apply(void 0,o([xa.getDefault()],e))}var ac,sc=function(){function t(t){this._checkbox=null,this._radioButton=null,this._button=null,this._header=null,this._switch=null,this._tree=null,this._grid=t}return t.prototype.getThemeColor=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return lc.apply(void 0,o([this._grid],t))},Object.defineProperty(t.prototype,"underlayBackgroundColor",{get:function(){return lc(this._grid,"underlayBackgroundColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return lc(this._grid,"font")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsFont",{get:function(){return lc(this._grid,"frozenRowsFont")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return lc(this._grid,"color")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsColor",{get:function(){return lc(this._grid,"frozenRowsColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBgColor",{get:function(){return lc(this._grid,"defaultBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsBgColor",{get:function(){return lc(this._grid,"frozenRowsBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusBgColor",{get:function(){return lc(this._grid,"focusBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionBgColor",{get:function(){return lc(this._grid,"selectionBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBgColor",{get:function(){return lc(this._grid,"highlightBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionDragBgColor",{get:function(){return lc(this._grid,"selectionDragBgColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borderColor",{get:function(){return lc(this._grid,"borderColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frozenRowsBorderColor",{get:function(){return lc(this._grid,"frozenRowsBorderColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBorderColor",{get:function(){return lc(this._grid,"highlightBorderColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridBorderColor",{get:function(){return lc(this._grid,"gridBorderColor")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridBorderWidth",{get:function(){return lc(this._grid,"gridBorderWidth")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultRowHeight",{get:function(){return lc(this._grid,"defaultRowHeight")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultColWidth",{get:function(){return lc(this._grid,"defaultColWidth")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightBorderWidth",{get:function(){return lc(this._grid,"highlightBorderWidth")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"checkbox",{get:function(){var t=this._grid;return this._checkbox||(this._checkbox={get uncheckBgColor(){return lc(t,"checkbox","uncheckBgColor")},get checkBgColor(){return lc(t,"checkbox","checkBgColor")},get borderColor(){return lc(t,"checkbox","borderColor")}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radioButton",{get:function(){var t=this._grid;return this._radioButton||(this._radioButton={get checkColor(){return lc(t,"radioButton","checkColor")},get uncheckBorderColor(){return lc(t,"radioButton","uncheckBorderColor")},get checkBorderColor(){return lc(t,"radioButton","checkBorderColor")},get uncheckBgColor(){return lc(t,"radioButton","uncheckBgColor")},get checkBgColor(){return lc(t,"radioButton","checkBgColor")}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"button",{get:function(){var t=this._grid;return this._button||(this._button={get color(){return lc(t,"button","color")},get bgColor(){return lc(t,"button","bgColor")}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){var t=this._grid;return this._header||(this._header={get sortArrowColor(){return lc(t,"header","sortArrowColor")}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"switch",{get:function(){var t=this._grid;return this._switch||(this._switch={get uncheckBgColor(){return lc(t,"switch","uncheckBgColor")},get checkBgColor(){return lc(t,"switch","checkBgColor")},get borderColor(){return lc(t,"switch","borderColor")}})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tree",{get:function(){var t=this._grid;return this._tree||(this._tree={get lineColor(){return lc(t,"tree","lineColor")},get buttonColor(){return lc(t,"tree","buttonColor")},get buttonBgColor(){return lc(t,"tree","buttonBgColor")},get buttonBorderColor(){return lc(t,"tree","buttonBorderColor")},get linkColor(){return lc(t,"tree","linkColor")}})},enumerable:!1,configurable:!0}),t}();!function(t){t[t.default=0]="default",t[t.iPhone=1]="iPhone"}(ac||(ac={}));var cc=ac.default,uc=rc("…");function hc(t,e,n,o,r){return x(t,{col:e,context:r,grid:o,row:n})}function fc(t,e,n,o,r){if(null!=t)return x(t,{col:e,row:n,grid:o,context:r})}function dc(t,e,n,o,r){if(!r){r=e.color;var i=t.isFrozenCell(n,o);i&&i.row&&(r=e.frozenRowsColor)}return r}function pc(t,e,n,o,r){if(!r){r=e.font;var i=t.isFrozenCell(n,o);i&&i.row&&(r=e.frozenRowsFont)}return r}function gc(t,e,n,o,r,i,l,a,s){function c(e,c,u){if(e.canDraw()){t.save();try{t.fillStyle=hc(e.color()||t.fillStyle,l,a,s,t),t.font=e.font()||t.font,e.draw({canvasHelper:za,ctx:t,offset:o,offsetBottom:i,offsetLeft:c,offsetRight:u,offsetTop:r,rect:n})}finally{t.restore()}}else e.onReady((function(){return s.invalidateCell(l,a)}))}if(1===e.length)c(e[0],0,0);else if(e.length>1){var u=e.map((function(e){return(e.width({ctx:t})||0)-0})),h=u.reduce((function(t,e){return t+e})),f=0;e.forEach((function(t,e){var n=u[e];c(t,f,h-=n),f+=n}))}}function vc(t,e){return ic(t,c(e)?e:"")}function yc(t){return function(t){return ic(void 0,t).join("")}(t)}function _c(t){return bc(t)&&"ellipsis"!==t&&1===(t=t.trim()).length?rc(t[0]):uc}function bc(t){return!(!t||"clip"===t||"string"!=typeof t)}function wc(t,e,n){for(var o=n-3,r=0,i=0;i<e.length;i++){var l=(e[i].width({ctx:t})||0)-0;if(r+l>o)return{index:i,lineWidth:r,remWidth:o-r};r+=l}return null}function mc(t,e,n){return!!wc(t,e,n)}function Cc(t,e,n){var o,r,i=wc(t,e,n);if(!i)return{afterInlines:[],beforeInlines:e,overflow:!1};var l=i.index,a=i.remWidth,s=e[l],c=e.slice(0,l),u=[];if(s.canBreak()){var h=s.breakWord(t,a),f=h.before,d=h.after;f||c.length||(f=(o=s.breakAll(t,a)).before,d=o.after),f||c.length||(f=(r=s.splitIndex(1)).before,d=r.after),f&&c.push(f),d&&u.push(d),u.push.apply(u,e.slice(l+1))}else c.length||c.push(s),u.push.apply(u,e.slice(c.length));return{afterInlines:u,beforeInlines:c,overflow:!0}}function xc(t,e,n,o,r){var i=wc(t,e,n);if(!i)return{inlines:e,overflow:!1};var l=i.index,a=i.lineWidth,s=e[l],c=_c(r),u=n-a-c.width({ctx:t})-o-1,h=e.slice(0,l);if(s.canBreak()){var f=s.breakAll(t,u).before;f&&h.push(f)}return h.push(c),{inlines:h,overflow:!0}}function Rc(t,e,n,o,r,i,l){var a=l.offset,s=l.color,c=l.textAlign,u=l.textBaseline,h=l.font,f=l.textOverflow,d=l.icons;e.fillStyle=hc(s||e.fillStyle,r,i,t,e),e.textAlign=c,e.textBaseline=u,e.font=h||e.font;var p=vc(d,n);if(bc(f)&&mc(e,p,o.width)){var g=xc(e,p,o.width,a,f),v=g.inlines,y=g.overflow;p=v,t.setCellOverflowText(r,i,y&&yc(n))}else t.setCellOverflowText(r,i,!1);gc(e,p,o,a,0,0,r,i,t)}function Ec(t,e,n,o,r,i,l){var a,s=l.offset,c=l.color,u=l.textAlign,h=l.textBaseline,f=l.font,d=l.lineHeight,p=l.autoWrapText,g=l.lineClamp,v=l.textOverflow,y=l.icons;if(e.fillStyle=hc(c||e.fillStyle,r,i,t,e),e.textAlign=u,e.textBaseline=h,e.font=f||e.font,"auto"===g){var _=o.height-2*s-2;g=Math.max(Math.floor(_/d),1)}if(p||g>0||bc(v)){var b=o.width;a=[];var w=g>0?function(o,l){if(a.length+1>=g){if(0===o.length&&l)a.push([_c(v)]),t.setCellOverflowText(r,i,n.map(yc).join("\n"));else{var c=xc(e,o,b,s,v),u=c.inlines,h=c.overflow;a.push(l&&!h?u.concat([_c(v)]):u),(h||l)&&t.setCellOverflowText(r,i,n.map(yc).join("\n"))}return!1}return!0}:function(){return!0},m=p?function(t,n){if(!w(t,n))return!1;for(;t.length;){if(!w(t,n))return!1;var o=Cc(e,t,b),r=o.beforeInlines,i=o.afterInlines;a.push(r),t=i}return!0}:bc(v)?function(o,l){if(!w(o,l))return!1;var c=xc(e,o,b,s,v),u=c.inlines,h=c.overflow;return a.push(u),h&&t.setCellOverflowText(r,i,n.map(yc).join("\n")),!0}:function(t,e){return!!w(t,e)&&(a.push(t),!0)};t.setCellOverflowText(r,i,!1);for(var C=0;C<n.length;C++){var x=n[C];if(!m(vc(0===C?y:void 0,x),C+1<n.length))break}}else t.setCellOverflowText(r,i,!1),a=n.map((function(t,e){return vc(0===e?y:void 0,t)}));var R=0,E=d*(a.length-1);if("top"===e.textBaseline||"hanging"===e.textBaseline){var O=Qo(e,e.font).height;R+=L=(d-O)/2,E-=L}else if("bottom"===e.textBaseline||"alphabetic"===e.textBaseline||"ideographic"===e.textBaseline){var L;O=Qo(e,e.font).height;R-=L=(d-O)/2,E+=L}a.forEach((function(n){gc(e,n,o,s,R,E,r,i,t),R+=d,E-=d}))}function Oc(t,e,n,o,r,i,l,a){var s=void 0===l?{}:l,c=s.animElapsedTime,u=void 0===c?1:c,h=s.uncheckBgColor,f=void 0===h?i.theme.checkbox.uncheckBgColor:h,d=s.checkBgColor,p=void 0===d?i.theme.checkbox.checkBgColor:d,g=s.borderColor,v=void 0===g?i.theme.checkbox.borderColor:g,y=s.textAlign,_=void 0===y?"center":y,b=s.textBaseline,w=void 0===b?"middle":b;void 0===a&&(a={});var m=za.measureCheckbox(t).width;t.textAlign=_,t.textBaseline=w;var C=tr(t,e,m+1,m+1,a);f=i.getColor(f,n,o,t),p=i.getColor(p,n,o,t),v=i.getColor(v,n,o,t),0<u&&u<1&&(f=r?f:Ta(p,f,u),p=r?Ta(f,p,u):p),za.drawCheckbox(t,C.x,C.y,!!r&&u,{borderColor:v,checkBgColor:p,uncheckBgColor:f})}function Lc(t){if(cc===ac.default)return{height:22,width:44};var e=t.height-t.height/4;return{height:e,width:1.625*e}}function kc(t,e,n,o,r,i,l,a){void 0===l&&(l={}),void 0===a&&(a={});var s=void 0===l.animElapsedTime?1:l.animElapsedTime,c=l.uncheckBgColor||i.theme.switch.uncheckBgColor,u=l.checkBgColor||i.theme.switch.checkBgColor,h=l.borderColor||i.theme.switch.borderColor,f=l.textAlign||"center",d=l.textBaseline||"middle",p=Lc(e);t.textAlign=f,t.textBaseline=d;var g=tr(t,e,p.width+1,p.height+1,a);c=i.getColor(c,n,o,t),u=i.getColor(u,n,o,t),h=i.getColor(h,n,o,t),h=D.toBoxArray(h).find((function(t){return t})),(cc===ac.default?za.drawSwitchButton:za.drawSwitchBtn)(t,g.x,g.y,r,s,{borderColor:h,checkBgColor:u,uncheckBgColor:c,btnSize:p})}function Sc(t,e,n,o,r,i){if(Array.isArray(e)){var l=D.toBoxArray(e);za.strokeColorsRect(t,l,n,o,r,i)}else e&&(t.strokeStyle=e,t.strokeRect(n,o,r,i))}var Ic=function(){function t(t){this._grid=t,this._theme=new sc(t)}return t.prototype.createCalculator=function(t,e){return{calcWidth:function(n){return ti(n,{get full(){return t.getRect().width},get em(){return Qo(t.getContext(),e).width}})},calcHeight:function(n){return ti(n,{get full(){return t.getRect().height},get em(){return Qo(t.getContext(),e).height}})}}},t.prototype.getColor=function(t,e,n,o){return hc(t,e,n,this._grid,o)},t.prototype.toBoxArray=function(t){return D.toBoxArray(t)},t.prototype.toBoxPixelArray=function(t,e,n){if("string"==typeof t||Array.isArray(t)){var o=this.createCalculator(e,n),r=D.toBoxArray(t);return[o.calcHeight(r[0]),o.calcWidth(r[1]),o.calcHeight(r[2]),o.calcWidth(r[3])]}return D.toBoxArray(t)},Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},enumerable:!1,configurable:!0}),t.prototype.drawWithClip=function(t,e){var n=t.getDrawRect();if(n){var o=t.getContext();if(o){o.save();try{o.beginPath(),o.rect(n.left,n.top,n.width,n.height),o.clip(),e(o)}finally{o.restore()}}}},t.prototype.drawBorderWithClip=function(t,e){var n=t.getDrawRect();if(n){var o=t.getRect(),r=t.getContext();if(r){r.save();try{r.lineCap="square",r.beginPath();var i=n.left,l=n.width;n.left===o.left&&(i+=-1,l+=1);var a=n.top,s=n.height;n.top===o.top&&(a+=-1,s+=1),r.rect(i,a,l,s),r.clip(),e(r)}finally{r.restore()}}}},t.prototype.getTextRect=function(t,e,n){var o=void 0===n?{}:n,r=o.padding,i=o.offset,l=void 0===i?2:i,a=o.textAlign,s=void 0===a?"left":a,c=o.textBaseline,u=void 0===c?"middle":c,h=o.font,f=o.textOverflow,d=void 0===f?"clip":f,p=o.icons,g=e.getRect(),v=e.getDrawRect(),y=e.getContext(),_=e.col,b=e.row;if(h=pc(this._grid,this.theme,_,b,h),v&&y){y.save();try{if(h=fc(h,e.col,e.row,this._grid,y),r){var w=this.toBoxPixelArray(r,e,h),m=g.left+w[3],C=g.top+w[0],x=g.width-w[1]-w[3],R=g.height-w[0]-w[2];g=new je(m,C,x,R)}y.textAlign=s,y.textBaseline=u,y.font=h||y.font;var E=vc(p,t);if(bc(d)&&mc(y,E,g.width))E=xc(y,E,g.width,l,d).inlines;var O=E.map((function(t){return(t.width({ctx:y})||0)-0})),L=O.length>0?O.reduce((function(t,e){return t+e})):0,k=0,S=g.right,I=g.bottom,T=0,P=0;E.forEach((function(t,e){var n=O[e];L-=n,y.font=t.font()||y.font;var o=Qo(y,y.font).height,r=tr(y,{bottom:g.top+g.height,height:g.height,left:g.left,right:g.left+g.width,top:g.top,width:g.width},n,o,{offset:l+1,padding:{bottom:0,left:k,right:L,top:0}});S=Math.floor(Math.min(S,r.x)),I=Math.floor(Math.min(I,r.y)),T=Math.ceil(Math.max(T,r.x+n)),P=Math.ceil(Math.max(P,r.y+o)),k+=n})),g=new je(Math.min(S,T),Math.min(I,P),Math.abs(T-S),Math.abs(P-I))}finally{y.restore()}}return g},t.prototype.text=function(t,e,n){var o=this,r=void 0===n?{}:n,i=r.padding,l=r.offset,a=void 0===l?2:l,s=r.color,c=r.textAlign,u=void 0===c?"left":c,h=r.textBaseline,f=void 0===h?"middle":h,d=r.font,p=r.textOverflow,g=void 0===p?"clip":p,v=r.icons,y=e.getRect(),_=e.col,b=e.row;s=dc(this._grid,this.theme,_,b,s),d=pc(this._grid,this.theme,_,b,d),this.drawWithClip(e,(function(n){if(d=fc(d,e.col,e.row,o._grid,n),i){var r=o.toBoxPixelArray(i,e,d),l=y.left+r[3],c=y.top+r[0],h=y.width-r[1]-r[3],p=y.height-r[0]-r[2];y=new je(l,c,h,p)}Rc(o._grid,n,t,y,_,b,{color:s,font:d,icons:v,offset:a,textAlign:u,textBaseline:f,textOverflow:g})}))},t.prototype.multilineText=function(t,e,n){var o=this,r=void 0===n?{}:n,i=r.padding,l=r.offset,a=void 0===l?2:l,s=r.color,c=r.textAlign,u=void 0===c?"left":c,h=r.textBaseline,f=void 0===h?"middle":h,d=r.font,p=r.lineHeight,g=void 0===p?"1em":p,v=r.autoWrapText,y=void 0!==v&&v,_=r.lineClamp,b=void 0===_?0:_,w=r.textOverflow,m=void 0===w?"clip":w,C=r.icons,x=e.getRect(),R=e.col,E=e.row;s=dc(this._grid,this.theme,R,E,s),d=pc(this._grid,this.theme,R,E,d),this.drawWithClip(e,(function(n){if(d=fc(d,e.col,e.row,o._grid,n),i){var r=o.toBoxPixelArray(i,e,d),l=x.left+r[3],c=x.top+r[0],h=x.width-r[1]-r[3],p=x.height-r[0]-r[2];x=new je(l,c,h,p)}var v=o.createCalculator(e,d);g=v.calcHeight(g),Ec(o._grid,n,t,x,R,E,{autoWrapText:y,color:s,font:d,icons:C,lineClamp:b,lineHeight:g,offset:a,textAlign:u,textBaseline:f,textOverflow:m})}))},t.prototype.fillText=function(t,e,n,o,r){var i=void 0===r?{}:r,l=i.color,a=i.textAlign,s=void 0===a?"left":a,c=i.textBaseline,u=void 0===c?"top":c,h=i.font,f=o.col,d=o.row;l=dc(this._grid,this.theme,f,d,l),h=pc(this._grid,this.theme,f,d,h);var p=o.getContext();p.save();try{h=fc(h,o.col,o.row,this._grid,p),p.fillStyle=hc(l,f,d,this._grid,p),p.textAlign=s,p.textBaseline=u,p.font=h||p.font,p.fillText(t,e,n)}finally{p.restore()}},t.prototype.clearCell=function(t){var e=t.getRect();this.drawWithClip(t,(function(t){t.clearRect(e.left,e.top,e.width,e.height)}))},t.prototype.fillCell=function(t,e){var n=this,o=void 0===e?{}:e,r=o.fillColor,i=void 0===r?this.theme.defaultBgColor:r,l=o.selectionColor,a=t.getRect();this.drawWithClip(t,(function(e){var o=t.col,r=t.row;e.fillStyle=hc(i,o,r,n._grid,e),e.beginPath(),e.clearRect(a.left,a.top,a.width,a.height),e.rect(a.left,a.top,a.width,a.height),e.fill(),l&&(e.fillStyle=hc(l,o,r,n._grid,e),e.fill())}))},t.prototype.fillCellWithState=function(t,e){void 0===e&&(e={}),e.fillColor=this.getFillColorState(t,e),e.isEditing?(delete e.selectionColor,delete e.isEditing):e.selectionColor=this.getSelectionColorState(t,e),this.fillCell(t,e)},t.prototype.fillRect=function(t,e,n){var o=void 0===n?{}:n,r=o.fillColor,i=void 0===r?this.theme.defaultBgColor:r,l=o.selectionColor,a=e.getContext();a.save();try{var s=e.col,c=e.row;a.fillStyle=hc(i,s,c,this._grid,a),a.beginPath(),a.rect(t.left,t.top,t.width,t.height),a.fill(),l&&(a.fillStyle=hc(l,s,c,this._grid,a),a.fill())}finally{a.restore()}},t.prototype.fillRectWithState=function(t,e,n){void 0===n&&(n={}),n.fillColor=this.getFillColorState(e,n),n.selectionColor=this.getSelectionColorState(e,n),this.fillRect(t,e,n)},t.prototype.getSelectionColorState=function(t,e){void 0===e&&(e={});var n=t.getSelection(),o=t.col,r=t.row;return e.selectionColor?e.selectionColor:n.dragged?this.theme.selectionDragBgColor:!L(t.range,n.select.col,n.select.row)&&L(n.range,o,r)?this.theme.selectionBgColor:L(t.range,n.select.col,n.select.row)&&L(n.range,o,r)?this.theme.focusBgColor:void 0},t.prototype.getFillColorState=function(t,e){void 0===e&&(e={});var n=t.getSelection(),o=t.col,r=t.row;if(!L(t.range,n.select.col,n.select.row)&&L(n.range,o,r))return this.theme.selectionBgColor;if(e.fillColor)return e.fillColor;if(L(t.range,n.select.col,n.select.row))return this.theme.highlightBgColor;var i=this._grid.isFrozenCell(o,r);return i&&i.row?this.theme.frozenRowsBgColor:this.theme.defaultBgColor},t.prototype.border=function(t,e){var n=this,o=void 0===e?{}:e,r=o.borderColor,i=void 0===r?this.theme.borderColor:r,l=o.lineWidth,a=void 0===l?1:l,s=t.getRect();this.drawBorderWithClip(t,(function(e){var o=t.col,r=t.row,l=s.left,c=s.top,u=s.width,h=s.height;0===o&&(l+=a,u-=a),0===r&&(c+=a,h-=a);var f=hc(i,o,r,n._grid,e);if(1===a)e.lineWidth=1,Sc(e,f,l-.5,c-.5,u,h);else if(2===a)e.lineWidth=2,Sc(e,f,l,c,u-1,h-1);else{e.lineWidth=a;var d=a/2-1;Sc(e,f,l+d,c+d,u-a+1,h-a+1)}}))},t.prototype.borderSelection=function(t,e){var n=this;void 0===e&&(e={});var o=t.col,r=t.row,i=t.getSelection().border,l=t.getRect(),a=t.getDrawRect()||l,s=this._grid.isFrozenCell(o,r);if(s&&s.row&&(e.borderColor=this.theme.frozenRowsBorderColor),e.lineWidth=1,this.border(t,e),!e.isEditing){var c=1;void 0!==e.highlightBorderWidth&&(c=e.highlightBorderWidth),(i.top||i.right||i.bottom||i.left)&&this.drawBorderWithClip(t,(function(t){var e=hc(n.theme.highlightBorderColor,o,r,n._grid,t),s=D.toBoxArray(e);if(t.lineWidth=c,t.lineWidth>0){var u=t.lineWidth/2;0===r&&(l.top+=u),0===o&&(l.left+=u),i.top&&(t.strokeStyle=s[0]||t.strokeStyle,t.beginPath(),t.moveTo(l.left,l.top),t.lineTo(l.right-u,l.top),t.stroke()),i.right&&(t.strokeStyle=s[1]||t.strokeStyle,t.beginPath(),t.moveTo(l.right-u,l.top),t.lineTo(l.right-u,l.bottom-u),t.stroke()),i.bottom&&(t.strokeStyle=s[2]||t.strokeStyle,t.beginPath(),t.moveTo(l.right-u,l.bottom-u),t.lineTo(l.left,l.bottom-u),t.stroke()),i.left&&(t.strokeStyle=s[3]||t.strokeStyle,t.beginPath(),t.moveTo(l.left,l.bottom-u),t.lineTo(l.left,l.top),t.stroke())}if(i.right&&i.bottom&&n._grid.canDragSelection){var h=a.right,f=a.bottom;t.lineWidth=1,t.strokeStyle=s[1]||s[2]||t.strokeStyle,t.beginPath(),t.moveTo(h-8,f-3),t.lineTo(h-3,f-8),t.moveTo(h-5,f-3),t.lineTo(h-3,f-5),t.stroke()}}));var u=this._grid.selection.range;u.start.row<=r&&u.end.row>=r&&u.end.col===o-1?this.drawBorderWithClip(t,(function(t){var e=hc(n.theme.highlightBorderColor,o-1,r,n._grid,t),i=D.toBoxArray(e);t.lineWidth=1,t.strokeStyle=i[1]||t.strokeStyle,t.beginPath(),t.moveTo(l.left-.5,l.top),t.lineTo(l.left-.5,l.bottom),t.stroke()})):u.start.col<=o&&u.end.col>=o&&u.end.row===r-1&&this.drawBorderWithClip(t,(function(t){var e=hc(n.theme.highlightBorderColor,o,r-1,n._grid,t),i=D.toBoxArray(e);t.lineWidth=1,t.strokeStyle=i[0]||t.strokeStyle,t.beginPath(),t.moveTo(l.left,l.top-.5),t.lineTo(l.right,l.top-.5),t.stroke()}))}},t.prototype.buildCheckBoxInline=function(t,e,n){void 0===n&&(n={});var o=this,r=za.measureCheckbox(e.getContext()).width;return new Hs({color:void 0,draw:function(r){var i=e.col,l=e.row;Oc(r.ctx,r.rect,i,l,t,o,n,{offset:r.offset+1,padding:{bottom:r.offsetBottom,left:r.offsetLeft+1,right:r.offsetRight,top:r.offsetTop}})},height:r+1,width:r+3})},t.prototype.buildSwitchBtnInline=function(t,e,n){void 0===n&&(n={});var o=this,r=Lc(e.getRect());return new Hs({color:void 0,draw:function(r){var i=e.col,l=e.row;kc(r.ctx,r.rect,i,l,t,o,n,{offset:r.offset+1,padding:{bottom:r.offsetBottom,left:r.offsetLeft+1,right:r.offsetRight,top:r.offsetTop}})},height:r.height+1,width:r.width+3})},t.prototype.checkbox=function(t,e,n){var o=this;void 0===n&&(n={}),this.drawWithClip(e,(function(r){var i=e.col,l=e.row;Oc(r,e.getRect(),i,l,t,o,n)}))},t.prototype.radioButton=function(t,e,n){var o=this;void 0===n&&(n={}),this.drawWithClip(e,(function(r){var i=e.col,l=e.row;!function(t,e,n,o,r,i,l,a){var s=l.animElapsedTime,c=void 0===s?1:s,u=l.checkColor,h=void 0===u?i.theme.radioButton.checkColor:u,f=l.uncheckBorderColor,d=void 0===f?i.theme.radioButton.uncheckBorderColor:f,p=l.checkBorderColor,g=void 0===p?i.theme.radioButton.checkBorderColor:p,v=l.uncheckBgColor,y=void 0===v?i.theme.radioButton.uncheckBgColor:v,_=l.checkBgColor,b=void 0===_?i.theme.radioButton.checkBgColor:_,w=l.textAlign,m=void 0===w?"center":w,C=l.textBaseline,x=void 0===C?"middle":C;void 0===a&&(a={});var R=za.measureRadioButton(t).width;t.textAlign=m,t.textBaseline=x;var E=tr(t,e,R+1,R+1,a);h=i.getColor(h,n,o,t),d=i.getColor(d,n,o,t),g=i.getColor(g,n,o,t),y=i.getColor(y,n,o,t),b=i.getColor(b,n,o,t);var O=r?g:d,L=r?b:y;0<c&&c<1&&(O=r?Ta(d,g,c):Ta(g,d,c),L=r?Ta(y,b,c):Ta(b,y,c)),za.drawRadioButton(t,E.x,E.y,r?c:1-c,{checkColor:h,borderColor:O,bgColor:L})}(r,e.getRect(),i,l,t,o,n)}))},t.prototype.switch=function(t,e,n){var o=this;void 0===n&&(n={}),this.drawWithClip(e,(function(r){var i=e.col,l=e.row;kc(r,e.getRect(),i,l,t,o,n)}))},t.prototype.button=function(t,e,n){var o=this,r=void 0===n?{}:n,i=r.bgColor,l=void 0===i?this.theme.button.bgColor:i,a=r.padding,s=r.offset,c=void 0===s?2:s,u=r.color,h=void 0===u?this.theme.button.color:u,f=r.textAlign,d=void 0===f?"center":f,p=r.textBaseline,g=void 0===p?"middle":p,v=r.shadow,y=r.font,_=r.textOverflow,b=void 0===_?"clip":_,w=r.icons,m=e.getRect();this.drawWithClip(e,(function(n){y=fc(y,e.col,e.row,o._grid,n);var r=e.col,i=e.row,s=o.toBoxPixelArray(a||m.height/8,e,y),u=m.left+s[3],f=m.top+s[0],p=m.width-s[1]-s[3],_=m.height-s[0]-s[2];l=hc(l,e.col,e.row,o._grid,n),za.drawButton(n,u,f,p,_,{bgColor:l,radius:m.height/8,shadow:v}),Rc(o._grid,n,t,new je(u,f,p,_),r,i,{color:h,font:y,icons:w,offset:c,textAlign:d,textBaseline:g,textOverflow:b})}))},t.prototype.testFontLoad=function(t,e,n){return function(t,e,n,o){return!(t&&!$s.check(t,e)&&($s.load(t,e,(function(){return function(t,e){e.invalidateCell(t.col,t.row)}(n,o)})),1))}(t,e,n,this._grid)},t.prototype.tree=function(t,e,n){var o=this,r=void 0===n?{}:n,i=r.font,l=r.offset,a=void 0===l?2:l,s=r.color,u=r.lineColor,h=void 0===u?this.theme.tree.lineColor:u,f=r.buttonColor,d=void 0===f?this.theme.tree.buttonColor:f,p=r.buttonBgColor,g=void 0===p?this.theme.tree.buttonBgColor:p,v=r.buttonBorderColor,y=void 0===v?this.theme.tree.buttonBorderColor:v,_=r.icons,b=r.padding,w=r.textAlign,m=void 0===w?"left":w,C=r.textBaseline,x=void 0===C?"middle":C,R=r.textOverflow,E=void 0===R?"clip":R,O=r.treeInfo,L=r.treeNodeSpace,k=void 0===L?0:L,S=r.isMultilineText,I=void 0!==S&&S,T=r.autoWrapText,P=void 0!==T&&T,B=r.lineHeight,A=void 0===B?"1em":B,M=r.lineClamp,D=void 0===M?0:M,j=e.getRect(),F=e.col,W=e.row;s=dc(this._grid,this.theme,F,W,s),i=pc(this._grid,this.theme,F,W,i),this.drawWithClip(e,(function(n){var r=j.left,l=0;if(O){var u=O,f=j.top,p=f+j.height/2,v=f+j.height;l=k,n.strokeStyle=o.getColor(h,F,W,n),n.beginPath();for(var w=0;w<u.level;w++){r+=l;var C=w===u.level-1,R=u.levelLast[w];!C&&R||(n.moveTo(r,f),R?n.lineTo(r,p):n.lineTo(r,v),C&&(n.moveTo(r,p),n.lineTo(r+l-5,p)))}if(n.stroke(),!u.isLeaf){n.beginPath(),n.strokeStyle=o.getColor(y,F,W,n),n.moveTo(r+l+5,p),n.arc(r+l,p,5,0,2*Math.PI),n.fillStyle=o.getColor(g,F,W,n),n.fill(),n.stroke(),u.expanded&&(n.beginPath(),n.strokeStyle=o.getColor(h,F,W,n),n.moveTo(r+l,p+5),n.lineTo(r+l,v),n.stroke());n.beginPath(),n.lineWidth=2,n.strokeStyle=o.getColor(d,F,W,n),n.moveTo(r+l-3,p),n.lineTo(r+l+3,p),u.expanded||(n.moveTo(r+l,p-3),n.lineTo(r+l,p+3)),n.stroke()}}if(j.left=r+2*l,i=fc(i,e.col,e.row,o._grid,n),b){var L=o.toBoxPixelArray(b,e,i),S=j.left+L[3],T=j.top+L[0],B=j.width-L[1]-L[3],M=j.height-L[0]-L[2];j=new je(S,T,B,M)}if(I){var H=(t=c(t)?t+"":"").replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n"),z=o.createCalculator(e,i);A=z.calcHeight(A),Ec(o._grid,n,H,j,F,W,{autoWrapText:P,color:s,font:i,icons:_,lineClamp:D,lineHeight:A,offset:a,textAlign:m,textBaseline:x,textOverflow:E})}else Rc(o._grid,n,t,j,F,W,{color:s,font:i,icons:_,offset:a,textAlign:m,textBaseline:x,textOverflow:E})}))},t.prototype.attachArea=function(t,e){this.drawWithClip(e,(function(n){var o=e.getSelection(),r=e.col,i=e.row;L(o.range,r,i)||n.setLineDash([4,4]),n.strokeStyle="#D9D9D9",n.lineWidth=1;var l=t.left,a=t.top,s=t.width,c=t.height;n.beginPath(),n.moveTo(l+2,a),n.arcTo(l+s,a,l+s,a+2,2),n.arcTo(l+s,a+c,l+s-2,a+c,2),n.arcTo(l,a+c,l,a+c-2,2),n.arcTo(l,a,l+2,a,2),n.stroke()}))},t}(),Tc=function(){function t(t){this._grid=t}return t.prototype.dispose=function(){this.detachTooltipElement(),this._tooltipElement&&this._tooltipElement.dispose(),delete this._tooltipElement},t.prototype.attachTooltipElement=function(t,e,n){this._getTooltipElement().attach(this._grid,t,e,n)},t.prototype.moveTooltipElement=function(t,e){this._getTooltipElement().move(this._grid,t,e)},t.prototype.detachTooltipElement=function(){this._getTooltipElement().detach()},t.prototype._getTooltipElement=function(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal())},t}(),Pc="kaka-grid__tooltip-element",Bc=Pc+"--hidden",Ac=Pc+"--shown",Mc=function(){function t(){this._handler=new Bt,this._rootElement=this.createTooltipDomElement(),this._messageElement=this.createTooltipMessageElement(this._rootElement,"kaka-grid__tooltip-element__content")}return t.prototype.dispose=function(){this.detach();var t=this._rootElement;t.parentElement&&t.parentElement.removeChild(t),this._handler.dispose(),this._messageElement=null},t.prototype.attach=function(t,e,n,o){var r=this._rootElement,i=this._messageElement;r.classList.remove(Ac),r.classList.add(Bc),i&&this.doSetContent(i,o),this._attachCell(t,e,n)?(r.classList.add(Ac),r.classList.remove(Bc)):this._detach()},t.prototype.move=function(t,e,n){var o=this._rootElement;this._attachCell(t,e,n)?(o.classList.add(Ac),o.classList.remove(Bc)):this._detach()},t.prototype.detach=function(){this._detach()},t.prototype.createTooltipDomElement=function(){return Ft.inject("tooltipElement","@keyframes kaka-grid__tooltip-element--shown-animation {\n  0% {\n    opacity: 0;\n    transform: scale(0.8) translateX(-60%);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) translateX(-50%);\n  }\n}\n\n.kaka-grid__tooltip-element {\n  position: absolute;\n  box-sizing: border-box;\n  border-radius: 3px;\n  /* background-color: #232f34; */\n  background-color: #fff;\n  border: 1px solid #ccc;\n  box-shadow: 1px 1px 3px #ccc;\n  padding: 8px;\n  pointer-events: none;\n  user-select: none;\n  color: #333;\n}\n\n.kaka-grid__tooltip-element--hidden {\n  opacity: 0;\n  transform: translateX(-50%);\n  /* transition: opacity 75ms linear; */\n}\n\n.kaka-grid__tooltip-element--shown {\n  opacity: 1;\n  transform: translateX(-50%);\n  animation: kaka-grid__tooltip-element--shown-animation 150ms ease-out;\n}\n\n.kaka-grid__tooltip-element__content {\n  font-family: Roboto;\n  font-size: 12px;\n  font-size: 0.75rem;\n  min-height: 1em;\n  line-height: 1;\n  width: 100%;\n  display: block;\n  /* white-space: pre-wrap; */\n  margin: 0;\n  box-sizing: border-box;\n}\n"),Rt("div",{classList:[Pc,Bc]})},t.prototype.createTooltipMessageElement=function(t,e){var n=Rt("pre",{classList:[e]});return t.appendChild(n),n},t.prototype.doSetContent=function(t,e){t.textContent=e},t.prototype._detach=function(){var t=this._rootElement;t.parentElement&&(t.classList.remove(Ac),t.classList.add(Bc))},t.prototype._attachCell=function(t,e,n){var o=this._rootElement,r=t.getAttachCellsArea(t.getCellRange(e,n)),i=r.element,l=r.rect,a=l.top,s=l.right,c=l.bottom,u=l.left,h=l.width,f=t.frozenRowCount,d=t.frozenColCount;if(n>=f&&f>0){if(c<t.getAttachCellsArea(t.getCellRange(e,f-1)).rect.bottom)return!1}else if(c<0)return!1;if(e>=d&&d>0){if(s<t.getAttachCellsArea(t.getCellRange(d-1,n)).rect.right)return!1}else if(s<0)return!1;var p=i.offsetHeight,g=i.offsetWidth;if(p<a)return!1;if(g<u)return!1;var v=c,y=u+h/2;o.style.top=v.toFixed()+"px",o.style.left=y.toFixed()+"px",o.style.minWidth=h.toFixed()+"px",o.parentElement!==i&&i.appendChild(o);var _=o.offsetHeight,b=o.offsetWidth;if(v+_>p){var w=a-_;o.style.top=w.toFixed()+"px"}if(y-b/2<0){var m=b/2;o.style.left=m.toFixed()+"px"}else if(y+b/2>g){var C=g-b/2;o.style.left=C.toFixed()+"px"}return!0},t}(),Dc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createTooltipElementInternal=function(){return new Mc},n}(Tc),jc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createTooltipMessageElement=function(t,e){var n=Rt("div",{classList:[e]});return t.appendChild(n),n},n.prototype.doSetContent=function(t,e){t.innerHTML=e},n}(Mc),Fc=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.createTooltipElementInternal=function(){return new jc},n}(Tc),Wc={"overflow-html":function(t){return new Fc(t)},"overflow-text":function(t){return new Dc(t)}};var Hc=function(){function t(t){this._grid=t,this._tooltipInstances={},this._bindGridEvent(t)}return t.prototype.dispose=function(){var t=this._tooltipInstances;for(var e in t)t[e].dispose();this._attachInfo=null},t.prototype._attach=function(t,e){var n=this._attachInfo,o=this._getTooltipInstanceInfo(t,e);if(!n||o&&n.instance===o.instance||(n.instance.detachTooltipElement(),this._attachInfo=null),o){var r=o.instance;r.attachTooltipElement(t,e,o.content);var i=this._grid.getCellRange(t,e);this._attachInfo={range:i,instance:r}}},t.prototype._move=function(t,e){var n=this._attachInfo;n&&L(n.range,t,e)&&n.instance.moveTooltipElement(t,e)},t.prototype._detach=function(){var t=this._attachInfo;t&&(t.instance.detachTooltipElement(),this._attachInfo=null)},t.prototype._isAttachCell=function(t,e){var n=this._attachInfo;return!!n&&L(n.range,t,e)},t.prototype._bindGridEvent=function(t){var e=this;t.listen(Za.MOUSEOVER_CELL,(function(t){t.related&&e._isAttachCell(t.col,t.row)||e._attach(t.col,t.row)})),t.listen(Za.MOUSEOUT_CELL,(function(t){t.related&&e._isAttachCell(t.related.col,t.related.row)||e._detach()})),t.listen(Za.SELECTED_CELL,(function(t){e._isAttachCell(t.col,t.row)&&e._detach()})),t.listen(Za.SCROLL,(function(){var t=e._attachInfo;t&&e._move(t.range.start.col,t.range.start.row)})),t.listen(Za.CHANGED_VALUE,(function(t){e._isAttachCell(t.col,t.row)&&(e._detach(),e._attach(t.col,t.row))}))},t.prototype._getTooltipInstanceInfo=function(t,e){var n=this._grid,o=this._tooltipInstances,r=function(t,e,n){var o=t.getCellOverflowText(e,n);return o?{content:o,type:t.getCellOverflowType(e,n)||"overflow-text"}:null}(n,t,e);if(!r)return null;var i=r.type;return{instance:o[i]||(o[i]=Wc[i](n)),type:i,content:r.content}},t}(),zc=G("protected.list_grid");function Nc(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Vc(t,e,n,o){var r=[];if(e<=n)for(var i=e;i<=n;i++)r.push(Kc(t,i,o));else for(i=e;i>=n;i--)r.push(Kc(t,i,o));return r}function Uc(t,e,n){var o,r,i=t[zc].layoutMap.getCellRange(e,n),l=function(t,e,n){var o=null,r=t[zc],i=r.spanBodyOptions,l=r.layoutMap;if(i&&n>=l.headerRowCount){var a=n,s=n,c=i.startCol,u=i.endCol;if(c<=e&&e<=u||u<=e&&e<=c){for(var h=Vc(t,c,e,n);a>l.headerRowCount&&Nc(h,Vc(t,c,e,a-1));)a--;for(;s<t.rowCount&&Nc(h,Vc(t,c,e,s+1));)s++}o={start:{col:e,row:Math.min(a,s)},end:{col:e,row:Math.max(a,s)}}}return o}(t,e,n);l&&(o=i,r=l,i={start:{col:Math.min(o.start.col,o.end.col,r.start.col,r.end.col),row:Math.min(o.start.row,o.end.row,r.start.row,r.end.row)},end:{col:Math.max(o.start.col,o.end.col,r.start.col,r.end.col),row:Math.max(o.start.row,o.end.row,r.start.row,r.end.row)}});var a={get col(){return e},get row(){return n},cellRange:i};return t.fireListeners(Za.CELL_RANGE,a),a.cellRange}function Kc(t,e,n){var o;if(n<t[zc].layoutMap.headerRowCount){var r=t[zc].layoutMap.getHeader(e,n).caption;o="function"==typeof r?r():r}else{var i=t[zc].layoutMap.getBody(e,n).field;o=$c(t,i,n)}var l={get col(){return e},get row(){return n},cellValue:o};return t.fireListeners(Za.CELL_VALUE,l),l.cellValue}function Gc(t,e,n){if(n<t[zc].layoutMap.headerRowCount)return null;var o=t[zc].layoutMap.getBody(e,n);return o&&o.message?$c(t,o.message,n):null}function Yc(t,e){return"function"==typeof e?e(t.headerValues):t.headerValues.get(e)}function Xc(t,e){if(Array.isArray(e))return e.map((function(e){return Xc(t,e)}));if(!B.isObject(e)||"function"==typeof e)return Yc(t,e);var n={},o=e;return De.iconPropKeys.forEach((function(e){if(o[e]){var r=Yc(t,o[e]);c(r)?n[e]=r:function(t,e){var n=!1;return t[zc].layoutMap.headerObjects.forEach((function(t){t.field===e&&(n=!0)})),n}(t,o[e])||(n[e]=o[e])}})),n}function qc(t,e,n){if(Array.isArray(e))return e.map((function(e){return qc(t,e,n)}));if(!B.isObject(e)||"function"==typeof e)return $c(t,e,n);var o={},r=e;return De.iconPropKeys.forEach((function(e){if(r[e]){var i=$c(t,r[e],n);c(i)?o[e]=i:function(t,e,n){if(!c(e))return!1;if(n<t[zc].layoutMap.headerRowCount)return!1;var o=ou(t,n);return t[zc].dataSource.hasField(o,e)}(t,r[e],n)||(o[e]=r[e])}})),o}function $c(t,e,n){if(!c(e))return null;if(n<t[zc].layoutMap.headerRowCount)return null;var o=ou(t,n);return t[zc].dataSource.getField(o,e)}function Zc(t,e,n,o,r,i){var l=o.col,a=o.row,s=t[zc].gridCanvasHelper,c=!!zt(t).cellRange,u=function(t){var e={fillColor:(void 0===t?{}:t).bgColor,isEditing:c};s.fillCellWithState(n,e)},h=function(){if(n.col===t.frozenColCount-1){var e=n.getRect();s.drawWithClip(n,(function(o){var r=n.row>=t.frozenRowCount?s.theme.borderColor:s.theme.frozenRowsBorderColor,i=s.toBoxArray(s.getColor(r,n.col,n.row,o));i[1]&&(o.lineWidth=1,o.strokeStyle=i[1],o.beginPath(),o.moveTo(e.right-2.5,e.top),o.lineTo(e.right-2.5,e.bottom),o.stroke())}))}s.borderSelection(n,{isEditing:c,highlightBorderWidth:ti(t.highlightBorderWidth,t[zc].calcWidthContext)})};return i(e,{getRecord:function(){return t.getRowRecord(a)},getIcon:function(){return function(t,e,n){var o=t[zc].layoutMap.getBody(e,n).icon;return null==o?null:qc(t,o,n)}(t,l,a)},getMessage:function(){return Gc(t,l,a)},messageHandler:t[zc].messageHandler,style:r,clearCellBase:function(){s.clearCell(n)},drawCellBase:function(t){var e=(void 0===t?{}:t).bgColor;u({bgColor:e}),h()},drawCellBg:u,drawCellBorder:h,getCell:function(){return{col:l,row:a}},getHeaderIcon:function(){return function(t,e,n){var o=t[zc].layoutMap.getHeader(e,n).icon;return null==o?null:Xc(t,o)}(t,l,a)},getContentHidden:function(){return function(t,e,n){var o=!1;if(n>=t[zc].layoutMap.headerRowCount){var r=t[zc].layoutMap.getBody(e,n);r&&r.contentHidden&&(o=x(r.contentHidden,t.getRowRecord(n)))}return o}(t,l,a)}},n,t)}function Jc(t){var e,n=t[zc];n.headerEvents&&n.headerEvents.forEach((function(e){return t.unlisten(e)}));var o,r=n.headerEvents=[];r.forEach((function(e){return t.unlisten(e)})),(o=n.layout&&(!Array.isArray(n.layout)||n.layout.length>0)?n.layoutMap=new $a(new qa(n.layout)):n.layoutMap=new $a(new Ga(null!==(e=n.header)&&void 0!==e?e:[]))).hiddenHeader=n.hiddenHeader,t.hiddenHeader||o.headerObjects.forEach((function(e){var n=e.headerType.bindGridEvent(t,e.id);if(r.push.apply(r,n),e.style&&e.style instanceof zl){var o=e.style.listen(zl.EVENT_TYPE.CHANGE_STYLE,(function(){t.invalidate()}));r.push(o)}if(e.action&&e.action instanceof yl){var i=e.action.bindGridEvent(t,e.id);r.push.apply(r,i)}})),o.columnObjects.forEach((function(e){if(e.action){var n=e.action.bindGridEvent(t,e.id);r.push.apply(r,n)}if(e.columnType){n=e.columnType.bindGridEvent(t,e.id);r.push.apply(r,n)}if(e.style&&e.style instanceof Gr.style.BaseStyle){var o=e.style.listen(Gr.style.EVENT_TYPE.CHANGE_STYLE,(function(){t.invalidate()}));r.push(o)}}));for(var i=0;i<o.columnWidths.length;i++){var l=o.columnWidths[i],a=l.width,s=l.minWidth,c=l.maxWidth,u=l.disableResize;a&&(a>0||"string"==typeof a)&&t.setColWidth(i,a),s&&(s>0||"string"==typeof s)&&t.setMinColWidth(i,s),c&&(c>0||"string"==typeof c)&&t.setMaxColWidth(i,c),"boolean"==typeof u&&t.setColDisableResize(i,u)}if(!t.hiddenHeader)for(var h=t[zc].headerRowHeight,f=0;f<o.headerRowCount;f++){var d=Array.isArray(h)?h[f]:h;d&&d>0&&t.setRowHeight(f,d)}t.colCount=o.colCount,Qc(t),t.frozenRowCount=o.headerRowCount}function Qc(t){var e=t[zc].layoutMap;t.rowCount=t[zc].dataSource.length*e.bodyRowCount+e.headerRowCount}function tu(t,e){t[zc].dataSourceEventIds&&t[zc].dataSourceEventIds.forEach((function(e){return t[zc].handler.off(e)})),e(t),t[zc].dataSourceEventIds=[t[zc].handler.on(t[zc].dataSource,xr.EVENT_TYPE.UPDATED_LENGTH,(function(){Qc(t),t.selection.fireSelectedEvent(),t.invalidate()})),t[zc].handler.on(t[zc].dataSource,xr.EVENT_TYPE.UPDATED_ORDER,(function(){t.selection.fireSelectedEvent(),t.invalidate()})),t[zc].handler.on(t[zc].dataSource,xr.EVENT_TYPE.REFRESH_DATA,(function(){t.selection.fireSelectedEvent(),t.invalidate()}))]}function eu(t,e){void 0===e&&(e=[]),tu(t,(function(){t[zc].records=e;var n=t[zc].dataSource=ul.ofArray(e);t.addDisposable(n)}))}function nu(t,e){tu(t,(function(){if(e)if(e instanceof xr)t[zc].dataSource=e;else{var n=t[zc].dataSource=new ul(e);t.addDisposable(n)}else t[zc].dataSource=xr.EMPTY;t[zc].records=null}))}function ou(t,e){return t[zc].layoutMap.getRecordIndexByRow(e)}function ru(t,e){var n,o=this;void 0===e&&(e=function(){return!0});for(var r=this[zc].layoutMap,i=this.selection.range,l=this.getCellRange(i.start.col,i.start.row).start,a=this.getCellRange(i.end.col,i.end.row).end,s=mi(t),c=Math.min(Math.max(a.row-l.row+1,s.rowCount),this.rowCount-l.row),u=Math.min(Math.max(a.col-l.col+1,s.colCount),this.colCount-l.col),h=!1,f=[],d=0;d<r.bodyRowCount;d++){var p=[];f.push(p);for(var g=0;g<u;g++){var v=r.getBody(l.col+g,d+r.headerRowCount);p[g]=v,!h&&(null===(n=v.action)||void 0===n?void 0:n.editable)&&(h=!0)}}if(h){for(var y=r.getRecordStartRowByRecordIndex(r.getRecordIndexByRow(l.row)),_=l.row-y,b={},w=_,m=0,C=0;C<c;C++){var x=0,R=function(t){var n=f[w][t],r=n.action,i=n.id;if(!b[i]&&(null==r?void 0:r.editable)){b[i]=!0;var a=l.col+t,c=l.row+C,u=s.getCellValue(x,m);E(O.getRowRecord(c),(function(t){E(Kc(o,a,c),(function(n){e({grid:o,record:t,col:a,row:c,value:u,oldValue:n})&&r.onPasteCellRangeBox(o,{col:a,row:c},u)}))}))}++x>=s.colCount&&(x=0)},O=this;for(g=0;g<u;g++)R(g);++w>=r.bodyRowCount&&(w=0,b={}),++m>=s.rowCount&&(m=0)}var L={col:l.col+u-1,row:l.row+c-1};this.selection.range={start:l,end:L},this.invalidateCellRange(this.selection.range)}}function iu(){for(var t,e=this,n=this[zc].layoutMap,o=this.selection.range,r=this.getCellRange(o.start.col,o.start.row).start,i=this.getCellRange(o.end.col,o.end.row).end,l=Math.min(i.row-r.row+1,this.rowCount-r.row),a=Math.min(i.col-r.col+1,this.colCount-r.col),s=!1,c=[],u=0;u<n.bodyRowCount;u++){var h=[];c.push(h);for(var f=0;f<a;f++){var d=n.getBody(r.col+f,u+n.headerRowCount);h[f]=d,!s&&(null===(t=d.action)||void 0===t?void 0:t.editable)&&(s=!0)}}if(s){for(var p=n.getRecordStartRowByRecordIndex(n.getRecordIndexByRow(r.row)),g=r.row-p,v={},y=g,_=0;_<l;_++){var b=function(t){var n=c[y][t],o=n.action,i=n.id;if(!v[i]&&(null==o?void 0:o.editable)){v[i]=!0;var l=r.col+t,a=r.row+_;E(w.getRowRecord(a),(function(t){E(Kc(e,l,a),(function(t){o.onDeleteCellRangeBox(e,{col:l,row:a})}))}))}},w=this;for(f=0;f<a;f++)b(f);++y>=n.bodyRowCount&&(y=0,v={})}this.invalidateCellRange(o)}}function lu(t,e,n){var o=t[e];return t[e]=n,o}var au,su={theme:function(t,e){return null!=e?lu(ca,t,e):ca[t]},icon:function(t,e){return null!=e?lu(ys,t,e):ys[t]},icons:function(t){return function(t,e){for(var n in e)t[n]=e[n]}(ys,t)}},cu={version:"2.3.1",core:sl,tools:Na,ListGrid:function(t){function n(e){var n;void 0===e&&(e={});var o=t.call(this,function(t,e){var n={},o=function(o){if(e.indexOf(o)>=0)return"continue";Object.defineProperty(n,o,{get:function(){return t[o]},set:function(e){t[o]=e},configurable:!0,enumerable:!0})};for(var r in t)o(r);return n}(e,["colCount","rowCount","frozenRowCount"]))||this;o[zc]={};var r=o[zc];return r.disabled=e.disabled||!1,r.readOnly=e.readonly||!1,r.header=e.header||[],r.layout=e.layout||[],r.headerRowHeight=e.headerRowHeight||[],r.hiddenHeader=!!e.hiddenHeader,r.spanBodyOptions=e.spanBodyOptions||void 0,r.handler=new Bt,r.sortState={col:-1,order:void 0,row:-1},r.gridCanvasHelper=new Ic(o),r.theme=xa.of(e.theme),r.messageHandler=new vs(o,(function(t,e){return Gc(o,t,e)})),r.tooltipHandler=new Hc(o),e.dataSource?nu(o,e.dataSource):eu(o,e.records),r.allowRangePaste=null!==(n=e.allowRangePaste)&&void 0!==n&&n,Jc(o),o.selection.fireSelectedEvent(),o.invalidate(),c(e.monitorResize)&&!0!==e.monitorResize||r.handler.on(window,"resize",(function(){return o.resize()})),o}return e(n,t),Object.defineProperty(n,"EVENT_TYPE",{get:function(){return Za},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var e=this[zc];e.handler.dispose(),e.messageHandler.dispose(),e.tooltipHandler.dispose(),t.prototype.dispose.call(this)},Object.defineProperty(n.prototype,"header",{get:function(){return this[zc].header},set:function(t){this[zc].header=t,Jc(this);var e=this.selection.range,n=this.updateSelectionRange(this.selection.range);e.start.col===n.start.col&&e.end.col===n.end.col&&e.start.row===n.start.row&&e.end.row===n.end.row||(this.selection._forceUpdateRange(),this.selection.fireSelectedEvent())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"layout",{get:function(){return this[zc].layout},set:function(t){this[zc].layout=t,Jc(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"recordRowCount",{get:function(){return this[zc].layoutMap.bodyRowCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"records",{get:function(){return this[zc].records||null},set:function(t){null!=t&&(eu(this,t),Qc(this),this.invalidate())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dataSource",{get:function(){return this[zc].dataSource},set:function(t){nu(this,t),Qc(this),this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"theme",{get:function(){return this[zc].theme},set:function(t){this[zc].theme=xa.of(t),this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"allowRangePaste",{get:function(){return this[zc].allowRangePaste},set:function(t){this[zc].allowRangePaste=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sortState",{get:function(){return this[zc].sortState},set:function(t){var e,n=this.sortState;n.col>=0&&n.row>=0&&(e=this.getHeaderField(n.col,n.row));var o,r=this[zc].sortState=c(t)?t:{col:-1,row:-1,order:void 0};r.col>=0&&r.row>=0&&(o=this.getHeaderField(r.col,r.row)),c(e)&&e!==o&&this.setHeaderValue(n.col,n.row,void 0),c(o)&&this.setHeaderValue(r.col,r.row,r.order)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"headerValues",{get:function(){return this[zc].headerValues||(this[zc].headerValues=new Map)},set:function(t){this[zc].headerValues=t||new Map},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hiddenHeader",{get:function(){return this[zc].hiddenHeader},set:function(t){this[zc].hiddenHeader=t,Jc(this),this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"disabled",{get:function(){return this[zc].disabled},set:function(t){this[zc].disabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readOnly",{get:function(){return this[zc].readOnly},set:function(t){this[zc].readOnly=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readonly",{get:function(){return window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly},set:function(t){window.console.warn("'readonly' is deprecated, please use 'readOnly' instead"),this.readOnly=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"spanBodyOptions",{get:function(){var t;return null!==(t=this[zc].spanBodyOptions)&&void 0!==t?t:null},set:function(t){this[zc].spanBodyOptions=null!=t?t:void 0},enumerable:!1,configurable:!0}),n.prototype.getField=function(t,e){return this[zc].layoutMap.getBody(t,null!=e?e:this[zc].layoutMap.headerRowCount).field},n.prototype.getColumnDefine=function(t,e){return this[zc].layoutMap.getBody(t,null!=e?e:this[zc].layoutMap.headerRowCount).define},n.prototype.getColumnType=function(t,e){return this[zc].layoutMap.getBody(t,e).columnType},n.prototype.getHeaderField=function(t,e){return this[zc].layoutMap.getHeader(t,e).field},n.prototype.getHeaderDefine=function(t,e){return this[zc].layoutMap.getHeader(t,e).define},n.prototype.getColumn=function(t,e){return this[zc].layoutMap.getBody(t,e||0)},n.prototype.getRowRecord=function(t){return t<this[zc].layoutMap.headerRowCount?void 0:this[zc].dataSource.get(ou(this,t))},n.prototype.getRecordIndexByRow=function(t){return ou(this,t)},n.prototype.getRowRecordIndex=function(t){return window.console.warn("'getRowRecordIndex' is deprecated, please use 'getRecordIndexByRow' instead"),this.getRecordIndexByRow(t)},n.prototype.getRecordStartRowByRecordIndex=function(t){return this[zc].layoutMap.getRecordStartRowByRecordIndex(t)},n.prototype.getColumnIndexByField=function(t){var e,n=this.getCellRangeByField(t,0);return null!==(e=null==n?void 0:n.start.col)&&void 0!==e?e:null},n.prototype.getCellRangeByField=function(t,e){var n=this[zc].layoutMap,o=n.columnObjects.find((function(e){return e.field===t}));if(o){var r=n.getBodyLayoutRangeById(o.id),i=n.getRecordStartRowByRecordIndex(e);return{start:{col:r.start.col,row:i+r.start.row},end:{col:r.end.col,row:i+r.end.row}}}return null},n.prototype.focusGridCell=function(t,e){var n,o=this.selection.range,r=o.start,i=r.col,l=r.row,a=o.end,s=a.col,c=a.row,u=null===(n=this.getCellRangeByField(t,e))||void 0===n?void 0:n.start;null!=u&&(this.focusCell(u.col,u.row),this.selection.select=u,this.invalidateGridRect(i,l,s,c),this.invalidateCell(u.col,u.row))},n.prototype.makeVisibleGridCell=function(t,e){var n,o,r,i=null===(n=this.getCellRangeByField(t,e))||void 0===n?void 0:n.start;this.makeVisibleCell(null!==(o=null==i?void 0:i.col)&&void 0!==o?o:0,null!==(r=null==i?void 0:i.row)&&void 0!==r?r:this[zc].layoutMap.headerRowCount)},n.prototype.selectCellRange=function(t,e,n,o){this.focusCell(t,e),this.selection.range=di(t,e,n,o);var r=this.selection.range,i=r.start,l=i.col,a=i.row,s=r.end,c=s.col,u=s.row;this.invalidateGridRect(l,a,c,u)},n.prototype.getGridCanvasHelper=function(){return this[zc].gridCanvasHelper},n.prototype.getCellRange=function(t,e){return Uc(this,t,e)},n.prototype.getHeaderCellRange=function(t,e){return window.console.warn("'getHeaderCellRange' is deprecated, please use 'getCellRange' instead"),this.getCellRange(t,e)},n.prototype.getCopyCellValue=function(t,e,n){var o,r=Uc(this,t,e),i=n?Math.max(n.start.col,r.start.col):r.start.col,l=n?Math.max(n.start.row,r.start.row):r.start.row;if(i!==t||l!==e)return"";var a=this[zc].layoutMap,s=Kc(this,t,e);if(e>=a.headerRowCount){var c=a.getBody(t,e).columnType;s=null!==(o=c.getCopyCellValue(s,this,{col:t,row:e}))&&void 0!==o?o:s,s=c.convertCopyValue(s,{col:t,row:e},this)}return s},n.prototype.onDrawCell=function(t,e,n){var o,r,i=this[zc].layoutMap;if(e<i.headerRowCount){var l=i.getHeader(t,e);o=l.headerType.onDrawCell,r=l.style}else{var a=i.getBody(t,e);o=a.columnType.onDrawCell,r=a.style}return function(t,e,n,o){o.setRectFilter((function(o){for(var r=o.left,i=o.right,l=o.top,a=o.bottom,s=Uc(t,e,n),c=s.start,u=c.col,h=c.row,f=s.end,d=f.col,p=f.row,g=e-1;g>=u;g--)r-=t.getColWidth(g);for(g=e+1;g<=d;g++)i+=t.getColWidth(g);for(var v=n-1;v>=h;v--)l-=t.getRowHeight(v);for(v=n+1;v<=p;v++)a+=t.getRowHeight(v);return je.bounds(r,l,i,a)})),o.range=Uc(t,e,n)}(this,t,e,n),Zc(this,Kc(this,t,e),n,{col:t,row:e},r,o)},n.prototype.doGetCellValue=function(t,e,n){if(e<this[zc].layoutMap.headerRowCount)return!1;var o=Kc(this,t,e);return!R(o)&&(n(o),!0)},n.prototype.doChangeValue=function(t,e,n){var o=this;if(e<this[zc].layoutMap.headerRowCount)return!1;var r=this.getRowRecord(e);if(R(r))return!1;var i=Kc(this,t,e);if(R(i))return!1;var l=n(i);return void 0!==l&&E(function(t,e,n,o){if(n<t[zc].layoutMap.headerRowCount)return!1;var r=t[zc].layoutMap.getBody(e,n).field;if(null==r)return!1;var i=ou(t,n);return t[zc].dataSource.setField(i,r,o)}(this,t,e,l),(function(n){if(n){var a=o[zc].layoutMap.getBody(t,e).field;o.fireListeners(Za.CHANGED_VALUE,{col:t,row:e,field:a,record:r,value:l,oldValue:i})}return n}))},n.prototype.doSetPasteValue=function(t,e){ru.call(this,t,e)},n.prototype.getHeaderValue=function(t,e){var n=this.getHeaderField(t,e);return this.headerValues.get(n)},n.prototype.setHeaderValue=function(t,e,n){var o=this.getHeaderField(t,e),r=this.headerValues.get(o);this.headerValues.set(o,n),this.fireListeners(Za.CHANGED_HEADER_VALUE,{col:t,field:o,oldValue:r,row:e,value:n})},n.prototype.getLayoutCellId=function(t,e){return this[zc].layoutMap.getCellId(t,e)},n.prototype.completeEdit=function(){this.focus()},n.prototype.bindEventsInternal=function(){var t=this;this.listen(Za.SELECTED_CELL,(function(e){if(e.selected){var n=Uc(t,e.before.col,e.before.row),o=n.start,r=o.col,i=o.row,l=n.end,a=l.col,s=l.row;r===a&&i===s||t.invalidateGridRect(r,i,a,s);var c=Uc(t,e.col,e.row),u=c.start,h=u.col,f=u.row,d=c.end,p=d.col,g=d.row;h===p&&f===g||t.invalidateGridRect(h,f,p,g)}})),this.listen(Za.PASTE_CELL,(function(e){if(t[zc].allowRangePaste){var n=t.selection.range,o=n.start,r=n.end;if(e.multi||!O(o,r)){var i=t[zc].layoutMap;o.row<i.headerRowCount||(M.cancel(e.event),ru.call(t,e.normalizeValue))}}})),this.listen(Za.DELETE_CELL,(function(e){var n=t.selection.range.start,o=t[zc].layoutMap;n.row<o.headerRowCount||(M.cancel(e.event),iu.call(t))}))},n.prototype.getMoveLeftColByKeyDownInternal=function(e){var n=e.col,o=e.row;return n=Uc(this,n,o).start.col,t.prototype.getMoveLeftColByKeyDownInternal.call(this,{col:n,row:o})},n.prototype.getMoveRightColByKeyDownInternal=function(e){var n=e.col,o=e.row;return n=Uc(this,n,o).end.col,t.prototype.getMoveRightColByKeyDownInternal.call(this,{col:n,row:o})},n.prototype.getMoveUpRowByKeyDownInternal=function(e){var n=e.col,o=e.row;return o=Uc(this,n,o).start.row,t.prototype.getMoveUpRowByKeyDownInternal.call(this,{col:n,row:o})},n.prototype.getMoveDownRowByKeyDownInternal=function(e){var n=e.col,o=e.row;return o=Uc(this,n,o).end.row,t.prototype.getMoveDownRowByKeyDownInternal.call(this,{col:n,row:o})},n.prototype.getOffsetInvalidateCells=function(){return 1},n.prototype.getCopyRangeInternal=function(t){return{start:this.getCellRange(t.start.col,t.start.row).start,end:this.getCellRange(t.end.col,t.end.row).end}},n.prototype.getAttachCellsAreaInternal=function(e){var n=t.prototype.getAttachCellsAreaInternal.call(this,e),o=this.getCellRange(e.start.col,e.start.row).start,r=o.col,i=o.row;i>=this[zc].layoutMap.headerRowCount&&this[zc].layoutMap.getBody(r,i).columnType.reviseAttachCellsArea(n,i,this);return n},n.prototype.getAttachCellsPaddingInternal=function(e){var n=t.prototype.getAttachCellsPaddingInternal.call(this,e),o=this.getCellRange(e.start.col,e.start.row).start,r=o.col,i=o.row;i>=this[zc].layoutMap.headerRowCount&&this[zc].layoutMap.getBody(r,i).columnType.reviseAttachCellsPadding(n,i,this);return n},n.prototype.getFocusRectInternal=function(e,n){var o=t.prototype.getFocusRectInternal.call(this,e,n);this[zc]&&n>=this[zc].layoutMap.headerRowCount&&this[zc].layoutMap.getBody(e,n).columnType.reviseFocusRect(o,n,this);return o},n.prototype.getCellOverflowTextInternal=function(t){var e=t.col,n=t.row,o="";if(n>=this[zc].layoutMap.headerRowCount){var r=this[zc].layoutMap.getBody(e,n).tooltip,i=this.getRowRecord(n);i&&("function"==typeof r?o=r.call(this,i):"string"==typeof r&&(o=i[r]))}else{var l=this[zc].layoutMap.getHeader(e,n);if(l)"function"==typeof(r=l.tooltip)?o=r.call(this,{cell:{col:e,row:n},field:this.getHeaderField(e,n)}):"string"==typeof r&&(o=r)}return o||""},n.prototype.getCellOverflowTypeInternal=function(t){var e=t.col,n=t.row,o="";if(n>=this[zc].layoutMap.headerRowCount){var r=this[zc].layoutMap.getBody(e,n).tooltipType,i=this.getRowRecord(n);i&&("function"==typeof r?o=r.call(this,i):"string"==typeof r&&(o=r))}else{var l=this[zc].layoutMap.getHeader(e,n);if(l)"function"==typeof(r=l.tooltipType)?o=r.call(this,{cell:{col:e,row:n},field:this.getHeaderField(e,n)}):"string"==typeof r&&(o=r)}return o||""},n.prototype.getDefaultRowHeight=function(){return this[zc]&&this[zc].gridCanvasHelper.theme.defaultRowHeight||t.prototype.getDefaultRowHeight.call(this)},n.prototype.getDefaultColWidth=function(){return this[zc]&&this[zc].gridCanvasHelper.theme.defaultColWidth||t.prototype.getDefaultColWidth.call(this)},n.prototype.getHighlightBorderWidth=function(){return this[zc]&&this[zc].gridCanvasHelper.theme.highlightBorderWidth||t.prototype.getHighlightBorderWidth.call(this)},n.prototype.updateSelectionRange=function(t){for(var e=t.start.col,n=t.start.row,o=t.end.col,r=t.end.row,i=Math.min(t.start.col,t.end.col),l=Math.min(t.start.row,t.end.row),a=Math.max(t.start.col,t.end.col),s=Math.max(t.start.row,t.end.row),c=i,u=l,h=a,f=s,d=l;d<=s;d++)for(var p=i;p<=a;p++){var g=this.getCellRange(p,d);c=Math.min(g.start.col,c),u=Math.min(g.start.row,u),h=Math.max(g.end.col,h),f=Math.max(g.end.row,f)}return c<i&&(t.start.col>t.end.col?t.end.col=c:t.start.col=c),u<l&&(t.start.row>t.end.row?t.end.row=u:t.start.row=u),h>a&&(t.start.col>t.end.col?t.start.col=h:t.end.col=h),f>s&&(t.start.row>t.end.row?t.start.row=f:t.end.row=f),e===t.start.col&&n===t.start.row&&o===t.end.col&&r===t.end.row||(t=this.updateSelectionRange(t)),t},n.prototype.getDefaultFont=function(){return this[zc].gridCanvasHelper.theme.font},n.prototype.getDefaultUnderlayBackgroundColor=function(){return this[zc].gridCanvasHelper.theme.underlayBackgroundColor},n.prototype.getDefaultBorderColor=function(){return this[zc].gridCanvasHelper.theme.gridBorderColor},n.prototype.getDefaultBorderWidth=function(){return this[zc].gridCanvasHelper.theme.gridBorderWidth},n.prototype.fireListeners=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return t.prototype.fireListeners.apply(this,o([e],n))},n}(al),columns:Gr,data:vl,headers:sa,themes:xa,GridCanvasHelper:Ic,get icons(){return Es()},template:A.template,register:su};return function(t){t.version=cu.version;var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(cu.ListGrid);t.ListGrid=n,t.core=cu.core,t.tools=cu.tools,t.columns=cu.columns,t.data=cu.data,t.headers=cu.headers,t.themes=cu.themes,t.GridCanvasHelper=cu.GridCanvasHelper,t.icons=cu.icons,t.template=cu.template,t.register=cu.register}(au||(au={})),au}));
//# sourceMappingURL=kakaGrid.es5.min.js.map
