{"version":3,"file":"kakaGrid.min.js","sources":["src/internal/utils.ts","src/columns/action/action-utils.ts","src/core/draw-grid/DG_EVENT_TYPE.ts","src/core/draw-grid/KEY_CODE.ts","src/internal/symbolManager.ts","src/columns/action/actionBind.ts","src/columns/action/BaseAction.ts","src/columns/action/Action.ts","src/columns/action/Editor.ts","src/columns/action/BaseInputEditor.ts","src/columns/action/BaseActionInput.ts","src/internal/animate.ts","src/columns/action/BaseCheckEditor.ts","src/columns/action/ButtonAction.ts","src/columns/action/CheckEditor.ts","src/columns/action/SwitchEditor.ts","src/internal/dom.ts","src/internal/EventHandler.ts","src/internal/style.ts","src/columns/action/internal/input-value-handler.ts","src/columns/utils/index.ts","src/columns/action/internal/InlineInputElement.ts","src/columns/action/InlineInputEditor.ts","src/columns/action/internal/InlineLookupElement.ts","src/columns/action/InlineLookupEditor.ts","src/internal/menu-items.ts","src/columns/action/internal/InlineMenuElement.ts","src/internal/icons.ts","src/internal/Rect.ts","src/columns/type/columnUtils.ts","src/core/EventTarget.ts","src/columns/style/BaseStyle.ts","src/columns/style/BaseStdStyle.ts","src/columns/style/BaseCheckStyle.ts","src/columns/style/Style.ts","src/columns/style/ButtonStyle.ts","src/columns/style/CheckStyle.ts","src/columns/style/SwitchStyle.ts","src/columns/style/DateStyle.ts","src/columns/style/DrawStyle.ts","src/columns/style/IconStyle.ts","src/columns/style/ImageStyle.ts","src/columns/style/LookupStyle.ts","src/columns/style/MenuStyle.ts","src/columns/style/MultilineTextStyle.ts","src/columns/style/NumberStyle.ts","src/columns/style/PercentCompleteBarStyle.ts","src/columns/style/RadioStyle.ts","src/columns/style/TreeStyle.ts","src/columns/style.ts","src/columns/type/BaseColumn.ts","src/columns/type/MenuColumn.ts","src/columns/action/InlineMenuEditor.ts","src/columns/action/internal/InlineTextAreaElement.ts","src/columns/action/InlineTextAreaEditor.ts","src/columns/action/RadioEditor.ts","src/columns/action/internal/SmallDialogInputElement.ts","src/columns/action/SmallDialogInputEditor.ts","src/columns/action.ts","src/columns/immutable/ImmutableCheckEditor.ts","src/columns/immutable/ImmutableRadioEditor.ts","src/columns/immutable/ImmutableInputEditor.ts","src/columns/immutable/ImmutableSwitchEditor.ts","src/columns/type/BaseCheckColumn.ts","src/columns/style/BranchGraphStyle.ts","src/columns/type/branch/BranchLine.ts","src/columns/type/branch/BranchPoint.ts","src/columns/type/BranchGraphColumn.ts","src/columns/type/Column.ts","src/columns/type/ButtonColumn.ts","src/columns/type/CheckColumn.ts","src/columns/type/SwitchColumn.ts","src/columns/type/DateColumn.ts","src/columns/type/DrawColumn.ts","src/columns/type/IconColumn.ts","src/internal/canvases.ts","src/internal/LRUCache.ts","src/internal/imgs.ts","src/columns/type/ImageColumn.ts","src/columns/type/LookupColumn.ts","src/columns/type/MultilineTextColumn.ts","src/columns/type/NumberColumn.ts","src/columns/type/PercentCompleteBarColumn.ts","src/internal/sort.ts","src/data/DataSource.ts","src/data/TreeDataSource.ts","src/columns/type/TreeColumn.ts","src/columns/type/RadioColumn.ts","src/columns/type.ts","src/columns.ts","src/internal/calc.ts","src/internal/hiDPI.ts","src/internal/NumberMap.ts","src/internal/Scrollbar.ts","src/internal/Scrollable.ts","src/core/draw-grid/BaseMouseDownMover.ts","src/core/draw-grid/CellSelector.ts","src/core/draw-grid/ColumnResizer.ts","src/core/draw-grid/DrawCellContext.ts","src/core/draw-grid/DrawLayer.ts","src/core/draw-grid/DrawLayers.ts","src/core/draw-grid/FocusControl.ts","src/core/draw-grid/Selection.ts","src/core/draw-grid/SelectionResizer.ts","src/internal/paste-utils.ts","src/core/DrawGrid.ts","src/core.ts","src/data/CachedDataSource.ts","src/data/filter/DataSourceIterator.ts","src/data/filter/FilterData.ts","src/data/FilterDataSource.ts","src/data/PivotDataSource.ts","src/data.ts","src/header/action/BaseAction.ts","src/header/action/actionBind.ts","src/header/action/action-utils.ts","src/header/action/BaseCheckAction.ts","src/header/action/CheckHeaderAction.ts","src/header/action/SwitchHeaderAction.ts","src/header/action/SortHeaderAction.ts","src/header/immutable/ImmutableSortHeaderAction.ts","src/header/action.ts","src/header/immutable/ImmutableCheckHeaderAction.ts","src/header/immutable/ImmutableSwitchHeaderAction.ts","src/header/style/BaseStyle.ts","src/header/style/BaseStdStyle.ts","src/header/style/Style.ts","src/header/style/BaseCheckStyle.ts","src/header/style/CheckHeaderStyle.ts","src/header/style/SortHeaderStyle.ts","src/header/style/SwitchHeaderStyle.ts","src/header/style/MultilineTextHeaderStyle.ts","src/header/style.ts","src/header/type/BaseHeader.ts","src/header/type/BaseCheckHeader.ts","src/header/type/CheckHeader.ts","src/header/type/headerUtils.ts","src/header/type/Header.ts","src/header/type/SortHeader.ts","src/header/type/SwitchHeader.ts","src/header/type/MultilineTextHeader.ts","src/header/type.ts","src/headers.ts","src/plugins/themes.ts","src/themes/BASIC.ts","src/themes/MATERIAL_DESIGN.ts","src/themes/theme.ts","src/themes.ts","src/internal/color.ts","src/tools/canvasHelper.ts","src/tools.ts","src/list-grid/layout-map/internal/utils.ts","src/list-grid/layout-map/internal/simple-header-layout.ts","src/list-grid/layout-map/internal/multi-layout.ts","src/list-grid/LayoutMap.ts","src/list-grid/LG_EVENT_TYPE.ts","src/columns/message/BaseMessage.ts","src/columns/message/internal/MessageElement.ts","src/columns/message/internal/ErrorMessageElement.ts","src/columns/message/messageUtils.ts","src/columns/message/ErrorMessage.ts","src/columns/message/InfoMessage.ts","src/columns/message/internal/WarningMessageElement.ts","src/columns/message/WarningMessage.ts","src/columns/message/MessageHandler.ts","src/plugins/icons.ts","src/tools/Svg.ts","src/tools/svgToIcon.ts","src/icons.ts","src/internal/legacy/canvas/PathCommands.ts","src/internal/legacy/canvas/PathCommandsParser.ts","src/internal/legacy/canvas/Path2DShim.ts","src/internal/path2DManager.ts","src/element/Inline.ts","src/element/InlineDrawer.ts","src/internal/legacy/fontwatch/FontRuler.ts","src/internal/legacy/fontwatch/FontWatchRunner.ts","src/internal/fonts.ts","src/GridCanvasHelper.ts","src/element/InlineIcon.ts","src/element/InlineImage.ts","src/element/InlinePath2D.ts","src/element/InlineSvg.ts","src/element/inlines.ts","src/GridThemeHelper.ts","src/tooltip/BaseTooltip.ts","src/tooltip/internal/TooltipElement.ts","src/tooltip/Tooltip.ts","src/tooltip/internal/HtmlTooltipElement.ts","src/tooltip/HtmlTooltip.ts","src/tooltip/TooltipHandler.ts","src/ListGrid.ts","src/register.ts","src/kakaGrid.ts"],"sourcesContent":["import { CellAddress, CellRange, MaybeCall, MaybePromise } from '../ts-types'\n\nconst isNode =\n  typeof window === 'undefined' || typeof window.window === 'undefined'\n\ntype ArrayElementPredicate<E> = (t: E, i: number, arr: E[]) => boolean\n// type ObjectElementPredicate<T, K extends keyof T> = (\n//   t: T[K],\n//   key?: K,\n//   obj?: T\n// ) => boolean;\n\ntype ArrayElementFunction<E> = (t: E, i: number, arr: E[]) => void\ntype ObjectElementFunction<T, K extends keyof T> = (\n  t: T[K],\n  key: K,\n  obj: T\n) => void\nlet arrayFind: <T>(\n  arr: T[],\n  predicate: ArrayElementPredicate<T>\n) => T | undefined\nlet arrayFindIndex: <T>(arr: T[], predicate: ArrayElementPredicate<T>) => number\nconst array = {\n  get find(): typeof arrayFind {\n    if (arrayFind) {\n      return arrayFind\n    }\n    if (Array.prototype.find) {\n      arrayFind = <T>(\n        arr: T[],\n        predicate: ArrayElementPredicate<T>\n      ): T | undefined => Array.prototype.find.call(arr, predicate)\n    } else {\n      arrayFind = <T>(\n        arr: T[],\n        predicate: ArrayElementPredicate<T>\n      ): T | undefined => {\n        const index = array.findIndex(arr, predicate)\n        return index >= 0 ? arr[index] : undefined\n      }\n    }\n    return arrayFind\n  },\n  get findIndex(): typeof arrayFindIndex {\n    if (arrayFindIndex) {\n      return arrayFindIndex\n    }\n    if (Array.prototype.findIndex) {\n      arrayFindIndex = <T>(\n        arr: T[],\n        predicate: ArrayElementPredicate<T>\n      ): number => Array.prototype.findIndex.call(arr, predicate)\n    } else {\n      arrayFindIndex = <T>(\n        arr: T[],\n        predicate: ArrayElementPredicate<T>\n      ): number => {\n        const { length } = arr\n        for (let i = 0; i < length; i++) {\n          const value = arr[i]\n          if (predicate(value, i, arr)) {\n            return i\n          }\n        }\n        return -1\n      }\n    }\n    return arrayFindIndex\n  },\n}\n\nconst isDef = <T>(data: T | null | undefined | void): data is T => {\n  return data !== null && typeof data !== 'undefined'\n}\n\nconst isDefString = <T>(data: T | null | undefined | void): data is T => {\n  return isDef(data) && (typeof data !== 'string' || data !== '')\n}\n\nfunction analyzeUserAgent(): {\n  IE: boolean\n  Edge: boolean\n  Chrome: boolean\n  Firefox: boolean\n  Safari: boolean\n} {\n  if (isNode) {\n    return {\n      Chrome: false,\n      Edge: false,\n      Firefox: false,\n      IE: false,\n      Safari: false,\n    }\n  } else {\n    const ua = window.navigator.userAgent.toLowerCase()\n    return {\n      IE: !!/(msie|trident)/.exec(ua),\n      Edge: ua.indexOf('edge') > -1,\n      Chrome: ua.indexOf('chrome') > -1 && ua.indexOf('edge') === -1,\n      Firefox: ua.indexOf('firefox') > -1,\n      Safari: ua.indexOf('safari') > -1 && ua.indexOf('edge') === -1,\n    }\n  }\n}\nconst { IE, Chrome, Firefox, Edge, Safari } = analyzeUserAgent()\n\nfunction setReadonly<T, K extends keyof T>(obj: T, name: K, value: T[K]): void {\n  Object.defineProperty(obj, name, {\n    enumerable: false,\n    configurable: true,\n    value,\n  })\n}\n\nexport function each<E>(obj: E[], fn: ArrayElementFunction<E>): void\nexport function each<T, K extends keyof T>(\n  obj: T,\n  fn: ObjectElementFunction<T, K>\n): void\n\nexport function each(obj: any, fn: any): void {\n  for (const key in obj) {\n    fn(obj[key], key, obj)\n  }\n}\n\nfunction isObject(obj: any): obj is Record<string, any> {\n  return obj === Object(obj)\n}\n\nexport function omit<T, K extends keyof T>(source: T, omits: K[]): Omit<T, K> {\n  const result = {} as Omit<T, K>\n  for (const key in source) {\n    if (omits.indexOf(key as never) >= 0) {\n      continue\n    }\n    Object.defineProperty(result, key, {\n      get() {\n        return source[key]\n      },\n      set(val) {\n        source[key] = val\n      },\n      configurable: true,\n      enumerable: true,\n    })\n  }\n  return result\n}\n\nexport function defaults<T>(source: T, defs: Partial<T>): T {\n  const keys: string[] = []\n  const result = {} as T\n  for (const key in source) {\n    keys.push(key)\n    Object.defineProperty(result, key, {\n      get() {\n        const val = source[key]\n        return val === undefined ? defs[key] : val\n      },\n      set(val) {\n        source[key] = val\n      },\n      configurable: true,\n      enumerable: true,\n    })\n  }\n  for (const key in defs) {\n    if (keys.indexOf(key) >= 0) {\n      continue\n    }\n    Object.defineProperty(result, key, {\n      get() {\n        const val = source[key]\n        return val === undefined ? defs[key] : val\n      },\n      set(val) {\n        source[key] = val\n      },\n      configurable: true,\n      enumerable: true,\n    })\n  }\n  return result\n}\n\nfunction extend<T, U>(t: T, u: U): T & U\nfunction extend<T, U, V>(t: T, u: U, v: V): T & U & V\nfunction extend<T>(...args: T[]): T\nfunction extend<T>(...args: T[]): T {\n  const result = {} as T\n  args.forEach((source) => {\n    for (const key in source) {\n      Object.defineProperty(result, key, {\n        get() {\n          return source[key]\n        },\n        set(val) {\n          source[key] = val\n        },\n        configurable: true,\n        enumerable: true,\n      })\n    }\n  })\n  return result\n}\n\nfunction isDescendantElement(root: HTMLElement, target: HTMLElement): boolean {\n  while (target && target.parentElement) {\n    const p = target.parentElement\n    if (root === p) {\n      return true\n    }\n    target = p\n  }\n  return false\n}\n\nfunction applyChainSafe(\n  obj: any,\n  fn: (value: any, name: string) => any,\n  ...names: string[]\n): any {\n  let value = obj\n  for (let i = 0; i < names.length && isDef(value); i++) {\n    value = fn(value, names[i])\n  }\n  return value\n}\n\nfunction getChainSafe(obj: any, ...names: string[]): any {\n  return applyChainSafe(obj, (val, name) => val[name], ...names)\n}\n\nfunction getOrApply<T, A extends any[]>(value: undefined, ...args: A): undefined\nfunction getOrApply<T, A extends any[]>(value: null, ...args: A): null\nfunction getOrApply<T, A extends any[]>(value: MaybeCall<T, A>, ...args: A): T\nfunction getOrApply<T, A extends any[]>(value: MaybeCall<T, A>, ...args: A): T {\n  if (typeof value === 'function') {\n    return (value as any)(...args)\n  } else {\n    return value\n  }\n}\n\nfunction endsWith(\n  str: string,\n  searchString: string,\n  position?: number\n): boolean {\n  const subjectString = str.toString()\n  if (\n    typeof position !== 'number' ||\n    !isFinite(position) ||\n    Math.floor(position) !== position ||\n    position > subjectString.length\n  ) {\n    position = subjectString.length\n  }\n  position -= searchString.length\n  const lastIndex = subjectString.lastIndexOf(searchString, position)\n  return lastIndex !== -1 && lastIndex === position\n}\n\nfunction genChars(s: string): { next(): string | null } {\n  // Surrogate Code Point\n  // [\\uD800-\\uDBFF]\n  // Variation Selectors\n  // FVS [\\u180B-\\u180D]\n  // VS1～VS16 [\\uFE00-\\uFE0F]\n  // VS17～VS256 \\uDB40[\\uDD00-\\uDDEF]\n  const re = /([\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|\\r\\n|[^\\uD800-\\uDFFF])([\\u180B-\\u180D]|[\\uFE00-\\uFE0F]|\\uDB40[\\uDD00-\\uDDEF])?/g\n  return {\n    next(): string | null {\n      const res = re.exec(s)\n      return res !== null ? res[0] : null\n    },\n  }\n}\n\nexport type GenWordsResult = {\n  next(): string | null\n}\nfunction genWords(s: string): GenWordsResult {\n  const re = /[!-~]+|[^!-~\\s]+|\\s+/g\n  return {\n    next(): string | null {\n      const res = re.exec(s)\n      return res !== null ? res[0] : null\n    },\n  }\n}\n\nconst template = (strings: TemplateStringsArray, ...keys: any[]) => {\n  return (...values: any[]) => {\n    const dict = values[values.length - 1] || {}\n    const result = [strings[0]]\n    keys.forEach((key, i) => {\n      const isInteger = Number.isInteger\n        ? Number.isInteger(key)\n        : typeof key === 'number' && key !== Infinity && Math.floor(key) === key\n      const value = isInteger ? values[key] : dict[key]\n      result.push(value, strings[i + 1])\n    })\n    return result.join('')\n  }\n}\n\nconst escape = (html: string) => {\n  return String(html)\n    .replace(/&/g, '&amp;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n}\n\nfunction isPromise<T>(data: T | Promise<T> | undefined): data is Promise<T> {\n  return Boolean(data && typeof (data as Promise<T>).then === 'function')\n}\nfunction then<T, R>(\n  result: MaybePromise<T>,\n  callback: (arg: T) => MaybePromise<R>\n): MaybePromise<R>\nfunction then<T, R>(\n  result: MaybePromise<T>,\n  callback: (arg: T) => R\n): MaybePromise<R>\nfunction then<T, R>(\n  result: MaybePromise<T>,\n  callback: (arg: T) => R\n): MaybePromise<R> {\n  return isPromise(result) ? result.then((r) => callback(r)) : callback(result)\n}\n\nfunction getMouseButtons(e: MouseEvent): number {\n  if (isDef(e.buttons)) {\n    return e.buttons\n  }\n  /* for legacy */\n  if (isDef(e.which)) {\n    if (e.which === 3) {\n      // right?\n      return 4\n    }\n    if (e.which === 2) {\n      // middle?\n      return 4\n    }\n    return e.which // left or no\n  }\n\n  if (e.button === 0 || e.button === 1) {\n    return 1 // candidate left\n  }\n  if (e.button === 2) {\n    return 2 // right\n  }\n  return 0 // no or middle?\n}\n\nfunction getKeyCode(e: KeyboardEvent): number {\n  return e.keyCode || e.which\n}\n\nfunction isTouchEvent(e: Event): e is TouchEvent {\n  return !!(e as TouchEvent).changedTouches\n}\n\nfunction getIgnoreCase(obj: any, name: string): any {\n  if (obj[name]) {\n    return obj[name]\n  }\n  const l = name.toLowerCase()\n  if (obj[l]) {\n    return obj[l]\n  }\n  const u = name.toLowerCase()\n  if (obj[u]) {\n    return obj[u]\n  }\n  for (const k in obj) {\n    if (k.toLowerCase() === l) {\n      return obj[k]\n    }\n  }\n  return undefined\n}\n\nfunction cancel(e: Event): void {\n  e.preventDefault()\n  e.stopPropagation()\n  e.stopImmediatePropagation()\n}\n\nfunction toBoxArray<T>(obj: T | T[]): [T, T, T, T] {\n  if (!Array.isArray(obj)) {\n    return [obj /*top*/, obj /*right*/, obj /*bottom*/, obj /*left*/]\n  }\n  if (obj.length === 3) {\n    return [\n      obj[0] /*top*/,\n      obj[1] /*right*/,\n      obj[2] /*bottom*/,\n      obj[1] /*left*/,\n    ]\n  }\n  if (obj.length === 2) {\n    return [\n      obj[0] /*top*/,\n      obj[1] /*right*/,\n      obj[0] /*bottom*/,\n      obj[1] /*left*/,\n    ]\n  }\n  if (obj.length === 1) {\n    return [\n      obj[0] /*top*/,\n      obj[0] /*right*/,\n      obj[0] /*bottom*/,\n      obj[0] /*left*/,\n    ]\n  }\n  return obj as [T, T, T, T]\n}\n\nexport {\n  isNode,\n  isDef,\n  isDefString,\n  extend,\n  isDescendantElement,\n  getChainSafe,\n  applyChainSafe,\n  getOrApply,\n  getIgnoreCase,\n  isPromise,\n  then,\n  array,\n}\n\nexport function cellEquals(a: CellAddress, b: CellAddress): boolean {\n  return a.col === b.col && a.row === b.row\n}\n\nexport function cellInRange(\n  range: CellRange,\n  col: number,\n  row: number\n): boolean {\n  return (\n    range.start.col <= col &&\n    col <= range.end.col &&\n    range.start.row <= row &&\n    row <= range.end.row\n  )\n}\n\nexport function cellMerge(a: CellRange, b: CellRange): CellRange {\n  const startCol = Math.min(a.start.col, a.end.col, b.start.col, b.end.col)\n  const startRow = Math.min(a.start.row, a.end.row, b.start.row, b.end.row)\n  const endCol = Math.max(a.start.col, a.end.col, b.start.col, b.end.col)\n  const endRow = Math.max(a.start.row, a.end.row, b.start.row, b.end.row)\n  return {\n    start: {\n      col: startCol,\n      row: startRow,\n    },\n    end: {\n      col: endCol,\n      row: endRow,\n    },\n  }\n}\n\nexport const browser = {\n  IE,\n  Edge,\n  Chrome,\n  Firefox,\n  Safari,\n  // Chrome 33554431\n  // FireFox 17895588\n  // IE 10737433\n  heightLimit: Chrome ? 33554431 : Firefox ? 17895588 : 10737433, // default IE limit\n}\n\nexport const obj = {\n  setReadonly,\n  isObject,\n}\nexport const str = {\n  endsWith,\n  genChars,\n  genWords,\n  escape,\n  template,\n}\nexport const event = {\n  getMouseButtons,\n  getKeyCode,\n  isTouchEvent,\n  cancel,\n}\nexport const style = {\n  toBoxArray,\n}\nexport const emptyFn = () => {}\n","import { ListGridAPI } from '../../ts-types'\nimport { isPromise } from '../../internal/utils'\n\nexport function toggleValue(val: number): number\nexport function toggleValue(val: string): string\nexport function toggleValue(val: unknown): boolean\nexport function toggleValue(\n  val: number | string | unknown\n): number | string | boolean {\n  if (typeof val === 'number') {\n    if (val === 0) {\n      return 1\n    } else {\n      return 0\n    }\n  } else if (typeof val === 'string') {\n    if (val === 'false') {\n      return 'true'\n    } else if (val === 'off') {\n      return 'on'\n    } else if (/^0+$/.exec(val)) {\n      return val.replace(/^(0*)0$/, '$11')\n    } else if (val === 'true') {\n      return 'false'\n    } else if (val === 'on') {\n      return 'off'\n    } else if (/^0*1$/.exec(val)) {\n      return val.replace(/^(0*)1$/, '$10')\n    }\n  }\n  return !val\n}\n\nconst getBooleanOptionOfRecord = <T>(\n  option: boolean | ((record?: T) => boolean),\n  grid: ListGridAPI<T>,\n  row: number\n) => {\n  if (typeof option === 'function') {\n    const record = grid.getRowRecord(row)\n    if (isPromise(record)) {\n      return true\n    }\n    return !!option(record)\n  }\n  return !!option\n}\n\nexport const isDisabledRecord = <T>(\n  option: boolean | ((record: T) => boolean),\n  grid: ListGridAPI<T>,\n  row: number\n) => {\n  return (\n    getBooleanOptionOfRecord(grid.disabled, grid, row) ||\n    getBooleanOptionOfRecord(option, grid, row)\n  )\n}\n\nexport const isReadOnlyRecord = <T>(\n  option: boolean | ((record: T) => boolean),\n  grid: ListGridAPI<T>,\n  row: number\n) => {\n  return (\n    getBooleanOptionOfRecord(grid.readOnly, grid, row) ||\n    getBooleanOptionOfRecord(option, grid, row)\n  )\n}\n","export interface DrawGridEvents {\n  /**\n   * Indicates when the cell was clicked.\n   */\n  CLICK_CELL: 'click_cell'\n  /**\n   * Indicates when the cell was double-clicked.\n   */\n  DBLCLICK_CELL: 'dblclick_cell'\n  /**\n   * Indicates when the cell was double-taped.\n   */\n  DBLTAP_CELL: 'dbltap_cell'\n  /**\n   * Indicates when pointing device button is pressed in a cell.\n   */\n  MOUSEDOWN_CELL: 'mousedown_cell'\n  /**\n   * Indicates when pointing device button is released in a cell.\n   */\n  MOUSEUP_CELL: 'mouseup_cell'\n  /**\n   * Indicates the cell selection state has changed.\n   */\n  SELECTED_CELL: 'selected_cell'\n  MOUSE_SELECTED_START: 'mouse_selected_start'\n  MOUSE_SELECTED_END: 'mouse_selected_end'\n  /**\n   * Indicates key-downed.\n   */\n  KEYDOWN: 'keydown'\n  MOUSEMOVE_CELL: 'mousemove_cell'\n  MOUSEENTER_CELL: 'mouseenter_cell'\n  MOUSELEAVE_CELL: 'mouseleave_cell'\n  MOUSEOVER_CELL: 'mouseover_cell'\n  MOUSEOUT_CELL: 'mouseout_cell'\n  /**\n   * Indicates when the user attempts to open a context menu in the cell.\n   */\n  CONTEXTMENU_CELL: 'contextmenu_cell'\n  INPUT_CELL: 'input_cell'\n  PASTE_CELL: 'paste_cell'\n  DELETE_CELL: 'delete_cell'\n  EDITABLEINPUT_CELL: 'editableinput_cell'\n  MODIFY_STATUS_EDITABLEINPUT_CELL: 'modify_status_editableinput_cell'\n  /**\n   * Indicates when the column width has changed.\n   */\n  RESIZE_COLUMN: 'resize_column'\n  /**\n   * Indicates when scrolled.\n   */\n  SCROLL: 'scroll'\n  FOCUS_GRID: 'focus_grid'\n  BLUR_GRID: 'blur_grid'\n\n  CAN_DRAG_SELECTION: 'can_drag_selection'\n  DRAG_SELECTION: 'drag_selection'\n  CLICK_UNDERLAY: 'click_underlay'\n  DBLCLICK_UNDERLAY: 'dblclick_underlay'\n  DBLTAP_UNDERLAY: 'dbltap_underlay'\n  COPY: 'copydata'\n  CUT: 'cutdata'\n  PASTE: 'pastedata'\n}\n\nexport const DG_EVENT_TYPE: DrawGridEvents = {\n  CLICK_CELL: 'click_cell',\n  DBLCLICK_CELL: 'dblclick_cell',\n  DBLTAP_CELL: 'dbltap_cell',\n  MOUSEDOWN_CELL: 'mousedown_cell',\n  MOUSEUP_CELL: 'mouseup_cell',\n  SELECTED_CELL: 'selected_cell',\n  MOUSE_SELECTED_START: 'mouse_selected_start',\n  MOUSE_SELECTED_END: 'mouse_selected_end',\n  KEYDOWN: 'keydown',\n  MOUSEMOVE_CELL: 'mousemove_cell',\n  MOUSEENTER_CELL: 'mouseenter_cell',\n  MOUSELEAVE_CELL: 'mouseleave_cell',\n  MOUSEOVER_CELL: 'mouseover_cell',\n  MOUSEOUT_CELL: 'mouseout_cell',\n  CONTEXTMENU_CELL: 'contextmenu_cell',\n  INPUT_CELL: 'input_cell',\n  PASTE_CELL: 'paste_cell',\n  DELETE_CELL: 'delete_cell',\n  EDITABLEINPUT_CELL: 'editableinput_cell',\n  MODIFY_STATUS_EDITABLEINPUT_CELL: 'modify_status_editableinput_cell',\n  RESIZE_COLUMN: 'resize_column',\n  SCROLL: 'scroll',\n  FOCUS_GRID: 'focus_grid',\n  BLUR_GRID: 'blur_grid',\n\n  CAN_DRAG_SELECTION: 'can_drag_selection',\n  DRAG_SELECTION: 'drag_selection',\n  CLICK_UNDERLAY: 'click_underlay',\n  DBLCLICK_UNDERLAY: 'dblclick_underlay',\n  DBLTAP_UNDERLAY: 'dbltap_underlay',\n  COPY: 'copydata',\n  CUT: 'cutdata',\n  PASTE: 'pastedata',\n}\n","export const KEY_BS = 8\nexport const KEY_TAB = 9\nexport const KEY_ENTER = 13\nexport const KEY_ESC = 27\nexport const KEY_SPACE = 32\nexport const KEY_END = 35\nexport const KEY_HOME = 36\nexport const KEY_LEFT = 37\nexport const KEY_UP = 38\nexport const KEY_RIGHT = 39\nexport const KEY_DOWN = 40\nexport const KEY_DEL = 46\nexport const KEY_ALPHA_A = 65\nexport const KEY_ALPHA_C = 67\nexport const KEY_ALPHA_V = 86\nexport const KEY_F2 = 113\n","// import utils from \"./utils\";\n\n// type SymbolType = (description?: string | number) => symbol;\n\n// const Symbol: SymbolType = utils.isNode\n//   ? (global.Symbol as SymbolType)\n//   : (window.Symbol as SymbolType)\n//   ? (window.Symbol as SymbolType)\n//   : ((): SymbolType => {\n//       function random(): string {\n//         const c = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n//         const cl = c.length;\n//         let r = \"\";\n//         for (let i = 0; i < 10; i++) {\n//           r += c[Math.floor(Math.random() * cl)];\n//         }\n//         return r;\n//       }\n//       return (name?: string | number): symbol => {\n//         if (name) {\n//           return `#${name}_${random()}` as any;\n//         } else {\n//           return `#_${random()}` as any;\n//         }\n//       };\n//     })();\n// const mem: { [key: string]: symbol } = {};\n\nfunction get(name?: string): '$$$$private symbol$$$$' {\n  // if (name) {\n  //   return (mem[name] ? mem[name] : (mem[name] = Symbol(name))) as any;\n  // } else {\n  //   return Symbol() as any;\n  // }\n  return (name || '_') as any\n}\n\nexport function getEventTargetSymbol(): '$$$$event_target_symbol$$$$' {\n  return get('protected.event_target') as any\n}\nexport function getThemeSymbol(): '$$$$theme_symbol$$$$' {\n  return get('protected.theme') as any\n}\nexport function getDrawGridSymbol(): '$$$$draw_grid_symbol$$$$' {\n  return get('protected.draw_grid') as any\n}\nexport function getListGridSymbol(): '$$$$list_grid_symbol$$$$' {\n  return get('protected.list_grid') as any\n}\nexport function getCheckColumnStateId(): '$$$$chkcol.stateID symbol$$$$' {\n  return get('chkcol.stateID') as any\n}\nexport function getRadioColumnStateId(): '$$$$rdcol.stateID symbol$$$$' {\n  return get('rdcol.stateID') as any\n}\nexport function getSwitchColumnStateId(): '$$$$swtcol.stateID symbol$$$$' {\n  return get('swtcol.stateID') as any\n}\nexport function getButtonColumnStateId(): '$$$$btncol.stateID symbol$$$$' {\n  return get('btncol.stateID') as any\n}\nexport function getColumnActionStateId(): '$$$$col.action_stateID symbol$$$$' {\n  return get('col.action.stateID') as any\n}\nexport function getColumnFadeinStateId(): '$$$$col.fadein_stateID symbol$$$$' {\n  return get('col.fadein_stateID') as any\n}\nexport function getInlineEditingStateId(): '$$$$col.inline_editing_stateID symbol$$$$' {\n  return get('col.inline_editing_stateID') as any\n}\nexport function getBranchGraphColumnStateId(): '$$$$branch_graph_col.stateID symbol$$$$' {\n  return get('branch_graph_col.stateID') as any\n}\nexport function getSmallDialogInputEditorStateId(): '$$$$small_dialog_input_editor.stateID symbol$$$$' {\n  return get('small_dialog_input_editor.stateID') as any\n}\nexport function getInlineInputEditorStateId(): '$$$$inline_input_editor.stateID symbol$$$$' {\n  return get('inline_input_editor.stateID') as any\n}\nexport function getInlineTextareaEditorStateId(): '$$$$inline_textarea_editor.stateID symbol$$$$' {\n  return get('inline_textarea_editor.stateID') as any\n}\nexport function getInlineLookupEditorStateId(): '$$$$inline_lookup_editor.stateID symbol$$$$' {\n  return get('inline_lookup_editor.stateID') as any\n}\nexport function getInlineMenuEditorStateId(): '$$$$inline_menu_editor.stateID symbol$$$$' {\n  return get('inline_menu_editor.stateID') as any\n}\nexport function getCheckHeaderStateId(): '$$$$check_header.stateID symbol$$$$' {\n  return get('check_header.stateID') as any\n}\nexport function getSwitchHeaderStateId(): '$$$$switch_header.stateID symbol$$$$' {\n  return get('switch_header.stateID') as any\n}\n","import {\n  ListGridAPI,\n  CellAddress,\n  LayoutObjectId,\n  EventListenerId,\n} from '../../ts-types'\nimport { event, isPromise, obj } from '../../internal/utils'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { KEY_ENTER, KEY_SPACE } from '../../core/draw-grid/KEY_CODE'\nimport { getColumnActionStateId } from '../../internal/symbolManager'\n\nconst COLUMN_ACTION_STATE_ID = getColumnActionStateId()\n\nexport function bindCellClickAction<T>(\n  grid: ListGridAPI<T>,\n  cellId: LayoutObjectId,\n  {\n    action,\n    mouseOver,\n    mouseMove,\n    mouseOut,\n  }: {\n    action: (cell: CellAddress) => void\n    mouseOver: (cell: CellAddress, event: any) => boolean\n    mouseMove?: (cell: CellAddress, event: any) => boolean\n    mouseOut: (cell: CellAddress) => void\n  }\n): EventListenerId[] {\n  function isTarget(col: number, row: number): boolean {\n    return grid.getLayoutCellId(col, row) === cellId\n  }\n\n  if (!(grid as any)[COLUMN_ACTION_STATE_ID]) {\n    obj.setReadonly(grid as any, COLUMN_ACTION_STATE_ID, {})\n  }\n\n  const actionState = (grid as any)[COLUMN_ACTION_STATE_ID]\n\n  return [\n    // click\n    grid.listen(DG_EVENT_TYPE.CLICK_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (isPromise(grid.getRowRecord(e.row))) {\n        return\n      }\n      action({\n        col: e.col,\n        row: e.row,\n      })\n    }),\n    // mouse move\n    grid.listen(DG_EVENT_TYPE.MOUSEMOVE_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (isPromise(grid.getRowRecord(e.row))) {\n        return\n      }\n      if (mouseMove) {\n        if (\n          !mouseMove(\n            {\n              col: e.col,\n              row: e.row,\n            },\n            e.event\n          )\n        ) {\n          grid.getElement().style.cursor = ''\n          actionState.mouseActive = false\n          return\n        }\n      }\n      grid.getElement().style.cursor = 'pointer'\n      actionState.mouseActive = true\n    }),\n    grid.listen(DG_EVENT_TYPE.MOUSEOVER_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (isPromise(grid.getRowRecord(e.row))) {\n        return\n      }\n      if (mouseOver) {\n        if (\n          !mouseOver(\n            {\n              col: e.col,\n              row: e.row,\n            },\n            e.event\n          )\n        ) {\n          grid.getElement().style.cursor = ''\n          actionState.mouseActive = false\n          return\n        }\n      }\n      grid.getElement().style.cursor = 'pointer'\n      actionState.mouseActive = true\n    }),\n    grid.listen(DG_EVENT_TYPE.MOUSEOUT_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (mouseOut) {\n        mouseOut({\n          col: e.col,\n          row: e.row,\n        })\n      }\n      grid.getElement().style.cursor = ''\n      actionState.mouseActive = false\n    }),\n  ]\n}\nexport function bindCellKeyAction<T>(\n  grid: ListGridAPI<T>,\n  cellId: LayoutObjectId,\n  {\n    action,\n    acceptKeys = [],\n  }: {\n    action: (option: CellAddress) => void\n    acceptKeys?: number[]\n  }\n) {\n  function isTarget(col: number, row: number): boolean {\n    return grid.getLayoutCellId(col, row) === cellId\n  }\n  acceptKeys = [...acceptKeys, KEY_ENTER, KEY_SPACE]\n  return [\n    // enter key down\n    grid.listen(DG_EVENT_TYPE.KEYDOWN, (e) => {\n      if (acceptKeys.indexOf(e.keyCode) === -1) {\n        return\n      }\n      if (grid.keyboardOptions?.moveCellOnEnter && e.keyCode === KEY_ENTER) {\n        // When moving with the enter key, no action is taken with the enter key.\n        return\n      }\n      const sel = grid.selection.select\n      if (!isTarget(sel.col, sel.row)) {\n        return\n      }\n      if (isPromise(grid.getRowRecord(sel.row))) {\n        return\n      }\n      action({\n        col: sel.col,\n        row: sel.row,\n      })\n      event.cancel(e.event)\n    }),\n  ]\n}\n","import {\n  BaseActionOption,\n  ListGridAPI,\n  EventListenerId,\n  LayoutObjectId,\n  CellAddress,\n} from '../../ts-types'\n\nexport abstract class BaseAction<T> {\n  protected _disabled: boolean | ((record: T) => boolean)\n  public constructor(options: BaseActionOption<T> = {}) {\n    this._disabled = options.disabled || false\n  }\n  public get disabled(): boolean | ((record: T) => boolean) {\n    return this._disabled\n  }\n  public set disabled(disabled) {\n    if (this._disabled !== disabled) {\n      this._disabled = disabled\n      this.onChangeDisabledInternal()\n    }\n  }\n  public abstract get editable(): boolean\n  public abstract clone(): BaseAction<T>\n  public abstract bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[]\n\n  public abstract onPasteCellRangeBox(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    value: string\n  ): void\n  public abstract onDeleteCellRangeBox(\n    grid: ListGridAPI<T>,\n    cell: CellAddress\n  ): void\n  protected onChangeDisabledInternal(): void {\n    // nothing\n  }\n}\n","import {\n  ActionListener,\n  ActionOption,\n  ListGridAPI,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { emptyFn, isDef } from '../../internal/utils'\nimport { isDisabledRecord } from './action-utils'\nimport { bindCellClickAction, bindCellKeyAction } from './actionBind'\nimport { BaseAction } from './BaseAction'\n\nexport class Action<T> extends BaseAction<T> {\n  private _action: ActionListener<T>\n  public constructor(options: ActionOption<T> = {}) {\n    super(options)\n    this._action = options.action || emptyFn\n  }\n  get editable(): boolean {\n    return false\n  }\n  public get action() {\n    return this._action\n  }\n  public set action(action) {\n    this._action = action\n  }\n  public clone(): Action<T> {\n    return new Action(this)\n  }\n  public getState(_grid: any): any {\n    return {}\n  }\n  public bindGridEvent(grid: ListGridAPI<T>, cellId: LayoutObjectId): any[] {\n    const state = this.getState(grid)\n    const action = (cell: CellAddress) => {\n      if (isDisabledRecord(this.disabled, grid, cell.row)) {\n        return\n      }\n      const record = grid.getRowRecord(cell.row)\n      this._action.apply(this, [\n        record,\n        {\n          cell,\n          grid,\n        },\n      ])\n    }\n    const actionMouse = (cell: CellAddress) => {\n      if (state.mouseActive) {\n        action(cell)\n      }\n    }\n    const mouseOut = (cell: CellAddress) => {\n      delete state.mouseRelativePos\n      delete state.mouseActiveCell\n      delete state.mouseActive\n      const range = grid.getCellRange(cell.col, cell.row)\n      grid.invalidateCellRange(range)\n    }\n    const mouseMove = (cell: CellAddress, event: any) => {\n      if (isDisabledRecord(this.disabled, grid, cell.row)) {\n        return false\n      }\n      state.mouseRelativePos = grid._getMouseRelativePoint(event)\n      state.mouseActiveCell = {\n        col: cell.col,\n        row: cell.row,\n      }\n      const range = grid.getCellRange(cell.col, cell.row)\n      grid.invalidateCellRange(range)\n      return isDef(state.mouseActive) ? state.mouseActive : true\n    }\n\n    return [\n      ...bindCellClickAction(grid, cellId, {\n        action: actionMouse,\n        mouseMove,\n        mouseOut,\n        mouseOver: mouseMove,\n      }),\n      ...bindCellKeyAction(grid, cellId, {\n        action,\n      }),\n    ]\n  }\n  public onPasteCellRangeBox(): void {\n    // noop\n  }\n  public onDeleteCellRangeBox(): void {\n    // noop\n  }\n}\n","import { BaseAction } from './BaseAction'\nimport { EditorOption } from '../../ts-types'\n\nexport abstract class Editor<T> extends BaseAction<T> {\n  protected _readOnly: boolean | ((record: T) => boolean)\n  public constructor(options: EditorOption<T> = {}) {\n    super(options)\n    this._readOnly = options.readOnly || (options as any).readonly || false\n  }\n  public get editable(): boolean {\n    return true\n  }\n  public get readOnly() {\n    return this._readOnly\n  }\n  public set readOnly(readOnly) {\n    if (this._readOnly !== readOnly) {\n      this._readOnly = readOnly\n      this.onChangeReadOnlyInternal()\n    }\n  }\n  public get readonly() {\n    window.console.warn(\n      \"'readonly' is deprecated, please use 'readOnly' instead\"\n    )\n    return this.readOnly\n  }\n  public set readonly(readOnly) {\n    window.console.warn(\n      \"'readonly' is deprecated, please use 'readOnly' instead\"\n    )\n    this.readOnly = readOnly\n  }\n  protected onChangeReadOnlyInternal() {\n    // nothing\n  }\n}\n","import {\n  EditorOption,\n  ListGridAPI,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { KEY_ENTER, KEY_F2 } from '../../core/draw-grid/KEY_CODE'\nimport { event, cellEquals } from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord } from './action-utils'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { Editor } from './Editor'\n\nimport Rect from '../../internal/Rect'\n\nfunction _inAttachCellArea<T>(\n  grid: ListGridAPI<T>,\n  col: number,\n  row: number,\n  event: TouchEvent | MouseEvent\n) {\n  let bool = false\n  const relativePos = grid._getMouseRelativePoint(event)\n  const rect = grid.getAttachCellsArea(grid.getCellRange(col, row)).rect\n  if (relativePos) {\n    if ((rect as Rect).inPoint(relativePos.x, relativePos.y)) {\n      bool = true\n    }\n  }\n  return bool\n}\n\nexport abstract class BaseInputEditor<T> extends Editor<T> {\n  public constructor(options: EditorOption<T> = {}) {\n    super(options)\n  }\n  public open(grid: ListGridAPI<T>, cell: CellAddress): boolean {\n    const allowOpen =\n      !isReadOnlyRecord(this.readOnly, grid, cell.row) &&\n      !isDisabledRecord(this.disabled, grid, cell.row)\n    if (allowOpen) {\n      this.onOpenCellInternal(grid, cell)\n    }\n    return allowOpen\n  }\n  public abstract clone(): BaseInputEditor<T>\n  abstract onInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ): void\n  abstract onOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress): void\n  abstract onChangeSelectCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    selected: boolean\n  ): void\n  abstract onSetInputAttrsInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    input: HTMLInputElement\n  ): void\n  abstract onGridScrollInternal(grid: ListGridAPI<T>): void\n  public onBeforeKeydownInternal(\n    _grid: ListGridAPI<T>,\n    _keyCode: number,\n    _e: KeyboardEvent,\n    _cellId: LayoutObjectId\n  ) {\n    return true\n  }\n  public bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const open = (cell: CellAddress): boolean => {\n      return this.open(grid, cell)\n    }\n\n    const input = (cell: CellAddress, value: any) => {\n      if (\n        isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n        isDisabledRecord(this.disabled, grid, cell.row)\n      ) {\n        return\n      }\n      this.onInputCellInternal(grid, cell, value)\n    }\n\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    return [\n      grid.listen(DG_EVENT_TYPE.INPUT_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        input(\n          {\n            col: e.col,\n            row: e.row,\n          },\n          e.value\n        )\n      }),\n      grid.listen(DG_EVENT_TYPE.PASTE_CELL, (e) => {\n        if (e.multi) {\n          // ignore multi cell values\n          return\n        }\n        const selectionRange = grid.selection.range\n        if (!cellEquals(selectionRange.start, selectionRange.end)) {\n          // ignore multi paste values\n          return\n        }\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        event.cancel(e.event)\n        input(\n          {\n            col: e.col,\n            row: e.row,\n          },\n          e.normalizeValue\n        )\n      }),\n      grid.listen(DG_EVENT_TYPE.DBLCLICK_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (!_inAttachCellArea(grid, e.col, e.row, e.event)) {\n          return\n        }\n        open({\n          col: e.col,\n          row: e.row,\n        })\n        event.cancel(e.event)\n      }),\n      grid.listen(DG_EVENT_TYPE.DBLTAP_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (!_inAttachCellArea(grid, e.col, e.row, e.event)) {\n          return\n        }\n        open({\n          col: e.col,\n          row: e.row,\n        })\n        event.cancel(e.event)\n      }),\n      grid.listen(DG_EVENT_TYPE.KEYDOWN, (e) => {\n        if (\n          (e.keyCode !== KEY_F2 && e.keyCode !== KEY_ENTER) ||\n          (e.keyCode === KEY_ENTER && e.event.shiftKey)\n        ) {\n          return\n        }\n        const sel = grid.selection.select\n        if (!isTarget(sel.col, sel.row)) {\n          return\n        }\n        if (\n          this.onBeforeKeydownInternal(grid, e.keyCode, e.event, cellId) ===\n          false\n        ) {\n          return false\n        }\n        if (e.event.ctrlKey || e.event.metaKey) {\n          return\n        }\n        if (\n          open({\n            col: sel.col,\n            row: sel.row,\n          })\n        ) {\n          event.cancel(e.event)\n          e.stopCellMoving()\n        }\n      }),\n      grid.listen(DG_EVENT_TYPE.SELECTED_CELL, (e) => {\n        this.onChangeSelectCellInternal(\n          grid,\n          { col: e.col, row: e.row },\n          e.selected\n        )\n      }),\n      grid.listen(DG_EVENT_TYPE.SCROLL, () => {\n        this.onGridScrollInternal(grid)\n      }),\n      grid.listen(DG_EVENT_TYPE.EDITABLEINPUT_CELL, (cell) => {\n        if (!isTarget(cell.col, cell.row)) {\n          return false\n        }\n        if (\n          isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n          isDisabledRecord(this.disabled, grid, cell.row)\n        ) {\n          return false\n        }\n        return true\n      }),\n      grid.listen(DG_EVENT_TYPE.MODIFY_STATUS_EDITABLEINPUT_CELL, (cell) => {\n        if (!isTarget(cell.col, cell.row)) {\n          return\n        }\n        if (\n          isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n          isDisabledRecord(this.disabled, grid, cell.row)\n        ) {\n          return\n        }\n        const range = grid.getCellRange(cell.col, cell.row)\n        if (\n          range.start.col !== range.end.col ||\n          range.start.row !== range.end.row\n        ) {\n          const { input } = cell\n          const baseRect = grid.getCellRect(cell.col, cell.row)\n          const rangeRect = grid.getCellRangeRect(range)\n          input.style.top = `${(\n            parseFloat(input.style.top) +\n            (rangeRect.top - baseRect.top)\n          ).toFixed()}px`\n          input.style.left = `${(\n            parseFloat(input.style.left) +\n            (rangeRect.left - baseRect.left)\n          ).toFixed()}px`\n          input.style.width = `${rangeRect.width.toFixed()}px`\n          input.style.height = `${rangeRect.height.toFixed()}px`\n        }\n        this.onSetInputAttrsInternal(\n          grid,\n          {\n            col: cell.col,\n            row: cell.row,\n          },\n          cell.input\n        )\n      }),\n    ]\n  }\n  public onPasteCellRangeBox(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    value: string\n  ): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    grid.doChangeValue(cell.col, cell.row, () => value)\n  }\n  public onDeleteCellRangeBox(grid: ListGridAPI<T>, cell: CellAddress): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    grid.doChangeValue(cell.col, cell.row, () => '')\n  }\n}\n","import { KEY_ENTER } from '../../core/draw-grid/KEY_CODE'\nimport { event, isDef } from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord } from './action-utils'\nimport { bindCellClickAction } from './actionBind'\nimport { BaseInputEditor } from './BaseInputEditor'\nimport {\n  ActionListener,\n  BaseActionInputOption,\n  ListGridAPI,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\n\nexport abstract class BaseActionInput<T> extends BaseInputEditor<T> {\n  private _disableInput: boolean | ActionListener<T>\n  private _disableAction: boolean | ActionListener<T>\n  private _action?: ActionListener<T>\n  public constructor(options: BaseActionInputOption<T> = {}) {\n    super(options)\n    this._disableInput = options.disableInput || false\n    this._disableAction = options.disableAction || false\n    this._action = options.action\n  }\n  public get disableInput() {\n    return this._disableInput\n  }\n  public set disableInput(disableInput) {\n    this._disableInput = disableInput\n  }\n  public get disableAction() {\n    return this._disableAction\n  }\n  public set disableAction(disableAction) {\n    this._disableAction = disableAction\n  }\n  public get action() {\n    return this._action\n  }\n  public set action(action) {\n    this._action = action\n  }\n  public onBeforeKeydownInternal(\n    grid: ListGridAPI<T>,\n    keyCode: number,\n    e: KeyboardEvent,\n    cellId: LayoutObjectId\n  ) {\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    const sel = grid.selection.select\n    if (\n      isReadOnlyRecord(this.readOnly, grid, sel.row) ||\n      isDisabledRecord(this.disabled, grid, sel.row) ||\n      !isTarget(sel.col, sel.row) ||\n      !this._action ||\n      this.isDisabledAction(grid, sel)\n    ) {\n      return true\n    }\n    if (\n      (this.isDisabledInput(grid, sel) &&\n        keyCode === KEY_ENTER &&\n        !e.ctrlKey &&\n        !e.metaKey) ||\n      (keyCode === KEY_ENTER && (e.ctrlKey || e.metaKey))\n    ) {\n      const record = grid.getRowRecord(sel.row)\n      if (this._action) {\n        this._action.apply(this, [\n          record,\n          {\n            cell: {\n              col: sel.col,\n              row: sel.row,\n            },\n            grid,\n          },\n        ])\n        event.cancel(e)\n        return false\n      }\n    }\n    return true\n  }\n  public bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const state = this.getState(grid)\n    const action = (cell: CellAddress) => {\n      if (\n        isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n        isDisabledRecord(this.disabled, grid, cell.row) ||\n        !this._action ||\n        this.isDisabledAction(grid, cell)\n      ) {\n        return\n      }\n      if (state.mouseActive) {\n        const record = grid.getRowRecord(cell.row)\n        if (this._action) {\n          this._action.apply(this, [\n            record,\n            {\n              cell,\n              grid,\n            },\n          ])\n        }\n      }\n    }\n    const mouseOut = (cell: CellAddress) => {\n      delete state.mouseRelativePos\n      delete state.mouseActiveCell\n      delete state.mouseActive\n      const range = grid.getCellRange(cell.col, cell.row)\n      grid.invalidateCellRange(range)\n    }\n    const mouseMove = (cell: CellAddress, event: any) => {\n      if (\n        isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n        isDisabledRecord(this.disabled, grid, cell.row) ||\n        !this._action ||\n        this.isDisabledAction(grid, cell)\n      ) {\n        return false\n      }\n      state.mouseRelativePos = grid._getMouseRelativePoint(event)\n      state.mouseActiveCell = {\n        col: cell.col,\n        row: cell.row,\n      }\n      const range = grid.getCellRange(cell.col, cell.row)\n      grid.invalidateCellRange(range)\n      return isDef(state.mouseActive) ? state.mouseActive : true\n    }\n    let ids = super.bindGridEvent(grid, cellId)\n    ids = ids.concat(\n      bindCellClickAction(grid, cellId, {\n        action,\n        mouseMove,\n        mouseOut,\n        mouseOver: mouseMove,\n      })\n    )\n    return ids\n  }\n  public onInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ) {\n    if (this.isDisabledInput(grid, cell)) {\n      return\n    }\n    this.onActionInputCellInternal(grid, cell, inputValue)\n  }\n  public onOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress) {\n    if (this.isDisabledInput(grid, cell)) {\n      return\n    }\n    this.onActionOpenCellInternal(grid, cell)\n  }\n  public onActionInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ) {\n    throw new Error()\n  }\n  public onActionOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress) {\n    throw new Error()\n  }\n  protected abstract getState(grid: any): any\n  private isDisabledInput(grid: ListGridAPI<T>, cell: CellAddress) {\n    return this.isDisabled(this._disableInput, grid, cell)\n  }\n  private isDisabledAction(grid: ListGridAPI<T>, cell: CellAddress) {\n    return this.isDisabled(this._disableAction, grid, cell)\n  }\n  private isDisabled(\n    p: boolean | ActionListener<T>,\n    grid: ListGridAPI<T>,\n    cell: CellAddress\n  ) {\n    let isDisabled = false\n    if (p) {\n      if (typeof p === 'function') {\n        const record = grid.getRowRecord(cell.row)\n        if (\n          p.apply(this, [\n            record,\n            {\n              cell,\n              grid,\n            },\n          ])\n        ) {\n          isDisabled = true\n        }\n      } else {\n        isDisabled = true\n      }\n    }\n    return isDisabled\n  }\n}\n","import { isNode } from './utils'\n\nfunction cubicBezier(\n  x2: number,\n  y2: number,\n  x3: number,\n  y3: number\n): EasingFunction {\n  let step: number\n  const err = 0.0001\n\n  x2 *= 3\n  y2 *= 3\n  x3 *= 3\n  y3 *= 3\n\n  return function (t: number): number {\n    let p, a, b, c, d, x, s\n    if (t < 0 || 1 < t) {\n      throw new Error(`${t}`)\n    }\n\n    p = step || t\n\n    do {\n      a = 1 - p\n      b = a * a\n      c = p * p\n      d = c * p\n\n      x = x2 * b * p + x3 * a * c + d\n      s = t - x\n      p += s * 0.5\n    } while (err < Math.abs(s))\n\n    step = p\n    return y2 * b * p + y3 * a * c + d\n  }\n}\n\nconst EASINGS = {\n  linear(p: number): number {\n    return p\n  },\n  easeIn: cubicBezier(0.42, 0.0, 1.0, 1.0),\n  easeOut: cubicBezier(0.0, 0.0, 0.58, 1.0),\n  easeInOut: cubicBezier(0.42, 0.0, 0.58, 1.0),\n}\n\nconst raf: typeof requestAnimationFrame = (isNode\n  ? (): void => {}\n  : window.requestAnimationFrame ||\n    ((fn: () => void): any =>\n      setTimeout(fn, 1))) as typeof requestAnimationFrame\n\nfunction now(): number {\n  return Date.now()\n}\n\nexport type EasingFunction = (t: number) => number\nexport type EasingKind = keyof typeof EASINGS\nexport type StepFunction = (s: number) => void\n/**\n * <pre>\n * Animates.\n * </pre>\n * @param duration - animation time.\n * @param step - step\n * @param easing - easing\n * @returns Deferred object.\n */\nexport function animate(\n  duration: number,\n  step: StepFunction,\n  easing?: EasingKind | EasingFunction\n): {\n  cancel: () => void\n} {\n  const startedAt = now()\n\n  const easingFn: EasingFunction =\n    easing == null\n      ? EASINGS.easeInOut\n      : typeof easing === 'string'\n      ? EASINGS[easing]\n      : easing\n\n  let canceledFlg = false\n  const createAnim = (\n    resolve: (value: any) => void,\n    reject: () => void\n  ): (() => void) => {\n    const anim = (): void => {\n      const point = now() - startedAt\n      if (canceledFlg) {\n        //cancel\n        if (reject) {\n          reject()\n        }\n      } else if (point >= duration) {\n        //end\n        step(1)\n        if (resolve) {\n          resolve(undefined)\n        }\n      } else {\n        step(easingFn(point / duration))\n\n        raf(anim)\n      }\n    }\n    return anim\n  }\n  const cancel = (): void => {\n    canceledFlg = true\n  }\n  if (typeof Promise !== 'undefined') {\n    const result: any = new Promise<unknown>((resolve, reject) => {\n      const anim = createAnim(resolve, reject)\n      step(0)\n      anim()\n    })\n    result.cancel = cancel\n    return result\n  } else {\n    const anim = createAnim(\n      () => {},\n      () => {}\n    )\n    step(0)\n    anim()\n    return {\n      cancel,\n    }\n  }\n}\n","import {\n  EditorOption,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { GridInternal, CheckColumnState } from '../../ts-types-internal'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { KEY_ENTER, KEY_SPACE } from '../../core/draw-grid/KEY_CODE'\nimport { animate } from '../../internal/animate'\nimport { isPromise, event, cellEquals } from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord, toggleValue } from './action-utils'\nimport { bindCellClickAction, bindCellKeyAction } from './actionBind'\nimport { Editor } from './Editor'\n\nexport abstract class BaseCheckEditor<T> extends Editor<T> {\n  public constructor(options: EditorOption<T> = {}) {\n    super(options)\n  }\n  public bindGridEvent(\n    grid: GridInternal<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const state = this.getState(grid)\n\n    const action = (cell: CellAddress) => {\n      const range = grid.getCellRange(cell.col, cell.row)\n      const cellKey = `${range.start.col}:${range.start.row}`\n      if (\n        isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n        isDisabledRecord(this.disabled, grid, cell.row) ||\n        state.block[cellKey]\n      ) {\n        return\n      }\n      const ret = grid.doChangeValue(cell.col, cell.row, toggleValue)\n      if (ret) {\n        const onChange = () => {\n          // checkbox animation\n          animate(200, (point) => {\n            if (point === 1) {\n              delete state.elapsed[cellKey]\n            } else {\n              state.elapsed[cellKey] = point\n            }\n            grid.invalidateCellRange(range)\n          })\n        }\n        if (isPromise(ret)) {\n          state.block[cellKey] = true\n          ret.then(() => {\n            delete state.block[cellKey]\n            onChange()\n          })\n        } else {\n          onChange()\n        }\n      }\n    }\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    return [\n      ...bindCellClickAction(grid, cellId, {\n        action,\n        mouseOver: (e) => {\n          if (isDisabledRecord(this.disabled, grid, e.row)) {\n            return false\n          }\n          state.mouseActiveCell = {\n            col: e.col,\n            row: e.row,\n          }\n          const range = grid.getCellRange(e.col, e.row)\n          grid.invalidateCellRange(range)\n          return true\n        },\n        mouseOut: (e) => {\n          delete state.mouseActiveCell\n          const range = grid.getCellRange(e.col, e.row)\n          grid.invalidateCellRange(range)\n        },\n      }),\n      ...bindCellKeyAction(grid, cellId, {\n        action: (e) => {\n          const selRange = grid.selection.range\n          const col = grid.selection.select.col\n          for (let row = selRange.start.row; row <= selRange.end.row; row++) {\n            if (!isTarget(col, row)) {\n              continue\n            }\n            action({\n              col,\n              row,\n            })\n          }\n        },\n        acceptKeys: [KEY_ENTER, KEY_SPACE],\n      }),\n      // paste value\n      grid.listen(DG_EVENT_TYPE.PASTE_CELL, (e) => {\n        if (e.multi) {\n          // ignore multi cell values\n          return\n        }\n        const selectionRange = grid.selection.range\n        if (!cellEquals(selectionRange.start, selectionRange.end)) {\n          // ignore multi paste values\n          return\n        }\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        const pasteValue = e.normalizeValue.trim()\n        grid.doGetCellValue(e.col, e.row, (value) => {\n          const newValue = toggleValue(value)\n          if (`${newValue}`.trim() === pasteValue) {\n            event.cancel(e.event)\n\n            action({\n              col: e.col,\n              row: e.row,\n            })\n          }\n        })\n      }),\n    ]\n  }\n  public onPasteCellRangeBox(\n    grid: GridInternal<T>,\n    cell: CellAddress,\n    value: string\n  ): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    const pasteValue = value.trim()\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      const newValue = toggleValue(value)\n      if (`${newValue}`.trim() === pasteValue) {\n        grid.doChangeValue(cell.col, cell.row, toggleValue)\n      }\n    })\n  }\n  public onDeleteCellRangeBox(): void {\n    // noop\n  }\n  protected abstract getState(grid: GridInternal<T>): CheckColumnState\n}\n","import { ButtonActionOption } from '../../ts-types'\nimport { obj } from '../../internal/utils'\nimport { Action } from './Action'\nimport { getButtonColumnStateId } from '../../internal/symbolManager'\n\nconst BUTTON_COLUMN_STATE_ID = getButtonColumnStateId()\n\nexport class ButtonAction<T> extends Action<T> {\n  public constructor(options: ButtonActionOption<T> = {}) {\n    super(options)\n  }\n  public getState(grid: any): any {\n    if (!grid[BUTTON_COLUMN_STATE_ID]) {\n      obj.setReadonly(grid, BUTTON_COLUMN_STATE_ID, {})\n    }\n    return grid[BUTTON_COLUMN_STATE_ID]\n  }\n}\n","import { CheckHeaderState, GridInternal } from '../../ts-types-internal'\nimport { obj } from '../../internal/utils'\nimport { BaseCheckEditor } from './BaseCheckEditor'\nimport { getCheckColumnStateId } from '../../internal/symbolManager'\n\nconst CHECK_COLUMN_STATE_ID = getCheckColumnStateId()\n\nexport class CheckEditor<T> extends BaseCheckEditor<T> {\n  public clone(): CheckEditor<T> {\n    return new CheckEditor(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[CHECK_COLUMN_STATE_ID]\n    if (!state) {\n      state = { block: {}, elapsed: {} }\n      obj.setReadonly(grid, CHECK_COLUMN_STATE_ID, state)\n    }\n    return state\n  }\n}\n","import { CheckHeaderState, GridInternal } from '../../ts-types-internal'\nimport { getSwitchColumnStateId } from '../../internal/symbolManager'\nimport { obj } from '../../internal/utils'\nimport { BaseCheckEditor } from './BaseCheckEditor'\n\nconst SWITCH_COLUMN_STATE_ID = getSwitchColumnStateId()\n\nexport class SwitchEditor<T> extends BaseCheckEditor<T> {\n  public clone(): SwitchEditor<T> {\n    return new SwitchEditor(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[SWITCH_COLUMN_STATE_ID]\n    if (!state) {\n      state = { block: {}, elapsed: {} }\n      obj.setReadonly(grid, SWITCH_COLUMN_STATE_ID, state)\n    }\n    return state\n  }\n}\n","import { isDef } from './utils'\n\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tagName: K,\n  {\n    classList,\n    text,\n    html,\n  }: { classList?: string[] | string; text?: string; html?: string } = {}\n): HTMLElementTagNameMap[K] {\n  const element = document.createElement(tagName)\n  if (classList) {\n    if (Array.isArray(classList)) {\n      element.classList.add(...classList)\n    } else {\n      element.classList.add(classList)\n    }\n  }\n  if (text) {\n    element.textContent = text\n  } else if (html) {\n    element.innerHTML = html\n  }\n  return element\n}\n\nexport function empty(dom: HTMLElement): void {\n  let c\n  while ((c = dom.firstChild)) {\n    dom.removeChild(c)\n  }\n}\n\nfunction isNode(arg: HTMLElement | string): arg is HTMLElement {\n  return !!((arg as any).nodeType && (arg as any).nodeName)\n}\n\nfunction toNode(arg: HTMLElement | string): HTMLElement | HTMLElement[] {\n  if (isNode(arg)) {\n    return arg\n  }\n  const dom = createElement('div', { html: arg })\n  return Array.prototype.slice.call(dom.childNodes) as HTMLElement[]\n}\n\nexport function toNodeList(\n  arg: HTMLElement | HTMLElement[] | string\n): HTMLElement[] {\n  if (Array.isArray(arg)) {\n    const result: HTMLElement[] = []\n    arg.forEach((e) => {\n      result.push(...toNodeList(e))\n    })\n    return result\n  }\n  const node = toNode(arg)\n  return Array.isArray(node) ? (node as HTMLElement[]) : [node]\n}\n\nexport function appendHtml(\n  dom: HTMLElement,\n  inner: HTMLElement | HTMLElement[] | string\n): void {\n  toNodeList(inner).forEach((node) => {\n    dom.appendChild(node)\n  })\n}\n\nexport function disableFocus(el: HTMLElement): void {\n  el.dataset.disableBeforeTabIndex = `${el.tabIndex}`\n  el.tabIndex = -1\n  Array.prototype.slice\n    .call(el.children || el.childNodes, 0)\n    .forEach(disableFocus)\n}\n\nexport function enableFocus(el: HTMLElement): void {\n  if ('disableBeforeTabIndex' in el.dataset) {\n    el.tabIndex = Number(el.dataset.disableBeforeTabIndex)\n  }\n  Array.prototype.slice\n    .call(el.children || el.childNodes, 0)\n    .forEach(enableFocus)\n}\n\nexport function isFocusable(el: Node): el is HTMLElement {\n  return (\n    isDef((el as HTMLElement).tabIndex) && (el as HTMLElement).tabIndex > -1\n  )\n}\n\nexport function findPrevSiblingFocusable(el: HTMLElement): HTMLElement | null {\n  let n = el.previousSibling\n  while (n && !isFocusable(n)) {\n    n = n.previousSibling\n  }\n  return n\n}\n\nexport function findNextSiblingFocusable(el: HTMLElement): HTMLElement | null {\n  let n = el.nextSibling\n  while (n && !isFocusable(n)) {\n    n = n.nextSibling\n  }\n  return n\n}\n","import { AnyFunction, EventListenerId } from '../ts-types'\nimport { EventTarget as CustomEventTarget } from '../core/EventTarget'\nimport { each } from './utils'\n\nlet eventHandlerNextId = 1\n\ntype EventHandlerTarget = EventTarget | CustomEventTarget\ntype Listener = AnyFunction\ntype EventListenerObject = {\n  target: EventHandlerTarget\n  type: string\n  listener: Listener\n  options: any[]\n}\n\nexport class EventHandler {\n  private _listeners: {\n    [key: string]: EventListenerObject\n  } = {}\n  public on<TYPE extends keyof GlobalEventHandlersEventMap>(\n    target: EventHandlerTarget,\n    type: TYPE,\n    listener: (event: GlobalEventHandlersEventMap[TYPE]) => any,\n    ...options: any[]\n  ): EventListenerId\n  public on(\n    target: EventHandlerTarget,\n    type: string,\n    listener: Listener,\n    ...options: any[]\n  ): EventListenerId\n  public on(\n    target: EventHandlerTarget,\n    type: string,\n    listener: Listener,\n    ...options: any[]\n  ): EventListenerId {\n    if (target.addEventListener) {\n      target.addEventListener(type, listener, ...(options as []))\n    }\n    const obj = {\n      target,\n      type,\n      listener,\n      options,\n    }\n    const id = eventHandlerNextId++\n    this._listeners[id] = obj\n    return id\n  }\n  public once<TYPE extends keyof GlobalEventHandlersEventMap>(\n    target: EventHandlerTarget,\n    type: TYPE,\n    listener: (event: GlobalEventHandlersEventMap[TYPE]) => any,\n    ...options: any[]\n  ): EventListenerId\n  public once(\n    target: EventHandlerTarget,\n    type: string,\n    listener: Listener,\n    ...options: (boolean | AddEventListenerOptions)[]\n  ): EventListenerId\n  public once(\n    target: EventHandlerTarget,\n    type: string,\n    listener: Listener,\n    ...options: (boolean | AddEventListenerOptions)[]\n  ): EventListenerId {\n    const id = this.on(\n      target,\n      type,\n      (...args) => {\n        this.off(id)\n        listener(...args)\n      },\n      ...options\n    )\n    return id\n  }\n  public tryWithOffEvents(\n    target: EventHandlerTarget,\n    type: string,\n    call: () => void\n  ): void {\n    const list: EventListenerObject[] = []\n    try {\n      each(this._listeners, (obj) => {\n        if (obj.target === target && obj.type === type) {\n          if (obj.target.removeEventListener) {\n            obj.target.removeEventListener(\n              obj.type,\n              obj.listener,\n              ...(obj.options as [])\n            )\n          }\n          list.push(obj)\n        }\n      })\n      call()\n    } finally {\n      list.forEach((obj) => {\n        if (obj.target.addEventListener) {\n          obj.target.addEventListener(\n            obj.type,\n            obj.listener,\n            ...(obj.options as [])\n          )\n        }\n      })\n    }\n  }\n  public off(id: EventListenerId | null | undefined): void {\n    if (id == null) {\n      return\n    }\n    const obj = this._listeners[id]\n    if (!obj) {\n      return\n    }\n    delete this._listeners[id]\n    if (obj.target.removeEventListener) {\n      obj.target.removeEventListener(\n        obj.type,\n        obj.listener,\n        ...(obj.options as [])\n      )\n    }\n  }\n  public fire(target: EventTarget, type: string, ...args: any[]): void {\n    each(this._listeners, (obj) => {\n      if (obj.target === target && obj.type === type) {\n        obj.listener.call(obj.target, ...args)\n      }\n    })\n  }\n  public hasListener(target: EventTarget, type: string): boolean {\n    let result = false\n    each(this._listeners, (obj) => {\n      if (obj.target === target && obj.type === type) {\n        result = true\n      }\n    })\n    return result\n  }\n  public clear(): void {\n    each(this._listeners, (obj) => {\n      if (obj.target.removeEventListener) {\n        obj.target.removeEventListener(\n          obj.type,\n          obj.listener,\n          ...(obj.options as [])\n        )\n      }\n    })\n    this._listeners = {}\n  }\n  public dispose(): void {\n    this.clear()\n  }\n}\n","import styleCss from './style.css'\n\nfunction styleInject(id: string, css: string) {\n  if (css && typeof document !== 'undefined') {\n    let styleElement\n    if (id) {\n      const el = document.getElementById(id)\n      if (el instanceof HTMLStyleElement) {\n        styleElement = el as HTMLStyleElement\n      }\n    }\n    if (!styleElement) {\n      styleElement = document.createElement('style')\n      styleElement.type = 'text/css'\n      styleElement.id = id\n      const headElement =\n        document.head || document.getElementsByTagName('head')[0]\n      headElement.appendChild(styleElement)\n    }\n    if ((styleElement as any).styleSheet) {\n      ;(styleElement as any).styleSheet.cssText = css\n    } else {\n      styleElement.innerHTML = ''\n      styleElement.appendChild(document.createTextNode(css))\n    }\n  }\n}\n\nfunction getScrollBarWidth() {\n  // https://stackoverflow.com/questions/986937/how-can-i-get-the-browsers-scrollbar-sizes\n  const inner = document.createElement('p')\n  inner.style.width = '100%'\n  inner.style.height = '200px'\n\n  const outer = document.createElement('div')\n  outer.style.position = 'absolute'\n  outer.style.top = '0px'\n  outer.style.left = '0px'\n  outer.style.visibility = 'hidden'\n  outer.style.width = '200px'\n  outer.style.height = '150px'\n  outer.style.overflow = 'hidden'\n  outer.appendChild(inner)\n\n  document.body.appendChild(outer)\n  const w1 = inner.offsetWidth\n  outer.style.overflow = 'scroll'\n  let w2 = inner.offsetWidth\n  if (w1 === w2) {\n    w2 = outer.clientWidth\n  }\n\n  document.body.removeChild(outer)\n\n  return w1 - w2\n}\n\nlet SCROLLBAR_SIZE: number = 0\n\nconst isPerfectScrollbar = () => !!(window as any).PerfectScrollbar\n\nconst initDocument = () => {\n  let css = styleCss\n  if (isPerfectScrollbar()) {\n    css += `\n      .kaka-grid .grid-scroll-end-point {\n        width: 1px;\n        height: 1px;\n      }`\n  } else {\n    SCROLLBAR_SIZE = getScrollBarWidth() || 10\n    css += `\n      .kaka-grid .grid-scrollable {\n        overflow: scroll;\n      }\n      .kaka-grid .grid-scroll-end-point {\n        width: ${SCROLLBAR_SIZE}px;\n        height: ${SCROLLBAR_SIZE}px;\n      }\n      .kaka-grid > canvas {\n        width: -webkit-calc(100% - ${SCROLLBAR_SIZE}px);\n        width: calc(100% - ${SCROLLBAR_SIZE}px);\n        height: -webkit-calc(100% - ${SCROLLBAR_SIZE}px);\n        height: calc(100% - ${SCROLLBAR_SIZE}px);\n      }`\n  }\n  styleInject('style', css)\n}\n\nconst style = {\n  initDocument() {\n    style.initDocument = () => {\n      // nothing\n    }\n    initDocument()\n  },\n  getScrollBarSize() {\n    return SCROLLBAR_SIZE\n  },\n  inject: styleInject,\n  isPerfectScrollbar,\n}\n\nexport default style\n","import { EventHandler } from '../../../internal/EventHandler'\n\nexport function setInputValue(input: HTMLInputElement, value: string): void {\n  const sign = input.type === 'number' && value === '-'\n  if (sign) {\n    // When `type=\"number\"`, the minus sign is not accepted, so change it to `type=\"text\"` once.\n    input.type = ''\n    let handler: EventHandler | null = new EventHandler()\n    const dispose = (): void => {\n      if (handler) {\n        handler.dispose()\n        handler = null\n      }\n    }\n    handler.once(input, 'input', (_e) => {\n      input.type = 'number'\n      dispose()\n    })\n    handler.once(input, 'blur', (_e) => {\n      dispose()\n    })\n  }\n\n  input.value = value ?? ''\n}\n","import { getInlineEditingStateId } from '../../internal/symbolManager'\nimport { GridInternal, InlineEditingState } from 'src/ts-types-internal'\nimport { obj } from '../../internal/utils'\n\nconst INLINE_EDITING_STATE_ID = getInlineEditingStateId()\n\nexport function getInlineEditingState<T>(\n  grid: GridInternal<T>\n): InlineEditingState {\n  let state = grid[INLINE_EDITING_STATE_ID]\n  if (!state) {\n    state = {}\n    obj.setReadonly(grid, INLINE_EDITING_STATE_ID, state)\n  }\n  return state\n}\n\nexport function toBoolean(val: unknown): boolean {\n  if (typeof val === 'string') {\n    if (val === 'false') {\n      return false\n    } else if (val === 'off') {\n      return false\n    } else if (/^0+$/.exec(val)) {\n      return false\n    }\n  }\n  return Boolean(val)\n}\n","import { ListGridAPI } from '../../../ts-types'\nimport { KEY_ENTER, KEY_ESC, KEY_TAB } from '../../../core/draw-grid/KEY_CODE'\nimport { createElement } from '../../../internal/dom'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport style from '../../../internal/style'\nimport { isDef, event } from '../../../internal/utils'\nimport inlineInputElementCss from './InlineInputElement.css'\nimport { setInputValue } from './input-value-handler'\nimport { getInlineEditingState } from '../../../columns/utils'\n\nconst CLASSNAME_IIE = 'kaka-grid__inline-input'\n\nfunction createInputElement() {\n  style.inject('inlineInputElement', inlineInputElementCss)\n  return createElement('input', { classList: CLASSNAME_IIE })\n}\n\nconst INPUT_EDITOR_TYPE = 'editor_type'\nconst BEFORE_INPUT_VALUE = 'before_value'\n\nfunction setInlineInputValue(\n  type: string = '',\n  input: HTMLInputElement,\n  value: any,\n  inputValue?: string\n) {\n  input.dataset[INPUT_EDITOR_TYPE] = type\n  if (type === 'date') {\n    if (value instanceof Date) {\n      if (input.type === 'text') {\n        input.value = value.toJSON().slice(0, 10)\n      } else {\n        input.valueAsDate = value\n      }\n    } else {\n      input.value = ''\n    }\n  } else if (type === 'number') {\n    if (typeof value === 'number' || typeof value === 'string') {\n      input.value = String(value)\n    } else {\n      input.value = ''\n    }\n  } else if (isDef(value)) {\n    input.value = value\n  } else {\n    input.value = ''\n  }\n  input.dataset[BEFORE_INPUT_VALUE] = input.value\n  if (inputValue) {\n    setInputValue(input, inputValue)\n  }\n}\n\nfunction getInlineInputValue(input: HTMLInputElement) {\n  let value: any\n  switch (input.dataset[INPUT_EDITOR_TYPE]) {\n    case 'date':\n      if (\n        /(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)/.test(\n          input.value\n        )\n      ) {\n        value = new Date(input.value)\n      } else {\n        value = null\n      }\n      break\n    case 'number':\n      value = input.value ? Number(input.value) : null\n      if (isNaN(value)) {\n        value = null\n      }\n      break\n    default:\n      value = input.value\n      break\n  }\n  return value\n}\n\nfunction isInputValueChanged(input: HTMLInputElement) {\n  return input.value !== input.dataset[BEFORE_INPUT_VALUE]\n}\n\ntype EditorProps = {\n  type?: string\n  classList?: string[]\n  enabledMouseWheel: boolean\n}\n\ntype ActiveData<T> = {\n  grid: ListGridAPI<T>\n  col: number\n  row: number\n  editor: EditorProps\n}\n\nfunction setInputAttrs<T>(\n  editor: EditorProps,\n  _grid: ListGridAPI<T>,\n  input: HTMLInputElement,\n  fixedType?: string\n): void {\n  const { classList, type } = editor\n  if (classList) {\n    input.classList.add(...classList)\n  }\n  try {\n    input.type = fixedType || type || ''\n  } catch (e) {\n    input.type = ''\n  }\n}\n\nexport class InlineInputElement<T> {\n  public static setInputAttrs<T>(\n    editor: EditorProps,\n    grid: ListGridAPI<T>,\n    input: HTMLInputElement,\n    fixedType?: string\n  ) {\n    setInputAttrs(editor, grid, input, fixedType)\n  }\n  private _handler: EventHandler\n  private _input: HTMLInputElement\n  private _beforePropEditor?: EditorProps | null\n  private _activeData?: ActiveData<T> | null\n  private _attaching: boolean\n  private _enabledMouseWheel: boolean = false\n  public constructor() {\n    this._handler = new EventHandler()\n    this._input = createInputElement()\n    this._bindInputEvents()\n  }\n  public dispose(): void {\n    const input = this._input\n    this.detach()\n    this._handler.dispose()\n    this._beforePropEditor = null\n    input.parentElement?.removeChild(input)\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    editor: EditorProps,\n    col: number,\n    row: number,\n    value: string,\n    inputValue?: string\n  ): void {\n    const input = this._input\n    this._enabledMouseWheel = editor.enabledMouseWheel\n\n    if (input.parentElement) {\n      // 解决 chrome 下 Failed to execute 'appendChild' on 'Node': The node to be removed is no longer a child of this node. Perhaps it was moved in a 'blur' event handler? 问题\n      // 问题原因：\n      //  正在输入的时候，双击其他单元格，正常情况要先触发 blur 再执行此方法，但 chrome 有时会延后执行 blur\n      //  element.appendChild(input) 执行此行代码的过程中会执行 blur 事件内容，导致此错误\n      // 解决办法：\n      //  如果发现 blur 还没有执行，则不执行此方法\n      return\n    }\n\n    const handler = this._handler\n\n    if (this._beforePropEditor) {\n      const { classList } = this._beforePropEditor\n      if (classList) {\n        input.classList.remove(...classList)\n      }\n    }\n\n    input.style.font = grid.font || '16px sans-serif'\n\n    const { element, rect, padding } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n    input.style.top = `${rect.top.toFixed()}px`\n    input.style.left = `${rect.left.toFixed()}px`\n    input.style.width = `${rect.width.toFixed()}px`\n    input.style.height = `${rect.height.toFixed()}px`\n    input.style.paddingTop = `${padding[0]}px`\n    input.style.paddingRight = `${padding[1]}px`\n    input.style.paddingBottom = `${padding[2]}px`\n    input.style.paddingLeft = `${padding[3]}px`\n    element.appendChild(input)\n\n    setInputAttrs(editor, grid, input)\n    setInlineInputValue(editor.type, input, value, inputValue)\n\n    this._activeData = { grid, col, row, editor }\n    this._beforePropEditor = editor\n\n    const focus = () => {\n      input.focus()\n\n      const end = input.value.length\n      try {\n        if (typeof input.selectionStart !== 'undefined') {\n          input.selectionStart = end\n          input.selectionEnd = end\n          return\n        }\n      } catch (e) {\n        // ignore\n      }\n      if ((document as any).selection) {\n        const range = (input as any).createTextRange()\n        range.collapse()\n        range.moveEnd('character', end)\n        range.moveStart('character', end)\n        range.select()\n      }\n    }\n    const safeInputFocus = () => {\n      handler.tryWithOffEvents(input, 'blur', () => {\n        focus()\n      })\n      const state = getInlineEditingState(grid)\n      state.cellRange = grid.getCellRange(col, row)\n      grid.invalidateCellRange(state.cellRange)\n    }\n\n    this._attaching = true\n    setTimeout(() => {\n      safeInputFocus()\n      this._attaching = false\n    })\n  }\n  public detach(gridFocus?: boolean) {\n    if (this._isActive()) {\n      const activeData = this._activeData!\n      const grid = activeData.grid\n      const col = activeData.col\n      const row = activeData.row\n      const input = this._input\n      this._handler.tryWithOffEvents(input, 'blur', () => {\n        if (input.parentElement) {\n          input.parentElement.removeChild(input)\n        }\n      })\n      const state = getInlineEditingState(grid)\n      delete state.cellRange\n      const range = grid.getCellRange(col, row)\n      grid.invalidateCellRange(range)\n      if (gridFocus) {\n        grid.focus()\n      }\n    }\n    delete this._activeData\n    this._enabledMouseWheel = false\n  }\n  public doChangeValue() {\n    if (!this._isActive()) {\n      return\n    }\n    if (isInputValueChanged(this._input)) {\n      const value = getInlineInputValue(this._input)\n      const activeData = this._activeData!\n      const grid = activeData.grid\n      const col = activeData.col\n      const row = activeData.row\n      grid.doChangeValue(col, row, () => value)\n    }\n  }\n  private _isActive() {\n    const input = this._input\n    if (!input || !input.parentElement) {\n      return false\n    }\n    if (!this._activeData) {\n      return false\n    }\n    return true\n  }\n  private _bindInputEvents() {\n    const handler = this._handler\n    const input = this._input\n    const stopPropagationOnly = (e: Event) => e.stopPropagation() // 终止事件传播\n    handler.on(input, 'click', stopPropagationOnly)\n    handler.on(input, 'mousedown', stopPropagationOnly)\n    handler.on(input, 'touchstart', stopPropagationOnly)\n    handler.on(input, 'dblclick', stopPropagationOnly)\n    handler.on(input, 'mousewheel', (e) => {\n      if (!this._enabledMouseWheel) {\n        e.preventDefault()\n      }\n    })\n    handler.on(input, 'compositionstart', (e) => {\n      input.classList.add('composition')\n    })\n    handler.on(input, 'compositionend', (e) => {\n      input.classList.remove('composition')\n    })\n    handler.on(input, 'keydown', (e) => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      if (keyCode === KEY_ESC) {\n        this.detach(true)\n        event.cancel(e)\n      } else if (keyCode === KEY_ENTER) {\n        this._onKeydownEnter(e)\n      } else if (keyCode === KEY_TAB) {\n        this._onKeydownTab(e)\n      }\n    })\n    handler.on(input, 'blur', (e) => {\n      this.doChangeValue()\n      this.detach()\n    })\n  }\n  private _onKeydownEnter(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n\n    const { grid } = this._activeData!\n\n    this.doChangeValue()\n    this.detach(true)\n\n    event.cancel(e)\n\n    if (grid.keyboardOptions?.moveCellOnEnter) {\n      grid.onKeyDownMove(e)\n    }\n  }\n  private _onKeydownTab(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n\n    const { grid } = this._activeData!\n    if (!grid.keyboardOptions?.moveCellOnTab) {\n      return\n    }\n    this.doChangeValue()\n    this.detach(true)\n    grid.onKeyDownMove(e)\n  }\n}\n","import {\n  InlineInputEditorOption,\n  ListGridAPI,\n  CellAddress,\n} from '../../ts-types'\nimport { obj } from '../../internal/utils'\nimport { BaseActionInput } from './BaseActionInput'\nimport { InlineInputElement } from './internal/InlineInputElement'\nimport { getInlineInputEditorStateId } from '../../internal/symbolManager'\n\nconst INLINE_INPUT_EDITOR_STATE_ID = getInlineInputEditorStateId()\n\nlet globalInlineInputElement: InlineInputElement<any> | null = null\nlet globalInlineInputBindGridCount = 0\n\nfunction attachInput<T>(\n  grid: ListGridAPI<T>,\n  cell: CellAddress,\n  editor: InlineInputEditor<T>,\n  value: any,\n  inputValue?: string\n) {\n  if (!globalInlineInputElement) {\n    globalInlineInputElement = new InlineInputElement()\n  }\n  const state = (editor as any).getState(grid)\n  if (!state.element) {\n    state.element = globalInlineInputElement\n    globalInlineInputBindGridCount++\n    grid.addDisposable({\n      dispose() {\n        globalInlineInputBindGridCount--\n        if (!globalInlineInputBindGridCount && globalInlineInputElement) {\n          globalInlineInputElement.dispose()\n          globalInlineInputElement = null\n        }\n      },\n    })\n  }\n\n  globalInlineInputElement.attach(\n    grid,\n    editor,\n    cell.col,\n    cell.row,\n    value,\n    inputValue\n  )\n}\nfunction detachInput(gridFocus?: boolean) {\n  if (globalInlineInputElement) {\n    globalInlineInputElement.detach(gridFocus)\n  }\n}\nfunction doChangeValue<T>(_grid: ListGridAPI<T>) {\n  if (globalInlineInputElement) {\n    globalInlineInputElement.doChangeValue()\n  }\n}\n\nexport class InlineInputEditor<T> extends BaseActionInput<T> {\n  private _classList?: string | string[]\n  private _type?: string\n  private _enabledMouseWheel: boolean\n  public constructor(options: InlineInputEditorOption<T> = {}) {\n    super(options)\n    this._classList = options.classList\n    this._type = options.type\n    this._enabledMouseWheel = !!options.enabledMouseWheel\n  }\n  public get classList(): string[] | undefined {\n    if (!this._classList) {\n      return undefined\n    }\n    return Array.isArray(this._classList) ? this._classList : [this._classList]\n  }\n  public set classList(classList) {\n    this._classList = classList\n  }\n  public get type() {\n    return this._type\n  }\n  public set type(type) {\n    this._type = type\n  }\n  public get enabledMouseWheel() {\n    return this._enabledMouseWheel\n  }\n  public set enabledMouseWheel(enabled) {\n    this._enabledMouseWheel = enabled\n  }\n  public clone(): InlineInputEditor<T> {\n    return new InlineInputEditor(this)\n  }\n  public onActionInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ): void {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachInput(grid, cell, this, value, inputValue)\n    })\n  }\n  public onActionOpenCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress\n  ): void {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachInput(grid, cell, this, value)\n    })\n  }\n  public onChangeSelectCellInternal(\n    grid: ListGridAPI<T>,\n    _cell: CellAddress,\n    _selected: boolean\n  ): void {\n    doChangeValue(grid)\n    detachInput()\n  }\n  public onGridScrollInternal(grid: ListGridAPI<T>) {\n    doChangeValue(grid)\n    detachInput(true)\n  }\n  public onChangeDisabledInternal(): void {\n    // cancel input\n    detachInput(true)\n  }\n  public onChangeReadOnlyInternal(): void {\n    // cancel input\n    detachInput(true)\n  }\n  public onSetInputAttrsInternal(\n    grid: ListGridAPI<T>,\n    _cell: CellAddress,\n    input: HTMLInputElement\n  ): void {\n    InlineInputElement.setInputAttrs(this, grid, input, 'text')\n  }\n  protected getState(grid: any): any {\n    if (!grid[INLINE_INPUT_EDITOR_STATE_ID]) {\n      obj.setReadonly(grid, INLINE_INPUT_EDITOR_STATE_ID, {})\n    }\n    return grid[INLINE_INPUT_EDITOR_STATE_ID]\n  }\n}\n","import { ListGridAPI } from '../../../ts-types'\nimport {\n  KEY_DOWN,\n  KEY_ENTER,\n  KEY_ESC,\n  KEY_UP,\n  KEY_TAB,\n} from '../../../core/draw-grid/KEY_CODE'\nimport {\n  createElement,\n  findPrevSiblingFocusable,\n  isFocusable,\n  appendHtml,\n  empty,\n  findNextSiblingFocusable,\n} from '../../../internal/dom'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport style from '../../../internal/style'\nimport {\n  isDef,\n  isDefString,\n  getOrApply,\n  str,\n  event,\n} from '../../../internal/utils'\nimport InlineLookupElementCss from './InlineLookupElement.css'\nimport { getInlineEditingState } from '../../../columns/utils'\n\ntype EditorProps<T, L> = {\n  type?: string\n  classList?: string[]\n  valueField?: string\n  valueType: 'string' | 'number'\n  captionField?: string\n  filterFields: string | string[]\n  filter?: (lookupRecord: L, record: T) => boolean\n  allowOtherInput: boolean | ((rec: T) => boolean)\n  disableFilterRecords: boolean\n  disableFilterSort: boolean\n  dropdownTemplate?: (...values: any[]) => string\n  dropdownEmptyTemplate?: (...values: any[]) => string\n}\n\ntype ActiveData<T, L> = {\n  grid: ListGridAPI<T>\n  col: number\n  row: number\n  editor: EditorProps<T, L>\n  dropdownInfo: {\n    records: L[]\n    valueField: string\n    valueType: 'string' | 'number'\n    filterFields: string[]\n    captionField: string\n    allowOtherInput: boolean\n    disableFilterRecords: boolean\n    disableFilterSort: boolean\n    beforeRecord?: L\n    emptyRecord?: L\n    dropdownTemplate: (...values: any[]) => string\n    dropdownEmptyTemplate: (...values: any[]) => string\n  }\n}\n\nconst CLASSNAME_ILE = 'kaka-grid__inline-lookup'\nconst INPUT_CLASSNAME_ILE = `${CLASSNAME_ILE}__input`\nconst DROPDOWN_CLASSNAME_ILE = `${CLASSNAME_ILE}__dropdown`\nconst DROPDOWN_HIDDEN_CLASSNAME_ILE = `${DROPDOWN_CLASSNAME_ILE}--hidden`\nconst DROPDOWN_SHOWN_CLASSNAME_ILE = `${DROPDOWN_CLASSNAME_ILE}--shown`\nconst DROPDOWN_RIGHT_CLASSNAME_ILE = `${DROPDOWN_CLASSNAME_ILE}--right`\nconst DROPDOWN_BOTTOM_CLASSNAME_ILE = `${DROPDOWN_CLASSNAME_ILE}--bottom`\nconst DROPDOWN_ITEM_CLASSNAME_ILE = `${DROPDOWN_CLASSNAME_ILE}-item`\nconst DROPDOWN_ITEM_EMPTY_CLASSNAME_ILE = `${DROPDOWN_ITEM_CLASSNAME_ILE}--empty`\nconst DROPDOWN_ITEM_OTHER_CLASSNAME_ILE = `${DROPDOWN_ITEM_CLASSNAME_ILE}--other`\nconst DROPDOWN_ITEM_FIRST_CLASSNAME_ILE = `${DROPDOWN_ITEM_CLASSNAME_ILE}--first`\nconst DEFAULT_DROPDOWN_VALUE_FIELD = 'id'\n\nfunction highlight(data: string, search: string) {\n  // http://kevin.vanzonneveld.net\n  // +   original by: booeyOH\n  // +   improved by: Ates Goral (http://magnetiq.com)\n  // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n  // +   bugfixed by: Onno Marsman\n  // *     example 1: preg_quote(\"$40\");\n  // *     returns 1: '\\$40'\n  // *     example 2: preg_quote(\"*RRRING* Hello?\");\n  // *     returns 2: '\\*RRRING\\* Hello\\?'\n  // *     example 3: preg_quote(\"\\\\.+*?[^]$(){}=!<>|:\");\n  // *     returns 3: '\\\\\\.\\+\\*\\?\\[\\^\\]\\$\\(\\)\\{\\}\\=\\!\\<\\>\\|\\:'\n  const s = (search + '').replace(/([\\\\.+*?[^\\]$(){}=!<>|:])/g, '\\\\$1')\n  return s ? data.replace(new RegExp('(' + s + ')', 'gi'), '<b>$1</b>') : data\n}\n\nfunction createLookupElement() {\n  style.inject('InlineLookupElement', InlineLookupElementCss)\n  const element = createElement('div', { classList: CLASSNAME_ILE })\n  const input = createElement('input', { classList: INPUT_CLASSNAME_ILE })\n  const ul = createElement('ul', { classList: DROPDOWN_CLASSNAME_ILE })\n  ul.tabIndex = -1\n  element.appendChild(input)\n  element.appendChild(ul)\n  return element\n}\n\nconst LOOKUP_BEFORE_VALUE = 'before_value'\nconst LOOKUP_SELECT_VALUE = 'select_value'\nconst LOOKUP_VALUE_TYPE = 'value_type'\n\nfunction setLookupInputValue(\n  type: 'string' | 'number',\n  input: HTMLInputElement,\n  value: any,\n  captionValue: string,\n  inputValue?: string\n) {\n  input.value = captionValue\n  input.dataset[LOOKUP_VALUE_TYPE] = type\n  input.dataset[LOOKUP_BEFORE_VALUE] = JSON.stringify(value)\n  input.dataset[LOOKUP_SELECT_VALUE] = JSON.stringify(value)\n  if (inputValue) {\n    input.value = inputValue\n  }\n}\n\nfunction getLookupInputValue(input: HTMLInputElement) {\n  let value = JSON.parse(input.dataset[LOOKUP_SELECT_VALUE] || 'null')\n  if (input.dataset[LOOKUP_VALUE_TYPE] === 'number' && isDef(value)) {\n    value = value - 0\n    if (isNaN(value)) {\n      value = null\n    }\n  }\n  return value\n}\n\nfunction isLookupInputValueChanged(input: HTMLInputElement) {\n  return (\n    input.dataset[LOOKUP_BEFORE_VALUE] !== input.dataset[LOOKUP_SELECT_VALUE]\n  )\n}\n\nfunction findDropdownItemParents(target: HTMLElement) {\n  let el: HTMLElement | null = target\n  while (!el.classList.contains(DROPDOWN_ITEM_CLASSNAME_ILE)) {\n    el = el.parentElement\n    if (!el || el.classList.contains(DROPDOWN_CLASSNAME_ILE)) {\n      return undefined\n    }\n  }\n  return el\n}\n\nexport class InlineLookupElement<T, L> {\n  public static setInputAttrs<T, L>(\n    _editor: EditorProps<T, L>,\n    _grid: ListGridAPI<T>,\n    input: HTMLInputElement\n  ): void {\n    input.type = 'text'\n  }\n  private _handler: EventHandler\n  private _lookup: HTMLDivElement\n  private _input: HTMLInputElement\n  private _dropdown: HTMLUListElement\n  private _attaching: boolean = false\n  private _beforeValue?: string\n  private _activeData?: ActiveData<T, L>\n  private _beforePropEditor?: EditorProps<T, L> | null\n  public constructor() {\n    this._handler = new EventHandler()\n    this._lookup = createLookupElement()\n    this._input = this._lookup.querySelector(\n      `.${INPUT_CLASSNAME_ILE}`\n    ) as HTMLInputElement\n    this._dropdown = this._lookup.querySelector(\n      `.${DROPDOWN_CLASSNAME_ILE}`\n    ) as HTMLUListElement\n    this._bindInputEvents()\n  }\n  public dispose(): void {\n    const lookup = this._lookup\n    this.detach()\n    this._handler.dispose()\n    this._beforePropEditor = null\n    lookup.parentElement?.removeChild(lookup)\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    editor: EditorProps<T, L>,\n    col: number,\n    row: number,\n    value: any,\n    lookupRecords: L[],\n    inputValue?: string\n  ) {\n    const handler = this._handler\n    const lookup = this._lookup\n    const input = this._input\n\n    if (this._beforePropEditor) {\n      this._unbindLookupProps(grid, lookup, input, this._beforePropEditor)\n    }\n\n    const { element, rect, padding } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n    lookup.style.top = `${rect.top.toFixed()}px`\n    lookup.style.left = `${rect.left.toFixed()}px`\n    lookup.style.width = `${rect.width.toFixed()}px`\n    lookup.style.height = `${rect.height.toFixed()}px`\n    input.style.width = lookup.style.width\n    input.style.height = lookup.style.height\n    input.style.paddingTop = `${padding[0]}px`\n    input.style.paddingRight = `${padding[1]}px`\n    input.style.paddingBottom = `${padding[2]}px`\n    input.style.paddingLeft = `${padding[3]}px`\n    element.appendChild(lookup)\n\n    input.style.font = grid.font || '16px sans-serif'\n    const valueField = editor.valueField || DEFAULT_DROPDOWN_VALUE_FIELD\n    const captionField = editor.captionField || valueField\n\n    // 让 valueField 和 captionField 默认在 filterFields 中\n    const filterFields =\n      !isDefString(editor.filterFields) ||\n      (Array.isArray(editor.filterFields) && editor.filterFields.length === 0)\n        ? [valueField, captionField]\n        : []\n    if (Array.isArray(editor.filterFields)) {\n      editor.filterFields.forEach((field) => {\n        if (filterFields.indexOf(field) < 0 && field) {\n          filterFields.push(field)\n        }\n      })\n    } else if (\n      isDef(editor.filterFields) &&\n      filterFields.indexOf(editor.filterFields) < 0 &&\n      editor.filterFields\n    ) {\n      filterFields.push(editor.filterFields)\n    }\n\n    const gridRecord = grid.getRowRecord(row) as T\n    const records: L[] = []\n    let emptyRecord: any // 找到表示空的记录\n    let beforeRecord: any // 找到上一个值对应的记录\n    const filter =\n      typeof editor.filter === 'function' ? editor.filter : () => true\n    for (const record of lookupRecords) {\n      if (filter(record, gridRecord)) {\n        records.push(record)\n        if (!isDefString((record as any)[valueField])) {\n          emptyRecord = record\n          if (!isDefString(value)) {\n            beforeRecord = record\n          }\n        } else if ((record as any)[valueField] === value) {\n          beforeRecord = record\n        }\n      }\n    }\n    // 进入编辑状态时，输入框中显示 captionField 的值\n    // 如果 captionField 没有值则显示 valueField 的值\n    // 如果 valueField 为空，显示空格\n    let captionValue = isDef(value) ? value + '' : ''\n    if (beforeRecord) {\n      if (beforeRecord !== emptyRecord) {\n        captionValue = beforeRecord[captionField] + '' || captionValue\n      } else {\n        captionValue = ''\n      }\n    }\n\n    const allowOtherInput = getOrApply(editor.allowOtherInput, gridRecord)\n\n    const activeData: ActiveData<T, L> = {\n      col,\n      dropdownInfo: {\n        allowOtherInput,\n        beforeRecord: isDef(inputValue) ? undefined : beforeRecord,\n        captionField,\n        disableFilterRecords: editor.disableFilterRecords,\n        disableFilterSort: editor.disableFilterSort,\n        dropdownEmptyTemplate: editor.dropdownEmptyTemplate\n          ? editor.dropdownEmptyTemplate\n          : str.template`${captionField}`,\n        dropdownTemplate: editor.dropdownTemplate\n          ? editor.dropdownTemplate\n          : str.template`${captionField}`,\n        emptyRecord,\n        filterFields,\n        records,\n        valueField,\n        valueType: editor.valueType,\n      },\n      editor,\n      grid,\n      row,\n    }\n\n    setLookupInputValue(\n      editor.valueType,\n      input,\n      value,\n      captionValue,\n      inputValue\n    )\n    this._onInputValue(input, activeData)\n\n    this._bindLookupProps(grid, lookup, input, editor)\n\n    this._activeData = activeData\n    this._beforePropEditor = editor\n\n    const focus = () => {\n      input.focus()\n\n      const end = input.value.length\n      try {\n        if (typeof input.selectionStart !== 'undefined') {\n          input.selectionStart = end\n          input.selectionEnd = end\n          return\n        }\n      } catch (e) {\n        // ignore\n      }\n      if ((document as any).selection) {\n        const range = (input as any).createTextRange()\n        range.collapse()\n        range.moveEnd('character', end)\n        range.moveStart('character', end)\n        range.select()\n      }\n    }\n    const safeInputFocus = () => {\n      handler.tryWithOffEvents(input, 'blur', () => {\n        focus()\n      })\n      const state = getInlineEditingState(grid)\n      state.cellRange = grid.getCellRange(col, row)\n      grid.invalidateCellRange(state.cellRange)\n    }\n\n    this._attaching = true\n    setTimeout(() => {\n      safeInputFocus()\n      this._attaching = false\n    })\n  }\n  public detach(gridFocus?: boolean) {\n    if (this._isActive()) {\n      const lookup = this._lookup\n      const input = this._input\n      this._handler.tryWithOffEvents(input, 'blur', () => {\n        if (lookup.parentElement) {\n          this._onInputValue(input)\n          lookup.parentElement.removeChild(lookup)\n        }\n      })\n      const { grid, col, row } = this._activeData!\n      const state = getInlineEditingState(grid)\n      delete state.cellRange\n      const range = grid.getCellRange(col, row)\n      grid.invalidateCellRange(range)\n      if (gridFocus) {\n        grid.focus()\n      }\n    }\n    delete this._beforeValue\n    delete this._activeData\n  }\n  public doChangeValue(changeOnlyWhenAllowOtherInput?: boolean) {\n    if (!this._isActive()) {\n      return\n    }\n    if (\n      changeOnlyWhenAllowOtherInput &&\n      this._activeData &&\n      !this._activeData.dropdownInfo.allowOtherInput\n    ) {\n      return\n    }\n    if (isLookupInputValueChanged(this._input)) {\n      const value = getLookupInputValue(this._input)\n      const { grid, col, row } = this._activeData!\n      grid.doChangeValue(col, row, () => value)\n    }\n  }\n  private _isActive() {\n    const lookup = this._lookup\n    if (!lookup || !lookup.parentElement) {\n      return false\n    }\n    if (!this._activeData) {\n      return false\n    }\n    return true\n  }\n  private _bindInputEvents() {\n    const handler = this._handler\n    const dropdown = this._dropdown\n    const input = this._input\n    const stopPropagationOnly = (e: Event) => e.stopPropagation() // 终止事件传播\n    handler.on(input, 'click', stopPropagationOnly)\n    handler.on(input, 'mousedown', stopPropagationOnly)\n    handler.on(input, 'touchstart', stopPropagationOnly)\n    handler.on(input, 'dblclick', stopPropagationOnly)\n    handler.on(dropdown, 'mousedown', stopPropagationOnly)\n    handler.on(dropdown, 'touchstart', stopPropagationOnly)\n    handler.on(dropdown, 'dblclick', stopPropagationOnly)\n\n    handler.on(dropdown, 'click', (e) => {\n      e.stopPropagation()\n      const item = findDropdownItemParents(e.target as HTMLElement)\n      if (item) {\n        this._selectNode(item)\n        this.doChangeValue()\n        this.detach(true)\n      } else {\n        this._input.focus()\n      }\n    })\n\n    handler.on(input, 'compositionstart', (e) => {\n      input.classList.add('composition')\n    })\n    handler.on(input, 'compositionend', (e) => {\n      input.classList.remove('composition')\n      this._onInputValue(input)\n    })\n    const onKeyupAndPress = (e: Event) => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      this._onInputValue(input)\n    }\n    handler.on(input, 'keyup', onKeyupAndPress)\n    handler.on(input, 'keypress', onKeyupAndPress)\n    handler.on(input, 'keydown', (e) => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      if (keyCode === KEY_ESC) {\n        this.detach(true)\n        event.cancel(e)\n      } else if (keyCode === KEY_ENTER) {\n        this._onKeydownEnter(e)\n      } else if (keyCode === KEY_TAB) {\n        this._onKeydownTab(e)\n      } else if (keyCode === KEY_UP) {\n        const n = this._dropdown.querySelector(\n          '[data-select=true]'\n        ) as HTMLLIElement\n        if (n) {\n          this._selectNode(n, false)\n          let next = findPrevSiblingFocusable(n) as HTMLElement\n          if (!next) {\n            const items = this._dropdown.querySelectorAll(\n              `.${DROPDOWN_ITEM_CLASSNAME_ILE}`\n            )\n            next = items[items.length - 1] as HTMLElement\n            if (!isFocusable(next)) {\n              next = findPrevSiblingFocusable(next) as HTMLElement\n            }\n          }\n          if (next) {\n            this._selectNode(next)\n            event.cancel(e)\n          }\n        }\n      } else if (keyCode === KEY_DOWN) {\n        const n = this._dropdown.querySelector(\n          '[data-select=true]'\n        ) as HTMLLIElement\n        if (n) {\n          this._selectNode(n, false)\n          let next = findNextSiblingFocusable(n) as HTMLElement\n          if (!next) {\n            next = this._dropdown.querySelector(\n              `.${DROPDOWN_ITEM_CLASSNAME_ILE}`\n            ) as HTMLElement\n            if (!isFocusable(next)) {\n              next = findNextSiblingFocusable(next) as HTMLElement\n            }\n          }\n          if (next) {\n            this._selectNode(next)\n            event.cancel(e)\n          }\n        }\n      } else {\n        this._onInputValue(input)\n      }\n    })\n    handler.on(input, 'blur', () => setTimeout(() => this.detach(), 300))\n  }\n  private _onKeydownEnter(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n    const { grid } = this._activeData!\n    this.doChangeValue()\n    this.detach(true)\n    if (grid.keyboardOptions?.moveCellOnEnter) {\n      grid.onKeyDownMove(e)\n    } else {\n      event.cancel(e)\n    }\n  }\n  private _onKeydownTab(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n    const { grid } = this._activeData!\n    if (!grid.keyboardOptions?.moveCellOnTab) {\n      return\n    }\n    this.doChangeValue()\n    this.detach(true)\n    grid.onKeyDownMove(e)\n  }\n  private _onInputValue(\n    input: HTMLInputElement,\n    activeData?: ActiveData<T, L>\n  ) {\n    const before = this._beforeValue\n    const value = input.value\n    if (before !== value) {\n      this._onInputValueChange(value, before as string, activeData)\n    }\n    this._beforeValue = value\n  }\n  private _onInputValueChange(\n    after: string,\n    before: string,\n    activeData?: ActiveData<T, L>\n  ) {\n    activeData = activeData || this._activeData!\n    const grid = activeData.grid\n    const dropdownInfo = activeData.dropdownInfo\n    const isFirstChange = !isDef(before)\n\n    // 过滤下拉数据\n    const filterInfo = this._filterRecords(\n      dropdownInfo.records,\n      dropdownInfo.filterFields,\n      after,\n      dropdownInfo.valueField,\n      dropdownInfo.disableFilterRecords,\n      dropdownInfo.disableFilterSort,\n      dropdownInfo.emptyRecord,\n      isFirstChange ? dropdownInfo.beforeRecord : undefined\n    )\n    const isAll = filterInfo.isAll\n    const filterRecords = filterInfo.filterRecords\n    const itemNodes: HTMLElement[] = []\n    let beforeNode: any\n    let firstMatchedNode: any\n    // 只在有输入内容时显示输入内容选项\n    let isEmptyValue = false\n    if (dropdownInfo.allowOtherInput) {\n      let saveValue: any = after\n      let displayValue: string = str.escape(after)\n      if (dropdownInfo.valueType === 'number') {\n        if (saveValue.trim()) {\n          saveValue = Number(after)\n          if (isNaN(saveValue)) {\n            saveValue = null\n          }\n        } else {\n          saveValue = null\n        }\n        if (saveValue === null) {\n          displayValue = str.escape('<null>')\n          isEmptyValue = true\n        }\n      } else {\n        if (!saveValue) {\n          displayValue = str.escape('<Empty>')\n          isEmptyValue = true\n        }\n      }\n      if (\n        (dropdownInfo.valueType === 'number' &&\n          (saveValue !== null ||\n            (isAll && isEmptyValue && !dropdownInfo.emptyRecord))) ||\n        (dropdownInfo.valueType !== 'number' &&\n          (saveValue || (isEmptyValue && !dropdownInfo.emptyRecord)))\n      ) {\n        const otherLi = createElement('li', {\n          classList: [\n            DROPDOWN_ITEM_CLASSNAME_ILE,\n            isEmptyValue\n              ? DROPDOWN_ITEM_EMPTY_CLASSNAME_ILE\n              : DROPDOWN_ITEM_OTHER_CLASSNAME_ILE,\n          ],\n        })\n        otherLi.tabIndex = 0\n        otherLi.dataset.value = JSON.stringify(saveValue)\n        appendHtml(otherLi, displayValue)\n        itemNodes.push(otherLi)\n      }\n    }\n    if (itemNodes.length === 0 || isEmptyValue || !isAll) {\n      // 当 allowOtherInput === true 并\"有非空输入内容\"且\"无匹配\"时，不显示参照列表、只显示其他值\n      // 显示过滤后的选项\n      filterRecords.forEach((record: any) => {\n        const classList = [DROPDOWN_ITEM_CLASSNAME_ILE]\n        let html\n        if (record.__isEmpty) {\n          classList.push(DROPDOWN_ITEM_EMPTY_CLASSNAME_ILE)\n          html = dropdownInfo.dropdownEmptyTemplate(record)\n        } else {\n          html = dropdownInfo.dropdownTemplate(record)\n        }\n        const li = createElement('li', {\n          classList,\n        })\n        if (record.__isBefore) {\n          beforeNode = li\n        }\n        if (!isDef(firstMatchedNode) && record.__isMatched) {\n          firstMatchedNode = li\n        }\n        li.tabIndex = 0\n        li.dataset.value = JSON.stringify(record.__value)\n        appendHtml(li, html)\n        itemNodes.push(li)\n      })\n    }\n\n    empty(this._dropdown)\n    const offset = this._dropdown.scrollHeight + 2\n    if (itemNodes.length > 0) {\n      itemNodes[0].classList.add(DROPDOWN_ITEM_FIRST_CLASSNAME_ILE)\n      let selectedNode\n      if (isFirstChange && dropdownInfo.beforeRecord && beforeNode) {\n        selectedNode = beforeNode\n      } else if (firstMatchedNode) {\n        selectedNode = firstMatchedNode\n      } else {\n        selectedNode = itemNodes[0]\n      }\n      this._selectNode(selectedNode)\n      this._dropdown.style.maxHeight = ''\n      appendHtml(this._dropdown, itemNodes)\n      // 确定下拉框显示位置\n      if (\n        this._lookup.offsetTop +\n          this._lookup.offsetHeight +\n          this._dropdown.offsetHeight >\n          grid.getElement().clientHeight &&\n        this._lookup.offsetTop >\n          grid.getElement().clientHeight -\n            this._lookup.offsetTop -\n            this._lookup.offsetHeight\n      ) {\n        // 上方显示\n        this._dropdown.classList.add(DROPDOWN_BOTTOM_CLASSNAME_ILE)\n        this._dropdown.style.maxHeight = this._lookup.offsetTop - offset + 'px'\n      } else {\n        // 下方显示\n        this._dropdown.style.maxHeight =\n          grid.getElement().clientHeight -\n          this._lookup.offsetTop -\n          this._lookup.offsetHeight -\n          offset +\n          'px'\n        this._dropdown.classList.remove(DROPDOWN_BOTTOM_CLASSNAME_ILE)\n      }\n      if (\n        this._lookup.offsetLeft +\n          this._lookup.offsetWidth +\n          this._dropdown.offsetWidth >\n          grid.getElement().clientWidth &&\n        this._lookup.offsetLeft >\n          grid.getElement().clientWidth -\n            this._lookup.offsetLeft -\n            this._lookup.offsetWidth\n      ) {\n        this._dropdown.classList.add(DROPDOWN_RIGHT_CLASSNAME_ILE)\n      } else {\n        this._dropdown.classList.remove(DROPDOWN_RIGHT_CLASSNAME_ILE)\n      }\n      this._dropdown.classList.remove(DROPDOWN_HIDDEN_CLASSNAME_ILE)\n      this._dropdown.classList.add(DROPDOWN_SHOWN_CLASSNAME_ILE)\n    } else {\n      this._selectNode()\n      this._dropdown.classList.remove(DROPDOWN_SHOWN_CLASSNAME_ILE)\n      this._dropdown.classList.add(DROPDOWN_HIDDEN_CLASSNAME_ILE)\n    }\n  }\n  private _selectNode(node?: HTMLElement, isSelected?: boolean) {\n    if (node) {\n      if (isSelected !== false) {\n        node.dataset.select = 'true'\n        this._input.dataset[LOOKUP_SELECT_VALUE] = node.dataset.value\n        // 滚动到可视位置\n        if (node.parentElement) {\n          if (node.offsetTop < node.parentElement.scrollTop) {\n            node.parentElement.scrollTop = node.offsetTop\n          } else if (\n            node.offsetTop + node.offsetHeight >\n            node.parentElement.scrollTop + node.parentElement.clientHeight\n          ) {\n            node.parentElement.scrollTop =\n              node.offsetTop +\n              node.offsetHeight -\n              node.parentElement.clientHeight\n          }\n        }\n      } else {\n        delete node.dataset.select\n        this._input.dataset[LOOKUP_SELECT_VALUE] = this._input.dataset[\n          LOOKUP_BEFORE_VALUE\n        ]\n      }\n    } else {\n      this._input.dataset[LOOKUP_SELECT_VALUE] = this._input.dataset[\n        LOOKUP_BEFORE_VALUE\n      ]\n    }\n  }\n  private _filterRecords(\n    records: L[],\n    filterFields: string[],\n    inputValue: string,\n    valueField: string,\n    disableFilterRecords: boolean,\n    disableFilterSort: boolean,\n    emptyRecord?: L,\n    beforeRecord?: L\n  ) {\n    const filterRecords: L[] = []\n    const allRecords: L[] = []\n    const otherRecords: L[] = []\n    records.forEach((record) => {\n      const filterRecord: any = {}\n      let matched = false\n      for (const key in record) {\n        const value = isDef(record[key]) ? record[key] + '' : ''\n        if (filterFields.indexOf(key) >= 0) {\n          const matchValue = highlight(value, inputValue)\n          filterRecord[key] = matchValue\n          matched = matched || matchValue !== value || !inputValue\n        } else {\n          filterRecord[key] = value\n        }\n      }\n      filterRecord.__isMatched = matched\n      filterRecord.__value = (record as any)[valueField]\n      filterRecord.__isBefore = beforeRecord === record\n      filterRecord.__isEmpty = emptyRecord === record\n      if (matched || filterRecord.__isBefore || disableFilterSort) {\n        filterRecords.push(filterRecord)\n      } else if (disableFilterRecords) {\n        otherRecords.push(filterRecord)\n      }\n      allRecords.push(filterRecord)\n    })\n    const isAll =\n      filterFields.length === 0 ||\n      (!inputValue && !beforeRecord) ||\n      filterRecords.length === 0\n    if (!isAll && disableFilterRecords) {\n      for (const record of otherRecords) {\n        filterRecords.push(record)\n      }\n    }\n    return {\n      filterRecords: isAll ? allRecords : filterRecords,\n      isAll,\n    }\n  }\n  private _bindLookupProps(\n    grid: ListGridAPI<T>,\n    lookup: HTMLDivElement,\n    input: HTMLInputElement,\n    editor: EditorProps<T, L>\n  ) {\n    const classList = editor.classList\n    if (classList) {\n      lookup.classList.add(...classList)\n    }\n    InlineLookupElement.setInputAttrs(editor, grid, input)\n  }\n  private _unbindLookupProps(\n    _grid: ListGridAPI<T>,\n    lookup: HTMLDivElement,\n    _input: HTMLInputElement,\n    editor: EditorProps<T, L>\n  ) {\n    const classList = editor.classList\n    if (classList) {\n      lookup.classList.remove(...classList)\n    }\n  }\n}\n","import {\n  InlineLookupEditorOption,\n  ListGridAPI,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { getOrApply, isPromise, isDef, obj } from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord } from './action-utils'\nimport { BaseActionInput } from './BaseActionInput'\nimport { InlineLookupElement } from './internal/InlineLookupElement'\nimport { getInlineLookupEditorStateId } from '../../internal/symbolManager'\n\nconst INLINE_LOOKUP_EDITOR_STATE_ID = getInlineLookupEditorStateId()\n\nlet globalInlineLookupElement: InlineLookupElement<any, any> | null = null\nlet globalInlineLookupBindGridCount = 0\n\nfunction attachLookupInput<T, L>(\n  grid: ListGridAPI<T>,\n  cell: CellAddress,\n  editor: InlineLookupEditor<T, L>,\n  value: any,\n  inputValue?: string\n) {\n  if (!globalInlineLookupElement) {\n    globalInlineLookupElement = new InlineLookupElement()\n  }\n  const state = (editor as any).getState(grid)\n  if (!state.element) {\n    state.element = globalInlineLookupElement\n    globalInlineLookupBindGridCount++\n    grid.addDisposable({\n      dispose() {\n        globalInlineLookupBindGridCount--\n        if (!globalInlineLookupBindGridCount && globalInlineLookupElement) {\n          globalInlineLookupElement.dispose()\n          globalInlineLookupElement = null\n        }\n      },\n    })\n  }\n\n  const records = getOrApply(\n    editor.records || [],\n    grid.getRowRecord(cell.row) as any\n  )\n  if (isPromise(records)) {\n    records.then((rs) => {\n      if (globalInlineLookupElement) {\n        globalInlineLookupElement.attach(\n          grid,\n          editor,\n          cell.col,\n          cell.row,\n          value,\n          rs,\n          inputValue\n        )\n      }\n    })\n  } else {\n    globalInlineLookupElement.attach(\n      grid,\n      editor,\n      cell.col,\n      cell.row,\n      value,\n      records,\n      inputValue\n    )\n  }\n}\nfunction detachLookupInput(gridFocus?: boolean) {\n  if (globalInlineLookupElement) {\n    globalInlineLookupElement.detach(gridFocus)\n  }\n}\n\nfunction doChangeLookupValue() {\n  if (globalInlineLookupElement) {\n    globalInlineLookupElement.doChangeValue(true)\n  }\n}\n\nexport class InlineLookupEditor<T, L> extends BaseActionInput<T> {\n  private _classList?: string | string[]\n  private _records: L[] | ((rec: T) => L[] | Promise<L[]>)\n  private _valueField: string\n  private _valueType: 'string' | 'number'\n  private _captionField: string\n  private _filterFields: string | string[]\n  private _allowOtherInput: boolean | ((rec: T) => boolean)\n  private _disableFilterRecords: boolean\n  private _disableFilterSort: boolean\n  private _filter?: (lookupRecord: L, record: T) => boolean\n  private _dropdownTemplate?: (...values: any[]) => string\n  private _dropdownEmptyTemplate?: (...values: any[]) => string\n  public constructor(options: InlineLookupEditorOption<T, L> = {}) {\n    super(options)\n    this.action =\n      this.action ||\n      ((me) => (\n        _record: T,\n        data: {\n          grid: ListGridAPI<T>\n          cell: CellAddress\n        }\n      ) => {\n        if (\n          isReadOnlyRecord(me.readOnly, data.grid, data.cell.row) ||\n          isDisabledRecord(me.disabled, data.grid, data.cell.row)\n        ) {\n          return\n        }\n        me.onOpenCellInternal(data.grid, data.cell)\n      })(this)\n    this._classList = options.classList\n    this._records = options.records || []\n    this._valueField = options.valueField || ''\n    this._valueType = options.valueType || 'string'\n    this._captionField = options.captionField || ''\n    this._filterFields = options.filterFields || ''\n    this._allowOtherInput = options.allowOtherInput || false\n    this._disableFilterRecords = !!options.disableFilterRecords\n    this._disableFilterSort = !!options.disableFilterSort\n\n    if (isDef(options.disableDropdown)) {\n      this.disableDropdown = !!options.disableDropdown\n    }\n\n    this._filter = options.filter\n    this._dropdownTemplate = options.dropdownTemplate\n    this._dropdownEmptyTemplate = options.dropdownEmptyTemplate\n  }\n  public get classList(): string[] | undefined {\n    if (!this._classList) {\n      return undefined\n    }\n    return Array.isArray(this._classList) ? this._classList : [this._classList]\n  }\n  public set classList(classList) {\n    this._classList = classList\n  }\n  public get records() {\n    return this._records\n  }\n  public set records(records) {\n    this._records = records\n  }\n  public get valueField() {\n    return this._valueField\n  }\n  public set valueField(valueField) {\n    this._valueField = valueField\n  }\n  public get valueType() {\n    return this._valueType\n  }\n  public set valueType(valueType) {\n    this._valueType = valueType\n  }\n  public get captionField() {\n    return this._captionField\n  }\n  public set captionField(captionField) {\n    this._captionField = captionField\n  }\n  public get filterFields() {\n    return this._filterFields\n  }\n  public set filterFields(filterFields) {\n    this._filterFields = filterFields\n  }\n  public get allowOtherInput() {\n    return this._allowOtherInput\n  }\n  public set allowOtherInput(allowOtherInput) {\n    this._allowOtherInput = allowOtherInput || false\n  }\n  public get disableFilterRecords() {\n    return this._disableFilterRecords\n  }\n  public set disableFilterRecords(disableFilterRecords) {\n    this._disableFilterRecords = !!disableFilterRecords\n  }\n  public get disableFilterSort() {\n    return this._disableFilterSort\n  }\n  public set disableFilterSort(disableFilterSort) {\n    this._disableFilterSort = !!disableFilterSort\n  }\n  public get disableDropdown() {\n    window.console.warn(\n      \"'disableDropdown' is deprecated, please use 'disableInput' instead\"\n    )\n    return !!this.disableInput\n  }\n  public set disableDropdown(disableDropdown) {\n    window.console.warn(\n      \"'disableDropdown' is deprecated, please use 'disableInput' instead\"\n    )\n    this.disableInput = !!disableDropdown\n  }\n  public get filter() {\n    return this._filter\n  }\n  public set filter(filter) {\n    this._filter = filter\n  }\n  public get dropdownTemplate() {\n    return this._dropdownTemplate\n  }\n  public set dropdownTemplate(dropdownTemplate) {\n    this._dropdownTemplate = dropdownTemplate\n  }\n  public get dropdownEmptyTemplate() {\n    return this._dropdownEmptyTemplate\n  }\n  public set dropdownEmptyTemplate(dropdownEmptyTemplate) {\n    this._dropdownEmptyTemplate = dropdownEmptyTemplate\n  }\n  public clone(): InlineLookupEditor<T, L> {\n    return new InlineLookupEditor(this)\n  }\n  public onActionInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ) {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachLookupInput(grid, cell, this, value, inputValue)\n    })\n  }\n  public onActionOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress) {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachLookupInput(grid, cell, this, value)\n    })\n  }\n  public onChangeSelectCellInternal(\n    _grid: ListGridAPI<T>,\n    _cell: CellAddress,\n    _selected: boolean\n  ) {\n    // cancel input\n    doChangeLookupValue()\n    detachLookupInput()\n  }\n  public onGridScrollInternal(grid: ListGridAPI<T>) {\n    // cancel input\n    doChangeLookupValue()\n    detachLookupInput(true)\n  }\n  public onChangeDisabledInternal() {\n    // cancel input\n    detachLookupInput(true)\n  }\n  public onChangeReadOnlyInternal() {\n    // cancel input\n    detachLookupInput(true)\n  }\n  public onSetInputAttrsInternal(\n    grid: ListGridAPI<T>,\n    _cell: CellAddress,\n    input: HTMLInputElement\n  ) {\n    InlineLookupElement.setInputAttrs(this, grid, input)\n  }\n  public bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const ids = super.bindGridEvent(grid, cellId)\n    const detach = () => {\n      doChangeLookupValue()\n      detachLookupInput(true)\n    }\n    ids.push(grid.listen(DG_EVENT_TYPE.CLICK_UNDERLAY, detach))\n    ids.push(grid.listen(DG_EVENT_TYPE.DBLCLICK_UNDERLAY, detach))\n    ids.push(grid.listen(DG_EVENT_TYPE.DBLTAP_UNDERLAY, detach))\n    return ids\n  }\n  protected getState(grid: any): any {\n    if (!(grid as any)[INLINE_LOOKUP_EDITOR_STATE_ID]) {\n      obj.setReadonly(grid, INLINE_LOOKUP_EDITOR_STATE_ID, {})\n    }\n    return grid[INLINE_LOOKUP_EDITOR_STATE_ID]\n  }\n}\n","import { ColumnMenuItemOption, ColumnMenuItemOptions } from '../ts-types'\n\nfunction extend<T, U>(a: T, b: U): T & U {\n  const o: any = {}\n  for (const k in a) {\n    o[k] = a[k]\n  }\n  for (const k in b) {\n    o[k] = b[k]\n  }\n  return o\n}\n\n/**\n * Normalize the given menu options.\n * @param options - menu options to given\n * @returns Normalized options\n */\nfunction normalize(\n  options: ColumnMenuItemOptions | undefined\n): ColumnMenuItemOption[] {\n  if (!options) {\n    return []\n  }\n  if (Array.isArray(options)) {\n    return (options as any).map(\n      (e: any): ColumnMenuItemOption =>\n        extend(e, { label: e.caption || e.label })\n    )\n  }\n  if (typeof options === 'string') {\n    return normalize(JSON.parse(options))\n  }\n  const result = []\n  for (const k in options) {\n    if (options.hasOwnProperty(k)) {\n      result.push({\n        label: options[k],\n        value: k,\n      })\n    }\n  }\n  return result\n}\n\n/**\n * Normalize the given menu options.\n * @param options - menu options to given\n * @returns Normalized options\n */\nfunction normalizeToFn<T>(\n  options:\n    | ColumnMenuItemOptions\n    | ((record: T | undefined) => ColumnMenuItemOptions)\n    | undefined\n): (record: T | undefined) => ColumnMenuItemOption[] {\n  if (typeof options === 'function') {\n    return (record: T | undefined): ColumnMenuItemOption[] =>\n      normalize(options(record))\n  }\n  return (): ColumnMenuItemOption[] => normalize(options)\n}\n\nexport default {\n  normalize,\n  normalizeToFn,\n}\n","import { ListGridAPI, ColumnMenuItemOption, RectProps } from '../../../ts-types'\nimport {\n  KEY_DOWN,\n  KEY_ENTER,\n  KEY_ESC,\n  KEY_TAB,\n  KEY_UP,\n} from '../../../core/draw-grid/KEY_CODE'\nimport {\n  createElement,\n  appendHtml,\n  empty,\n  disableFocus,\n  findPrevSiblingFocusable,\n  findNextSiblingFocusable,\n  isFocusable,\n} from '../../../internal/dom'\nimport { isDef, event } from '../../../internal/utils'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport Rect from '../../../internal/Rect'\nimport style from '../../../internal/style'\n\nimport inlineMenuElementCss from './InlineMenuElement.css'\n\nconst CLASSNAME_IME = 'kaka-grid__inline-menu'\nconst ITEM_CLASSNAME_IME = `${CLASSNAME_IME}__menu-item`\nconst HIDDEN_CLASSNAME_IME = `${CLASSNAME_IME}--hidden`\nconst SHOWN_CLASSNAME_IME = `${CLASSNAME_IME}--shown`\nconst EMPTY_ITEM_CLASSNAME_IME = `${ITEM_CLASSNAME_IME}--empty`\n\nfunction findItemParents(target: HTMLElement) {\n  let el: HTMLElement | null = target\n  while (!el.classList.contains(ITEM_CLASSNAME_IME)) {\n    el = el.parentElement\n    if (!el || el.classList.contains(CLASSNAME_IME)) {\n      return undefined\n    }\n  }\n  return el\n}\n\nfunction createMenuElement() {\n  style.inject('inlineMenuElement', inlineMenuElementCss)\n  return createElement('ul', { classList: CLASSNAME_IME })\n}\nfunction attachElement(\n  element: HTMLElement,\n  rect: RectProps,\n  menu: HTMLUListElement,\n  autoWidth?: boolean\n) {\n  menu.style.top = `${rect.top.toFixed()}px`\n  menu.style.left = `${rect.left.toFixed()}px`\n  menu.style.width = autoWidth ? '' : `${rect.width.toFixed()}px`\n  menu.style.lineHeight = `${rect.height.toFixed()}px`\n  element.appendChild(menu)\n}\n\nfunction optionToLi(\n  { classList, label, value, html }: ColumnMenuItemOption,\n  index: number\n) {\n  const item = createElement('li', { classList: ITEM_CLASSNAME_IME })\n  item.tabIndex = 0\n  item.setAttribute('data-value-index', index + '')\n  if (classList) {\n    item.classList.add(...(Array.isArray(classList) ? classList : [classList]))\n  }\n\n  if (label) {\n    const span = createElement('span', { text: label })\n    item.appendChild(span)\n  } else if (html) {\n    appendHtml(item, html)\n  }\n\n  if (value === '' || !isDef(value)) {\n    item.classList.add(EMPTY_ITEM_CLASSNAME_IME)\n  }\n\n  return item\n}\n\nfunction openMenu<T>(\n  grid: ListGridAPI<T>,\n  editor: EditorProps<T>,\n  col: number,\n  row: number,\n  value: any,\n  options: ColumnMenuItemOption[],\n  menu: HTMLUListElement\n) {\n  const { classList } = editor\n  menu.classList.remove(SHOWN_CLASSNAME_IME)\n  menu.classList.add(HIDDEN_CLASSNAME_IME)\n  empty(menu)\n  menu.style.font = grid.font || '16px sans-serif'\n  let emptyItemEl: HTMLLIElement | null = null\n  let valueItemEl: HTMLLIElement | null = null\n\n  options.forEach((option, i) => {\n    const item = optionToLi(option, i)\n    menu.appendChild(item)\n    if (option.value === value) {\n      valueItemEl = item\n      item.dataset.select = 'select'\n    }\n    if (item.classList.contains(EMPTY_ITEM_CLASSNAME_IME)) {\n      emptyItemEl = item\n    }\n  })\n  const focusEl =\n    valueItemEl ||\n    emptyItemEl ||\n    ((menu.children || menu.childNodes)[0] as HTMLLIElement)\n  if (classList) {\n    menu.classList.add(...classList)\n  }\n  const children = Array.prototype.slice.call(\n    menu.children || menu.childNodes,\n    0\n  )\n  const focusIndex = children.indexOf(focusEl)\n  const { element, rect } = grid.getAttachCellsArea(grid.getCellRange(col, row))\n\n  // Cover the right line\n  rect.width++\n\n  // append for calculation\n  attachElement(element, rect, menu, editor.autoWidth)\n\n  // Make the selection item at the middle\n  let offset = 0\n  let allHeight = 0\n  for (let i = 0; i < children.length; i++) {\n    const offsetHeight = children[i].offsetHeight\n    if (i < focusIndex) {\n      offset += offsetHeight\n    }\n    allHeight += offsetHeight\n  }\n  ;(rect as Rect).offsetTop(-offset)\n  menu.style.transformOrigin = `center ${\n    offset + Math.ceil(children[focusIndex].offsetHeight / 2)\n  }px 0px`\n  attachElement(element, rect, menu, editor.autoWidth)\n\n  // Control not to overflow the screen range\n  const menuClientRect = menu.getBoundingClientRect()\n  const scaleDiff = (allHeight - menuClientRect.height) / 2\n  const orgMenuTop = menuClientRect.top - scaleDiff\n  let menuTop = orgMenuTop\n  const menuBottom = menuTop + allHeight\n  const winBottom = window.innerHeight\n  const winMargin = 20\n  if (menuBottom > winBottom - winMargin) {\n    const diff = menuBottom - winBottom + winMargin\n    menuTop -= diff\n  }\n  if (menuTop < 0 /*winTop*/ + winMargin) {\n    menuTop = winMargin\n  }\n  if (menuTop !== orgMenuTop) {\n    ;(rect as Rect).offsetTop(-(orgMenuTop - menuTop))\n    // re update\n    attachElement(element, rect, menu, editor.autoWidth)\n  }\n\n  if (focusEl) {\n    focusEl.focus()\n  }\n  menu.classList.remove(HIDDEN_CLASSNAME_IME)\n  menu.classList.add(SHOWN_CLASSNAME_IME)\n}\n\nfunction closeMenu<T>(\n  _grid: ListGridAPI<T>,\n  _col: number,\n  _row: number,\n  menu: HTMLUListElement\n) {\n  menu.classList.remove(SHOWN_CLASSNAME_IME)\n  menu.classList.add(HIDDEN_CLASSNAME_IME)\n  disableFocus(menu)\n}\n\ntype EditorProps<T> = {\n  classList?: string[]\n  options: (record: T | undefined) => ColumnMenuItemOption[]\n  autoWidth?: boolean\n}\ntype ActiveData<T> = {\n  grid: ListGridAPI<T>\n  col: number\n  row: number\n  editor: EditorProps<T>\n  options: ColumnMenuItemOption[]\n}\n\nexport class InlineMenuElement<T> {\n  private _handler: EventHandler\n  private _menu: HTMLUListElement\n  private _beforePropEditor?: EditorProps<T> | null\n  private _activeData?: ActiveData<T> | null\n  public constructor() {\n    this._handler = new EventHandler()\n    this._menu = createMenuElement()\n    this._bindMenuEvents()\n  }\n  public dispose(): void {\n    const menu = this._menu\n    this.detach()\n    this._handler.dispose()\n    this._beforePropEditor = null\n    menu.parentElement?.removeChild(menu)\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    editor: EditorProps<T>,\n    col: number,\n    row: number,\n    value: string,\n    record: T | undefined\n  ): void {\n    const menu = this._menu\n\n    if (this._beforePropEditor) {\n      const classList = this._beforePropEditor.classList\n      if (classList) {\n        menu.classList.remove(...classList)\n      }\n    }\n\n    const options = editor.options(record)\n\n    openMenu(grid, editor, col, row, value, options, menu)\n\n    // 当焦点离开菜单时，关闭菜单\n    const owner: any = menu\n    for (let i = 0; i < menu.childNodes.length; i++) {\n      const el = menu.childNodes[i]\n      this._handler.on(el, 'focus', () => {\n        owner._focus = true\n      })\n      this._handler.on(el, 'blur', () => {\n        owner._focus = false\n        setTimeout(() => {\n          if (!owner._focus) {\n            this.detach()\n          }\n        }, 0)\n      })\n    }\n\n    this._activeData = { grid, col, row, editor, options }\n    this._beforePropEditor = editor\n  }\n  public detach(gridFocus?: boolean): void {\n    if (this._isActive()) {\n      const { grid, col, row } = this._activeData!\n      const menu = this._menu\n      closeMenu(grid, col, row, menu)\n\n      const range = grid.getCellRange(col, row)\n      grid.invalidateCellRange(range)\n      if (gridFocus) {\n        grid.focus()\n      }\n    }\n    this._activeData = null\n  }\n  private _doChangeValue(valueIndex: string | null): void {\n    if (this._isActive() && valueIndex) {\n      const { grid, col, row, options } = this._activeData!\n      const option = options[parseInt(valueIndex, 10)]\n      if (option) {\n        const { value } = option\n        grid.doChangeValue(col, row, () => value)\n      }\n    }\n  }\n  private _isActive() {\n    const menu = this._menu\n    if (!menu || !menu.parentElement) {\n      return false\n    }\n    if (!this._activeData) {\n      return false\n    }\n    return true\n  }\n  private _bindMenuEvents() {\n    const handler = this._handler\n    const menu = this._menu\n\n    const stopPropagationOnly = (e: Event) => e.stopPropagation() // 为了不在grid中传播\n\n    handler.on(menu, 'mousedown', stopPropagationOnly)\n    handler.on(menu, 'touchstart', stopPropagationOnly)\n    handler.on(menu, 'dblclick', stopPropagationOnly)\n\n    handler.on(menu, 'click', (e) => {\n      e.stopPropagation()\n      const item = findItemParents(e.target as HTMLElement)\n      if (!item) {\n        return\n      }\n      const valueIndex = item.getAttribute('data-value-index')\n      this._doChangeValue(valueIndex)\n      this.detach(true)\n    })\n    handler.on(menu, 'keydown', (e) => {\n      const item = findItemParents(e.target as HTMLElement)\n      if (!item || !this._isActive()) {\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      if (keyCode === KEY_ENTER) {\n        this._onKeydownEnter(menu, item, e)\n      } else if (keyCode === KEY_ESC) {\n        this.detach(true)\n        event.cancel(e)\n      } else if (keyCode === KEY_UP) {\n        const n = findPrevSiblingFocusable(item)\n        if (n) {\n          n.focus()\n          event.cancel(e)\n        }\n      } else if (keyCode === KEY_DOWN) {\n        const n = findNextSiblingFocusable(item)\n        if (n) {\n          n.focus()\n          event.cancel(e)\n        }\n      } else if (keyCode === KEY_TAB) {\n        this._onKeydownTab(menu, item, e)\n      }\n    })\n  }\n  private _onKeydownEnter(\n    _menu: HTMLUListElement,\n    item: HTMLElement,\n    e: KeyboardEvent\n  ): void {\n    const grid = this._isActive() ? this._activeData!.grid : null\n\n    const valueIndex = item.getAttribute('data-value-index')\n    this._doChangeValue(valueIndex)\n    this.detach(true)\n    event.cancel(e)\n    if (grid) {\n      if (grid.keyboardOptions?.moveCellOnEnter) {\n        grid.onKeyDownMove(e)\n      }\n    }\n  }\n  private _onKeydownTab(\n    menu: HTMLUListElement,\n    item: HTMLElement,\n    e: KeyboardEvent\n  ): void {\n    if (this._isActive()) {\n      const { grid } = this._activeData!\n      if (grid.keyboardOptions?.moveCellOnTab) {\n        const valueIndex = item.getAttribute('data-value-index')\n        this._doChangeValue(valueIndex || '')\n        this.detach(true)\n        grid.onKeyDownMove(e)\n        return\n      }\n    }\n    if (!e.shiftKey) {\n      if (!findNextSiblingFocusable(item)) {\n        let n: HTMLElement | null = menu.querySelector(\n          `.${ITEM_CLASSNAME_IME}`\n        ) as HTMLElement\n        if (!isFocusable(n)) {\n          n = findNextSiblingFocusable(n)\n        }\n        if (n) {\n          n.focus()\n          event.cancel(e)\n        }\n      }\n    } else {\n      if (!findPrevSiblingFocusable(item)) {\n        const items = menu.querySelectorAll(`.${ITEM_CLASSNAME_IME}`)\n        let n: HTMLElement | null = items[items.length - 1] as HTMLElement\n        if (!isFocusable(n)) {\n          n = findPrevSiblingFocusable(n)\n        }\n        if (n) {\n          n.focus()\n          event.cancel(e)\n        }\n      }\n    }\n  }\n}\n","import {\n  ColumnIconOption,\n  FontIcon,\n  ImageIcon,\n  NamedIcon,\n  PathIcon,\n  SvgIcon,\n} from '../ts-types'\nimport { SimpleColumnIconOption } from '../ts-types-internal'\nimport { isDef } from './utils'\n\ntype ColumnIconArrayOption = {\n  content?: (string | null)[]\n  font?: (string | null)[]\n  color?: (string | null)[]\n  className?: (string | null)[]\n  tagName?: (string | null)[]\n  isLiga?: (boolean | null)[]\n  width?: (number | null)[]\n  src?: (string | null)[]\n  svg?: (string | null)[]\n  name?: (string | null)[]\n  path?: (string | null)[]\n}\n\ntype IconPropKey = (\n  | keyof FontIcon<unknown>\n  | keyof ImageIcon<unknown>\n  | keyof PathIcon<unknown>\n  | keyof SvgIcon<unknown>\n  | keyof NamedIcon<unknown>\n) &\n  keyof SimpleColumnIconOption\n\nconst ICON_PROP_KEYS: IconPropKey[] = [\n  'content',\n  'font',\n  'color',\n  'className',\n  'tagName',\n  'isLiga',\n  'width',\n  'src',\n  'svg',\n  'name',\n  'path',\n]\n\nfunction quote(name: string): string {\n  const quoted = []\n  const split = name.split(/,\\s*/)\n  for (let i = 0; i < split.length; i++) {\n    const part = split[i].replace(/['\"]/g, '')\n    if (part.indexOf(' ') === -1 && !/^\\d/.test(part)) {\n      quoted.push(part)\n    } else {\n      quoted.push(`'${part}'`)\n    }\n  }\n  return quoted.join(',')\n}\n\nconst doms: {\n  [tagName: string]: HTMLElement\n} = {}\nconst props: {\n  [tagName: string]: {\n    [className: string]: {}\n  }\n} = {}\n\nfunction getIconProps(\n  tagName: string,\n  className: string\n): SimpleColumnIconOption {\n  const tagProps = props[tagName] || (props[tagName] = {})\n  if (tagProps[className]) {\n    return tagProps[className]\n  }\n  const dom = doms[tagName] || (doms[tagName] = document.createElement(tagName))\n  dom.className = className\n  document.body.appendChild(dom)\n  try {\n    const beforeStyle = (document.defaultView || window).getComputedStyle(\n      dom,\n      '::before'\n    )\n    let content = beforeStyle.getPropertyValue('content')\n    if (content === 'none') {\n      content = '' // 解决部分IE11浏览器显示\"none\"的问题，并不是所有的IE11都有此问题，原因未知、暂无法解决\n    }\n    if (content.length >= 3 && (content[0] === '\"' || content[0] === \"'\")) {\n      if (content[0] === content[content.length - 1]) {\n        content = content.substr(1, content.length - 2)\n      }\n    }\n    let font = beforeStyle.getPropertyValue('font')\n    if (!font) {\n      font = `${beforeStyle.getPropertyValue(\n        'font-style'\n      )} ${beforeStyle.getPropertyValue(\n        'font-variant'\n      )} ${beforeStyle.getPropertyValue(\n        'font-weight'\n      )} ${beforeStyle.getPropertyValue(\n        'font-size'\n      )}/${beforeStyle.getPropertyValue('line-height')} ${quote(\n        beforeStyle.getPropertyValue('font-family')\n      )}`\n    }\n    const color = beforeStyle.getPropertyValue('color')\n    const width = dom.clientWidth\n    const isLiga =\n      (beforeStyle.getPropertyValue('font-feature-settings') || '').indexOf(\n        'liga'\n      ) > -1\n\n    return (tagProps[className] = {\n      color,\n      content,\n      font,\n      isLiga,\n      width,\n    })\n  } finally {\n    document.body.removeChild(dom)\n  }\n}\n\nfunction toPropArray<T>(prop: T, count: number): (T | null)[] {\n  const result: (T | null)[] = []\n  if (Array.isArray(prop)) {\n    result.push(...prop)\n    for (let i = prop.length; i < count; i++) {\n      result.push(null)\n    }\n  } else {\n    for (let i = 0; i < count; i++) {\n      result.push(prop)\n    }\n  }\n  return result\n}\n\nfunction toSimpleArray(\n  iconProps: ColumnIconOption<unknown> | ColumnIconOption<unknown>[]\n): SimpleColumnIconOption[] {\n  if (!iconProps) {\n    return iconProps\n  } else if (Array.isArray(iconProps)) {\n    return iconProps\n  }\n\n  const workData = {} as Required<ColumnIconArrayOption>\n\n  let count = 0\n  ICON_PROP_KEYS.forEach((k) => {\n    const prop = (iconProps as any)[k]\n    if (prop) {\n      if (Array.isArray(prop)) {\n        count = Math.max(count, prop.length)\n      } else {\n        count = Math.max(count, 1)\n      }\n    }\n  })\n\n  ICON_PROP_KEYS.forEach((k) => {\n    const arr = toPropArray((iconProps as any)[k], count)\n    ;(workData as any)[k] = arr\n  })\n\n  const result: SimpleColumnIconOption[] = []\n  for (let i = 0; i < count; i++) {\n    const data = {} as SimpleColumnIconOption\n    ICON_PROP_KEYS.forEach((k) => {\n      const val = (workData as any)[k][i]\n      ;(data as any)[k] = val\n    })\n    result.push(data)\n  }\n  return result\n}\n\nfunction normarize(iconProps: SimpleColumnIconOption): SimpleColumnIconOption {\n  const data: SimpleColumnIconOption = {}\n  for (const k in iconProps) {\n    if (k === 'className') {\n      continue\n    }\n    if (isIconKey(k)) {\n      data[k] = iconProps[k] as any\n    }\n  }\n  if (iconProps.className) {\n    const prop = getIconProps(iconProps.tagName || 'i', iconProps.className)\n    for (const k in prop) {\n      if (isIconKey(k)) {\n        if (!isDef(iconProps[k])) {\n          data[k] = prop[k] as any\n        }\n      }\n    }\n  }\n  return data\n}\n\nfunction toNormarizeArray(\n  iconProps: ColumnIconOption<unknown> | ColumnIconOption<unknown>[]\n): SimpleColumnIconOption[] {\n  const icons = toSimpleArray(iconProps)\n  if (!icons) {\n    return icons\n  }\n  return icons.map((icon) => normarize(icon))\n}\nconst iconPropKeys = ICON_PROP_KEYS\n\nfunction isIconKey(k: string): k is IconPropKey {\n  return ICON_PROP_KEYS.indexOf(k as any) >= 0\n}\n\nexport const icons = {\n  toNormarizeArray,\n  iconPropKeys,\n}\n","export default class Rect {\n  public static bounds(\n    left: number,\n    top: number,\n    right: number,\n    bottom: number\n  ) {\n    return new Rect(left, top, right - left, bottom - top)\n  }\n  public static max(rect1: Rect, rect2: Rect) {\n    return Rect.bounds(\n      Math.min(rect1.left, rect2.left),\n      Math.min(rect1.top, rect2.top),\n      Math.max(rect1.right, rect2.right),\n      Math.max(rect1.bottom, rect2.bottom)\n    )\n  }\n  private _left: number\n  private _top: number\n  private _width: number\n  private _height: number\n  private _right: number | undefined\n  private _bottom: number | undefined\n  public constructor(left: number, top: number, width: number, height: number) {\n    this._left = left\n    this._top = top\n    this._width = width\n    this._height = height\n    this._right = undefined\n  }\n  public get left() {\n    return this._left\n  }\n  public set left(left) {\n    const right = this.right\n    this._left = left\n    this.right = right\n  }\n  public get top() {\n    return this._top\n  }\n  public set top(top) {\n    const bottom = this.bottom\n    this._top = top\n    this.bottom = bottom\n  }\n  public get width() {\n    return this._width\n  }\n  public set width(width) {\n    this._width = width\n    this._right = undefined\n  }\n  public get height() {\n    return this._height\n  }\n  public set height(height) {\n    this._height = height\n    this._bottom = undefined\n  }\n  public get right() {\n    return this._right !== undefined\n      ? this._right\n      : (this._right = this.left + this.width)\n  }\n  public set right(right) {\n    this._right = right\n    this.width = right - this.left\n  }\n  public get bottom() {\n    return this._bottom !== undefined\n      ? this._bottom\n      : (this._bottom = this.top + this.height)\n  }\n  public set bottom(bottom) {\n    this._bottom = bottom\n    this.height = bottom - this.top\n  }\n  public offsetLeft(offset: number) {\n    this._left += offset\n    this._right = undefined\n  }\n  public offsetTop(offset: number) {\n    this._top += offset\n    this._bottom = undefined\n  }\n  public copy() {\n    return new Rect(this.left, this.top, this.width, this.height)\n  }\n  public intersection(rect: Rect) {\n    const x0 = Math.max(this.left, rect.left)\n    const x1 = Math.min(this.left + this.width, rect.left + rect.width)\n    if (x0 <= x1) {\n      const y0 = Math.max(this.top, rect.top)\n      const y1 = Math.min(this.top + this.height, rect.top + rect.height)\n      if (y0 <= y1) {\n        return Rect.bounds(x0, y0, x1, y1)\n      }\n    }\n    return null\n  }\n  public contains(another: Rect) {\n    return (\n      this.left <= another.left &&\n      this.left + this.width >= another.left + another.width &&\n      this.top <= another.top &&\n      this.top + this.height >= another.top + another.height\n    )\n  }\n  public inPoint(x: number, y: number) {\n    return (\n      this.left <= x &&\n      this.left + this.width >= x &&\n      this.top <= y &&\n      this.top + this.height >= y\n    )\n  }\n}\n","import { icons } from '../../internal/icons'\nimport {\n  MaybePromise,\n  ColumnIconOption,\n  CellContext,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  DrawCallback,\n  CellStyle,\n  AttachCellStyle,\n} from '../../ts-types'\nimport { SimpleColumnIconOption } from '../../ts-types-internal'\nimport Rect from '../../internal/Rect'\nimport { cellInRange, obj, isPromise, isDefString } from '../../internal/utils'\nimport { Style } from '../style'\n\nexport function loadIcons(\n  icon: MaybePromise<ColumnIconOption<any> | ColumnIconOption<any>[]> | null,\n  context: CellContext,\n  helper: GridCanvasHelperAPI,\n  callback: (\n    icon: SimpleColumnIconOption[] | undefined,\n    context: CellContext\n  ) => void\n): void {\n  let argIcon = undefined\n  if (icon) {\n    if (isPromise(icon)) {\n      icon.then((i) => {\n        loadIcons(i, context.toCurrentContext(), helper, callback)\n      })\n    } else {\n      const iconList = icons.toNormarizeArray(icon)\n      iconList.forEach((i) => {\n        if (i.font && i.content) {\n          helper.testFontLoad(i.font, i.content, context)\n        }\n      })\n      argIcon = iconList\n    }\n  }\n  callback(argIcon, context)\n}\nexport function getActionTextPadding(\n  context: CellContext,\n  helper: GridCanvasHelperAPI,\n  style: Style\n) {\n  const font = style.font\n  const padding = style.padding\n  const appearance = style.appearance\n\n  const basePadding = helper.toBoxPixelArray(padding || 0, context, font)\n  const textPadding = basePadding.slice(0)\n  if (appearance !== 'none' && isDefString(appearance)) {\n    textPadding[1] += 26 // 文字距离有边框位置，右侧图标\n  }\n  return textPadding\n}\nexport function drawActionButton<T>(\n  grid: ListGridAPI<T>,\n  context: CellContext,\n  stateId: any,\n  helper: GridCanvasHelperAPI,\n  style: Style\n) {\n  const textBaseline = style.textBaseline\n  const font = style.font\n  const padding = style.padding\n  const appearance = style.appearance\n  const color = style.color\n\n  let active = false\n  const state = (grid as any)[stateId]\n  if (state) {\n    if (\n      state.mouseActiveCell &&\n      cellInRange(context.range, state.mouseActiveCell.col, state.mouseActiveCell.row)\n    ) {\n      if (state.mouseRelativePos) {\n        let rect = context.getRect()\n        const btnWidth = 32\n        rect = new Rect(\n          rect.left + rect.width - btnWidth,\n          rect.top,\n          btnWidth,\n          rect.height\n        )\n        active =\n          rect.left <= state.mouseRelativePos.x &&\n          rect.right >= state.mouseRelativePos.x &&\n          rect.top <= state.mouseRelativePos.y &&\n          rect.bottom >= state.mouseRelativePos.y\n        state.mouseActive = active\n      }\n    }\n  }\n  if (appearance !== 'none' && isDefString(appearance)) {\n    const basePadding = helper.toBoxPixelArray(padding || 0, context, font)\n    const iconPadding = basePadding.slice(0)\n    iconPadding[1] += 8 // 图标距离右边框位置\n    let icon\n    if (appearance === 'menulist-button') {\n      // draw dropdown arrow icon\n      icon = {\n        color: active ? 'rgba(0, 0, 0, .9)' : 'rgba(0, 0, 0, .54)',\n        path: 'M0 2 5 7 10 2z',\n        width: 10,\n      }\n    } else if (appearance === 'lookup-button') {\n      // draw lookup icon\n      icon = {\n        color: active ? 'rgba(0, 0, 0, .9)' : 'rgba(0, 0, 0, .54)',\n        // tslint:disable-next-line:max-line-length\n        path:\n          'M4.7997924,9.6 C2.15326327,9.6 0,7.44655046 0,4.79937714 C0,2.15261906 2.15326327,0 4.7997924,0 C7.44673673,0 9.6,2.15261906 9.6,4.79937714 C9.6,7.44655046 7.44673673,9.6 4.7997924,9.6 Z M4.79959481,0.9 C2.64922597,0.9 0.9,2.64900249 0.9,4.79918953 C0.9,6.95018703 2.64922597,8.7 4.79959481,8.7 C6.95036883,8.7 8.7,6.95018703 8.7,4.79918953 C8.7,2.64940773 6.95036883,0.9 4.79959481,0.9 Z M11.579002,12 C11.4749824,12 11.3709629,11.9593028 11.289322,11.8774707 L7.93168591,8.56830498 C7.76260228,8.39851441 7.75555713,8.11713467 7.91510908,7.93902961 C8.07631871,7.76136216 8.34237677,7.75261007 8.51104597,7.92065022 L11.8686821,11.2315664 C12.0373513,11.4004817 12.0443964,11.6822991 11.8848445,11.8608417 C11.8019603,11.9527387 11.6904812,12 11.579002,12 Z',\n        width: 12,\n      }\n    } else if (appearance === 'clear-button') {\n      // draw clear icon\n      icon = {\n        color: active ? 'rgba(0, 0, 0, .9)' : 'rgba(0, 0, 0, .54)',\n        // tslint:disable-next-line:max-line-length\n        path:\n          'M5.26896659,6.00000686 L0.152356675,11.1166168 C-0.048420546,11.317394 -0.0501211184,11.6463861 0.151753253,11.8482467 C0.355026465,12.05152 0.681179729,12.0498468 0.883383238,11.8476433 L5.99999314,6.73103342 L11.1166168,11.8476433 C11.317394,12.0484205 11.6463861,12.0501211 11.8482467,11.8482467 C12.05152,11.6449735 12.0498468,11.3188203 11.8476433,11.1166168 L6.73103341,6.00000686 L11.8476433,0.883383238 C12.0484205,0.682606017 12.0501074,0.3536139 11.8482467,0.151753253 C11.6449598,-0.0515199596 11.3188065,-0.0498468209 11.1166168,0.152356675 L6.00000686,5.2689803 L0.883383238,0.152356688 C0.682606017,-0.0484205326 0.3536139,-0.0501073814 0.151753253,0.151753266 C-0.0515199596,0.355040202 -0.0498468209,0.681193466 0.152356675,0.883383252 L5.26896659,6.00000686 Z',\n        width: 12,\n      }\n    } else if (appearance === 'date-button') {\n      // draw date icon\n      icon = {\n        color: active ? 'rgba(0, 0, 0, .9)' : 'rgba(0, 0, 0, .54)',\n        // tslint:disable-next-line:max-line-length\n        path:\n          'M5.6,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C6.8,6.2,6.7,6,6.4,6c0,0,0,0,0,0H5.6C5.3,6,5.1,6.2,5.1,6.4c0,0,0,0,0,0C5.1,6.7,5.3,6.8,5.6,6.8L5.6,6.8z M5.6,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H5.6c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C5.1,8.4,5.3,8.6,5.6,8.6L5.6,8.6z M10.3,0.9H8.6V0.4C8.6,0.2,8.4,0,8.1,0c0,0,0,0,0,0C7.9,0,7.7,0.2,7.7,0.4c0,0,0,0,0,0v0.4H4.3V0.4C4.3,0.2,4.1,0,3.9,0c0,0,0,0,0,0C3.6,0,3.4,0.2,3.4,0.4c0,0,0,0,0,0v0.4H1.7C0.8,0.9,0,1.6,0,2.6v6.8c0,0.9,0.8,1.7,1.7,1.7h8.6c0.9,0,1.7-0.8,1.7-1.7V2.6C12,1.6,11.2,0.9,10.3,0.9L10.3,0.9z M11.1,9.4c0,0.5-0.4,0.9-0.9,0.9H1.7c-0.5,0-0.9-0.4-0.9-0.9V4.3h10.3V9.4z M11.1,3.4H0.9V2.6c0-0.5,0.4-0.9,0.9-0.9h1.7v0.4c0,0.2,0.2,0.4,0.4,0.4s0.4-0.2,0.4-0.4V1.7h3.4v0.4c0,0.2,0.2,0.4,0.4,0.4c0.2,0,0.4-0.2,0.4-0.4V1.7h1.7c0.5,0,0.9,0.4,0.9,0.9L11.1,3.4L11.1,3.4z M3,8.6h0.9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H3c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C2.6,8.4,2.8,8.6,3,8.6z M8.1,6.8H9c0.2,0,0.4-0.2,0.4-0.4C9.4,6.2,9.2,6,9,6c0,0,0,0,0,0H8.1C7.9,6,7.7,6.2,7.7,6.4c0,0,0,0,0,0C7.7,6.7,7.9,6.8,8.1,6.8L8.1,6.8z M3,6.8h0.9c0.2,0,0.4-0.2,0.4-0.4C4.3,6.2,4.1,6,3.9,6c0,0,0,0,0,0H3C2.8,6,2.6,6.2,2.6,6.4c0,0,0,0,0,0C2.6,6.7,2.8,6.8,3,6.8z M8.1,8.6H9c0.2,0,0.4-0.2,0.4-0.4c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0H8.1c-0.2,0-0.4,0.2-0.4,0.4c0,0,0,0,0,0C7.7,8.4,7.9,8.6,8.1,8.6z',\n        width: 12,\n      }\n    } else if (typeof appearance === 'function') {\n      icon = appearance(active)\n    } else if (obj.isObject(appearance)) {\n      icon = appearance\n    } else {\n      window.console.warn(`unsupported appearance:${appearance}`)\n    }\n    if (icon) {\n      // 绘制按钮图标时，不应影响到 overflowText\n      const cellOverflowText =\n        grid.getCellOverflowText(context.col, context.row) || ''\n      helper.text('', context, {\n        color,\n        font,\n        icons: [icon],\n        padding: iconPadding,\n        textAlign: 'right',\n        textBaseline,\n      })\n      grid.setCellOverflowText(context.col, context.row, cellOverflowText)\n    }\n  }\n}\nexport function customDraw<T>(\n  helper: GridCanvasHelperAPI,\n  draw: DrawCallback | undefined,\n  value: any,\n  context: CellContext,\n  grid: ListGridAPI<T>,\n  record: unknown\n) {\n  let b = false\n  if (draw) {\n    const rect = context.getRect()\n    const row = context.row\n    const col = context.col\n    const selection = context.getSelection()\n    const opt = {\n      grid,\n      record,\n      rect,\n      row,\n      col,\n      selection,\n    }\n    helper.drawWithClip(context, (ctx) => {\n      b = draw(value, ctx, opt) === false\n    })\n  }\n  return b\n}\nexport function isAttachArea<T>(record: T, cellStyle?: CellStyle) {\n  let s: AttachCellStyle | undefined\n  if (typeof cellStyle === 'function') {\n    s = cellStyle(record)\n  } else {\n    s = cellStyle\n  }\n  let b = false\n  if (s && s.innerBox === 'dashed') {\n    b = true\n  }\n  return b\n}\n\nexport function reviseAttachCellsArea<T>(\n  rect: Rect,\n  row: number,\n  grid: ListGridAPI<T>,\n  cellStyle?: CellStyle\n) {\n  const record = grid.getRowRecord(row)\n  if (isAttachArea(record, cellStyle)) {\n    rect.left += 4\n    rect.top += 4\n    rect.right -= 4\n    rect.bottom -= 4\n  }\n}\nexport function reviseAttachCellsPadding<T>(\n  padding: [number, number, number, number],\n  row: number,\n  grid: ListGridAPI<T>,\n  cellStyle?: CellStyle\n) {\n  const record = grid.getRowRecord(row)\n  if (isAttachArea(record, cellStyle)) {\n    padding[3] -= 4\n    if (padding[3] < 0) {\n      padding[3] = 0\n    }\n    padding[1] -= 4\n    if (padding[1] < 0) {\n      padding[1] = 0\n    }\n  }\n}\nexport function drawAttachArea<T>(\n  grid: ListGridAPI<T>,\n  record: unknown,\n  context: CellContext,\n  helper: GridCanvasHelperAPI,\n  cellStyle?: CellStyle\n) {\n  if (isAttachArea(record, cellStyle)) {\n    const rect = context.getRect()\n    rect.top += 4\n    rect.right -= 4\n    rect.bottom -= 4\n    rect.left += 4\n    helper.attachArea(rect, context)\n  }\n}\n","import { AnyListener, EventListenerId } from '../ts-types'\nimport { each, isDef } from '../internal/utils'\n\nimport { getEventTargetSymbol } from '../internal/symbolManager'\nconst _ = getEventTargetSymbol()\n\nlet eventTargetNextId = 1\n\n/**\n * event target.\n */\nexport class EventTarget {\n  private [_]: {\n    listeners: { [type: string]: AnyListener[] }\n    listenerData: {\n      [id: number]: {\n        type: string\n        listener: AnyListener\n        remove: () => void\n      }\n    }\n  } = {\n    listeners: {},\n    listenerData: {},\n  }\n  /**\n   * Adds an event listener.\n   * @param type - The event type id.\n   * @param listener - Callback method.\n   * @returns unique id for the listener.\n   */\n  public listen(type: string, listener: AnyListener): EventListenerId {\n    const list = this[_].listeners[type] || (this[_].listeners[type] = [])\n    list.push(listener)\n\n    const id = eventTargetNextId++\n    this[_].listenerData[id] = {\n      listener,\n      remove: () => {\n        delete this[_].listenerData[id]\n        const index = list.indexOf(listener)\n        list.splice(index, 1)\n        if (!this[_].listeners[type].length) {\n          delete this[_].listeners[type]\n        }\n      },\n      type,\n    }\n    return id\n  }\n  /**\n   * Removes an event listener which was added with listen() by the id returned by listen().\n   * @param id - the id returned by listen().\n   * @returns\n   */\n  public unlisten(id: EventListenerId): void {\n    if (!this[_]) {\n      return\n    }\n    this[_].listenerData[id].remove()\n  }\n  /**\n   * Adds an event listener.\n   * @param type - The event type id.\n   * @param listener - Callback method.\n   * @returns\n   */\n  public addEventListener(type: string, listener: AnyListener): void {\n    this.listen(type, listener)\n  }\n  /**\n   * Removes an event listener.\n   * @param type - The event type id.\n   * @param listener - Callback method.\n   * @returns\n   */\n  public removeEventListener(type: string, listener: AnyListener): void {\n    if (!this[_]) {\n      return\n    }\n    each(this[_].listenerData, (obj, id) => {\n      if (obj.type === type && obj.listener === listener) {\n        this.unlisten(id as number)\n      }\n    })\n  }\n  /**\n   * @param type - The event type id.\n   * @returns\n   */\n  public hasListeners(type: string): boolean {\n    return !!this[_].listeners[type]\n  }\n  /**\n   * Fires all registered listeners\n   * @param type - The type of the listeners to fire.\n   * @param args - fire arguments\n   * @returns the result of the last listener\n   */\n  public fireListeners(type: string, ...args: any[]): any[] {\n    const list = this[_].listeners[type]\n    if (!list) {\n      return []\n    }\n    return list.map((listener) => listener.call(this, ...args)).filter(isDef)\n  }\n  /**\n   * @returns\n   */\n  public dispose(): void {}\n}\n","import { ColumnStyle, ColorDef, BaseStyleOption } from '../../ts-types'\nimport { EventTarget } from '../../core/EventTarget'\n\nconst BASE_STYLE_EVENT_TYPE = {\n  CHANGE_STYLE: 'change_style' as const,\n}\n\nlet defaultBaseStyle: BaseStyle\n\nexport class BaseStyle extends EventTarget implements ColumnStyle {\n  public static get EVENT_TYPE(): { CHANGE_STYLE: 'change_style' } {\n    return BASE_STYLE_EVENT_TYPE\n  }\n  public static get DEFAULT(): BaseStyle {\n    return defaultBaseStyle\n      ? defaultBaseStyle\n      : (defaultBaseStyle = new BaseStyle())\n  }\n  private _bgColor?: ColorDef\n  public constructor({ bgColor }: BaseStyleOption = {}) {\n    super()\n    this._bgColor = bgColor\n  }\n  public get bgColor(): ColorDef | undefined {\n    return this._bgColor\n  }\n  public set bgColor(bgColor) {\n    this._bgColor = bgColor\n    this.doChangeStyle()\n  }\n  public doChangeStyle(): void {\n    this.fireListeners(BASE_STYLE_EVENT_TYPE.CHANGE_STYLE)\n  }\n  public clone(): BaseStyle {\n    return new BaseStyle(this)\n  }\n}\n","import { BaseStdStyleOption } from '../../ts-types'\nimport { BaseStyle } from './BaseStyle'\n\nlet defaultBaseStdStyle: BaseStdStyle\n\nexport class BaseStdStyle extends BaseStyle {\n  public static get DEFAULT(): BaseStdStyle {\n    return defaultBaseStdStyle\n      ? defaultBaseStdStyle\n      : (defaultBaseStdStyle = new BaseStdStyle())\n  }\n  private _textAlign: CanvasTextAlign\n  private _textBaseline: CanvasTextBaseline\n  public constructor(style: BaseStdStyleOption = {}) {\n    super(style)\n    this._textAlign = style.textAlign || 'left'\n    this._textBaseline = style.textBaseline || 'middle'\n  }\n  public get textAlign(): CanvasTextAlign {\n    return this._textAlign\n  }\n  public set textAlign(textAlign) {\n    this._textAlign = textAlign\n    this.doChangeStyle()\n  }\n  public get textBaseline(): CanvasTextBaseline {\n    return this._textBaseline\n  }\n  public set textBaseline(textBaseline) {\n    this._textBaseline = textBaseline\n    this.doChangeStyle()\n  }\n  public clone(): BaseStdStyle {\n    return new BaseStdStyle(this)\n  }\n}\n","import { ColorDef, BaseCheckStyleOption } from '../../ts-types'\nimport { BaseStdStyle } from './BaseStdStyle'\nimport { defaults } from '../../internal/utils'\n\nlet defaultBaseCheckStyle: BaseCheckStyle\n\nexport class BaseCheckStyle extends BaseStdStyle {\n  public static get DEFAULT(): BaseCheckStyle {\n    return defaultBaseCheckStyle\n      ? defaultBaseCheckStyle\n      : (defaultBaseCheckStyle = new BaseCheckStyle())\n  }\n  private _uncheckBgColor?: ColorDef\n  private _checkBgColor?: ColorDef\n  private _borderColor?: ColorDef\n  public constructor(style: BaseCheckStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n    const { uncheckBgColor, checkBgColor, borderColor } = style\n    this._uncheckBgColor = uncheckBgColor\n    this._checkBgColor = checkBgColor\n    this._borderColor = borderColor\n  }\n  public get uncheckBgColor(): ColorDef | undefined {\n    return this._uncheckBgColor\n  }\n  public set uncheckBgColor(uncheckBgColor) {\n    this._uncheckBgColor = uncheckBgColor\n    this.doChangeStyle()\n  }\n  public get checkBgColor(): ColorDef | undefined {\n    return this._checkBgColor\n  }\n  public set checkBgColor(checkBgColor) {\n    this._checkBgColor = checkBgColor\n    this.doChangeStyle()\n  }\n  public get borderColor(): ColorDef | undefined {\n    return this._borderColor\n  }\n  public set borderColor(borderColor) {\n    this._borderColor = borderColor\n    this.doChangeStyle()\n  }\n  public clone(): BaseCheckStyle {\n    return new BaseCheckStyle(this)\n  }\n}\n","import { ColorDef, TextOverflow, StyleOption, Appearance } from '../../ts-types'\nimport { BaseStdStyle } from './BaseStdStyle'\n\nlet defaultStyle: Style\n\nexport class Style extends BaseStdStyle {\n  public static get DEFAULT(): Style {\n    return defaultStyle ? defaultStyle : (defaultStyle = new Style())\n  }\n  private _color?: ColorDef\n  private _font?: string\n  private _padding?: number | string | (number | string)[]\n  private _inputPadding?: number | string | (number | string)[]\n  private _textOverflow: TextOverflow\n  private _appearance: Appearance\n  public constructor(style: StyleOption = {}) {\n    super(style)\n    this._color = style.color\n    this._font = style.font\n    this._padding = style.padding\n    this._inputPadding = style.inputPadding\n    this._textOverflow = style.textOverflow || 'clip'\n    this._appearance = style.appearance || 'none'\n  }\n  public get color(): ColorDef | undefined {\n    return this._color\n  }\n  public set color(color) {\n    this._color = color\n    this.doChangeStyle()\n  }\n  public get font(): string | undefined {\n    return this._font\n  }\n  public set font(font) {\n    this._font = font\n    this.doChangeStyle()\n  }\n  public get padding(): number | string | (number | string)[] | undefined {\n    return this._padding\n  }\n  public set padding(padding) {\n    this._padding = padding\n    this.doChangeStyle()\n  }\n  public get inputPadding(): number | string | (number | string)[] | undefined {\n    return this._inputPadding\n  }\n  public set inputPadding(inputPadding) {\n    this._inputPadding = inputPadding\n    this.doChangeStyle()\n  }\n  public get textOverflow(): TextOverflow {\n    return this._textOverflow\n  }\n  public set textOverflow(textOverflow) {\n    this._textOverflow = textOverflow\n    this.doChangeStyle()\n  }\n  public get appearance(): Appearance {\n    return this._appearance\n  }\n  public set appearance(appearance) {\n    this._appearance = appearance\n    this.doChangeStyle()\n  }\n  public clone(): Style {\n    return new Style(this)\n  }\n}\n","import { ButtonStyleOption, ColorDef } from '../../ts-types'\nimport { Style } from './Style'\nimport { defaults } from '../../internal/utils'\n\nlet defaultButtonStyle: ButtonStyle\n\nexport class ButtonStyle extends Style {\n  public static get DEFAULT() {\n    return defaultButtonStyle\n      ? defaultButtonStyle\n      : (defaultButtonStyle = new ButtonStyle())\n  }\n  private _buttonBgColor?: ColorDef\n  public constructor(style: ButtonStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n    this._buttonBgColor = style.buttonBgColor\n  }\n  public get buttonBgColor(): ColorDef | undefined {\n    return this._buttonBgColor\n  }\n  public set buttonBgColor(buttonBgColor) {\n    this._buttonBgColor = buttonBgColor\n    this.doChangeStyle()\n  }\n  public clone(): ButtonStyle {\n    return new ButtonStyle(this)\n  }\n}\n","import { CheckStyleOption } from '../../ts-types'\nimport { BaseCheckStyle } from './BaseCheckStyle'\n\nlet defaultCheckStyle: CheckStyle\n\nexport class CheckStyle extends BaseCheckStyle {\n  public static get DEFAULT(): CheckStyle {\n    return defaultCheckStyle\n      ? defaultCheckStyle\n      : (defaultCheckStyle = new CheckStyle())\n  }\n  public constructor(style: CheckStyleOption = {}) {\n    super(style)\n  }\n  public clone(): CheckStyle {\n    return new CheckStyle(this)\n  }\n}\n","import { SwitchStyleOption } from '../../ts-types'\nimport { BaseCheckStyle } from './BaseCheckStyle'\n\nlet defaultSwitchStyle: SwitchStyle\n\nexport class SwitchStyle extends BaseCheckStyle {\n  public static get DEFAULT(): SwitchStyle {\n    return defaultSwitchStyle\n      ? defaultSwitchStyle\n      : (defaultSwitchStyle = new SwitchStyle())\n  }\n  public constructor(style: SwitchStyleOption = {}) {\n    super(style)\n  }\n  public clone(): SwitchStyle {\n    return new SwitchStyle(this)\n  }\n}\n","import { DateStyleOption } from '../../ts-types'\nimport { Style } from './Style'\n\nfunction adjustDateTimeStyleOption(style: DateStyleOption): DateStyleOption {\n  style.textAlign = style.textAlign || 'right'\n  return style\n}\n\nlet defaultDateStyle: DateStyle\n\nexport class DateStyle extends Style {\n  public static get DEFAULT(): DateStyle {\n    return defaultDateStyle\n      ? defaultDateStyle\n      : (defaultDateStyle = new DateStyle())\n  }\n  public constructor(style: DateStyleOption = {}) {\n    super(adjustDateTimeStyleOption(style))\n  }\n  public clone(): DateStyle {\n    return new DateStyle(this)\n  }\n}\n","import { DrawStyleOption, Appearance } from '../../ts-types'\nimport { BaseStyle } from './BaseStyle'\n\nlet defaultDrawStyle: DrawStyle\n\nexport class DrawStyle extends BaseStyle {\n  private _appearance: Appearance\n  public static get DEFAULT(): DrawStyle {\n    return defaultDrawStyle\n      ? defaultDrawStyle\n      : (defaultDrawStyle = new DrawStyle())\n  }\n  public constructor(style: DrawStyleOption = {}) {\n    super(style)\n    this._appearance = style.appearance || 'none'\n  }\n  public get appearance(): Appearance {\n    return this._appearance\n  }\n  public set appearance(appearance) {\n    this._appearance = appearance\n    this.doChangeStyle()\n  }\n  public clone(): DrawStyle {\n    return new DrawStyle(this)\n  }\n}\n","import { IconStyleOption } from '../../ts-types'\nimport { Style } from './Style'\nimport { defaults } from '../../internal/utils'\n\nlet defaultIconStyle: IconStyle\n\nexport class IconStyle extends Style {\n  public static get DEFAULT() {\n    return defaultIconStyle\n      ? defaultIconStyle\n      : (defaultIconStyle = new IconStyle())\n  }\n  public constructor(style: IconStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n  }\n  public clone(): IconStyle {\n    return new IconStyle(this)\n  }\n}\n","import { ImageStyleOption, Appearance } from '../../ts-types'\nimport { BaseStdStyle } from './BaseStdStyle'\nimport { defaults } from '../../internal/utils'\n\nlet defaultImageStyle: ImageStyle\n\nexport class ImageStyle extends BaseStdStyle {\n  public static get DEFAULT(): ImageStyle {\n    return defaultImageStyle\n      ? defaultImageStyle\n      : (defaultImageStyle = new ImageStyle())\n  }\n  private _margin: number\n  private _imageSizing?: 'keep-aspect-ratio'\n  private _appearance?: Appearance\n  public constructor(style: ImageStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n    this._imageSizing = style.imageSizing\n    this._margin = style.margin || 4\n    this._appearance = style.appearance || 'none'\n  }\n  public get imageSizing(): 'keep-aspect-ratio' | undefined {\n    return this._imageSizing\n  }\n  public set imageSizing(imageSizing) {\n    this._imageSizing = imageSizing\n    this.doChangeStyle()\n  }\n  public get margin(): number {\n    return this._margin\n  }\n  public set margin(margin) {\n    this._margin = margin\n    this.doChangeStyle()\n  }\n  public get appearance(): Appearance | undefined {\n    return this._appearance\n  }\n  public set appearance(appearance) {\n    this._appearance = appearance\n    this.doChangeStyle()\n  }\n  public clone(): ImageStyle {\n    return new ImageStyle(this)\n  }\n}\n","import { LookupStyleOption } from '../../ts-types'\nimport { Style } from './Style'\nimport { defaults } from '../../internal/utils'\n\nlet defaultLookupStyle: LookupStyle\n\nexport class LookupStyle extends Style {\n  public static get DEFAULT() {\n    return defaultLookupStyle\n      ? defaultLookupStyle\n      : (defaultLookupStyle = new LookupStyle())\n  }\n  public constructor(style: LookupStyleOption = {}) {\n    super(defaults(style, { textAlign: 'left' }))\n    this.appearance = style.appearance || 'menulist-button'\n  }\n  public clone(): LookupStyle {\n    return new LookupStyle(this)\n  }\n}\n","import { MenuStyleOption } from '../../ts-types'\nimport { Style } from './Style'\n\nlet defaultMenuStyle: MenuStyle\n\nexport class MenuStyle extends Style {\n  public static get DEFAULT(): MenuStyle {\n    return defaultMenuStyle\n      ? defaultMenuStyle\n      : (defaultMenuStyle = new MenuStyle())\n  }\n  public constructor(style: MenuStyleOption = {}) {\n    super(style)\n    this.appearance = style.appearance || 'menulist-button'\n  }\n  public clone(): MenuStyle {\n    return new MenuStyle(this)\n  }\n}\n","import { LineClamp, MultilineTextStyleOption } from '../../ts-types'\nimport { Style } from './Style'\nimport { defaults } from '../../internal/utils'\n\nlet defaultMultilineTextStyle: MultilineTextStyle\n\nexport class MultilineTextStyle extends Style {\n  public static get DEFAULT() {\n    return defaultMultilineTextStyle\n      ? defaultMultilineTextStyle\n      : (defaultMultilineTextStyle = new MultilineTextStyle())\n  }\n  private _lineHeight: string | number\n  private _autoWrapText: boolean\n  private _lineClamp: LineClamp\n  public constructor(style: MultilineTextStyleOption = {}) {\n    super(defaults(style, { textBaseline: 'middle', textOverflow: 'ellipsis' }))\n    this._lineHeight = style.lineHeight || '1em'\n    this._autoWrapText = style.autoWrapText || false\n    this._lineClamp = style.lineClamp || 'auto'\n  }\n  public clone() {\n    return new MultilineTextStyle(this)\n  }\n  public get lineHeight(): string | number {\n    return this._lineHeight\n  }\n  public set lineHeight(lineHeight) {\n    this._lineHeight = lineHeight\n    this.doChangeStyle()\n  }\n  public get lineClamp(): LineClamp {\n    return this._lineClamp\n  }\n  public set lineClamp(lineClamp) {\n    this._lineClamp = lineClamp\n    this.doChangeStyle()\n  }\n  public get autoWrapText(): boolean {\n    return this._autoWrapText\n  }\n  public set autoWrapText(autoWrapText) {\n    this._autoWrapText = autoWrapText\n    this.doChangeStyle()\n  }\n}\n","import { NumberStyleOption } from '../../ts-types'\nimport { Style } from './Style'\nimport { defaults } from '../../internal/utils'\n\nlet defaultNumberStyle: NumberStyle\n\nexport class NumberStyle extends Style {\n  public static get DEFAULT() {\n    return defaultNumberStyle\n      ? defaultNumberStyle\n      : (defaultNumberStyle = new NumberStyle())\n  }\n  public constructor(style: NumberStyleOption = {}) {\n    super(defaults(style, { textAlign: 'right' }))\n  }\n  public clone(): NumberStyle {\n    return new NumberStyle(this)\n  }\n}\n","import { PercentCompleteBarStyleOption, ColorDef } from '../../ts-types'\nimport { Style } from './Style'\n\nlet defaultPercentCompleteBarStyle: PercentCompleteBarStyle\n\nconst DEFAULT_BAR_COLOR = (num: number): string => {\n  if (num > 80) {\n    return '#20a8d8'\n  }\n  if (num > 50) {\n    return '#4dbd74'\n  }\n  if (num > 20) {\n    return '#ffc107'\n  }\n  return '#f86c6b'\n}\n\nexport class PercentCompleteBarStyle extends Style {\n  public static get DEFAULT(): PercentCompleteBarStyle {\n    return defaultPercentCompleteBarStyle\n      ? defaultPercentCompleteBarStyle\n      : (defaultPercentCompleteBarStyle = new PercentCompleteBarStyle())\n  }\n  private _barColor: ColorDef | ((num: number) => ColorDef)\n  private _barBgColor: ColorDef\n  private _barHeight: number\n  public constructor(style: PercentCompleteBarStyleOption = {}) {\n    super(style)\n    this._barColor = style.barColor || DEFAULT_BAR_COLOR\n    this._barBgColor = style.barBgColor || '#f0f3f5'\n    this._barHeight = style.barHeight || 3\n  }\n  public get barColor(): ColorDef | ((num: number) => ColorDef) {\n    return this._barColor\n  }\n  public set barColor(barColor) {\n    this._barColor = barColor\n    this.doChangeStyle()\n  }\n  public get barBgColor(): ColorDef {\n    return this._barBgColor\n  }\n  public set barBgColor(barBgColor) {\n    this._barBgColor = barBgColor\n    this.doChangeStyle()\n  }\n  public get barHeight(): number {\n    return this._barHeight\n  }\n  public set barHeight(barHeight) {\n    this._barHeight = barHeight\n    this.doChangeStyle()\n  }\n  public clone(): PercentCompleteBarStyle {\n    return new PercentCompleteBarStyle(this)\n  }\n}\n","import { ColorDef, RadioStyleOption } from '../../ts-types'\nimport { BaseStdStyle } from './BaseStdStyle'\nimport { defaults } from '../../internal/utils'\n\nlet defaultRadioStyle: RadioStyle\nexport class RadioStyle extends BaseStdStyle {\n  public static get DEFAULT(): RadioStyle {\n    return defaultRadioStyle\n      ? defaultRadioStyle\n      : (defaultRadioStyle = new RadioStyle())\n  }\n  private _checkColor?: ColorDef\n  private _uncheckBorderColor?: ColorDef\n  private _checkBorderColor?: ColorDef\n  private _uncheckBgColor?: ColorDef\n  private _checkBgColor?: ColorDef\n  public constructor(style: RadioStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n    const {\n      checkColor,\n      uncheckBorderColor,\n      checkBorderColor,\n      uncheckBgColor,\n      checkBgColor,\n    } = style\n    this._checkColor = checkColor\n    this._uncheckBorderColor = uncheckBorderColor\n    this._checkBorderColor = checkBorderColor\n    this._uncheckBgColor = uncheckBgColor\n    this._checkBgColor = checkBgColor\n  }\n  public get checkColor(): ColorDef | undefined {\n    return this._checkColor\n  }\n  public set checkColor(checkColor) {\n    this._checkColor = checkColor\n    this.doChangeStyle()\n  }\n  public get uncheckBorderColor(): ColorDef | undefined {\n    return this._uncheckBorderColor\n  }\n  public set uncheckBorderColor(uncheckBorderColor) {\n    this._uncheckBorderColor = uncheckBorderColor\n    this.doChangeStyle()\n  }\n  public get checkBorderColor(): ColorDef | undefined {\n    return this._checkBorderColor\n  }\n  public set checkBorderColor(checkBorderColor) {\n    this._checkBorderColor = checkBorderColor\n    this.doChangeStyle()\n  }\n  public get uncheckBgColor(): ColorDef | undefined {\n    return this._uncheckBgColor\n  }\n  public set uncheckBgColor(uncheckBgColor) {\n    this._uncheckBgColor = uncheckBgColor\n    this.doChangeStyle()\n  }\n  public get checkBgColor(): ColorDef | undefined {\n    return this._checkBgColor\n  }\n  public set checkBgColor(checkBgColor) {\n    this._checkBgColor = checkBgColor\n    this.doChangeStyle()\n  }\n  public clone(): RadioStyle {\n    return new RadioStyle(this)\n  }\n}\n","import { TreeStyleOption, ColorDef, LineClamp } from '../../ts-types'\nimport { Style } from './Style'\n\nfunction adjustTreeStyleOption(style: TreeStyleOption) {\n  style.textAlign = style.textAlign || 'left'\n  return style\n}\n\nlet defaultTreeStyle: TreeStyle\n\nexport class TreeStyle extends Style {\n  public static get DEFAULT(): TreeStyle {\n    return defaultTreeStyle\n      ? defaultTreeStyle\n      : (defaultTreeStyle = new TreeStyle())\n  }\n  private _lineColor?: ColorDef\n  private _buttonColor?: ColorDef\n  private _buttonBgColor?: ColorDef\n  private _buttonBorderColor?: ColorDef\n  private _linkColor?: ColorDef\n  private _lineHeight: string | number\n  private _autoWrapText: boolean\n  private _lineClamp: LineClamp\n  public constructor(style: TreeStyleOption = {}) {\n    super(adjustTreeStyleOption(style))\n    this._lineColor = style.lineColor\n    this._buttonColor = style.buttonColor\n    this._buttonBgColor = style.buttonBgColor\n    this._buttonBorderColor = style.buttonBorderColor\n    this._linkColor = style.linkColor\n    this._lineHeight = style.lineHeight || '1em'\n    this._autoWrapText = style.autoWrapText || false\n    this._lineClamp = style.lineClamp || 'auto'\n  }\n  public get lineColor(): ColorDef | undefined {\n    return this._lineColor\n  }\n  public set lineColor(lineColor) {\n    this._lineColor = lineColor\n    this.doChangeStyle()\n  }\n  public get buttonColor(): ColorDef | undefined {\n    return this._buttonColor\n  }\n  public set buttonColor(buttonColor) {\n    this._buttonColor = buttonColor\n    this.doChangeStyle()\n  }\n  public get buttonBgColor(): ColorDef | undefined {\n    return this._buttonBgColor\n  }\n  public set buttonBgColor(buttonBgColor) {\n    this._buttonBgColor = buttonBgColor\n    this.doChangeStyle()\n  }\n  public get buttonBorderColor(): ColorDef | undefined {\n    return this._buttonBorderColor\n  }\n  public set buttonBorderColor(buttonBorderColor) {\n    this._buttonBorderColor = buttonBorderColor\n    this.doChangeStyle()\n  }\n  public get linkColor(): ColorDef | undefined {\n    return this._linkColor\n  }\n  public set linkColor(linkColor) {\n    this._linkColor = linkColor\n    this.doChangeStyle()\n  }\n  public get lineHeight(): string | number {\n    return this._lineHeight\n  }\n  public set lineHeight(lineHeight) {\n    this._lineHeight = lineHeight\n    this.doChangeStyle()\n  }\n  public get lineClamp(): LineClamp {\n    return this._lineClamp\n  }\n  public set lineClamp(lineClamp) {\n    this._lineClamp = lineClamp\n    this.doChangeStyle()\n  }\n  public get autoWrapText(): boolean {\n    return this._autoWrapText\n  }\n  public set autoWrapText(autoWrapText) {\n    this._autoWrapText = autoWrapText\n    this.doChangeStyle()\n  }\n  public clone(): TreeStyle {\n    return new TreeStyle(this)\n  }\n}\n","import { ColumnStyleOption } from '../ts-types'\nimport { BaseStyle } from './style/BaseStyle'\nimport { BaseStdStyle } from './style/BaseStdStyle'\nimport { BaseCheckStyle } from './style/BaseCheckStyle'\nimport { ButtonStyle } from './style/ButtonStyle'\nimport { CheckStyle } from './style/CheckStyle'\nimport { SwitchStyle } from './style/SwitchStyle'\nimport { DateStyle } from './style/DateStyle'\nimport { DrawStyle } from './style/DrawStyle'\nimport { IconStyle } from './style/IconStyle'\nimport { ImageStyle } from './style/ImageStyle'\nimport { LookupStyle } from './style/LookupStyle'\nimport { MenuStyle } from './style/MenuStyle'\nimport { MultilineTextStyle } from './style/MultilineTextStyle'\nimport { NumberStyle } from './style/NumberStyle'\nimport { PercentCompleteBarStyle } from './style/PercentCompleteBarStyle'\nimport { RadioStyle } from './style/RadioStyle'\nimport { Style } from './style/Style'\nimport { TreeStyle } from './style/TreeStyle'\n\nconst { EVENT_TYPE } = BaseStyle\nexport {\n  EVENT_TYPE,\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style,\n  NumberStyle,\n  CheckStyle,\n  RadioStyle,\n  SwitchStyle,\n  ButtonStyle,\n  ImageStyle,\n  IconStyle,\n  PercentCompleteBarStyle,\n  MultilineTextStyle,\n  MenuStyle,\n  DateStyle,\n  LookupStyle,\n  TreeStyle,\n  DrawStyle,\n}\n\nexport function of(\n  columnStyle: ColumnStyleOption | null | undefined,\n  record: any,\n  StyleClassDef: typeof BaseStyle = Style\n): BaseStyle {\n  if (columnStyle) {\n    if (columnStyle instanceof BaseStyle) {\n      return columnStyle\n    } else if (typeof columnStyle === 'function') {\n      return of(columnStyle(record), record, StyleClassDef)\n    } else if (\n      typeof columnStyle === 'string' &&\n      record &&\n      columnStyle in record\n    ) {\n      return of(record[columnStyle], record, StyleClassDef)\n    }\n    return new StyleClassDef(columnStyle as any)\n  } else {\n    return StyleClassDef.DEFAULT\n  }\n}\n","import * as styleContents from '../style'\nimport {\n  BaseColumnOption,\n  CellAddress,\n  CellContext,\n  ColumnTypeAPI,\n  EventListenerId,\n  GridCanvasHelperAPI,\n  LayoutObjectId,\n  ListGridAPI,\n  MaybePromise,\n  Message,\n  Convert,\n} from '../../ts-types'\nimport {\n  DrawCellInfo,\n  ColumnFadeinState,\n  GridInternal,\n} from '../../ts-types-internal'\nimport {\n  obj,\n  isDef,\n  getOrApply,\n  isPromise,\n  cellInRange,\n} from '../../internal/utils'\nimport { BaseStyle } from '../style/BaseStyle'\nimport { Style } from '../style/Style'\nimport { animate } from '../../internal/animate'\nimport Rect from '../../internal/Rect'\nimport { getColumnFadeinStateId } from '../../internal/symbolManager'\nimport { getInlineEditingState } from '../utils'\n\nconst COLUMN_FADEIN_STATE_ID = getColumnFadeinStateId()\n\nfunction getFadinState<T>(grid: GridInternal<T>): ColumnFadeinState {\n  let state = grid[COLUMN_FADEIN_STATE_ID]\n  if (!state) {\n    state = { cells: {} }\n    obj.setReadonly(grid, COLUMN_FADEIN_STATE_ID, state)\n  }\n  return state\n}\nfunction _generateFadinPointAction<T>(\n  grid: ListGridAPI<T>,\n  col: number,\n  row: number,\n  context: CellContext,\n  drawInternal: () => void,\n  drawCellBase: () => void\n): (point: number) => void {\n  return (point: number) => {\n    const state = getFadinState(grid)\n    const stateKey = `${col}:${row}`\n    if (point === 1) {\n      delete state.cells[stateKey]\n    } else {\n      state.cells[stateKey] = {\n        opacity: point,\n      }\n    }\n    drawCellBase()\n\n    drawInternal()\n\n    const cellState = state.cells[stateKey]\n    if (cellState) {\n      // 透明背景覆盖透明度\n      const ctx = context.getContext()\n      ctx.globalAlpha = 1 - cellState.opacity\n      try {\n        drawCellBase()\n      } finally {\n        ctx.globalAlpha = 1\n      }\n    }\n  }\n}\nconst fadinMgr = {\n  animate<T>(\n    grid: ListGridAPI<T>,\n    col: number,\n    row: number,\n    context: CellContext,\n    drawInternal: () => void,\n    drawCellBase: () => void\n  ): void {\n    // fadein animation\n    const state = getFadinState(grid)\n\n    const activeFadeins = [\n      _generateFadinPointAction(\n        grid,\n        col,\n        row,\n        context,\n        drawInternal,\n        drawCellBase\n      ),\n    ]\n    state.activeFadeins = activeFadeins\n\n    animate(500, (point) => {\n      activeFadeins.forEach((f) => f(point))\n      if (point === 1) {\n        delete state.activeFadeins\n      }\n    })\n  },\n  margeAnimate<T>(\n    grid: ListGridAPI<T>,\n    col: number,\n    row: number,\n    context: CellContext,\n    drawInternal: () => void,\n    drawCellBase: () => void\n  ): void {\n    const state = getFadinState(grid)\n    if (state.activeFadeins) {\n      state.activeFadeins.push(\n        _generateFadinPointAction(\n          grid,\n          col,\n          row,\n          context,\n          drawInternal,\n          drawCellBase\n        )\n      )\n    } else {\n      drawInternal()\n    }\n  },\n}\n\nexport abstract class BaseColumn<T, V> implements ColumnTypeAPI {\n  private _convert?: Convert\n  private _convertCopy?: Convert\n  private _fadeinWhenCallbackInPromise: boolean\n  private _hidden?: boolean | ((record: T) => boolean)\n  public constructor(options: BaseColumnOption<T> = {}) {\n    this.onDrawCell = this.onDrawCell.bind(this) // 修复范围\n\n    this._convert = options.convert\n    this._convertCopy = options.convertCopy\n    this._hidden = options.hidden\n\n    // 使用Promise的回调显示淡入\n    this._fadeinWhenCallbackInPromise =\n      options.fadeinWhenCallbackInPromise || false\n  }\n  public get StyleClass(): typeof BaseStyle {\n    return BaseStyle\n  }\n  public get fadeinWhenCallbackInPromise(): boolean | undefined {\n    return this._fadeinWhenCallbackInPromise\n  }\n  public get convert(): Convert | undefined {\n    return this._convert\n  }\n  public get convertCopy(): Convert | undefined {\n    return this._convertCopy\n  }\n  public get hidden(): boolean | ((record: T) => boolean) | undefined {\n    return this._hidden\n  }\n  public set hidden(hidden) {\n    this._hidden = hidden\n  }\n  public reviseAttachCellsArea(\n    _rect: Rect,\n    _row: number,\n    _grid: ListGridAPI<T>\n  ) {\n    // nothing\n  }\n  public reviseAttachCellsPadding(\n    padding: [number, number, number, number],\n    row: number,\n    grid: ListGridAPI<T>\n  ) {\n    const state = getInlineEditingState(grid)\n    if (state.inputPadding) {\n      padding[0] += state.inputPadding[0]\n      padding[1] += state.inputPadding[1]\n      padding[2] += state.inputPadding[2]\n      padding[3] += state.inputPadding[3]\n    }\n  }\n  public reviseFocusRect(_rect: Rect, _row: number, _grid: ListGridAPI<T>) {\n    // nothing\n  }\n  public onDrawCell(\n    cellValue: MaybePromise<unknown>,\n    info: DrawCellInfo<T>,\n    context: CellContext,\n    grid: ListGridAPI<T>\n  ): void | Promise<void> {\n    const {\n      style,\n      getRecord,\n      clearCellBase,\n      drawCellBase,\n      getCell,\n      getContentHidden,\n    } = info\n\n    const record = getRecord() as T\n    const helper = grid.getGridCanvasHelper()\n    const state = getInlineEditingState(grid)\n    if (\n      state.cellRange &&\n      cellInRange(state.cellRange, context.col, context.row)\n    ) {\n      // 被编辑单元格\n      drawCellBase({ bgColor: '#FFF' })\n      const actStyle = styleContents.of(style, record, this.StyleClass)\n      this.drawEditingInternal(context, actStyle, helper, grid, info)\n      return\n    }\n    if (!state.cellRange) {\n      // 在绘制单元格时，在编辑前，顺便保存当前焦点单元格的 inputPadding\n      const sel = context.getSelection()\n      const { col, row } = context\n      if (\n        !sel.dragged &&\n        cellInRange(context.range, sel.select.col, sel.select.row) &&\n        cellInRange(sel.range, col, row)\n      ) {\n        // 焦点单元格\n        const actStyle = styleContents.of(style, record, this.StyleClass)\n        if (actStyle instanceof Style && actStyle.inputPadding) {\n          state.inputPadding = helper.toBoxPixelArray(\n            actStyle.inputPadding,\n            context,\n            actStyle.font\n          )\n        } else {\n          delete state.inputPadding\n        }\n      }\n    }\n    clearCellBase()\n\n    let promise\n    if (!record) {\n      return // 过滤过程中 record 可能没有值\n    } else if (isPromise(record)) {\n      promise = record.then(() => cellValue)\n    } else if (isPromise(cellValue)) {\n      promise = cellValue\n    }\n    // 文字\n    if (promise) {\n      const start = Date.now()\n      return promise.then((val: any) => {\n        const currentContext = context.toCurrentContext()\n        const drawRect = currentContext.getDrawRect()\n        if (!drawRect) {\n          return\n        }\n        const time = Date.now() - start\n\n        const drawInternal = () => {\n          const _currentContext = context.toCurrentContext()\n          const _drawRect = _currentContext.getDrawRect()\n          if (!_drawRect) {\n            return\n          }\n          const _record = getRecord() as T\n          if (isPromise(_record)) {\n            return\n          }\n\n          const actStyle = styleContents.of(style, _record, this.StyleClass)\n          if (actStyle.bgColor) {\n            drawCellBase({ bgColor: actStyle.bgColor })\n          } else {\n            drawCellBase()\n          }\n\n          if (this.isContentHidden(_record, getContentHidden)) {\n            return\n          }\n\n          this.drawInternal(\n            this.doConvertInternal(val, getCell(), grid),\n            _currentContext,\n            actStyle,\n            helper,\n            grid,\n            info\n          )\n          this.drawMessageInternal(\n            info.getMessage(),\n            context,\n            actStyle,\n            helper,\n            grid,\n            info\n          )\n        }\n\n        let isFadeinWhenCallbackInPromise = this._fadeinWhenCallbackInPromise\n        if (!isDef(isFadeinWhenCallbackInPromise)) {\n          isFadeinWhenCallbackInPromise = !!grid.configure(\n            'fadeinWhenCallbackInPromise'\n          )\n        }\n\n        if (!isFadeinWhenCallbackInPromise) {\n          drawInternal() // 简单的绘图\n        } else {\n          const col = context.col\n          const row = context.row\n          if (time < 80) {\n            // 80 ms内的PromiseCallback被集成到之前的动画中\n            fadinMgr.margeAnimate(\n              grid,\n              col,\n              row,\n              context,\n              drawInternal,\n              drawCellBase\n            )\n          } else {\n            // 动画\n            fadinMgr.animate(\n              grid,\n              col,\n              row,\n              context,\n              drawInternal,\n              drawCellBase\n            )\n          }\n        }\n      })\n    } else {\n      const actStyle = styleContents.of(style, record, this.StyleClass)\n      if (actStyle.bgColor) {\n        drawCellBase({ bgColor: actStyle.bgColor })\n      } else {\n        drawCellBase()\n      }\n      if (this.isContentHidden(record, getContentHidden)) {\n        return\n      }\n      this.drawInternal(\n        this.doConvertInternal(cellValue, getCell(), grid),\n        context,\n        actStyle,\n        helper,\n        grid,\n        info\n      )\n      this.drawMessageInternal(\n        info.getMessage(),\n        context,\n        actStyle,\n        helper,\n        grid,\n        info\n      )\n      // 在淡入的情况下透明背景覆盖透明度\n      const col = context.col\n      const row = context.row\n      const stateKey = `${col}:${row}`\n      const cellState =\n        (grid as any)[COLUMN_FADEIN_STATE_ID] &&\n        (grid as any)[COLUMN_FADEIN_STATE_ID][stateKey]\n      if (cellState) {\n        const ctx = context.getContext()\n        ctx.globalAlpha = 1 - cellState.opacity\n        try {\n          drawCellBase()\n        } finally {\n          ctx.globalAlpha = 1\n        }\n      }\n      return\n    }\n  }\n  public abstract clone(): BaseColumn<T, V>\n  public abstract drawInternal(\n    value: V,\n    context: CellContext,\n    style: BaseStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void\n  public drawMessageInternal(\n    message: Message,\n    context: CellContext,\n    style: BaseStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    info.messageHandler.drawCellMessage(\n      message,\n      context,\n      style,\n      helper,\n      grid,\n      info\n    )\n  }\n  public bindGridEvent(\n    _grid: ListGridAPI<T>,\n    _cellId: LayoutObjectId\n  ): EventListenerId[] {\n    return []\n  }\n  public getCopyCellValue(\n    value: V,\n    _grid: ListGridAPI<T>,\n    _cell: CellAddress\n  ): string {\n    return value as any\n  }\n  public convertCopyValue(\n    value: unknown,\n    cell: CellAddress,\n    grid: ListGridAPI<T>\n  ) {\n    let displayValue = this.convertCopyInternal(value)\n    if (this.convertCopy) {\n      displayValue = this.convertCopy(value, displayValue, cell, grid)\n    }\n    return displayValue\n  }\n  protected doConvertInternal(\n    value: unknown,\n    cell: CellAddress,\n    grid: ListGridAPI<T>\n  ) {\n    let displayValue = this.convertInternal(value)\n    if (this.convert) {\n      displayValue = this.convert(value, displayValue, cell, grid)\n    }\n    return displayValue\n  }\n  protected convertInternal(value: unknown): V {\n    return (isDef(value) ? value : '') as V\n  }\n  protected convertCopyInternal(value: unknown): V {\n    return this.convertInternal(value)\n  }\n  protected drawEditingInternal(\n    _context: CellContext,\n    _style: BaseStyle,\n    _helper: GridCanvasHelperAPI,\n    _grid: ListGridAPI<T>,\n    _info: DrawCellInfo<T>\n  ): void {\n    // nothing\n  }\n  private isContentHidden(record: T, getContentHidden: () => boolean) {\n    let contentHidden = getOrApply(this.hidden, record)\n    if (!isDef(contentHidden)) {\n      contentHidden = getContentHidden()\n    }\n    return contentHidden\n  }\n}\n","import * as columnUtils from './columnUtils'\nimport {\n  CellAddress,\n  MenuColumnOption,\n  ColumnMenuItemOptions,\n  ListGridAPI,\n  GridCanvasHelperAPI,\n  SimpleColumnMenuItemOption,\n  CellContext,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { BaseColumn } from './BaseColumn'\nimport { MenuStyle } from '../style/MenuStyle'\nimport { isDef } from '../../internal/utils'\nimport menuItems from '../../internal/menu-items'\n\nexport class MenuColumn<T> extends BaseColumn<T, unknown> {\n  private _options: SimpleColumnMenuItemOption[]\n  public constructor(options: MenuColumnOption<T> = {}) {\n    super(options)\n    this._options = menuItems.normalize(options.options)\n  }\n  public get StyleClass(): typeof MenuStyle {\n    return MenuStyle\n  }\n  public get options(): SimpleColumnMenuItemOption[] {\n    return this._options\n  }\n  public clone(): MenuColumn<T> {\n    return new MenuColumn(this)\n  }\n  public withOptions(options: ColumnMenuItemOptions): MenuColumn<T> {\n    const c = this.clone()\n    c._options = menuItems.normalize(options)\n    return c\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: MenuStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { getCell, getIcon }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      font,\n      padding,\n      textOverflow,\n      appearance,\n    } = style\n    let { color } = style\n    const text = this._convertInternal(value, getCell(), grid)\n    helper.testFontLoad(font, text, context)\n    columnUtils.loadIcons(getIcon(), context, helper, (icons, ctx) => {\n      const basePadding = helper.toBoxPixelArray(padding || 0, context, font)\n      const textPadding = basePadding.slice(0)\n      textPadding[1] += 26 // icon padding\n      const iconPadding = basePadding.slice(0)\n      iconPadding[1] += 8\n      if (!isDef(color) && (!isDef(value) || value === '')) {\n        color = 'rgba(0, 0, 0, .38)'\n      }\n      helper.text(text, ctx, {\n        color,\n        font,\n        icons,\n        padding: textPadding,\n        textAlign,\n        textBaseline,\n        textOverflow,\n      })\n      if (appearance === 'menulist-button') {\n        // draw dropdown arrow icon\n        helper.text('', context, {\n          color,\n          font,\n          icons: [\n            {\n              color: 'rgba(0, 0, 0, .54)',\n              path: 'M0 2 5 7 10 2z',\n              width: 10,\n            },\n          ],\n          padding: iconPadding,\n          textAlign: 'right',\n          textBaseline,\n        })\n      } else if (appearance !== 'none') {\n        window.console.warn(`unsupported appearance:${appearance}`)\n      }\n    })\n  }\n  protected convertInternal(value: unknown) {\n    return value\n  }\n  private _convertInternal(\n    value: unknown,\n    cell: CellAddress,\n    grid: ListGridAPI<T>\n  ): string {\n    const options = this._options\n    for (const option of options) {\n      if (option.value === value) {\n        value = option.label\n        break\n      }\n    }\n    return super.doConvertInternal(value, cell, grid) as string\n  }\n  public getCopyCellValue(\n    value: unknown,\n    grid: ListGridAPI<T>,\n    cell: CellAddress\n  ): string {\n    return this._convertInternal(value, cell, grid)\n  }\n}\n","import {\n  InlineMenuEditorOption,\n  ListGridAPI,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n  SimpleColumnMenuItemOption,\n  ColumnTypeAPI,\n  ColumnMenuItemOption,\n} from '../../ts-types'\nimport { KEY_ENTER, KEY_F2 } from '../../core/draw-grid/KEY_CODE'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport menuItems from '../../internal/menu-items'\nimport {\n  obj,\n  event,\n  array,\n  then,\n  isPromise,\n  cellEquals,\n} from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord } from './action-utils'\nimport { Editor } from './Editor'\nimport { InlineMenuElement } from './internal/InlineMenuElement'\n\nimport { GridInternal, InputEditorState } from '../../ts-types-internal'\nimport { getInlineMenuEditorStateId } from '../../internal/symbolManager'\nimport { MenuColumn } from '../type/MenuColumn'\n\nconst INLINE_MENU_EDITOR_STATE_ID = getInlineMenuEditorStateId()\n\nlet globalInlineMenuElement: InlineMenuElement<any> | null = null\nlet globalInlineMenuBindGridCount = 0\n\nfunction getState<T>(grid: GridInternal<T>): InputEditorState {\n  let state = grid[INLINE_MENU_EDITOR_STATE_ID]\n  if (!state) {\n    state = {}\n    obj.setReadonly(grid, INLINE_MENU_EDITOR_STATE_ID, state)\n  }\n  return state\n}\n\nfunction attachMenu<T>(\n  grid: ListGridAPI<T>,\n  cell: CellAddress,\n  editor: InlineMenuEditor<T>,\n  value: any,\n  record: T | undefined\n) {\n  const state = getState(grid as any)\n  if (!globalInlineMenuElement) {\n    globalInlineMenuElement = new InlineMenuElement()\n  }\n  if (!state.element) {\n    state.element = globalInlineMenuElement\n    globalInlineMenuBindGridCount++\n    grid.addDisposable({\n      dispose() {\n        globalInlineMenuBindGridCount--\n        if (!globalInlineMenuBindGridCount && globalInlineMenuElement) {\n          globalInlineMenuElement.dispose()\n          globalInlineMenuElement = null\n        }\n      },\n    })\n  }\n\n  globalInlineMenuElement.attach(\n    grid,\n    editor,\n    cell.col,\n    cell.row,\n    value,\n    record\n  )\n}\nfunction detachMenu(gridFocus?: boolean) {\n  if (globalInlineMenuElement) {\n    globalInlineMenuElement.detach(gridFocus)\n  }\n}\n\nexport class InlineMenuEditor<T> extends Editor<T> {\n  private _classList?: string | string[]\n  private _options: (record: T | undefined) => ColumnMenuItemOption[]\n  private _autoWidth: boolean\n  public constructor(options: InlineMenuEditorOption<T> = {}) {\n    super(options)\n    this._classList = options.classList || ''\n    this._options = menuItems.normalizeToFn(options.options)\n    this._autoWidth = options.autoWidth || false\n  }\n  public dispose() {\n    // nothing\n  }\n  public get classList(): string[] | undefined {\n    if (!this._classList) {\n      return undefined\n    }\n    return Array.isArray(this._classList) ? this._classList : [this._classList]\n  }\n  public set classList(classList) {\n    this._classList = classList\n  }\n  public get options(): (record: T | undefined) => ColumnMenuItemOption[] {\n    return this._options\n  }\n  public set options(options) {\n    this._options = menuItems.normalizeToFn(options)\n  }\n  public get autoWidth(): boolean {\n    return this._autoWidth\n  }\n  public set autoWidth(autoWidth) {\n    this._autoWidth = autoWidth\n  }\n  public clone(): InlineMenuEditor<T> {\n    return new InlineMenuEditor(this)\n  }\n  public onChangeDisabledInternal() {\n    // cancel input\n    detachMenu(true)\n  }\n  public onChangeReadOnlyInternal() {\n    // cancel input\n    detachMenu(true)\n  }\n  public bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const open = (cell: CellAddress): boolean => {\n      const allowOpen =\n        !isReadOnlyRecord(this.readOnly, grid, cell.row) &&\n        !isDisabledRecord(this.disabled, grid, cell.row)\n      if (allowOpen) {\n        grid.doGetCellValue(cell.col, cell.row, (value) => {\n          const record = grid.getRowRecord(cell.row)\n          if (isPromise(record)) {\n            return\n          }\n          attachMenu(grid, cell, this, value, record)\n        })\n      }\n      return allowOpen\n    }\n\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    return [\n      grid.listen(DG_EVENT_TYPE.CLICK_CELL, (cell) => {\n        if (!isTarget(cell.col, cell.row)) {\n          return\n        }\n        open({\n          col: cell.col,\n          row: cell.row,\n        })\n      }),\n      grid.listen(DG_EVENT_TYPE.KEYDOWN, (e) => {\n        if (\n          (e.keyCode !== KEY_F2 && e.keyCode !== KEY_ENTER) ||\n          (e.keyCode === KEY_ENTER && e.event.shiftKey)\n        ) {\n          return\n        }\n        const sel = grid.selection.select\n        if (!isTarget(sel.col, sel.row)) {\n          return\n        }\n        if (\n          open({\n            col: sel.col,\n            row: sel.row,\n          })\n        ) {\n          event.cancel(e.event)\n          e.stopCellMoving()\n        }\n      }),\n      grid.listen(DG_EVENT_TYPE.SELECTED_CELL, (e) => {\n        detachMenu()\n      }),\n      grid.listen(DG_EVENT_TYPE.SCROLL, () => {\n        detachMenu(true)\n      }),\n\n      // mouse move\n      grid.listen(DG_EVENT_TYPE.MOUSEOVER_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (\n          isReadOnlyRecord(this.readOnly, grid, e.row) ||\n          isDisabledRecord(this.disabled, grid, e.row)\n        ) {\n          return\n        }\n        grid.getElement().style.cursor = 'pointer'\n      }),\n      grid.listen(DG_EVENT_TYPE.MOUSEMOVE_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (\n          isReadOnlyRecord(this.readOnly, grid, e.row) ||\n          isDisabledRecord(this.disabled, grid, e.row)\n        ) {\n          return\n        }\n        if (!grid.getElement().style.cursor) {\n          grid.getElement().style.cursor = 'pointer'\n        }\n      }),\n      grid.listen(DG_EVENT_TYPE.MOUSEOUT_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        grid.getElement().style.cursor = ''\n      }),\n\n      // paste value\n      grid.listen(DG_EVENT_TYPE.PASTE_CELL, (e) => {\n        if (e.multi) {\n          // ignore multi cell values\n          return\n        }\n        const selectionRange = grid.selection.range\n        if (!cellEquals(selectionRange.start, selectionRange.end)) {\n          // ignore multi paste values\n          return\n        }\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (\n          isReadOnlyRecord(this.readOnly, grid, e.row) ||\n          isDisabledRecord(this.disabled, grid, e.row)\n        ) {\n          return\n        }\n        const record = grid.getRowRecord(e.row)\n        if (isPromise(record)) {\n          return\n        }\n        const pasteOpt = this._pasteDataToOptionValue(\n          e.normalizeValue,\n          grid,\n          e,\n          record\n        )\n        if (pasteOpt) {\n          event.cancel(e.event)\n          then(\n            grid.doChangeValue(e.col, e.row, () => pasteOpt.value),\n            () => {\n              const range = grid.getCellRange(e.col, e.row)\n              grid.invalidateCellRange(range)\n            }\n          )\n        }\n      }),\n    ]\n  }\n  public onPasteCellRangeBox(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    value: string\n  ): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    const record = grid.getRowRecord(cell.row)\n    if (isPromise(record)) {\n      return\n    }\n    const pasteOpt = this._pasteDataToOptionValue(value, grid, cell, record)\n    if (pasteOpt) {\n      grid.doChangeValue(cell.col, cell.row, () => pasteOpt.value)\n    }\n  }\n  public onDeleteCellRangeBox(grid: ListGridAPI<T>, cell: CellAddress): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    const record = grid.getRowRecord(cell.row)\n    if (isPromise(record)) {\n      return\n    }\n    const pasteOpt = this._pasteDataToOptionValue('', grid, cell, record)\n    if (pasteOpt) {\n      grid.doChangeValue(cell.col, cell.row, () => pasteOpt.value)\n    }\n  }\n  private _pasteDataToOptionValue(\n    value: string,\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    record: T | undefined\n  ): SimpleColumnMenuItemOption | undefined {\n    const options = this._options(record)\n    const pasteOpt = _textToOptionValue(value, options)\n    if (pasteOpt) {\n      return pasteOpt\n    }\n    const columnType = grid.getColumnType(cell.col, cell.row)\n    if (hasOptions(columnType)) {\n      // Find with caption.\n      const pasteValue = normalizePasteValueStr(value)\n      const captionOpt = array.find(\n        columnType.options,\n        (opt) => normalizePasteValueStr(opt.label) === pasteValue\n      )\n      if (captionOpt) {\n        return _textToOptionValue(captionOpt.value, options)\n      }\n    }\n    return undefined\n  }\n}\n\nfunction _textToOptionValue<T>(\n  value: string,\n  options: SimpleColumnMenuItemOption[]\n): SimpleColumnMenuItemOption | undefined {\n  const pasteValue = normalizePasteValueStr(value)\n  const pasteOpt = array.find(\n    options,\n    (opt) => normalizePasteValueStr(opt.value) === pasteValue\n  )\n  if (pasteOpt) {\n    return pasteOpt\n  }\n  return undefined\n}\n\nfunction normalizePasteValueStr(value: any): string {\n  if (value == null) {\n    return ''\n  }\n  return `${value}`.trim()\n}\n\nfunction hasOptions(columnType: ColumnTypeAPI): columnType is MenuColumn<any> {\n  if (columnType instanceof MenuColumn) {\n    return true\n  }\n  if (Array.isArray((columnType as any).options)) {\n    return true\n  }\n\n  return false\n}\n","import { ListGridAPI } from '../../../ts-types'\nimport { KEY_ENTER, KEY_ESC, KEY_TAB } from '../../../core/draw-grid/KEY_CODE'\nimport { createElement } from '../../../internal/dom'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport style from '../../../internal/style'\nimport { event, isDef } from '../../../internal/utils'\n\nimport { InlineTextAreaEditor } from '../InlineTextAreaEditor'\nimport InlineTextAreaElementCss from './InlineTextAreaElement.css'\nimport { getInlineEditingState } from '../../../columns/utils'\n\nconst CLASSNAME_ITAE = 'kaka-grid__inline-textarea'\n\nfunction createInputElement() {\n  style.inject('InlineTextAreaElement', InlineTextAreaElementCss)\n  return createElement('textarea', { classList: CLASSNAME_ITAE })\n}\n\nconst BEFORE_TEXTAREA_VALUE = 'before_value'\n\nfunction inputAutoHeight(input: HTMLTextAreaElement) {\n  const h = input.style.minHeight\n  input.style.minHeight = '0px'\n  input.style.height = '0px'\n  input.style.height = input.scrollHeight + 'px'\n  input.style.minHeight = h\n}\n\nfunction setTextInputValue(\n  input: HTMLTextAreaElement,\n  value: any,\n  inputValue?: string\n) {\n  if (isDef(value)) {\n    input.value = value\n  } else {\n    input.value = ''\n  }\n  input.dataset[BEFORE_TEXTAREA_VALUE] = input.value\n  if (inputValue) {\n    input.value = inputValue\n  }\n  inputAutoHeight(input)\n}\n\nfunction getTextInputValue(input: HTMLTextAreaElement) {\n  return input.value\n}\n\nfunction isTextInputValueChanged(input: HTMLTextAreaElement) {\n  return input.value !== input.dataset[BEFORE_TEXTAREA_VALUE]\n}\n\ninterface ActiveData<T> {\n  grid: ListGridAPI<T>\n  col: number\n  row: number\n  editor: InlineTextAreaEditor<T>\n}\n\nexport class InlineTextAreaElement<T> {\n  public static setInputAttrs<T>(\n    editor: InlineTextAreaEditor<T>,\n    _grid: ListGridAPI<T>,\n    input: HTMLElement\n  ) {\n    const classList = editor.classList\n    if (classList) {\n      input.classList.add(...classList)\n    }\n  }\n  private _handler: EventHandler\n  private _input: HTMLTextAreaElement\n  private _attaching: boolean = false\n  private _activeData?: ActiveData<T>\n  private _beforePropEditor?: InlineTextAreaEditor<T>\n  public constructor() {\n    this._handler = new EventHandler()\n    this._input = createInputElement()\n    this._bindInputEvents()\n  }\n  public dispose() {\n    this.detach()\n    this._handler.dispose()\n    delete this._beforePropEditor\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    editor: InlineTextAreaEditor<T>,\n    col: number,\n    row: number,\n    value: any,\n    inputValue?: string\n  ) {\n    const input = this._input\n\n    if (input.parentElement) {\n      // 参见 InlineInputElement.ts\n      return\n    }\n\n    const handler = this._handler\n\n    if (this._beforePropEditor) {\n      const classList = this._beforePropEditor.classList\n      if (classList) {\n        input.classList.remove(...classList)\n      }\n    }\n\n    input.style.font = grid.font || '16px sans-serif'\n\n    const { element, rect, padding } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n    input.style.top = `${rect.top.toFixed()}px`\n    input.style.left = `${rect.left.toFixed()}px`\n    input.style.minWidth = `${rect.width.toFixed()}px`\n    input.style.width = input.style.minWidth\n    input.style.minHeight = `${rect.height.toFixed()}px`\n    input.style.height = input.style.minHeight\n    input.style.paddingTop = `${padding[0]}px`\n    input.style.paddingRight = `${padding[1]}px`\n    input.style.paddingBottom = `${padding[2]}px`\n    input.style.paddingLeft = `${padding[3]}px`\n    element.appendChild(input)\n\n    InlineTextAreaElement.setInputAttrs(editor, grid, input)\n    setTextInputValue(input, value, inputValue)\n\n    this._activeData = { grid, col, row, editor }\n    this._beforePropEditor = editor\n\n    const focus = () => {\n      input.focus()\n\n      const end = input.value.length\n      try {\n        if (typeof input.selectionStart !== 'undefined') {\n          input.selectionStart = end\n          input.selectionEnd = end\n          return\n        }\n      } catch (e) {\n        // ignore\n      }\n      if ((document as any).selection) {\n        const range = (input as any).createTextRange()\n        range.collapse()\n        range.moveEnd('character', end)\n        range.moveStart('character', end)\n        range.select()\n      }\n    }\n    const safeInputFocus = () => {\n      handler.tryWithOffEvents(input, 'blur', () => {\n        focus()\n      })\n      const state = getInlineEditingState(grid)\n      state.cellRange = grid.getCellRange(col, row)\n      grid.invalidateCellRange(state.cellRange)\n    }\n\n    this._attaching = true\n    setTimeout(() => {\n      safeInputFocus()\n      this._attaching = false\n    })\n  }\n  public detach(gridFocus?: boolean) {\n    if (this._isActive()) {\n      const activeData = this._activeData!\n      const grid = activeData.grid\n      const col = activeData.col\n      const row = activeData.row\n      const input = this._input\n      this._handler.tryWithOffEvents(input, 'blur', () => {\n        if (input.parentElement) {\n          input.parentElement.removeChild(input)\n        }\n      })\n      const state = getInlineEditingState(grid)\n      delete state.cellRange\n      const range = grid.getCellRange(col, row)\n      grid.invalidateCellRange(range)\n      if (gridFocus) {\n        grid.focus()\n      }\n    }\n    delete this._activeData\n  }\n  public doChangeValue() {\n    if (!this._isActive()) {\n      return\n    }\n    if (isTextInputValueChanged(this._input)) {\n      const value = getTextInputValue(this._input)\n      const activeData = this._activeData!\n      const grid = activeData.grid\n      const col = activeData.col\n      const row = activeData.row\n      grid.doChangeValue(col, row, () => value)\n    }\n  }\n  private _isActive() {\n    const input = this._input\n    if (!input || !input.parentElement) {\n      return false\n    }\n    if (!this._activeData) {\n      return false\n    }\n    return true\n  }\n  private _bindInputEvents() {\n    const handler = this._handler\n    const input = this._input\n    const stopPropagationOnly = (e: Event) => e.stopPropagation() // grid为了不在活动中传播\n    handler.on(input, 'click', stopPropagationOnly)\n    handler.on(input, 'mousedown', stopPropagationOnly)\n    handler.on(input, 'touchstart', stopPropagationOnly)\n    handler.on(input, 'dblclick', stopPropagationOnly)\n\n    handler.on(input, 'compositionstart', (e) => {\n      input.classList.add('composition')\n    })\n    handler.on(input, 'compositionend', (e) => {\n      input.classList.remove('composition')\n    })\n    handler.on(input, 'keydown', (e) => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      if (keyCode === KEY_ESC) {\n        this.detach(true)\n        event.cancel(e)\n      } else if (keyCode === KEY_ENTER) {\n        this._onKeydownEnter(e, input)\n      } else if (keyCode === KEY_TAB) {\n        this._onKeydownTab(e)\n      }\n    })\n    handler.on(input, 'blur', (e) => {\n      this.doChangeValue()\n      this.detach()\n    })\n    handler.on(input, 'input', (e) => {\n      inputAutoHeight(input)\n    })\n  }\n  private _onKeydownEnter(e: KeyboardEvent, input: HTMLTextAreaElement): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n    if (e.altKey || e.ctrlKey) {\n      input.setRangeText('\\n')\n      input.selectionStart++\n      setTimeout(() => {\n        inputAutoHeight(input)\n      }, 0)\n      event.cancel(e)\n    } else {\n      const { grid } = this._activeData!\n      this.doChangeValue()\n      this.detach(true)\n      if (grid.keyboardOptions?.moveCellOnEnter) {\n        grid.onKeyDownMove(e)\n      }\n      event.cancel(e)\n    }\n  }\n  private _onKeydownTab(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n    const { grid } = this._activeData!\n    if (grid.keyboardOptions?.moveCellOnTab) {\n      return\n    }\n    this.doChangeValue()\n    this.detach(true)\n    grid.onKeyDownMove(e)\n  }\n}\n","import { obj } from '../../internal/utils'\nimport { BaseActionInput } from './BaseActionInput'\nimport { InlineTextAreaElement } from './internal/InlineTextAreaElement'\nimport { getInlineTextareaEditorStateId } from '../../internal/symbolManager'\nimport {\n  InlineTextAreaEditorOption,\n  ListGridAPI,\n  CellAddress,\n} from '../../ts-types'\n\nconst INLINE_TEXTAREA_EDITOR_STATE_ID = getInlineTextareaEditorStateId()\n\nlet globalInlineTextAreaElement: InlineTextAreaElement<any> | null = null\nlet globalInlineInputBindGridCount = 0\n\nfunction attachInput<T>(\n  grid: ListGridAPI<T>,\n  cell: CellAddress,\n  editor: InlineTextAreaEditor<T>,\n  value: any,\n  inputValue?: string\n) {\n  if (!globalInlineTextAreaElement) {\n    globalInlineTextAreaElement = new InlineTextAreaElement()\n  }\n  const state = (editor as any).getState(grid)\n  if (!state.element) {\n    state.element = globalInlineTextAreaElement\n    globalInlineInputBindGridCount++\n    grid.addDisposable({\n      dispose() {\n        globalInlineInputBindGridCount--\n        if (!globalInlineInputBindGridCount && globalInlineTextAreaElement) {\n          globalInlineTextAreaElement.dispose()\n          globalInlineTextAreaElement = null\n        }\n      },\n    })\n  }\n\n  globalInlineTextAreaElement.attach(\n    grid,\n    editor,\n    cell.col,\n    cell.row,\n    value,\n    inputValue\n  )\n}\nfunction detachInput(gridFocus?: boolean) {\n  if (globalInlineTextAreaElement) {\n    globalInlineTextAreaElement.detach(gridFocus)\n  }\n}\nfunction doChangeValue<T>(grid: ListGridAPI<T>) {\n  if (globalInlineTextAreaElement) {\n    globalInlineTextAreaElement.doChangeValue()\n  }\n}\n\nexport class InlineTextAreaEditor<T> extends BaseActionInput<T> {\n  private _classList: string | string[]\n  public constructor(options: InlineTextAreaEditorOption<T> = {}) {\n    super(options)\n    this._classList = options.classList || ''\n  }\n  public get classList() {\n    return (\n      this._classList &&\n      (Array.isArray(this._classList) ? this._classList : [this._classList])\n    )\n  }\n  public set classList(classList) {\n    this._classList = classList\n  }\n  public clone(): InlineTextAreaEditor<T> {\n    return new InlineTextAreaEditor(this)\n  }\n  public onActionInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ) {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachInput(grid, cell, this, value, inputValue)\n    })\n  }\n  public onActionOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress) {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachInput(grid, cell, this, value)\n    })\n  }\n  public onChangeSelectCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    selected: any\n  ) {\n    doChangeValue(grid)\n    detachInput()\n  }\n  public onGridScrollInternal(grid: ListGridAPI<T>) {\n    doChangeValue(grid)\n    detachInput(true)\n  }\n  public onChangeDisabledInternal() {\n    // cancel input\n    detachInput(true)\n  }\n  public onChangeReadOnlyInternal() {\n    // cancel input\n    detachInput(true)\n  }\n  public onSetInputAttrsInternal(\n    grid: ListGridAPI<T>,\n    _cell: CellAddress,\n    input: HTMLInputElement\n  ) {\n    InlineTextAreaElement.setInputAttrs(this, grid, input)\n  }\n  protected getState(grid: any): any {\n    if (!(grid as any)[INLINE_TEXTAREA_EDITOR_STATE_ID]) {\n      obj.setReadonly(grid, INLINE_TEXTAREA_EDITOR_STATE_ID, {})\n    }\n    return grid[INLINE_TEXTAREA_EDITOR_STATE_ID]\n  }\n}\n","import {\n  CellAddress,\n  EventListenerId,\n  GetRadioEditorGroup,\n  LayoutObjectId,\n  RadioEditorOption,\n} from '../../ts-types'\nimport { bindCellClickAction, bindCellKeyAction } from './actionBind'\nimport { cellEquals, event, isPromise, obj } from '../../internal/utils'\nimport { isDisabledRecord, isReadOnlyRecord, toggleValue } from './action-utils'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { Editor } from './Editor'\nimport { GridInternal } from '../../ts-types-internal'\nimport { animate } from '../../internal/animate'\nimport { getRadioColumnStateId } from '../../internal/symbolManager'\nimport { toBoolean } from '../utils'\n\nconst RADIO_COLUMN_STATE_ID = getRadioColumnStateId()\n\nconst defaultGroupResolver: GetRadioEditorGroup<any> = ({ grid, col, row }) => {\n  const cellId = grid.getLayoutCellId(col, row)\n  const recordStartRow = grid.getRecordStartRowByRecordIndex(\n    grid.getRecordIndexByRow(row)\n  )\n  const offsetRow = row - recordStartRow\n\n  const result = []\n  const { rowCount, recordRowCount } = grid\n  for (\n    let targetRow = grid.frozenRowCount + offsetRow;\n    targetRow < rowCount;\n    targetRow += recordRowCount\n  ) {\n    if (grid.getLayoutCellId(col, targetRow) === cellId) {\n      result.push({ col, row: targetRow })\n    }\n  }\n  return result\n}\n\nexport class RadioEditor<T> extends Editor<T> {\n  protected _group: GetRadioEditorGroup<T>\n  public constructor(option: RadioEditorOption<T> = {}) {\n    super(option)\n    this._group = option.group || defaultGroupResolver\n  }\n  public clone(): RadioEditor<T> {\n    return new RadioEditor(this)\n  }\n  public get group(): GetRadioEditorGroup<T> {\n    return this._group\n  }\n  public set group(group) {\n    this._group = group\n  }\n  public bindGridEvent(\n    grid: GridInternal<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    let _state = grid[RADIO_COLUMN_STATE_ID]\n    if (!_state) {\n      _state = { block: {}, elapsed: {} }\n      obj.setReadonly(grid, RADIO_COLUMN_STATE_ID, _state)\n    }\n    const state = _state\n\n    const action = (cell: CellAddress): void => {\n      this._action(grid, cell)\n    }\n\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    return [\n      ...bindCellClickAction(grid, cellId, {\n        action,\n        mouseOver: (e) => {\n          if (isDisabledRecord(this.disabled, grid, e.row)) {\n            return false\n          }\n          state.mouseActiveCell = {\n            col: e.col,\n            row: e.row,\n          }\n          const range = grid.getCellRange(e.col, e.row)\n          grid.invalidateCellRange(range)\n          return true\n        },\n        mouseOut: (e) => {\n          delete state.mouseActiveCell\n          const range = grid.getCellRange(e.col, e.row)\n          grid.invalidateCellRange(range)\n        },\n      }),\n      ...bindCellKeyAction(grid, cellId, {\n        action,\n      }),\n\n      // paste value\n      grid.listen(DG_EVENT_TYPE.PASTE_CELL, (e) => {\n        if (e.multi) {\n          // ignore multi cell values\n          return\n        }\n        const selectionRange = grid.selection.range\n        if (!cellEquals(selectionRange.start, selectionRange.end)) {\n          // ignore multi paste values\n          return\n        }\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n\n        const pasteValue = e.normalizeValue.trim()\n        if (!toBoolean(pasteValue)) {\n          return\n        }\n        event.cancel(e.event)\n\n        action({\n          col: e.col,\n          row: e.row,\n        })\n      }),\n    ]\n  }\n  public onPasteCellRangeBox(\n    grid: GridInternal<T>,\n    cell: CellAddress,\n    value: string\n  ): void {\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row)\n    ) {\n      return\n    }\n    const pasteValue = value.trim()\n    if (!toBoolean(pasteValue)) {\n      return\n    }\n    this._action(grid, {\n      col: cell.col,\n      row: cell.row,\n    })\n  }\n  public onDeleteCellRangeBox(): void {\n    // noop\n  }\n  private _action(grid: GridInternal<T>, cell: CellAddress): void {\n    const state = grid[RADIO_COLUMN_STATE_ID]!\n    const range = grid.getCellRange(cell.col, cell.row)\n    const cellKey = `${range.start.col}:${range.start.row}`\n\n    if (\n      isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n      isDisabledRecord(this.disabled, grid, cell.row) ||\n      state.block[cellKey]\n    ) {\n      return\n    }\n\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      if (toBoolean(value)) {\n        return\n      }\n\n      const targets = this._group({ grid, col: cell.col, row: cell.row })\n      targets.forEach(({ col, row }) => {\n        const range = grid.getCellRange(col, row)\n        const cellKey = `${range.start.col}:${range.start.row}`\n\n        if (\n          isReadOnlyRecord(this.readOnly, grid, cell.row) ||\n          isDisabledRecord(this.disabled, grid, cell.row) ||\n          state.block[cellKey]\n        ) {\n          return\n        }\n\n        actionCell(grid, col, row, col === cell.col && row === cell.row)\n      })\n    })\n  }\n}\n\nfunction actionCell<T>(\n  grid: GridInternal<T>,\n  col: number,\n  row: number,\n  flag: boolean\n): void {\n  grid.doGetCellValue(col, row, (value) => {\n    if (toBoolean(value) === flag) {\n      return\n    }\n\n    const state = grid[RADIO_COLUMN_STATE_ID]!\n    const range = grid.getCellRange(col, row)\n    const cellKey = `${range.start.col}:${range.start.row}`\n    const ret = grid.doChangeValue(col, row, toggleValue)\n    if (ret) {\n      const onChange = (): void => {\n        // checkbox animation\n        animate(200, (point) => {\n          if (point === 1) {\n            delete state.elapsed[cellKey]\n          } else {\n            state.elapsed[cellKey] = point\n          }\n          grid.invalidateCellRange(range)\n        })\n      }\n      if (isPromise(ret)) {\n        state.block[cellKey] = true\n        ret.then(() => {\n          delete state.block[cellKey]\n          onChange()\n        })\n      } else {\n        onChange()\n      }\n    }\n  })\n}\n","import { ListGridAPI, MaybePromise } from '../../../ts-types'\nimport { KEY_ENTER, KEY_ESC, KEY_TAB } from '../../../core/draw-grid/KEY_CODE'\nimport { createElement } from '../../../internal/dom'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport style from '../../../internal/style'\nimport { event, then, browser } from '../../../internal/utils'\nimport smallDialogInputElementCss from './SmallDialogInputElement.css'\nimport { setInputValue } from './input-value-handler'\n\nconst CLASSNAME_SDE = 'kaka-grid__small-dialog-input'\nconst INPUT_CLASSNAME_SDE = `${CLASSNAME_SDE}__input`\nconst HIDDEN_CLASSNAME_SDE = `${CLASSNAME_SDE}--hidden`\nconst SHOWN_CLASSNAME_SDE = `${CLASSNAME_SDE}--shown`\n\nfunction _focus(input: HTMLInputElement, handler: EventHandler): void {\n  const focus = () => {\n    input.focus()\n\n    const end = input.value.length\n    try {\n      if (typeof input.selectionStart !== 'undefined') {\n        input.selectionStart = end\n        input.selectionEnd = end\n        return\n      }\n    } catch (e) {\n      // ignore\n    }\n    if ((document as any).selection) {\n      const range = (input as any).createTextRange()\n      range.collapse()\n      range.moveEnd('character', end)\n      range.moveStart('character', end)\n      range.select()\n    }\n  }\n  handler.tryWithOffEvents(input, 'blur', () => {\n    focus()\n  })\n}\n\nfunction createDialogElement(): HTMLDivElement {\n  style.inject('smallDialogInputElement', smallDialogInputElementCss)\n  const element = createElement('div', {\n    classList: [CLASSNAME_SDE, HIDDEN_CLASSNAME_SDE],\n  })\n  const input = createElement('input', { classList: INPUT_CLASSNAME_SDE })\n  // input.readOnly = true;\n  input.tabIndex = -1\n  element.appendChild(input)\n  return element\n}\n\ntype GetValueResult<T, R> = (\n  value: string,\n  info: { grid: ListGridAPI<T>; col: number; row: number }\n) => R\n\ntype EditorProps<T> = {\n  type?: string\n  classList?: string[]\n  helperText?: string | GetValueResult<T, string>\n  inputValidator?: GetValueResult<T, MaybePromise<string>>\n  validator?: GetValueResult<T, MaybePromise<string>>\n}\n\ntype ActiveData<T> = {\n  grid: ListGridAPI<T>\n  col: number\n  row: number\n  editor: EditorProps<T>\n}\n\nfunction bindProps<T>(\n  grid: ListGridAPI<T>,\n  dialog: HTMLDivElement,\n  input: HTMLInputElement,\n  editor: EditorProps<T>\n): void {\n  const { classList, helperText } = editor\n  if (classList) {\n    dialog.classList.add(...classList)\n  }\n  if (helperText && typeof helperText !== 'function') {\n    dialog.dataset.helperText = helperText\n  }\n  setInputAttrs(editor, grid, input)\n}\n\nfunction unbindProps<T>(\n  _grid: ListGridAPI<T>,\n  dialog: HTMLDivElement,\n  input: HTMLInputElement,\n  editor: EditorProps<T>\n): void {\n  const { classList } = editor\n  if (classList) {\n    dialog.classList.remove(...classList)\n  }\n  delete dialog.dataset.helperText\n  input.type = ''\n}\n\nfunction setInputAttrs<T>(\n  editor: EditorProps<T>,\n  _grid: ListGridAPI<T>,\n  input: HTMLInputElement\n): void {\n  const { type } = editor\n  input.type = type || ''\n}\n\nexport class SmallDialogInputElement<T> {\n  public static setInputAttrs<T>(\n    editor: EditorProps<T>,\n    grid: ListGridAPI<T>,\n    input: HTMLInputElement\n  ) {\n    setInputAttrs(editor, grid, input)\n  }\n  private _handler: EventHandler\n  private _dialog: HTMLDivElement\n  private _input: HTMLInputElement\n  private _beforePropEditor?: EditorProps<T> | null\n  private _activeData?: ActiveData<T> | null\n  private _attaching?: boolean\n  private _beforeValue?: string | null\n  public constructor() {\n    this._handler = new EventHandler()\n    this._dialog = createDialogElement()\n    this._input = this._dialog.querySelector(\n      `.${INPUT_CLASSNAME_SDE}`\n    ) as HTMLInputElement\n    this._bindDialogEvents()\n  }\n  public dispose(): void {\n    const dialog = this._dialog\n    this.detach()\n    this._handler.dispose()\n    this._beforePropEditor = null\n    if (dialog.parentElement) {\n      dialog.parentElement.removeChild(dialog)\n    }\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    editor: EditorProps<T>,\n    col: number,\n    row: number,\n    value: string\n  ): void {\n    const handler = this._handler\n    const dialog = this._dialog\n    const input = this._input\n\n    if (this._beforePropEditor) {\n      unbindProps(grid, dialog, input, this._beforePropEditor)\n    }\n\n    delete dialog.dataset.errorMessage\n    dialog.classList.remove(SHOWN_CLASSNAME_SDE)\n    dialog.classList.add(HIDDEN_CLASSNAME_SDE)\n    // input.readOnly = false;\n    input.tabIndex = 0\n    const { element, rect } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n    dialog.style.top = `${rect.top.toFixed()}px`\n    dialog.style.left = `${rect.left.toFixed()}px`\n    dialog.style.width = `${rect.width.toFixed()}px`\n    input.style.height = `${rect.height.toFixed()}px`\n    element.appendChild(dialog)\n\n    setInputValue(input, value)\n\n    input.style.font = grid.font || '16px sans-serif'\n    const activeData = { grid, col, row, editor }\n    this._onInputValue(input, activeData)\n    if (!browser.IE) {\n      _focus(input, handler)\n    } else {\n      // On the paste-event on IE, since it may not be focused, it will be delayed and focused.\n      setTimeout(() => _focus(input, handler))\n    }\n    dialog.classList.add(SHOWN_CLASSNAME_SDE)\n    dialog.classList.remove(HIDDEN_CLASSNAME_SDE)\n    // input.readOnly = true;\n\n    bindProps(grid, dialog, input, editor)\n\n    this._activeData = activeData\n    this._beforePropEditor = editor\n\n    this._attaching = true\n    setTimeout(() => {\n      delete this._attaching\n    })\n  }\n  public detach(gridFocus?: boolean): void {\n    if (this._isActive()) {\n      const dialog = this._dialog\n      const input = this._input\n\n      dialog.classList.remove(SHOWN_CLASSNAME_SDE)\n      dialog.classList.add(HIDDEN_CLASSNAME_SDE)\n      // input.readOnly = false;\n      input.tabIndex = -1\n\n      const { grid, col, row } = this._activeData!\n\n      const range = grid.getCellRange(col, row)\n      grid.invalidateCellRange(range)\n      if (gridFocus) {\n        grid.focus()\n      }\n    }\n    this._activeData = null\n    this._beforeValue = null\n  }\n  private _doChangeValue(): MaybePromise<boolean> {\n    if (!this._isActive()) {\n      return false\n    }\n    const input = this._input\n    const { value } = input\n    return then(this._validate(value), (res: boolean) => {\n      if (res && value === input.value) {\n        const { grid, col, row } = this._activeData!\n        grid.doChangeValue(col, row, () => value)\n        return true\n      }\n      return false\n    })\n  }\n  private _isActive(): boolean {\n    const dialog = this._dialog\n    if (!dialog || !dialog.parentElement) {\n      return false\n    }\n    if (!this._activeData) {\n      return false\n    }\n    return true\n  }\n  private _bindDialogEvents(): void {\n    const handler = this._handler\n    const dialog = this._dialog\n    const input = this._input\n    const stopPropagationOnly = (e: Event) => e.stopPropagation() // 终止事件传播\n    handler.on(dialog, 'click', stopPropagationOnly)\n    handler.on(dialog, 'dblclick', stopPropagationOnly)\n    handler.on(dialog, 'mousedown', stopPropagationOnly)\n    handler.on(dialog, 'touchstart', stopPropagationOnly)\n\n    handler.on(input, 'compositionstart', (e) => {\n      input.classList.add('composition')\n    })\n    handler.on(input, 'compositionend', (e) => {\n      input.classList.remove('composition')\n      this._onInputValue(input)\n    })\n    const onKeyupAndPress = (_e: KeyboardEvent): void => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      this._onInputValue(input)\n    }\n    handler.on(input, 'keyup', onKeyupAndPress)\n    handler.on(input, 'keypress', onKeyupAndPress)\n    handler.on(input, 'keydown', (e) => {\n      if (input.classList.contains('composition')) {\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      if (keyCode === KEY_ESC) {\n        this.detach(true)\n        event.cancel(e)\n      } else if (keyCode === KEY_ENTER) {\n        this._onKeydownEnter(e)\n      } else if (keyCode === KEY_TAB) {\n        this._onKeydownTab(e)\n      } else {\n        this._onInputValue(input)\n      }\n    })\n  }\n  private _onKeydownEnter(e: KeyboardEvent): void {\n    if (this._attaching) {\n      return\n    }\n    const input = this._input\n    const { value } = input\n    then(this._doChangeValue(), (r) => {\n      if (r && value === input.value) {\n        const grid = this._isActive() ? this._activeData!.grid : null\n        this.detach(true)\n\n        if (grid?.keyboardOptions?.moveCellOnEnter) {\n          grid.onKeyDownMove(e)\n        }\n      }\n    })\n    event.cancel(e)\n  }\n  private _onKeydownTab(e: KeyboardEvent): void {\n    if (!this._isActive() || this._attaching) {\n      return\n    }\n    const { grid } = this._activeData!\n    if (!grid.keyboardOptions?.moveCellOnTab) {\n      return\n    }\n    const input = this._input\n    const { value } = input\n    then(this._doChangeValue(), (r) => {\n      if (r && value === input.value) {\n        this.detach(true)\n        grid.onKeyDownMove(e)\n      }\n    })\n    event.cancel(e)\n  }\n  private _onInputValue(\n    input: HTMLInputElement,\n    activeData?: ActiveData<T>\n  ): void {\n    const before = this._beforeValue\n    const { value } = input\n    if (before !== value) {\n      this._onInputValueChange(value, activeData)\n    }\n    this._beforeValue = value\n  }\n  private _onInputValueChange(after: string, activeData?: ActiveData<T>): void {\n    activeData = (activeData || this._activeData)!\n    const dialog = this._dialog\n    const { grid, col, row, editor } = activeData\n    if (typeof editor.helperText === 'function') {\n      const helperText = editor.helperText(after, { grid, col, row })\n      if (helperText) {\n        dialog.dataset.helperText = helperText\n      } else {\n        delete dialog.dataset.helperText\n      }\n    }\n    if ('errorMessage' in dialog.dataset) {\n      this._validate(after, true)\n    }\n  }\n  private _validate(value: any, inputOnly?: boolean): MaybePromise<boolean> {\n    const dialog = this._dialog\n    const input = this._input\n    const { grid, col, row, editor } = this._activeData!\n    let message: MaybePromise<string> = ''\n    if (editor.inputValidator) {\n      message = editor.inputValidator(value, { grid, col, row })\n    }\n    return then(message, (msg: MaybePromise<string>) => {\n      if (!msg && editor.validator && !inputOnly) {\n        msg = editor.validator(value, { grid, col, row })\n      }\n      return then(msg, (mess) => {\n        if (mess && value === input.value) {\n          dialog.dataset.errorMessage = mess\n        } else {\n          delete dialog.dataset.errorMessage\n        }\n        return !mess\n      })\n    })\n  }\n}\n","import { obj } from '../../internal/utils'\nimport { BaseInputEditor } from './BaseInputEditor'\nimport { SmallDialogInputElement } from './internal/SmallDialogInputElement'\n\nimport { GridInternal, InputEditorState } from '../../ts-types-internal'\nimport { getSmallDialogInputEditorStateId } from '../../internal/symbolManager'\nimport {\n  SmallDialogInputEditorOption,\n  ListGridAPI,\n  MaybePromise,\n  CellAddress,\n} from '../../ts-types'\n\nconst SMALL_DIALOG_INPUT_EDITOR_STATE_ID = getSmallDialogInputEditorStateId()\n\nlet globalSmallDialogInputElement: SmallDialogInputElement<any> | null = null\nlet globalSmallDialogInputBindGridCount = 0\n\nfunction getState<T>(grid: GridInternal<T>): InputEditorState {\n  let state = grid[SMALL_DIALOG_INPUT_EDITOR_STATE_ID]\n  if (!state) {\n    state = {}\n    obj.setReadonly(grid, SMALL_DIALOG_INPUT_EDITOR_STATE_ID, state)\n  }\n  return state\n}\n\nfunction attachDialogInput<T>(\n  grid: ListGridAPI<T>,\n  cell: CellAddress,\n  editor: SmallDialogInputEditor<T>,\n  value: string\n): void {\n  const state = getState(grid as any)\n  if (!globalSmallDialogInputElement) {\n    globalSmallDialogInputElement = new SmallDialogInputElement()\n  }\n  if (!state.element) {\n    state.element = globalSmallDialogInputElement\n    globalSmallDialogInputBindGridCount++\n    grid.addDisposable({\n      dispose() {\n        globalSmallDialogInputBindGridCount--\n        if (\n          !globalSmallDialogInputBindGridCount &&\n          globalSmallDialogInputElement\n        ) {\n          globalSmallDialogInputElement.dispose()\n          globalSmallDialogInputElement = null\n        }\n      },\n    })\n  }\n\n  globalSmallDialogInputElement.attach(grid, editor, cell.col, cell.row, value)\n}\n\nfunction detachDialogInput(gridFocus?: boolean) {\n  if (globalSmallDialogInputElement) {\n    globalSmallDialogInputElement.detach(gridFocus)\n  }\n}\ntype GetValueResult<T, R> = (\n  value: string,\n  info: { grid: ListGridAPI<T>; col: number; row: number }\n) => R\n\nexport class SmallDialogInputEditor<T> extends BaseInputEditor<T> {\n  private _helperText?: string | GetValueResult<T, string>\n  private _inputValidator?: GetValueResult<T, MaybePromise<string>>\n  private _validator?: GetValueResult<T, MaybePromise<string>>\n  private _classList?: string | string[]\n  private _type?: string\n  public constructor(options: SmallDialogInputEditorOption<T> = {}) {\n    super(options)\n    this._helperText = options.helperText\n    this._inputValidator = options.inputValidator\n    this._validator = options.validator\n    this._classList = options.classList || ''\n    this._type = options.type || ''\n  }\n  public dispose() {\n    // noop\n  }\n  public get classList(): string[] | undefined {\n    if (!this._classList) {\n      return undefined\n    }\n    return Array.isArray(this._classList) ? this._classList : [this._classList]\n  }\n  public set classList(classList) {\n    this._classList = classList\n  }\n  public get type() {\n    return this._type\n  }\n  public set type(type) {\n    this._type = type\n  }\n  public get helperText() {\n    return this._helperText\n  }\n  public get inputValidator() {\n    return this._inputValidator\n  }\n  public get validator() {\n    return this._validator\n  }\n  public clone(): SmallDialogInputEditor<T> {\n    return new SmallDialogInputEditor(this)\n  }\n  public onInputCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    inputValue: string\n  ) {\n    attachDialogInput(grid, cell, this, inputValue)\n  }\n  public onOpenCellInternal(grid: ListGridAPI<T>, cell: CellAddress) {\n    grid.doGetCellValue(cell.col, cell.row, (value) => {\n      attachDialogInput(grid, cell, this, value)\n    })\n  }\n  public onChangeSelectCellInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    selected: any\n  ) {\n    // cancel input\n    detachDialogInput()\n  }\n  public onGridScrollInternal(grid: ListGridAPI<T>) {\n    // cancel input\n    detachDialogInput(true)\n  }\n  public onChangeDisabledInternal() {\n    // cancel input\n    detachDialogInput(true)\n  }\n  public onChangeReadOnlyInternal() {\n    // cancel input\n    detachDialogInput(true)\n  }\n  public onSetInputAttrsInternal(\n    grid: ListGridAPI<T>,\n    cell: CellAddress,\n    input: HTMLInputElement\n  ) {\n    SmallDialogInputElement.setInputAttrs(this, grid, input)\n  }\n}\n","import { ColumnActionOption } from '../ts-types'\nimport { Action } from './action/Action'\nimport { BaseAction } from './action/BaseAction'\nimport { BaseActionInput } from './action/BaseActionInput'\nimport { BaseInputEditor } from './action/BaseInputEditor'\nimport { BaseCheckEditor } from './action/BaseCheckEditor'\nimport { ButtonAction } from './action/ButtonAction'\nimport { CheckEditor } from './action/CheckEditor'\nimport { Editor } from './action/Editor'\nimport { SwitchEditor } from './action/SwitchEditor'\nimport { InlineInputEditor } from './action/InlineInputEditor'\nimport { InlineLookupEditor } from './action/InlineLookupEditor'\nimport { InlineMenuEditor } from './action/InlineMenuEditor'\nimport { InlineTextAreaEditor } from './action/InlineTextAreaEditor'\nimport { RadioEditor } from './action/RadioEditor'\nimport { SmallDialogInputEditor } from './action/SmallDialogInputEditor'\n\nimport { ImmutableCheckEditor } from './immutable/ImmutableCheckEditor'\nimport { ImmutableRadioEditor } from './immutable/ImmutableRadioEditor'\nimport { ImmutableInputEditor } from './immutable/ImmutableInputEditor'\nimport { ImmutableSwitchEditor } from './immutable/ImmutableSwitchEditor'\n\nexport interface ImmutableActions {\n  CHECK: ImmutableCheckEditor<any>\n  RADIO: ImmutableRadioEditor<any>\n  INPUT: ImmutableInputEditor<any>\n  SWITCH: ImmutableSwitchEditor<any>\n}\n\nexport const ACTIONS: ImmutableActions = {\n  CHECK: new ImmutableCheckEditor<any>(),\n  RADIO: new ImmutableRadioEditor<any>(),\n  INPUT: new ImmutableInputEditor<any>(),\n  SWITCH: new ImmutableSwitchEditor<any>(),\n}\n\nexport {\n  BaseAction,\n  Editor,\n  BaseCheckEditor,\n  BaseInputEditor,\n  BaseActionInput,\n  Action,\n  CheckEditor,\n  RadioEditor,\n  SwitchEditor,\n  ButtonAction,\n  SmallDialogInputEditor,\n  InlineInputEditor,\n  InlineTextAreaEditor,\n  InlineLookupEditor,\n  InlineMenuEditor,\n}\n\nexport function of<T>(\n  columnAction: ColumnActionOption | BaseAction<T> | null | undefined\n): BaseAction<T> | undefined {\n  if (!columnAction) {\n    return undefined\n  } else if (typeof columnAction === 'string') {\n    const key = columnAction.toUpperCase() as keyof typeof ACTIONS\n    return ACTIONS[key] || of(null)\n  } else {\n    return columnAction\n  }\n}\n","import { CheckEditor } from '../action/CheckEditor'\n\nexport class ImmutableCheckEditor<T> extends CheckEditor<T> {\n  public get disabled(): boolean | ((record: T) => boolean) {\n    return this._disabled\n  }\n  public get readOnly(): boolean | ((record: T) => boolean) {\n    return this._readOnly\n  }\n}\n","import { RadioEditor } from '../action/RadioEditor'\n\nexport class ImmutableRadioEditor<T> extends RadioEditor<T> {\n  public get disabled(): boolean | ((record: T) => boolean) {\n    return this._disabled\n  }\n  public get readOnly(): boolean | ((record: T) => boolean) {\n    return this._readOnly\n  }\n}\n","import { SmallDialogInputEditor } from '../action/SmallDialogInputEditor'\n\nexport class ImmutableInputEditor<T> extends SmallDialogInputEditor<T> {\n  public get disabled(): boolean | ((record: T) => boolean) {\n    return this._disabled\n  }\n  public get readOnly(): boolean | ((record: T) => boolean) {\n    return this._readOnly\n  }\n}\n","import { SwitchEditor } from '../action/SwitchEditor'\n\nexport class ImmutableSwitchEditor<T> extends SwitchEditor<T> {\n  public get disabled(): boolean | ((record: T) => boolean) {\n    return this._disabled\n  }\n  public get readOnly(): boolean | ((record: T) => boolean) {\n    return this._readOnly\n  }\n}\n","import * as utils from './columnUtils'\nimport {\n  CellContext,\n  GridCanvasHelperAPI,\n  InlineCheckOption,\n  DrawCallback,\n  BaseCheckColumnOption,\n} from '../../ts-types'\nimport {\n  GridInternal,\n  DrawCellInfo,\n  CheckColumnState,\n} from '../../ts-types-internal'\nimport { isDef } from '../../internal/utils'\nimport { BaseColumn } from './BaseColumn'\nimport { CheckStyle } from '../style'\nimport { toBoolean } from '../utils'\n\nexport abstract class BaseCheckColumn<T> extends BaseColumn<T, boolean> {\n  private _draw?: DrawCallback\n  public constructor(options: BaseCheckColumnOption<T> = {}) {\n    super(options)\n    this._draw = options.draw\n  }\n  public get draw() {\n    return this._draw\n  }\n  public drawInternal(\n    value: boolean,\n    context: CellContext,\n    style: CheckStyle,\n    helper: GridCanvasHelperAPI,\n    grid: GridInternal<T>,\n    { getRecord }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      borderColor,\n      checkBgColor,\n      uncheckBgColor,\n    } = style\n\n    const isCustomDraw = utils.customDraw(\n      helper,\n      this.draw,\n      value,\n      context,\n      grid,\n      getRecord()\n    )\n    if (!isCustomDraw) {\n      const { col, row } = context\n      const range = grid.getCellRange(col, row)\n      const cellKey = `${range.start.col}:${range.start.row}`\n      const state = this.getState(grid)\n      const elapsed = state?.elapsed[cellKey]\n\n      const opt: InlineCheckOption = {\n        borderColor,\n        checkBgColor,\n        textAlign,\n        textBaseline,\n        uncheckBgColor,\n      }\n      if (isDef(elapsed)) {\n        opt.animElapsedTime = elapsed\n      }\n      this.doDrawInternal(helper, value, context, opt)\n    }\n  }\n  protected convertInternal(value: any) {\n    return toBoolean(value)\n  }\n  protected abstract getState(grid: GridInternal<T>): CheckColumnState\n  protected abstract doDrawInternal(\n    helper: GridCanvasHelperAPI,\n    value: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): void\n}\n","import { BranchGraphStyleOption, ColorDef } from '../../ts-types'\nimport { BaseStyle } from './BaseStyle'\n\nlet defaultBranchGraphStyle: BranchGraphStyle\n\nconst DEFAULT_BRANCH_COLORS = (_name: string, index: number): string => {\n  switch (index % 3) {\n    case 0:\n      return '#979797'\n    case 1:\n      return '#008fb5'\n    case 2:\n      return '#f1c109'\n    default:\n  }\n  return '#979797'\n}\n\nexport class BranchGraphStyle extends BaseStyle {\n  private _branchColors: ColorDef | ((name: string, index: number) => ColorDef)\n  private _margin: number\n  private _circleSize: number\n  private _branchLineWidth: number\n  private _mergeStyle: 'straight' | 'bezier'\n  public static get DEFAULT(): BranchGraphStyle {\n    return defaultBranchGraphStyle\n      ? defaultBranchGraphStyle\n      : (defaultBranchGraphStyle = new BranchGraphStyle())\n  }\n  public constructor(style: BranchGraphStyleOption = {}) {\n    super(style)\n    this._branchColors = style.branchColors || DEFAULT_BRANCH_COLORS\n    this._margin = style.margin || 4\n    this._circleSize = style.circleSize || 16\n    this._branchLineWidth = style.branchLineWidth || 4\n    this._mergeStyle = style.mergeStyle === 'straight' ? 'straight' : 'bezier'\n  }\n  public get branchColors():\n    | ColorDef\n    | ((name: string, index: number) => ColorDef) {\n    return this._branchColors\n  }\n  public set branchColors(branchColors) {\n    this._branchColors = branchColors\n    this.doChangeStyle()\n  }\n  public get margin(): number {\n    return this._margin\n  }\n  public set margin(margin) {\n    this._margin = margin\n    this.doChangeStyle()\n  }\n  public get circleSize(): number {\n    return this._circleSize\n  }\n  public set circleSize(circleSize) {\n    this._circleSize = circleSize\n    this.doChangeStyle()\n  }\n  public get branchLineWidth(): number {\n    return this._branchLineWidth\n  }\n  public set branchLineWidth(branchLineWidth) {\n    this._branchLineWidth = branchLineWidth\n    this.doChangeStyle()\n  }\n  public get mergeStyle(): 'straight' | 'bezier' {\n    return this._mergeStyle\n  }\n  public set mergeStyle(mergeStyle) {\n    this._mergeStyle = mergeStyle\n    this.doChangeStyle()\n  }\n  public clone(): BranchGraphStyle {\n    return new BranchGraphStyle(this)\n  }\n}\n","import { BranchPoint } from './BranchPoint'\n\nexport class BranchLine {\n  public fromIndex?: number\n  public toIndex?: number\n  public colorIndex: number\n  public point?: BranchPoint\n  public constructor({\n    fromIndex,\n    toIndex,\n    colorIndex,\n    point,\n  }: {\n    fromIndex?: number\n    toIndex?: number\n    colorIndex: number\n    point?: BranchPoint\n  }) {\n    this.fromIndex = fromIndex\n    this.toIndex = toIndex\n    this.colorIndex = colorIndex\n    this.point = point\n  }\n}\n","import { isDef } from '../../../internal/utils'\nimport { BranchLine } from './BranchLine'\n\nexport class BranchPoint {\n  public static mergeLines(lines: BranchLine[]): BranchLine[] {\n    const result = lines.filter((l) => isDef(l.fromIndex) && isDef(l.toIndex))\n\n    const fromLines = lines.filter(\n      (l) => isDef(l.fromIndex) && !isDef(l.toIndex)\n    )\n    const toLines = lines.filter((l) => !isDef(l.fromIndex) && isDef(l.toIndex))\n\n    fromLines.forEach((f) => {\n      for (let i = 0; i < toLines.length; i++) {\n        const t = toLines[i]\n        if (t.point) {\n          continue\n        }\n        if (f.colorIndex === t.colorIndex) {\n          f.toIndex = t.toIndex\n          toLines.splice(i, 1)\n          break\n        }\n      }\n\n      result.push(f)\n    })\n\n    return result.concat(toLines)\n  }\n  public static merge(a: BranchPoint, b: BranchPoint): BranchPoint {\n    if (!a) {\n      return b\n    }\n    return new BranchPoint({\n      commit: a.commit || b.commit,\n      index: a.index,\n      lines: BranchPoint.mergeLines(a.lines.concat(b.lines)),\n      tag: a.tag || b.tag,\n    })\n  }\n  public index: number\n  public commit: boolean\n  public lines: BranchLine[]\n  public tag?: string\n  public constructor({\n    index,\n    commit = false,\n    lines = [],\n    tag,\n  }: {\n    index: number\n    commit?: boolean\n    lines?: BranchLine[]\n    tag?: string\n  }) {\n    this.index = index\n    this.commit = commit\n    this.lines = lines\n    this.tag = tag\n  }\n}\n","import {\n  FieldDef,\n  BranchGraphCommand,\n  MaybePromiseOrUndef,\n  ListGridAPI,\n  ColorDef,\n  BranchGraphColumnOption,\n  MaybePromise,\n  CellContext,\n  GridCanvasHelperAPI,\n} from '../../ts-types'\nimport { GridInternal, DrawCellInfo } from '../../ts-types-internal'\nimport { isPromise, obj, isDef, getOrApply } from '../../internal/utils'\nimport { BranchGraphStyle } from '../style/BranchGraphStyle'\nimport { BaseColumn } from './BaseColumn'\n\nimport { BranchLine } from './branch/BranchLine'\nimport { BranchPoint } from './branch/BranchPoint'\n\nimport { getBranchGraphColumnStateId } from '../../internal/symbolManager'\n\nconst BRANCH_GRAPH_COLUMN_STATE_ID = getBranchGraphColumnStateId()\n\ntype Timelines = { timeline: BranchPoint[][]; branches: string[] }\n\nfunction getAllColumnData<T>(\n  grid: ListGridAPI<T>,\n  field: FieldDef<T>,\n  callback: (allData: BranchGraphCommand[]) => void\n) {\n  const { dataSource } = grid\n  const allData: BranchGraphCommand[] = []\n  let promise\n  for (let index = 0; index < dataSource.length; index++) {\n    const data = dataSource.getField(index, field) as MaybePromiseOrUndef<\n      BranchGraphCommand\n    >\n    if (isPromise(data)) {\n      const dataIndex = allData.length\n      allData.push(undefined)\n      if (!promise) {\n        promise = data.then((d) => {\n          allData[dataIndex] = d\n        })\n      } else {\n        promise = promise\n          .then(() => data)\n          .then((d) => {\n            allData[dataIndex] = d\n          })\n      }\n    } else {\n      allData.push(data)\n    }\n  }\n\n  if (promise) {\n    promise.then(() => callback(allData))\n  } else {\n    callback(allData)\n  }\n}\n\nfunction joinLine(timeline: BranchPoint[][], branchIndex: number): boolean {\n  const reverse = [...timeline].reverse()\n  for (let i = 0; i < reverse.length; i++) {\n    const f = reverse[i][branchIndex]\n    if (f) {\n      f.lines = BranchPoint.mergeLines(\n        f.lines.concat([\n          new BranchLine({\n            colorIndex: branchIndex,\n            toIndex: branchIndex,\n          }),\n        ])\n      )\n\n      for (let j = 0; j < i; j++) {\n        const tl = reverse[j]\n        tl[branchIndex] = new BranchPoint({\n          index: branchIndex,\n          lines: [\n            new BranchLine({\n              colorIndex: branchIndex,\n              fromIndex: branchIndex,\n              toIndex: branchIndex,\n            }),\n          ],\n        })\n      }\n      return true\n    }\n  }\n  return false\n}\n\nfunction branch(\n  { timeline, branches }: Timelines,\n  from: string | null,\n  to: string\n): BranchPoint | null {\n  const fromIndex = from != null ? branches.indexOf(from) : -1\n  let toIndex = branches.indexOf(to)\n  if (toIndex < 0) {\n    toIndex = branches.length\n    branches.push(to)\n  }\n\n  function findBranchRootIndex(): number {\n    for (let index = timeline.length - 1; index >= 0; index--) {\n      const tl = timeline[index]\n      const fromTL = tl[fromIndex]\n      if (fromTL && fromTL.commit) {\n        return index\n      }\n    }\n    return -1\n  }\n\n  if (fromIndex < 0) {\n    return new BranchPoint({\n      index: toIndex,\n    })\n  } else {\n    const fromTargetIndex = findBranchRootIndex()\n    if (fromTargetIndex === -1) {\n      return null\n    }\n    const branchTargetFromIndex = fromTargetIndex + 1\n    const branchPoint = new BranchPoint({\n      index: toIndex,\n      lines: [\n        new BranchLine({\n          colorIndex: toIndex,\n          fromIndex,\n        }),\n      ],\n    })\n    let point\n    let result = null\n    if (branchTargetFromIndex < timeline.length) {\n      const targetLine = timeline[branchTargetFromIndex]\n      point = targetLine[toIndex] = BranchPoint.merge(\n        targetLine[toIndex],\n        branchPoint\n      )\n    } else {\n      point = branchPoint\n      result = branchPoint\n    }\n    const fromTL = timeline[fromTargetIndex][fromIndex]\n    fromTL.lines = BranchPoint.mergeLines(\n      fromTL.lines.concat([\n        new BranchLine({\n          colorIndex: toIndex,\n          point,\n          toIndex,\n        }),\n      ])\n    )\n    return result\n  }\n}\n\nfunction commit(\n  { timeline, branches }: Timelines,\n  name: string\n): BranchPoint | null {\n  const index = branches.indexOf(name)\n  if (index < 0) {\n    return null\n  }\n  const result = new BranchPoint({\n    commit: true,\n    index,\n  })\n\n  if (joinLine(timeline, index)) {\n    result.lines = BranchPoint.mergeLines(\n      result.lines.concat([\n        new BranchLine({\n          colorIndex: index,\n          fromIndex: index,\n        }),\n      ])\n    )\n  }\n  return result\n}\n\nfunction commitTag(\n  { branches }: Timelines,\n  name: any,\n  tag: string\n): BranchPoint {\n  let index = branches.indexOf(name)\n  if (index < 0) {\n    index = branches.length\n    branches.push(name)\n  }\n  return new BranchPoint({\n    index,\n    tag,\n  })\n}\n\nfunction commitMerge(\n  { timeline, branches }: Timelines,\n  from: string,\n  to: string\n): BranchPoint {\n  const fromIndex = branches.indexOf(from)\n  const toIndex = branches.indexOf(to)\n  if (toIndex < 0 || fromIndex < 0) {\n    return new BranchPoint({\n      index: toIndex,\n      commit: true,\n    })\n  }\n  const result = new BranchPoint({\n    index: toIndex,\n    commit: true,\n    lines: [\n      new BranchLine({\n        colorIndex: fromIndex,\n        fromIndex,\n      }),\n      new BranchLine({\n        colorIndex: toIndex,\n        fromIndex: toIndex,\n      }),\n    ],\n  })\n  const froms = [...timeline]\n  const fromTargetLine = froms.pop()\n  if (fromTargetLine) {\n    fromTargetLine[fromIndex] = BranchPoint.merge(\n      fromTargetLine[fromIndex],\n      new BranchPoint({\n        index: toIndex,\n        lines: [\n          new BranchLine({\n            colorIndex: fromIndex,\n            toIndex,\n          }),\n        ],\n      })\n    )\n  }\n\n  if (joinLine(froms, fromIndex) && fromTargetLine) {\n    fromTargetLine[fromIndex].lines = BranchPoint.mergeLines(\n      fromTargetLine[fromIndex].lines.concat([\n        new BranchLine({\n          colorIndex: fromIndex,\n          fromIndex,\n        }),\n      ])\n    )\n  }\n  joinLine(timeline, toIndex)\n\n  return result\n}\n\nfunction calcCommand(info: Timelines, command: BranchGraphCommand): void {\n  const { timeline } = info\n  const timelineData: BranchPoint[] = []\n  // const last = timeline.length > 0 ? timeline[timeline.length - 1] : null;\n  const commands = Array.isArray(command) ? command : [command]\n  commands.forEach((cmd) => {\n    if (!cmd) {\n      return\n    }\n    let point\n    if (cmd.command === 'branch') {\n      const from = obj.isObject(cmd.branch) ? cmd.branch.from : null\n      const to = obj.isObject(cmd.branch) ? cmd.branch.to : cmd.branch\n      point = branch(info, from, to)\n    } else if (cmd.command === 'commit') {\n      point = commit(info, cmd.branch)\n    } else if (cmd.command === 'merge') {\n      const from = cmd.branch.from\n      const to = cmd.branch.to\n      point = commitMerge(info, from, to)\n    } else if (cmd.command === 'tag') {\n      point = commitTag(info, cmd.branch, cmd.tag)\n    }\n    if (point && point.index > -1) {\n      timelineData[point.index] = BranchPoint.merge(\n        timelineData[point.index],\n        point\n      )\n    }\n  })\n  timeline.push(timelineData)\n}\n\nfunction calcBranchesInfo<T>(\n  start: 'top' | 'bottom',\n  grid: ListGridAPI<T>,\n  field: FieldDef<T>\n): Timelines {\n  const result = {\n    branches: [],\n    timeline: [],\n  }\n  getAllColumnData(grid, field, (data) => {\n    if (start !== 'top') {\n      data = [...data].reverse()\n    }\n    data.forEach((command) => {\n      calcCommand(result, command)\n    })\n  })\n  return result\n}\n\nfunction calcBranchXPoints(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  width: number,\n  radius: number,\n  branches: string[],\n  timeline: BranchPoint[][]\n): number[] {\n  let w = Math.max(width / branches.length + 1, 5)\n  timeline.forEach((tl) => {\n    tl.forEach((p, index) => {\n      if (index <= 0) {\n        // 没有计算的意义\n        return\n      }\n      if (p.tag) {\n        const textWidth = ctx.measureText(p.tag).width\n        if (w * index + radius * 2 + 4 + textWidth > width) {\n          w = Math.max((width - radius * 2 - 4 - textWidth) / index, 5)\n        }\n      }\n    })\n  })\n  const result: number[] = []\n  let x = left\n  branches.forEach(() => {\n    result.push(Math.ceil(x + radius))\n    x += w\n  })\n  return result\n}\n\nfunction renderMerge<T>(\n  grid: ListGridAPI<T>,\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  upLineIndex: number | undefined,\n  downLineIndex: number | undefined,\n  colorIndex: number,\n  {\n    branchXPoints,\n    // margin,\n    branchColors,\n    branchLineWidth,\n    mergeStyle,\n  }: {\n    branchXPoints: number[]\n    margin: number\n    branchColors: ColorDef | ((name: string, index: number) => ColorDef)\n    branchLineWidth: number\n    mergeStyle: 'straight' | 'bezier'\n  },\n  {\n    // width,\n    col,\n    row,\n    branches,\n  }: {\n    width: number\n    col: number\n    row: number\n    branches: string[]\n  }\n): void {\n  if (isDef(upLineIndex) || isDef(downLineIndex)) {\n    ctx.strokeStyle = getOrApply(branchColors, branches[colorIndex], colorIndex)\n    ctx.lineWidth = branchLineWidth\n    ctx.lineCap = 'round'\n    ctx.beginPath()\n\n    if (isDef(upLineIndex)) {\n      const upX = branchXPoints[upLineIndex]\n      const upRect = grid.getCellRelativeRect(col, row - 1)\n      const upY = upRect.top + upRect.height / 2\n      ctx.moveTo(upX, upY)\n      if (mergeStyle === 'bezier') {\n        ctx.bezierCurveTo(upX, (y + upY) / 2, x, (y + upY) / 2, x, y)\n      } else {\n        ctx.lineTo(x, y)\n      }\n    } else {\n      ctx.moveTo(x, y)\n    }\n\n    if (isDef(downLineIndex)) {\n      const downX = branchXPoints[downLineIndex]\n      const downRect = grid.getCellRelativeRect(col, row + 1)\n      const downY = downRect.top + downRect.height / 2\n      if (mergeStyle === 'bezier') {\n        ctx.bezierCurveTo(\n          x,\n          (y + downY) / 2,\n          downX,\n          (y + downY) / 2,\n          downX,\n          downY\n        )\n      } else {\n        ctx.lineTo(downX, downY)\n      }\n    }\n\n    ctx.stroke()\n  }\n}\n\n/**\n * BranchGraphColumn\n */\nexport class BranchGraphColumn<T> extends BaseColumn<T, unknown> {\n  private _start: 'top' | 'bottom'\n  private _cache: boolean\n  public constructor(options: BranchGraphColumnOption<T> = {}) {\n    super(options)\n    this._start = options.start || 'bottom'\n    this._cache = isDef(options.cache) ? options.cache : false\n  }\n  public get StyleClass(): typeof BranchGraphStyle {\n    return BranchGraphStyle\n  }\n  public clearCache(grid: GridInternal<T>): void {\n    delete grid[BRANCH_GRAPH_COLUMN_STATE_ID]\n  }\n  public onDrawCell(\n    cellValue: MaybePromise<unknown>,\n    info: DrawCellInfo<T>,\n    context: CellContext,\n    grid: GridInternal<T>\n  ): void | Promise<void> {\n    if (this._cache) {\n      const state =\n        grid[BRANCH_GRAPH_COLUMN_STATE_ID] ||\n        (grid[BRANCH_GRAPH_COLUMN_STATE_ID] = new Map())\n      const { col, row } = context\n      const field = grid.getField(col, row) as FieldDef<T>\n      if (!state.has(field)) {\n        state.set(field, calcBranchesInfo(this._start, grid, field))\n      }\n    }\n    return super.onDrawCell(cellValue, info, context, grid)\n  }\n  public clone(): BranchGraphColumn<T> {\n    return new BranchGraphColumn(this)\n  }\n  public drawInternal(\n    _value: unknown,\n    context: CellContext,\n    style: BranchGraphStyle,\n    helper: GridCanvasHelperAPI,\n    grid: GridInternal<T>,\n    _info: DrawCellInfo<T>\n  ): void {\n    const { col, row } = context\n    const field = grid.getField(col, row) as FieldDef<T>\n    const { timeline, branches } =\n      (this._cache ? grid[BRANCH_GRAPH_COLUMN_STATE_ID]?.get(field) : null) ??\n      calcBranchesInfo(this._start, grid, field)\n\n    const {\n      upLineIndexKey,\n      downLineIndexKey,\n    }: {\n      upLineIndexKey: 'fromIndex' | 'toIndex'\n      downLineIndexKey: 'fromIndex' | 'toIndex'\n    } =\n      this._start !== 'top'\n        ? { upLineIndexKey: 'toIndex', downLineIndexKey: 'fromIndex' }\n        : { upLineIndexKey: 'fromIndex', downLineIndexKey: 'toIndex' }\n    const data =\n      this._start !== 'top'\n        ? timeline[timeline.length - (row - grid.frozenRowCount) - 1]\n        : timeline[row - grid.frozenRowCount]\n\n    const {\n      branchColors,\n      branchLineWidth,\n      circleSize,\n      mergeStyle,\n      margin,\n    } = style\n\n    const rect = context.getRect()\n    const radius = circleSize / 2\n    const width = rect.width - margin * 2\n\n    helper.drawWithClip(context, (ctx) => {\n      ctx.textAlign = 'left'\n      ctx.textBaseline = 'middle'\n      const branchXPoints = calcBranchXPoints(\n        ctx,\n        rect.left + margin,\n        width,\n        radius,\n        branches,\n        timeline\n      )\n\n      const y = rect.top + rect.height / 2\n\n      // draw join lines\n      data\n        .map((point, index) =>\n          point\n            ? point.lines.map((line) => ({\n                colorIndex: line.colorIndex,\n                downLineIndex: line[downLineIndexKey],\n                pointIndex: index,\n                upLineIndex: line[upLineIndexKey],\n              }))\n            : []\n        )\n        .reduce((p, c) => p.concat(c), []) // flatMap\n        // order of overlap\n        .sort((a, b) => b.colorIndex - a.colorIndex)\n        .forEach((line) => {\n          const x = branchXPoints[line.pointIndex]\n          renderMerge(\n            grid,\n            ctx,\n            x,\n            y,\n            line.upLineIndex,\n            line.downLineIndex,\n            line.colorIndex,\n            {\n              branchColors,\n              branchLineWidth,\n              branchXPoints,\n              margin,\n              mergeStyle,\n            },\n            {\n              branches,\n              col,\n              row,\n              width,\n            }\n          )\n        })\n      // draw commit points\n      data.forEach((p, index) => {\n        if (p && p.commit) {\n          const x = branchXPoints[index]\n          ctx.fillStyle = getOrApply(branchColors, branches[index], index)\n          ctx.beginPath()\n          ctx.arc(x, y, radius, 0, Math.PI * 2, true)\n          ctx.fill()\n          ctx.closePath()\n        }\n      })\n      // draw tags\n      data.forEach((p, index) => {\n        if (p && p.tag) {\n          ctx.fillStyle = getOrApply(branchColors, branches[index], index)\n          ctx.fillText(p.tag, branchXPoints[index] + radius + 4, y)\n        }\n      })\n    })\n  }\n}\n","import * as columnUtils from './columnUtils'\nimport {\n  ColumnOption,\n  DrawCallback,\n  CellContext,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  CellStyle,\n} from '../../ts-types'\nimport { BaseColumn } from './BaseColumn'\nimport { Style } from '../style/Style'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { getInlineInputEditorStateId } from '../../internal/symbolManager'\nimport Rect from '../../internal/Rect'\n\nconst INLINE_INPUT_EDITOR_STATE_ID = getInlineInputEditorStateId()\n\nexport class Column<T> extends BaseColumn<T, string> {\n  private _draw?: DrawCallback\n  private _cellStyle?: CellStyle\n  public constructor(options: ColumnOption<T> = {}) {\n    super(options)\n    this._draw = options.draw\n    this._cellStyle = options.cellStyle\n  }\n  public get StyleClass() {\n    return Style\n  }\n  public clone(): Column<T> {\n    return new Column(this)\n  }\n  public get draw() {\n    return this._draw\n  }\n  public get cellStyle(): CellStyle | undefined {\n    return this._cellStyle\n  }\n  public reviseAttachCellsArea(rect: Rect, row: number, grid: ListGridAPI<T>) {\n    columnUtils.reviseAttachCellsArea(rect, row, grid, this._cellStyle)\n  }\n  public reviseAttachCellsPadding(\n    padding: [number, number, number, number],\n    row: number,\n    grid: ListGridAPI<T>\n  ) {\n    super.reviseAttachCellsPadding(padding, row, grid)\n    columnUtils.reviseAttachCellsPadding(padding, row, grid, this._cellStyle)\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: Style,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { getIcon, getRecord }: DrawCellInfo<T>\n  ): void {\n    const { textAlign, textBaseline, color, font, textOverflow } = style\n\n    helper.testFontLoad(font, value, context)\n    columnUtils.loadIcons(getIcon(), context, helper, (icons, ctx) => {\n      const isCustomDraw = columnUtils.customDraw<T>(\n        helper,\n        this.draw,\n        value,\n        context,\n        grid,\n        getRecord()\n      )\n      if (!isCustomDraw) {\n        helper.text(value, ctx, {\n          color,\n          font,\n          icons,\n          padding: columnUtils.getActionTextPadding(context, helper, style),\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      }\n      columnUtils.drawActionButton(\n        grid,\n        context,\n        INLINE_INPUT_EDITOR_STATE_ID,\n        helper,\n        style\n      )\n      columnUtils.drawAttachArea(\n        grid,\n        getRecord(),\n        context,\n        helper,\n        this._cellStyle\n      )\n    })\n  }\n}\n","import * as utils from './columnUtils'\nimport {\n  ButtonColumnOption,\n  ListGridAPI,\n  GridCanvasHelperAPI,\n  CellContext,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { ButtonStyle } from '../style/ButtonStyle'\nimport { Column } from './Column'\nimport { getButtonColumnStateId } from '../../internal/symbolManager'\nimport { cellInRange } from '../../internal/utils'\n\nconst BUTTON_COLUMN_STATE_ID = getButtonColumnStateId()\n\nexport class ButtonColumn<T> extends Column<T> {\n  private _caption?: string\n  private _linkButton: boolean\n  public constructor(options: ButtonColumnOption<T> = {}) {\n    super(options)\n    this._caption = options.caption\n    this._linkButton = !!options.linkButton\n  }\n  public get StyleClass(): typeof ButtonStyle {\n    return ButtonStyle\n  }\n  public get caption(): string | undefined {\n    return this._caption\n  }\n  public withCaption(caption: string): ButtonColumn<T> {\n    const c = this.clone()\n    c._caption = caption\n    return c\n  }\n  public clone(): ButtonColumn<T> {\n    return new ButtonColumn(this)\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: ButtonStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { getIcon }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      color,\n      buttonBgColor,\n      font,\n      padding,\n      textOverflow,\n    } = style\n\n    helper.testFontLoad(font, value, context)\n    const { col, row } = context\n    const range = grid.getCellRange(col, row)\n    let active = false\n    let selected = false\n    const state = (grid as any)[BUTTON_COLUMN_STATE_ID]\n    if (state) {\n      if (\n        state.mouseActiveCell &&\n        cellInRange(range, state.mouseActiveCell.col, state.mouseActiveCell.row)\n      ) {\n        active = true\n      }\n      const { select } = context.getSelection()\n      if (cellInRange(range, select.col, select.row)) {\n        selected = true\n      }\n    }\n\n    utils.loadIcons(getIcon(), context, helper, (icons, ctx) => {\n      if (this._linkButton) {\n        if (active && state && state.mouseRelativePos) {\n          const rect = helper.getTextRect(value, ctx, {\n            font,\n            icons,\n            padding,\n            textAlign,\n            textBaseline,\n            textOverflow,\n          })\n          active =\n            rect.left <= state.mouseRelativePos.x &&\n            rect.right >= state.mouseRelativePos.x &&\n            rect.top <= state.mouseRelativePos.y &&\n            rect.bottom >= state.mouseRelativePos.y\n          state.mouseActive = active\n        }\n        helper.text(value, ctx, {\n          color: active ? buttonBgColor || helper.theme.button.bgColor : color,\n          font,\n          icons,\n          padding,\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      } else {\n        if (active) {\n          state.mouseActive = active\n        }\n        helper.button(value, ctx, {\n          bgColor: buttonBgColor,\n          color,\n          font,\n          icons,\n          padding,\n          shadow:\n            active || selected\n              ? {\n                  blur: 6,\n                  color: 'rgba(0, 0, 0, 0.48)',\n                  offsetY: 3,\n                }\n              : {},\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      }\n    })\n  }\n  protected convertInternal(value: unknown) {\n    return this._caption || super.convertInternal(value)\n  }\n}\n","import {\n  CellContext,\n  GridCanvasHelperAPI,\n  InlineCheckOption,\n} from '../../ts-types'\nimport { CheckColumnState, GridInternal } from '../../ts-types-internal'\nimport { CheckStyle } from '../style/CheckStyle'\nimport { BaseCheckColumn } from './BaseCheckColumn'\nimport { getCheckColumnStateId } from '../../internal/symbolManager'\nimport { obj } from '../../internal/utils'\n\nconst CHECK_COLUMN_STATE_ID = getCheckColumnStateId()\n\nexport class CheckColumn<T> extends BaseCheckColumn<T> {\n  public get StyleClass() {\n    return CheckStyle\n  }\n  public clone(): CheckColumn<T> {\n    return new CheckColumn(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckColumnState {\n    let state = grid[CHECK_COLUMN_STATE_ID]\n    if (!state) {\n      state = { block: {}, elapsed: {} }\n      obj.setReadonly(grid, CHECK_COLUMN_STATE_ID, state)\n    }\n    return state\n  }\n  protected doDrawInternal(\n    helper: GridCanvasHelperAPI,\n    value: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): void {\n    helper.checkbox(value, context, opt)\n  }\n}\n","import {\n  GridCanvasHelperAPI,\n  CellContext,\n  InlineCheckOption,\n} from '../../ts-types'\nimport { CheckColumnState, GridInternal } from '../../ts-types-internal'\nimport { SwitchStyle } from '../style/SwitchStyle'\nimport { BaseCheckColumn } from './BaseCheckColumn'\nimport { getSwitchColumnStateId } from '../../internal/symbolManager'\nimport { obj } from '../../internal/utils'\n\nconst SWITCH_COLUMN_STATE_ID = getSwitchColumnStateId()\n\nexport class SwitchColumn<T> extends BaseCheckColumn<T> {\n  public get StyleClass(): typeof SwitchStyle {\n    return SwitchStyle\n  }\n  public clone(): SwitchColumn<T> {\n    return new SwitchColumn(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckColumnState {\n    let state = grid[SWITCH_COLUMN_STATE_ID]\n    if (!state) {\n      state = { block: {}, elapsed: {} }\n      obj.setReadonly(grid, SWITCH_COLUMN_STATE_ID, state)\n    }\n    return state\n  }\n  protected doDrawInternal(\n    helper: GridCanvasHelperAPI,\n    value: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): void {\n    helper.switch(value, context, opt)\n  }\n}\n","import { DateColumnOption } from '../../ts-types'\nimport { DateStyle } from '../style/DateStyle'\nimport { Column } from './Column'\n\nlet defaultDateTimeFormat: Intl.DateTimeFormat\n\nexport class DateColumn<T> extends Column<T> {\n  public static get defaultFormat() {\n    return (\n      defaultDateTimeFormat ||\n      (defaultDateTimeFormat = new Intl.DateTimeFormat())\n    )\n  }\n  public static set defaultFormat(fmt) {\n    defaultDateTimeFormat = fmt\n  }\n  private _format?: Intl.DateTimeFormat\n  public constructor(options: DateColumnOption<T> = {}) {\n    super(options)\n    this._format = options.format\n  }\n  public get StyleClass(): typeof DateStyle {\n    return DateStyle\n  }\n  public get format(): Intl.DateTimeFormat | undefined {\n    return this._format\n  }\n  public clone(): DateColumn<T> {\n    return new DateColumn(this)\n  }\n  public withFormat(format: Intl.DateTimeFormat): DateColumn<T> {\n    const c = this.clone()\n    c._format = format\n    return c\n  }\n  protected convertInternal(value: Date): string {\n    if (value instanceof Date) {\n      const format = this._format || DateColumn.defaultFormat\n      return format.format(value)\n    } else {\n      return ''\n    }\n  }\n}\n","import * as utils from './columnUtils'\nimport {\n  DrawCallback,\n  DrawColumnOptions,\n  ListGridAPI,\n  GridCanvasHelperAPI,\n  CellContext,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { DrawStyle } from '../style/DrawStyle'\nimport { BaseColumn } from './BaseColumn'\nimport { getInlineInputEditorStateId } from '../../internal/symbolManager'\n\nconst INLINE_INPUT_EDITOR_STATE_ID = getInlineInputEditorStateId()\n\nexport class DrawColumn<T> extends BaseColumn<T, unknown> {\n  private _draw?: DrawCallback\n  public constructor(options: DrawColumnOptions<T> = {}) {\n    super(options)\n    this._draw = options.draw\n  }\n  public get StyleClass() {\n    return DrawStyle\n  }\n  public clone(): DrawColumn<T> {\n    return new DrawColumn(this)\n  }\n  public get draw() {\n    return this._draw\n  }\n  public drawInternal(\n    value: any,\n    context: CellContext,\n    style: DrawStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { getRecord }: DrawCellInfo<T>\n  ): void {\n    utils.customDraw(helper, this.draw, value, context, grid, getRecord())\n    utils.drawActionButton(\n      grid,\n      context,\n      INLINE_INPUT_EDITOR_STATE_ID,\n      helper,\n      style as any\n    )\n  }\n}\n","import { icons } from '../../internal/icons'\nimport {\n  IconColumnOption,\n  ColumnIconOption,\n  ListGridAPI,\n  GridCanvasHelperAPI,\n  CellContext,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { IconStyle } from '../style/IconStyle'\nimport { Column } from './Column'\n\nfunction repeatArray(\n  val: ColumnIconOption<unknown>,\n  count: number\n): ColumnIconOption<unknown>[] {\n  if (count === Infinity) {\n    count = 0\n  }\n  const a = []\n  for (let i = 0; i < count; i++) {\n    a.push(val)\n  }\n  return a\n}\n\nexport class IconColumn<T> extends Column<T> {\n  private _tagName: string\n  private _className?: string\n  private _content?: string\n  private _name?: string\n  private _iconWidth?: number\n  public constructor(options: IconColumnOption<T> = {}) {\n    super(options)\n    this._tagName = options.tagName || 'i'\n    this._className = options.className\n    this._content = options.content\n    this._name = options.name\n    this._iconWidth = options.iconWidth\n  }\n  public get StyleClass(): typeof IconStyle {\n    return IconStyle\n  }\n  public clone(): IconColumn<T> {\n    return new IconColumn(this)\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: IconStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ) {\n    const num = Number(value)\n    if (!isNaN(num)) {\n      const icon: IconColumnOption<T> & { width?: number } = {}\n      icons.iconPropKeys.forEach((k) => {\n        ;(icon as any)[k] = (style as any)[k]\n      })\n      icon.className = this._className\n      icon.tagName = this._tagName\n      icon.content = this._content\n      icon.name = this._name\n      if (this._iconWidth) {\n        icon.width = this._iconWidth\n      }\n\n      info.getIcon = (): ColumnIconOption<unknown>[] =>\n        repeatArray(icon as ColumnIconOption<unknown>, num)\n    } else {\n      info.getIcon = (): null => null\n    }\n    super.drawInternal('', context, style, helper, grid, info)\n  }\n}\n","import { RectProps } from '../ts-types'\n\nexport type PaddingOption = {\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n}\n\nconst fontSizeCache: {\n  [key: string]: {\n    width: number\n    height: number\n  }\n} = {}\n\nexport function getFontSize(\n  ctx: CanvasRenderingContext2D,\n  font: string | null | undefined\n): {\n  width: number\n  height: number\n} {\n  const fontName = font || ctx.font\n  if (fontSizeCache[fontName]) {\n    return fontSizeCache[fontName]\n  }\n  const bk = ctx.font\n  try {\n    ctx.font = fontName\n    const em = ctx.measureText('哦').width\n    return (fontSizeCache[fontName] = {\n      height: em,\n      width: em,\n    })\n  } finally {\n    ctx.font = bk\n  }\n}\n\nexport function calcBasePosition(\n  ctx: CanvasRenderingContext2D,\n  rect: RectProps,\n  {\n    offset = 0,\n    padding: {\n      left: paddingLeft = 0,\n      right: paddingRight = 0,\n      top: paddingTop = 0,\n      bottom: paddingBottom = 0,\n    } = {},\n  }: {\n    offset?: number\n    padding?: PaddingOption\n  } = {}\n): { x: number; y: number } {\n  return calcStartPosition(ctx, rect, 0, 0, {\n    offset,\n    padding: {\n      bottom: paddingBottom,\n      left: paddingLeft,\n      right: paddingRight,\n      top: paddingTop,\n    },\n  })\n}\n\nexport function calcStartPosition(\n  ctx: CanvasRenderingContext2D,\n  rect: RectProps,\n  width: number,\n  height: number,\n  {\n    offset = 0,\n    padding: {\n      left: paddingLeft = 0,\n      right: paddingRight = 0,\n      top: paddingTop = 0,\n      bottom: paddingBottom = 0,\n    } = {},\n  }: {\n    offset?: number\n    padding?: PaddingOption\n  } = {}\n): { x: number; y: number } {\n  const textAlign = ctx.textAlign || 'left'\n  const textBaseline = ctx.textBaseline || 'middle'\n  ctx.textAlign = textAlign\n  ctx.textBaseline = textBaseline\n\n  let x = rect.left + offset + paddingLeft\n  if (textAlign === 'right' || textAlign === 'end') {\n    x = rect.right - width - offset - paddingRight\n  } else if (textAlign === 'center') {\n    x = rect.left + (rect.width - width + paddingLeft - paddingRight) / 2\n  }\n  let y = rect.top + offset + paddingTop\n  if (\n    textBaseline === 'bottom' ||\n    textBaseline === 'alphabetic' ||\n    textBaseline === 'ideographic'\n  ) {\n    y = rect.bottom - height - offset - paddingBottom\n  } else if (textBaseline === 'middle') {\n    y = rect.top + (rect.height - height + paddingTop - paddingBottom) / 2\n  }\n  return { x, y }\n}\n","export class LRUCache<T> {\n  private _list: string[]\n  private _map: { [key: string]: T }\n  private _cacheSize: number\n  public constructor(cacheSize: number) {\n    this._list = []\n    this._map = {}\n    this._cacheSize = cacheSize || 50\n  }\n  public get(key: string): T {\n    const val = this._map[key]\n    if (val) {\n      const list = this._list\n      const idx = list.indexOf(key)\n      list.splice(idx, 1)\n      list.push(key)\n    }\n    return val\n  }\n  public put(key: string, value: T): void {\n    const list = this._list\n    const map = this._map\n    if (map[key]) {\n      const idx = list.indexOf(key)\n      list.splice(idx, 1)\n    }\n    map[key] = value\n    list.push(key)\n    if (list.length > this._cacheSize) {\n      const remKey = list.shift() || ''\n      delete map[remKey]\n    }\n  }\n}\n","import { MaybePromise } from '../ts-types'\nimport { LRUCache } from './LRUCache'\nimport { then } from './utils'\n\nconst allCache: {\n  [key: string]: LRUCache<MaybePromise<HTMLImageElement>>\n} = {}\n\n// function isDataUrl(url: string): boolean {\n//   return url ? url.search(/^(data:)/) !== -1 : false\n// }\n\nfunction loadImage(src: string): Promise<HTMLImageElement> {\n  if (typeof Promise === 'undefined') {\n    window.console.error(\n      'Promise is not loaded. load Promise before this process.'\n    )\n    return {\n      then(): Promise<HTMLImageElement> {\n        return this as any\n      },\n    } as any\n  }\n  const img = new Image()\n  const result = new Promise<HTMLImageElement>((resolve) => {\n    img.onload = (): void => {\n      resolve(img)\n    }\n  })\n  img.onerror = (): void => {\n    const url = src.length > 200 ? `${src.substr(0, 200)}...` : src\n    console.warn(`cannot load: ${url}`)\n    throw new Error(`IMAGE LOAD ERROR: ${url}`)\n  }\n  // img.src = isDataUrl(src) ? src : `${src}?${Date.now()}`\n  img.src = src\n  return result\n}\n\nfunction getCacheOrLoad0(\n  cache: LRUCache<MaybePromise<HTMLImageElement>>,\n  src: MaybePromise<string>\n): MaybePromise<HTMLImageElement> {\n  return then(src, (src) => {\n    const c = cache.get(src)\n    if (c) {\n      return c\n    }\n    const result = loadImage(src).then((img: any) => {\n      cache.put(src, img)\n      return img\n    })\n    cache.put(src, result)\n    return result\n  })\n}\n\nexport function getCacheOrLoad(\n  cacheName: string,\n  cacheSize: number,\n  src: MaybePromise<string>\n): MaybePromise<HTMLImageElement> {\n  const cache =\n    allCache[cacheName] ||\n    (allCache[cacheName] = new LRUCache<MaybePromise<HTMLImageElement>>(\n      cacheSize\n    ))\n  return getCacheOrLoad0(cache, src)\n}\n","import * as utils from './columnUtils'\nimport {\n  ListGridAPI,\n  MaybePromise,\n  CellContext,\n  GridCanvasHelperAPI,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { calcStartPosition } from '../../internal/canvases'\nimport { getCacheOrLoad } from '../../internal/imgs'\nimport Rect from '../../internal/Rect'\nimport { ImageStyle } from '../style/ImageStyle'\nimport { BaseColumn } from './BaseColumn'\nimport { getInlineInputEditorStateId } from '../../internal/symbolManager'\n\nconst INLINE_INPUT_EDITOR_STATE_ID = getInlineInputEditorStateId()\n\nconst MAX_LRU_CACHE_SIZE = 50\nfunction getImage(url: MaybePromise<string>): MaybePromise<HTMLImageElement> {\n  return getCacheOrLoad('ImageColumn', MAX_LRU_CACHE_SIZE, url)\n}\n\nfunction calcKeepAspectRatioSize(\n  width: number,\n  height: number,\n  maxWidth: number,\n  maxHeight: number\n): {\n  width: number\n  height: number\n} {\n  let newWidth = width\n  let newHeight = height\n  if (newWidth > maxWidth) {\n    newWidth = maxWidth\n    newHeight = (newWidth * height) / width\n  }\n  if (newHeight > maxHeight) {\n    newHeight = maxHeight\n    newWidth = (newHeight * width) / height\n  }\n  return {\n    height: newHeight,\n    width: newWidth,\n  }\n}\n\nexport class ImageColumn<T> extends BaseColumn<T, HTMLImageElement> {\n  public get StyleClass(): typeof ImageStyle {\n    return ImageStyle\n  }\n  public onDrawCell(\n    cellValue: MaybePromise<string>,\n    info: DrawCellInfo<T>,\n    context: CellContext,\n    grid: ListGridAPI<T>\n  ) {\n    const img = cellValue ? getImage(cellValue) : ''\n    return super.onDrawCell(img, info, context, grid)\n  }\n  public clone(): ImageColumn<T> {\n    return new ImageColumn(this)\n  }\n  public drawInternal(\n    value: HTMLImageElement,\n    context: CellContext,\n    style: ImageStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    _info: DrawCellInfo<T>\n  ) {\n    const { textAlign, textBaseline, margin } = style\n\n    if (value) {\n      helper.drawWithClip(context, (ctx) => {\n        ctx.textAlign = textAlign\n        ctx.textBaseline = textBaseline\n\n        const rect = (context.getRect() as Rect).copy()\n        const padding = utils.getActionTextPadding(\n          context,\n          helper,\n          style as any\n        )\n        rect.width -= padding[1]\n        if (rect.width < 0) {\n          rect.width = 0\n        }\n\n        if (style.imageSizing === 'keep-aspect-ratio') {\n          const size = calcKeepAspectRatioSize(\n            value.width,\n            value.height,\n            rect.width - margin * 2,\n            rect.height - margin * 2\n          )\n          const width = size.width\n          const height = size.height\n          const pos = calcStartPosition(ctx, rect, width, height, {\n            offset: margin,\n          })\n          ctx.drawImage(\n            value,\n            0,\n            0,\n            value.width,\n            value.height,\n            pos.x,\n            pos.y,\n            width,\n            height\n          )\n        } else {\n          ctx.drawImage(\n            value,\n            0,\n            0,\n            value.width,\n            value.height,\n            rect.left + margin,\n            rect.top + margin,\n            rect.width - margin * 2,\n            rect.height - margin * 2\n          )\n        }\n      })\n    }\n    utils.drawActionButton(\n      grid,\n      context,\n      INLINE_INPUT_EDITOR_STATE_ID,\n      helper,\n      style as any\n    )\n  }\n}\n","import * as columnUtils from './columnUtils'\nimport {\n  CellAddress,\n  LookupColumnOption,\n  CellContext,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  DrawCallback,\n  CellStyle,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { LookupStyle } from '../style/LookupStyle'\nimport { BaseColumn } from './BaseColumn'\nimport { getOrApply, isPromise, isDef } from '../../internal/utils'\nimport { getInlineLookupEditorStateId } from '../../internal/symbolManager'\nimport Rect from '../../internal/Rect'\n\nconst INLINE_LOOKUP_EDITOR_STATE_ID = getInlineLookupEditorStateId()\n\nlet lookupColumnPromiseDrawingCol = ''\n\nexport class LookupColumn<T, L> extends BaseColumn<T, string> {\n  private _records?: L[] | ((rec: T) => L[] | Promise<L[]>)\n  private _lookupMap: {\n    [key: string]: string\n  } = {}\n  private _valueField?: string\n  private _captionField?: string\n  private _draw?: DrawCallback\n  private _cellStyle?: CellStyle\n  public constructor(options: LookupColumnOption<T, L> = {}) {\n    super(options)\n    this._records = options.records\n    this._valueField = options.valueField\n    this._captionField = options.captionField\n    this._draw = options.draw\n    this._cellStyle = options.cellStyle\n  }\n  public get StyleClass(): typeof LookupStyle {\n    return LookupStyle\n  }\n  public get records(): L[] | ((rec: T) => L[] | Promise<L[]>) | undefined {\n    return this._records\n  }\n  public get valueField(): string | undefined {\n    return this._valueField\n  }\n  public get captionField(): string | undefined {\n    return this._captionField\n  }\n  public get draw(): DrawCallback | undefined {\n    return this._draw\n  }\n  public get cellStyle(): CellStyle | undefined {\n    return this._cellStyle\n  }\n  public reviseAttachCellsArea(rect: Rect, row: number, grid: ListGridAPI<T>) {\n    columnUtils.reviseAttachCellsArea(rect, row, grid, this._cellStyle)\n  }\n  public reviseAttachCellsPadding(\n    padding: [number, number, number, number],\n    row: number,\n    grid: ListGridAPI<T>\n  ) {\n    super.reviseAttachCellsPadding(padding, row, grid)\n    columnUtils.reviseAttachCellsPadding(padding, row, grid, this._cellStyle)\n  }\n  public clone(): LookupColumn<T, L> {\n    return new LookupColumn(this)\n  }\n  public drawInternal(\n    value: any,\n    context: CellContext,\n    style: LookupStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ) {\n    const getIcon = info.getIcon\n    const getCell = info.getCell\n    const getRecord = info.getRecord\n    const records = getOrApply(this.records || [], getRecord())\n    if (isPromise(records)) {\n      const cell = getCell()\n      const col = cell.col\n      const row = cell.row\n      if (!lookupColumnPromiseDrawingCol) {\n        records.then(\n          ((me, col, row) => (rs: L[]) => {\n            lookupColumnPromiseDrawingCol = String(col)\n            try {\n              me._mergeRecords(rs)\n              const range = grid.getCellRange(col, row)\n              grid.invalidateCellRange(range)\n            } finally {\n              lookupColumnPromiseDrawingCol = ''\n            }\n          })(this, col, row)\n        )\n        return\n      }\n    } else {\n      this._mergeRecords(records)\n    }\n\n    const textAlign = style.textAlign\n    const textBaseline = style.textBaseline\n    const font = style.font\n    const textOverflow = style.textOverflow\n\n    let color = style.color\n\n    const text = this._convertInternal(value, getCell(), grid)\n    helper.testFontLoad(font, text, context)\n\n    columnUtils.loadIcons(getIcon(), context, helper, (icons, ctx) => {\n      const isCustomDraw = columnUtils.customDraw(\n        helper,\n        this.draw,\n        text,\n        context,\n        grid,\n        getRecord()\n      )\n      if (!isCustomDraw) {\n        if (!isDef(color) && (!isDef(value) || value === '')) {\n          color = 'rgba(0, 0, 0, .38)'\n        }\n        helper.text(text, ctx, {\n          color,\n          font,\n          icons,\n          padding: columnUtils.getActionTextPadding(ctx, helper, style),\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      }\n      columnUtils.drawActionButton(\n        grid,\n        ctx,\n        INLINE_LOOKUP_EDITOR_STATE_ID,\n        helper,\n        style\n      )\n      columnUtils.drawAttachArea(\n        grid,\n        getRecord(),\n        context,\n        helper,\n        this._cellStyle\n      )\n    })\n  }\n  public convertCopyInternal(value: unknown) {\n    return isDef(value) ? this._convertInternalValue(value) : ''\n  }\n  protected convertInternal(value: any): string {\n    return value\n  }\n  protected doConvertInternal(\n    value: unknown,\n    _cell: CellAddress,\n    _grid: ListGridAPI<T>\n  ) {\n    return this.convertInternal(value)\n  }\n  private _convertInternalValue(value: unknown): string {\n    const key = isDef(value) ? value + '' : ''\n    let v = this._lookupMap[key]\n    if (!isDef(v)) {\n      v = key\n    }\n    return v\n  }\n  private _convertInternal(\n    value: any,\n    cell: CellAddress,\n    grid: ListGridAPI<T>\n  ) {\n    let v = this._convertInternalValue(value)\n    if (this.convert) {\n      v = this.convert(value, v, cell, grid)\n    }\n    return this.doConvertInternal(v, cell, grid)\n  }\n  private _mergeRecords(recs: L[] = []) {\n    const valueField = this.valueField || 'id'\n    const captionField = this.captionField || valueField\n    for (const record of recs) {\n      let key = (record as any)[valueField]\n      key = isDef(key) ? key + '' : ''\n      let value = (record as any)[captionField]\n      value = isDef(value) ? value + '' : ''\n      this._lookupMap[key] = value\n    }\n  }\n}\n","import * as columnUtils from './columnUtils'\nimport {\n  MultilineTextColumnOption,\n  DrawCallback,\n  CellContext,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  CellStyle,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { MultilineTextStyle } from '../style/MultilineTextStyle'\nimport { BaseColumn } from './BaseColumn'\nimport { isDef } from '../../internal/utils'\nimport { getInlineTextareaEditorStateId } from '../../internal/symbolManager'\nimport Rect from '../../internal/Rect'\n\nconst INLINE_TEXTAREA_EDITOR_STATE_ID = getInlineTextareaEditorStateId()\n\nexport class MultilineTextColumn<T> extends BaseColumn<T, string> {\n  private _draw?: DrawCallback\n  private _cellStyle?: CellStyle\n  public constructor(options: MultilineTextColumnOption<T> = {}) {\n    super(options)\n    this._draw = options.draw\n    this._cellStyle = options.cellStyle\n  }\n  public get StyleClass(): typeof MultilineTextStyle {\n    return MultilineTextStyle\n  }\n  public clone(): MultilineTextColumn<T> {\n    return new MultilineTextColumn(this)\n  }\n  public get draw() {\n    return this._draw\n  }\n  public get cellStyle(): CellStyle | undefined {\n    return this._cellStyle\n  }\n  public reviseAttachCellsArea(rect: Rect, row: number, grid: ListGridAPI<T>) {\n    columnUtils.reviseAttachCellsArea(rect, row, grid, this._cellStyle)\n  }\n  public reviseAttachCellsPadding(\n    padding: [number, number, number, number],\n    row: number,\n    grid: ListGridAPI<T>\n  ) {\n    super.reviseAttachCellsPadding(padding, row, grid)\n    columnUtils.reviseAttachCellsPadding(padding, row, grid, this._cellStyle)\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: MultilineTextStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { getIcon, getRecord }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      color,\n      font,\n      lineHeight,\n      autoWrapText,\n      lineClamp,\n      textOverflow,\n    } = style\n\n    const v = isDef(value) ? value + '' : ''\n    const multiline = v.replace(/\\r?\\n/g, '\\n').replace(/\\r/g, '\\n').split('\\n')\n    helper.testFontLoad(font, v, context)\n    columnUtils.loadIcons(getIcon(), context, helper, (icons, ctx) => {\n      const isCustomDraw = columnUtils.customDraw(\n        helper,\n        this.draw,\n        multiline,\n        context,\n        grid,\n        getRecord()\n      )\n      if (!isCustomDraw) {\n        helper.multilineText(multiline, ctx, {\n          autoWrapText,\n          color,\n          font,\n          icons,\n          lineClamp,\n          lineHeight,\n          padding: columnUtils.getActionTextPadding(context, helper, style),\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      }\n      columnUtils.drawActionButton(\n        grid,\n        context,\n        INLINE_TEXTAREA_EDITOR_STATE_ID,\n        helper,\n        style\n      )\n      columnUtils.drawAttachArea(\n        grid,\n        getRecord(),\n        context,\n        helper,\n        this._cellStyle\n      )\n    })\n  }\n}\n","import { NumberColumnOption } from '../../ts-types'\nimport { NumberStyle } from '../style/NumberStyle'\nimport { Column } from './Column'\n\nlet defaultFormat: Intl.NumberFormat\n\nexport class NumberColumn<T> extends Column<T> {\n  public static get defaultFormat(): Intl.NumberFormat {\n    return defaultFormat || (defaultFormat = new Intl.NumberFormat())\n  }\n  public static set defaultFormat(fmt) {\n    defaultFormat = fmt\n  }\n  private _format?: Intl.NumberFormat\n  public constructor(options: NumberColumnOption<T> = {}) {\n    super(options)\n    this._format = options.format\n  }\n  public get StyleClass(): typeof NumberStyle {\n    return NumberStyle\n  }\n  public get format(): Intl.NumberFormat | undefined {\n    return this._format\n  }\n  public clone(): NumberColumn<T> {\n    return new NumberColumn(this)\n  }\n  public withFormat(format: Intl.NumberFormat): NumberColumn<T> {\n    const c = this.clone()\n    c._format = format\n    return c\n  }\n  protected convertInternal(value: unknown): string {\n    let s: any = (value + '').trim()\n    if (s) {\n      s = s - 0\n      if (isNaN(s)) {\n        s = ''\n      } else {\n        s = (this._format || NumberColumn.defaultFormat).format(s)\n      }\n    }\n    return s\n  }\n}\n","import {\n  PercentCompleteBarColumnOption,\n  GridCanvasHelperAPI,\n  CellContext,\n  ListGridAPI,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { str, getOrApply } from '../../internal/utils'\nimport { PercentCompleteBarStyle } from '../style/PercentCompleteBarStyle'\nimport { Column } from './Column'\n\nconst MARGIN = 2\n\nexport class PercentCompleteBarColumn<T> extends Column<T> {\n  private _min: number\n  private _max: number\n  private _formatter: (value: string) => string\n  public constructor(options: PercentCompleteBarColumnOption<T> = {}) {\n    super(options)\n    this._min = options.min || 0\n    this._max = options.max || this._min + 100\n    this._formatter = options.formatter || ((v) => v)\n  }\n  public get StyleClass(): typeof PercentCompleteBarStyle {\n    return PercentCompleteBarStyle\n  }\n  public clone(): PercentCompleteBarColumn<T> {\n    return new PercentCompleteBarColumn(this)\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: PercentCompleteBarStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    super.drawInternal(\n      this._formatter(value),\n      context,\n      style,\n      helper,\n      grid,\n      info\n    )\n    const barColor = style.barColor\n    const barBgColor = style.barBgColor\n    const barHeight = style.barHeight\n\n    let sValue = `${value}`\n    if (str.endsWith(sValue, '%')) {\n      sValue = sValue.substr(0, sValue.length - 1)\n    }\n    const num = Number(sValue)\n    const rate =\n      num < this._min\n        ? 0\n        : num > this._max\n        ? 1\n        : (num - this._min) / (this._max - this._min)\n\n    helper.drawWithClip(context, (ctx) => {\n      const rect = context.getRect()\n\n      const barMaxWidth = rect.width - MARGIN * 2 - 1 /*边线*/\n      const barTop = rect.bottom - MARGIN - barHeight - 1 /*边线*/\n      const barLeft = rect.left + MARGIN\n      ctx.fillStyle = getOrApply(barBgColor, rate * 100) || '#f0f3f5'\n      ctx.beginPath()\n      ctx.rect(barLeft, barTop, barMaxWidth, barHeight)\n      ctx.fill()\n\n      const barSize = Math.min(barMaxWidth * rate, barMaxWidth)\n      ctx.fillStyle = getOrApply(barColor, rate * 100) || '#20a8d8'\n      ctx.beginPath()\n      ctx.rect(barLeft, barTop, barSize, barHeight)\n      ctx.fill()\n    })\n  }\n}\n","import { MaybePromise } from '../ts-types'\nimport { isPromise } from './utils'\n\nfunction createArray<T>(get: (i: number) => T, length: number): T[] {\n  const array = new Array<T>(length)\n  for (let i = 0; i < length; i++) {\n    array[i] = get(i)\n  }\n  return array\n}\nfunction createArrayPromise<R>(\n  get: (i: number) => MaybePromise<R>,\n  getField: undefined,\n  length: number\n): Promise<{ v: R; f: R }[]>\nfunction createArrayPromise<R, F>(\n  get: (i: number) => MaybePromise<R>,\n  getField: (r: R) => MaybePromise<F>,\n  length: number\n): Promise<{ v: R; f: F }[]>\nfunction createArrayPromise<R, F>(\n  get: (i: number) => MaybePromise<R>,\n  getField: ((r: R) => MaybePromise<F>) | undefined,\n  length: number\n): Promise<any[]> {\n  return new Promise((resolve) => {\n    const plist = []\n    const array = new Array<{ v: MaybePromise<R>; f: MaybePromise<R> }>(length)\n    for (let i = 0; i < length; i++) {\n      const data = get(i)\n      const record = {\n        v: data,\n        f: data,\n      }\n      array[i] = record\n      if (isPromise(data)) {\n        plist.push(\n          data.then((v) => {\n            record.v = v\n            record.f = v\n          })\n        )\n      }\n    }\n    Promise.all(plist)\n      .then(() =>\n        getField == null\n          ? (array as any)\n          : setArrayField(array as any, getField)\n      )\n      .then(resolve)\n  })\n}\nfunction setArrayField<R, F>(\n  array: { v: R; f: R | F }[],\n  getField: (r: R) => MaybePromise<F>\n): Promise<{ v: R; f: F }[]> {\n  return new Promise((resolve) => {\n    const { length } = array\n    const plist = []\n    for (let i = 0; i < length; i++) {\n      const record = array[i]\n      const f = getField(record.v)\n      if (isPromise(f)) {\n        plist.push(\n          f.then((v) => {\n            record.f = v\n          })\n        )\n      } else {\n        record.f = f\n      }\n    }\n    Promise.all(plist).then(() => resolve(array as { v: R; f: F }[]))\n  })\n}\nexport function sortArray<T>(\n  array: T[],\n  compare: (a: T, b: T) => number\n): void {\n  Array.prototype.sort.call(array, compare)\n}\n\nexport function sort<R, F>(\n  get: (i: number) => R,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: (a: R, b: R) => number\n): void\nexport function sort<R, F>(\n  get: (i: number) => R,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: (a: F, b: F) => number,\n  getField: (r: R) => F\n): void\nexport function sort<R, F>(\n  get: (i: number) => R,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: ((a: R, b: R) => number) | ((a: F, b: F) => number),\n  getField?: (r: R) => F\n): void {\n  const old = createArray(get, length)\n  if (getField != null) {\n    old.sort((r1, r2) =>\n      (compare as (a: F, b: F) => number)(getField(r1), getField(r2))\n    )\n  } else {\n    old.sort(compare as (a: R, b: R) => number)\n  }\n  for (let i = 0; i < length; i++) {\n    set(i, old[i])\n  }\n}\n\nexport function sortPromise<R, F>(\n  get: (i: number) => MaybePromise<R>,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: (a: R, b: R) => number\n): void\nexport function sortPromise<R, F>(\n  get: (i: number) => MaybePromise<R>,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: (a: F, b: F) => number,\n  getField: (r: R) => MaybePromise<F | undefined>\n): Promise<void>\nexport function sortPromise<R, F>(\n  get: (i: number) => MaybePromise<R>,\n  set: (i: number, r: R) => void,\n  length: number,\n  compare: any,\n  getField?: any\n): Promise<void> {\n  if (typeof Promise !== 'undefined') {\n    return createArrayPromise(get, getField, length).then((array) => {\n      array.sort((r1, r2) => compare(r1.f, r2.f))\n      for (let i = 0; i < length; i++) {\n        set(i, array[i].v)\n      }\n    })\n  } else {\n    sort(\n      get as (i: number) => R,\n      set,\n      length,\n      compare as (a: F, b: F) => number,\n      getField as (r: R) => F\n    )\n    const dummyPromise: Promise<undefined> = {\n      then(fn: () => void): Promise<undefined> {\n        fn()\n        return dummyPromise\n      },\n      catch(): Promise<undefined> {\n        return dummyPromise\n      },\n    } as any\n    return dummyPromise\n  }\n}\n","import * as sort from '../internal/sort'\nimport {\n  MaybePromiseOrUndef,\n  FieldDef,\n  FieldData,\n  MaybePromise,\n  MaybePromiseOrCallOrUndef,\n  FieldAssessor,\n  MaybePromiseOrCall,\n} from '../ts-types'\nimport {\n  applyChainSafe,\n  array,\n  emptyFn,\n  getOrApply,\n  isDef,\n  isPromise,\n  obj,\n} from '../internal/utils'\nimport { EventTarget } from '../core/EventTarget'\nimport { PromiseCacheValue } from './internal/types'\n\nfunction isFieldAssessor<T>(field: FieldDef<T>): field is FieldAssessor<T> {\n  if (obj.isObject(field)) {\n    const a = field as FieldAssessor<T>\n    if (a.get && a.set) {\n      return true\n    }\n  }\n  return false\n}\n\nconst DATA_SOURCE_EVENT_TYPE = {\n  REFRESH_DATA: 'refresh_data',\n  UPDATED_LENGTH: 'updated_length',\n  UPDATED_ORDER: 'updated_order',\n  UPDATE_LENGTH: 'update_length',\n} as const\n\ntype PromiseBack<V> = (value: PromiseCacheValue<V>) => void\n\nfunction getValue<V>(\n  value: MaybePromiseOrCallOrUndef<V, []>,\n  setPromiseBack: PromiseBack<V>\n): MaybePromiseOrUndef<V> {\n  const maybePromiseValue = getOrApply(value)\n  if (isPromise(maybePromiseValue)) {\n    const promiseValue = maybePromiseValue.then((r: V | undefined) => {\n      setPromiseBack(r)\n      return r\n    })\n    // 临时缓存\n    setPromiseBack(promiseValue)\n    return promiseValue\n  } else {\n    return maybePromiseValue\n  }\n}\n\nfunction getField<T, F extends FieldDef<T>>(\n  record: MaybePromiseOrUndef<T>,\n  field: F,\n  setPromiseBack: PromiseBack<any>\n): FieldData {\n  if (!isDef(record)) {\n    return undefined\n  }\n  if (isPromise(record)) {\n    return record.then((r: T | undefined) => getField(r, field, setPromiseBack))\n  }\n  const fieldGet = isFieldAssessor<T>(field) ? field.get : field\n  if (typeof fieldGet === 'string' && fieldGet in record) {\n    const fieldResult = (record as any)[fieldGet]\n    return getValue(fieldResult, setPromiseBack)\n  }\n  if (typeof fieldGet === 'function') {\n    const fieldResult = (fieldGet as any)(record)\n    return getValue(fieldResult, setPromiseBack)\n  }\n\n  const ss = `${fieldGet}`.split('.')\n  if (ss.length <= 1) {\n    const fieldResult = (record as any)[fieldGet]\n    return getValue(fieldResult, setPromiseBack)\n  }\n  const fieldResult = applyChainSafe(\n    record,\n    (val, name) => getField(val, name, emptyFn as any),\n    ...ss\n  )\n  return getValue(fieldResult, setPromiseBack)\n}\nfunction setField<T, F extends FieldDef<T>>(\n  record: T | undefined,\n  field: F,\n  value: any\n): boolean {\n  if (record == null) {\n    return false\n  }\n\n  const fieldSet = isFieldAssessor<T>(field) ? field.set : field\n  if (typeof fieldSet === 'string' && fieldSet in record) {\n    ;(record as any)[fieldSet] = value\n  } else if (typeof fieldSet === 'function') {\n    return (fieldSet as any)(record, value)\n  } else if (typeof fieldSet === 'string') {\n    const ss = `${fieldSet}`.split('.')\n    let obj: any = record\n    const { length } = ss\n    for (let i = 0; i < length; i++) {\n      const f = ss[i]\n      if (i === length - 1) {\n        obj[f] = value\n      } else {\n        obj = obj[f] || (obj[f] = {})\n      }\n    }\n  } else {\n    ;(record as any)[fieldSet] = value\n  }\n  return true\n}\nfunction _getIndex(sortedIndexMap: null | number[], index: number): number {\n  if (!sortedIndexMap) {\n    return index\n  }\n  const mapIndex = sortedIndexMap[index]\n  return isDef(mapIndex) ? mapIndex : index\n}\n\nexport interface DataSourceParam<T> {\n  get: (index: number) => T\n  length: number\n  source?: any\n}\n\n/**\n * grid data source\n */\nexport class DataSource<T> extends EventTarget {\n  public static get EVENT_TYPE() {\n    return DATA_SOURCE_EVENT_TYPE\n  }\n  public static EMPTY = new DataSource<any>({\n    get(): void {},\n    length: 0,\n  })\n  public static ofArray<T>(array: T[]): DataSource<T> {\n    return new DataSource({\n      get: (index: number): T => array[index],\n      length: array.length,\n      source: array,\n    })\n  }\n  protected _sortedIndexMap: null | number[] = null\n  private _get: (index: number) => MaybePromiseOrCall<T, []>\n  private _length: number\n  private readonly _source: any\n  public constructor(obj?: DataSourceParam<T> | DataSource<T>) {\n    super()\n    this._get = obj?.get.bind(obj) || (undefined as any)\n    this._length = obj?.length || 0\n    this._source = obj?.source ?? obj\n  }\n  get source(): any {\n    return this._source\n  }\n  public get(index: number): MaybePromiseOrUndef<T> {\n    return this.getOriginal(_getIndex(this._sortedIndexMap, index))\n  }\n  public getField<F extends FieldDef<T>>(index: number, field: F): FieldData {\n    return this.getOriginalField(_getIndex(this._sortedIndexMap, index), field)\n  }\n  public hasField(index: number, field: FieldDef<T>): boolean {\n    return this.hasOriginalField(_getIndex(this._sortedIndexMap, index), field)\n  }\n  public setField<F extends FieldDef<T>>(\n    index: number,\n    field: F,\n    value: any\n  ): MaybePromise<boolean> {\n    return this.setOriginalField(\n      _getIndex(this._sortedIndexMap, index),\n      field,\n      value\n    )\n  }\n  public sort(field: FieldDef<T>, order: 'desc' | 'asc'): MaybePromise<void> {\n    const sortedIndexMap = new Array<number>(this._length)\n\n    const orderFn: (v1: T, v2: T) => -1 | 0 | 1 =\n      order !== 'desc'\n        ? (v1: T, v2: T): -1 | 0 | 1 => (v1 === v2 ? 0 : v1 > v2 ? 1 : -1)\n        : (v1: T, v2: T): -1 | 0 | 1 => (v1 === v2 ? 0 : v1 < v2 ? 1 : -1)\n\n    return sort\n      .sortPromise(\n        (index) =>\n          isDef(sortedIndexMap[index])\n            ? sortedIndexMap[index]\n            : (sortedIndexMap[index] = index),\n        (index, rel) => {\n          sortedIndexMap[index] = rel\n        },\n        this._length,\n        orderFn,\n        (index) => this.getOriginalField(index, field)\n      )\n      .then(() => {\n        this._sortedIndexMap = sortedIndexMap\n        this.fireListeners(DATA_SOURCE_EVENT_TYPE.UPDATED_ORDER)\n      })\n  }\n  public get length(): number {\n    return this._length\n  }\n  public set length(length) {\n    if (this._length !== length) {\n      this.setLength(length)\n    }\n  }\n  public refresh(): void {\n    this.refreshInternal()\n    this.fireListeners(DATA_SOURCE_EVENT_TYPE.REFRESH_DATA)\n  }\n  get dataSource(): DataSource<T> {\n    return this\n  }\n  public dispose(): void {\n    super.dispose()\n  }\n  protected getOriginal(index: number): MaybePromiseOrUndef<T> {\n    return getValue(this._get(index), (val: PromiseCacheValue<T>) => {\n      this.recordPromiseCallBackInternal(index, val)\n    })\n  }\n  protected getOriginalField<F extends FieldDef<T>>(\n    index: number,\n    field: F\n  ): FieldData {\n    if (!isDef(field)) {\n      return undefined\n    }\n    const record = this.getOriginal(index)\n    return getField(record, field, (val: any) => {\n      this.fieldPromiseCallBackInternal(index, field, val)\n    })\n  }\n  protected hasOriginalField(index: number, field: FieldDef<T>): boolean {\n    if (!isDef(field)) {\n      return false\n    }\n    if (typeof field === 'function') {\n      return true\n    }\n    const record = this.getOriginal(index)\n    return Boolean(record && typeof field === 'string' && field in record)\n  }\n  protected setOriginalField<F extends FieldDef<T>>(\n    index: number,\n    field: F,\n    value: any\n  ): MaybePromise<boolean> {\n    if (!isDef(field)) {\n      return false\n    }\n    const record = this.getOriginal(index)\n    if (isPromise(record)) {\n      return record.then((r) => setField(r, field, value))\n    }\n    return setField(record, field, value)\n  }\n  protected fieldPromiseCallBackInternal<F extends FieldDef<T>>(\n    _index: number,\n    _field: F,\n    _value: PromiseCacheValue<any>\n  ): void {\n    // nothing\n  }\n  protected recordPromiseCallBackInternal(\n    _index: number,\n    _record: PromiseCacheValue<T>\n  ): void {\n    // nothing\n  }\n  protected refreshInternal() {\n    // nothing\n  }\n  protected setLength(length: number): void {\n    const results = this.fireListeners(\n      DATA_SOURCE_EVENT_TYPE.UPDATE_LENGTH,\n      length\n    )\n    if (array.findIndex(results, (v) => !v) >= 0) {\n      return\n    }\n    this._length = length\n    this.fireListeners(DATA_SOURCE_EVENT_TYPE.UPDATED_LENGTH, this._length)\n  }\n}\n","import { isPromise } from '../internal/utils'\nimport { DataSource } from './DataSource'\nimport { MaybePromiseOrUndef } from '../ts-types'\n\ntype TExpandedKeys = number[] | string[]\n\ninterface ITreeDataSourceOptions<T> {\n  keyField: string\n  parentKeyField: string\n  expandedKeys?: TExpandedKeys\n  hasChildren?: (rec?: T | null) => boolean\n  getChildren?: (\n    rec?: T | null,\n    all?: boolean\n  ) =>\n    | T[]\n    | Promise<\n        | T[]\n        | {\n            records: T[]\n            expandedKeys?: TExpandedKeys\n          }\n      >\n}\n\nexport interface ITreeInfo {\n  expanded: boolean\n  isLast: boolean\n  isLeaf: boolean\n  key: any\n  level: number\n  levelLast: boolean[]\n  parentKey: any\n}\n\ninterface IRecordMap<T> {\n  [key: string]: T\n  [key: number]: T\n}\n\ninterface IRecordsMap<T> {\n  [key: string]: T[]\n  [key: number]: T[]\n}\n\ninterface ILevelMap {\n  [key: string]: number\n  [key: number]: number\n}\n\ninterface ILastMap {\n  [key: string]: boolean\n  [key: number]: boolean\n}\n\ninterface IExpandMap {\n  [key: string]: boolean\n  [key: number]: boolean\n}\n\nfunction _initLevel<T>(ds: any, record: T, level: number) {\n  const key = (record as any)[ds.options.keyField]\n  ds._levelMap[key] = level\n  const children = ds._pIdMap[key] || []\n  for (const child of children) {\n    _initLevel(ds, child, level + 1)\n  }\n}\n\nfunction _initLast<T>(ds: any, records: T[]) {\n  if (records && records.length > 0) {\n    const key = (records as any)[records.length - 1][ds.options.keyField]\n    ds._lastMap[key] = true\n  }\n}\n\nfunction _expandAll<T>(ds: any, record: T) {\n  const key = (record as any)[ds.options.keyField]\n  const children = ds._pIdMap[key] || []\n  if (children.length > 0) {\n    ds._expandMap[key] = true\n    for (const r of children) {\n      _expandAll(ds, r)\n    }\n  }\n}\n\nfunction _getExpandRecords<T>(ds: any, record: T): T[] {\n  let records = []\n  const key = (record as any)[ds.options.keyField]\n  if (ds._expandMap[key]) {\n    const children = ds._pIdMap[key] || []\n    for (const r of children) {\n      records.push(r)\n      records = records.concat(_getExpandRecords(ds, r))\n    }\n  }\n  return records\n}\n\nfunction _getCollapseRecordCount(ds: any, index: number) {\n  const record = ds._records[index]\n  const key = record[ds.options.keyField]\n  const level = ds._levelMap[key]\n  let count = 0\n  for (let i = index + 1; i < ds._records.length; i++) {\n    const r = ds._records[i]\n    const k = r[ds.options.keyField]\n    if (level < ds._levelMap[k]) {\n      count++\n    } else {\n      break\n    }\n  }\n  return count\n}\n\nfunction _expand<T>(\n  ds: any,\n  record: T | null,\n  all: boolean,\n  silent: number,\n  callback?: (ds: any, record: T | null, all: boolean, silent: number) => void\n) {\n  if (record) {\n    const index = ds._records.indexOf(record)\n    const key = (record as any)[ds._options.keyField]\n    if (ds._pIdMap[key]) {\n      if (!ds._expandMap[key]) {\n        if (all) {\n          _expandAll(ds, record)\n        } else {\n          ds._expandMap[key] = true\n        }\n        ds._records.splice(index + 1, 0, ..._getExpandRecords(ds, record))\n      } else if (all) {\n        _expandAll(ds, record)\n        ds._records.splice(\n          index + 1,\n          _getCollapseRecordCount(ds, index),\n          ..._getExpandRecords(ds, record)\n        )\n      }\n      if (silent === 0) {\n        ds.length = ds._records.length\n      }\n    } else if (callback) {\n      callback(ds, record, all, silent)\n    }\n  }\n}\n\nfunction _collapseAll<T>(ds: any, record: T) {\n  const key = (record as any)[ds.options.keyField]\n  delete ds._expandMap[key]\n  const children = ds._pIdMap[key] || []\n  for (const r of children) {\n    _collapseAll(ds, r)\n  }\n}\n\nfunction _parentKey(ds: any, key: any) {\n  const record = ds._idMap[key]\n  const parentKey = record[ds.options.parentKeyField]\n  return parentKey\n}\n\nfunction _rebuildTree(ds: any, silent: number) {\n  // 构建显示记录列表\n  ds._levelMap = {} // 级别索引列表\n  ds._lastMap = {} // 是否末节点列表\n  ds._rootRecords = [] // 根记录对象列表\n  ds._records = [] // 显示记录列表\n  for (const parentKey in ds._pIdMap) {\n    if (ds._pIdMap.hasOwnProperty(parentKey)) {\n      const records = ds._pIdMap[parentKey]\n      if (ds._idMap[parentKey]) {\n        _initLast(ds, records)\n      } else {\n        for (const item of records) {\n          _initLevel(ds, item, 0)\n          ds._rootRecords.push(item)\n          ds._records.push(item)\n          ds._records.push(..._getExpandRecords(ds, item))\n        }\n      }\n    }\n  }\n  _initLast(ds, ds._rootRecords)\n\n  // 清理展开信息\n  for (const key in ds._expandMap) {\n    if (!ds._pIdMap[key]) {\n      delete ds._expandMap[key]\n    }\n  }\n\n  if (silent === 0) {\n    ds.length = ds._records.length\n  }\n}\n\nfunction _lazyLoadRecords<T>(\n  ds: any,\n  records: T[],\n  expandedKeys: TExpandedKeys | null,\n  silent: number\n) {\n  let hasNewRecords = false\n  for (const record of records) {\n    const key = (record as any)[ds._options.keyField]\n    if (!ds._idMap[key]) {\n      hasNewRecords = true\n      const pKey = (record as any)[ds._options.parentKeyField]\n      ds._idMap[key] = record\n      ds._pIdMap[pKey] = ds._pIdMap[pKey] || []\n      ds._pIdMap[pKey].push(record)\n      if (\n        expandedKeys &&\n        Array.isArray(expandedKeys) &&\n        (expandedKeys as (string | number)[]).indexOf(key) >= 0\n      ) {\n        ds._expandMap[key] = true\n      }\n    }\n  }\n  if (hasNewRecords) {\n    _rebuildTree(ds, silent)\n  }\n}\n\nfunction _lazyLoadChildren<T>(\n  ds: any,\n  record: T | null,\n  all: boolean,\n  silent: number,\n  callback?: (ds: any, record: T | null, all: boolean, silent: number) => void\n) {\n  if (\n    ds._options.hasChildren &&\n    ds._options.getChildren &&\n    ds._options.hasChildren(record)\n  ) {\n    const records = ds._options.getChildren(record, all)\n    if (isPromise(records)) {\n      records.then((recs) => {\n        const rs = Array.isArray(recs) ? recs : recs.records\n        const expandedKeys = Array.isArray(recs) ? undefined : recs.expandedKeys\n        _lazyLoadRecords(ds, rs, expandedKeys, silent)\n        if (callback) {\n          callback(ds, record, all, silent)\n        }\n      })\n    } else {\n      _lazyLoadRecords(ds, records, null, silent)\n      if (callback) {\n        callback(ds, record, all, silent)\n      }\n    }\n  }\n}\n\n/**\n * grid data source for tree\n */\nexport class TreeDataSource<T> extends DataSource<T> {\n  public static get EVENT_TYPE() {\n    return DataSource.EVENT_TYPE\n  }\n  private _dataSource: DataSource<T>\n  private _options: ITreeDataSourceOptions<T>\n  private _expandMap: IExpandMap\n  private _idMap: IRecordMap<T> = {}\n  private _pIdMap: IRecordsMap<T> = {}\n  private _levelMap: ILevelMap = {}\n  private _lastMap: ILastMap = {}\n  private _rootRecords: T[] = []\n  private _records: T[] = []\n  private _updateLengthSilentCounter: number = 0\n  public constructor(\n    dataSource: DataSource<T>,\n    options: ITreeDataSourceOptions<T>\n  ) {\n    super(dataSource)\n    this._dataSource = dataSource\n\n    this._options = options\n\n    this._expandMap = {}\n    for (const key of options.expandedKeys || []) {\n      this._expandMap[key] = true\n    }\n\n    this.refreshInternal()\n  }\n  public get options() {\n    return this._options\n  }\n  public get expandedKeys() {\n    return Object.keys(this._expandMap)\n  }\n  protected getOriginal(index: number): MaybePromiseOrUndef<T> {\n    return this._records[index]\n  }\n  public getTreeInfo(index: number): ITreeInfo | undefined {\n    const record = this.getOriginal(index)\n    if (record) {\n      const key = (record as any)[this._options.keyField]\n      const parentKey = _parentKey(this, key)\n      const expanded = !!this._expandMap[key]\n      let isLeaf = !this._pIdMap[key]\n      const isLast = !!this._lastMap[key]\n      const level = this._levelMap[key]\n\n      const levelLast = []\n      let k = key\n      for (let i = 0; i < level; i++) {\n        levelLast.unshift(!!this._lastMap[k])\n        k = _parentKey(this, k)\n      }\n\n      if (isLeaf && this._options.hasChildren) {\n        isLeaf = !this._options.hasChildren(record as T)\n      }\n\n      return {\n        expanded,\n        isLast,\n        isLeaf,\n        key,\n        level,\n        levelLast,\n        parentKey,\n      }\n    } else {\n      return undefined\n    }\n  }\n  public getIndexByKey(key: number | string) {\n    return this._records.indexOf(this._idMap[key])\n  }\n  public expandAll() {\n    this._records.length = 0\n    for (const record of this._rootRecords) {\n      _expandAll(this, record)\n      this._records.push(record)\n      this._records.push(..._getExpandRecords(this, record))\n    }\n    this.length = this._records.length\n  }\n  public expand(index: number, all: boolean = false) {\n    const record = this.getOriginal(index)\n    _expand(this, record, all, this._updateLengthSilentCounter,\n      (ds1, record1, all1, silent1) => {\n      _lazyLoadChildren(ds1, record1, all1, silent1, (ds2, record2, all2, silent2) => {\n        _expand(ds2, record2, all2, silent2)\n      })\n    })\n  }\n  public expandToKey(key: number | string) {\n    // 根据指定的主键，展开到该记录，并返回索引值\n    const parentKeys = []\n    let value = key\n    let record = this._idMap[value]\n    while (record) {\n      value = (record as any)[this._options.parentKeyField]\n      record = this._idMap[value]\n      if (record) {\n        parentKeys.unshift(value)\n      }\n    }\n    this._updateLengthSilentCounter++\n    try {\n      for (const parentKey of parentKeys) {\n        this.expand(this._records.indexOf(this._idMap[parentKey]))\n      }\n    } finally {\n      this._updateLengthSilentCounter--\n      if (this._updateLengthSilentCounter === 0) {\n        this.length = this._records.length\n      }\n    }\n    return this.getIndexByKey(key)\n  }\n  public expandToLevel(level: number) {\n    // 展开到指定级别\n    const targets = []\n    if (level > 0) {\n      this._updateLengthSilentCounter++\n      try {\n        for (const key in this._levelMap) {\n          if (this._levelMap.hasOwnProperty(key)) {\n            if (\n              level === this._levelMap[key] ||\n              (level > this._levelMap[key] && this._lastMap[key])\n            ) {\n              targets.push(this.expandToKey(key))\n            }\n          }\n        }\n      } finally {\n        this._updateLengthSilentCounter--\n        if (this._updateLengthSilentCounter === 0) {\n          this.length = this._records.length\n        }\n      }\n    }\n    return targets\n  }\n  public collapseAll() {\n    this._records.length = 0\n    this._records.push(...this._rootRecords)\n    this._expandMap = {}\n    this.length = this._records.length\n  }\n  public collapse(index: number, all?: boolean) {\n    const record = this.getOriginal(index)\n    if (record) {\n      const key = (record as any)[this._options.keyField]\n      if (this._pIdMap[key]) {\n        if (this._expandMap[key]) {\n          if (all) {\n            _collapseAll(this, record)\n          } else {\n            delete this._expandMap[key]\n          }\n          this._records.splice(index + 1, _getCollapseRecordCount(this, index))\n          this.length = this._records.length\n        } else if (all) {\n          _collapseAll(this, record)\n        }\n      }\n    }\n  }\n  public toggle(index: number, all?: boolean) {\n    const record = this.getOriginal(index)\n    if (record) {\n      const key = (record as any)[this._options.keyField]\n      if (this._expandMap[key]) {\n        this.collapse(index, all)\n      } else {\n        this.expand(index, all)\n      }\n    }\n  }\n  get source(): any {\n    return this._dataSource.source\n  }\n  get dataSource(): DataSource<T> {\n    return this._dataSource\n  }\n  protected refreshInternal() {\n    // 构建 id 和 pId 与记录的对应关系\n    this._idMap = {}\n    this._pIdMap = {}\n    for (let i = 0; i < this._dataSource.length; i++) {\n      const key = this._dataSource.getField(i, this._options.keyField as any)\n      const parentKey = this._dataSource.getField(\n        i,\n        this._options.parentKeyField as any\n      )\n      const record = this._dataSource.get(i)\n      this._idMap[key] = record as any\n      this._pIdMap[parentKey] = this._pIdMap[parentKey] || []\n      this._pIdMap[parentKey].push(record as any)\n    }\n\n    // 构建显示记录列表\n    _rebuildTree(this, this._updateLengthSilentCounter)\n\n    if (this.length === 0) {\n      _lazyLoadChildren(this, null, false, this._updateLengthSilentCounter)\n    }\n  }\n}\n","import * as columnUtils from './columnUtils'\nimport {\n  CellAddress,\n  ListGridAPI,\n  GridCanvasHelperAPI,\n  CellContext,\n  DrawCallback,\n  TreeColumnOption,\n  TreeInfo,\n  CanToggle,\n  Toggled,\n  ToggledType,\n  LayoutObjectId,\n  CellStyle,\n  MultilineText,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport {\n  KEY_DOWN,\n  KEY_ENTER,\n  KEY_LEFT,\n  KEY_RIGHT,\n  KEY_UP,\n} from '../../core/draw-grid/KEY_CODE'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { TreeDataSource } from '../../data/TreeDataSource'\nimport Rect from '../../internal/Rect'\nimport { TreeStyle } from '../style/TreeStyle'\nimport { BaseColumn } from './BaseColumn'\nimport { isPromise, event, cellInRange, getOrApply } from '../../internal/utils'\nimport {\n  getInlineInputEditorStateId,\n  getButtonColumnStateId,\n  getColumnActionStateId,\n} from '../../internal/symbolManager'\n\nconst INLINE_INPUT_EDITOR_STATE_ID = getInlineInputEditorStateId()\nconst BUTTON_COLUMN_STATE_ID = getButtonColumnStateId()\nconst COLUMN_ACTION_STATE_ID = getColumnActionStateId()\n\nconst TREE_NODE_SPACE = 16\n\nfunction _getTreeInfo<T>(\n  grid: ListGridAPI<T>,\n  row: number\n): TreeInfo | undefined {\n  let treeInfo: TreeInfo | undefined = undefined\n  if (grid.dataSource instanceof TreeDataSource) {\n    const recordIndex = grid.getRecordIndexByRow(row)\n    if (recordIndex >= 0) {\n      treeInfo = grid.dataSource.getTreeInfo(recordIndex)\n    }\n  }\n  return treeInfo\n}\n\nfunction _getTreeNodeSpaceWidth(treeInfo?: TreeInfo) {\n  let width = 0\n  if (treeInfo) {\n    width += treeInfo.level * TREE_NODE_SPACE + TREE_NODE_SPACE * 2\n  }\n  return width\n}\n\nfunction _isTreeNodeSpace<T>(\n  grid: ListGridAPI<T>,\n  col: number,\n  row: number,\n  event: MouseEvent\n) {\n  let bool = false\n  const relativePos = grid._getMouseRelativePoint(event)\n  if (relativePos) {\n    const rect = grid.getCellRelativeRect(col, row)\n    const treeInfo = _getTreeInfo(grid, row)\n    if (treeInfo && !treeInfo.isLeaf) {\n      const treeNodeSpaceWidth = _getTreeNodeSpaceWidth(treeInfo)\n      if (\n        treeNodeSpaceWidth &&\n        relativePos.x - rect.left < treeNodeSpaceWidth\n      ) {\n        bool = true\n      }\n    }\n  }\n  return bool\n}\n\nexport class TreeColumn<T> extends BaseColumn<T, string> {\n  private _canToggle?: CanToggle\n  private _toggled?: Toggled\n  private _draw?: DrawCallback\n  private _cellStyle?: CellStyle\n  private _multilineText?: MultilineText\n  public constructor(options: TreeColumnOption<T> = {}) {\n    super(options)\n    this._canToggle = options.canToggle\n    this._toggled = options.toggled\n    this._draw = options.draw\n    this._cellStyle = options.cellStyle\n    this._multilineText = options.multilineText\n  }\n  public get StyleClass(): typeof TreeStyle {\n    return TreeStyle\n  }\n  public get canToggle(): CanToggle | undefined {\n    return this._canToggle\n  }\n  public get toggled(): Toggled | undefined {\n    return this._toggled\n  }\n  public get draw(): DrawCallback | undefined {\n    return this._draw\n  }\n  public get cellStyle(): CellStyle | undefined {\n    return this._cellStyle\n  }\n  public get multilineText(): MultilineText | undefined {\n    return this._multilineText\n  }\n  public reviseAttachCellsArea(rect: Rect, row: number, grid: ListGridAPI<T>) {\n    columnUtils.reviseAttachCellsArea(rect, row, grid, this._cellStyle)\n  }\n  public reviseAttachCellsPadding(\n    padding: [number, number, number, number],\n    row: number,\n    grid: ListGridAPI<T>\n  ) {\n    super.reviseAttachCellsPadding(padding, row, grid)\n    const treeInfo = _getTreeInfo(grid, row)\n    padding[3] += _getTreeNodeSpaceWidth(treeInfo)\n    columnUtils.reviseAttachCellsPadding(padding, row, grid, this._cellStyle)\n  }\n  public reviseFocusRect(rect: Rect, row: number, grid: ListGridAPI<T>) {\n    const treeInfo = _getTreeInfo(grid, row)\n    rect.left += _getTreeNodeSpaceWidth(treeInfo)\n  }\n  public clone(): TreeColumn<T> {\n    return new TreeColumn(this)\n  }\n  public drawInternal<T>(\n    value: any,\n    context: CellContext,\n    style: TreeStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    const getIcon = info.getIcon\n    const getRecord = info.getRecord\n\n    const {\n      textAlign,\n      textBaseline,\n      color,\n      font,\n      textOverflow,\n      lineColor,\n      buttonColor,\n      buttonBgColor,\n      buttonBorderColor,\n      linkColor,\n      autoWrapText,\n      lineHeight,\n      lineClamp,\n    } = style\n\n    helper.testFontLoad(font, value, context)\n\n    const treeInfo = _getTreeInfo(grid, context.row)\n\n    let active = false\n    const state = (grid as any)[BUTTON_COLUMN_STATE_ID]\n    if (state) {\n      const range = grid.getCellRange(context.col, context.row)\n      if (\n        state.mouseActiveCell &&\n        cellInRange(range, state.mouseActiveCell.col, state.mouseActiveCell.row)\n      ) {\n        active = true\n      }\n    }\n\n    columnUtils.loadIcons(\n      getIcon(),\n      context,\n      helper,\n      (icons: any, ctx: CellContext) => {\n        const isCustomDraw = columnUtils.customDraw(\n          helper,\n          this.draw,\n          value,\n          context,\n          grid,\n          getRecord()\n        )\n        if (!isCustomDraw) {\n          const padding = columnUtils.getActionTextPadding(\n            context,\n            helper,\n            style\n          )\n          if (active && state && state.mouseRelativePos) {\n            const rect = helper.getTextRect(value, ctx, {\n              font,\n              icons,\n              padding,\n              textAlign,\n              textBaseline,\n              textOverflow,\n            })\n            const offset = _getTreeNodeSpaceWidth(treeInfo)\n            rect.left = Math.max(\n              context.getRect().left + offset,\n              rect.left + offset\n            )\n            rect.right += offset\n            active =\n              rect.left <= state.mouseRelativePos.x &&\n              rect.right >= state.mouseRelativePos.x &&\n              rect.top <= state.mouseRelativePos.y &&\n              rect.bottom >= state.mouseRelativePos.y\n            state.mouseActive = active\n          }\n          const record = info.getRecord()\n          const isMultilineText = getOrApply(this.multilineText, record)\n          helper.tree(value, ctx, {\n            color: active ? linkColor || helper.theme.tree.linkColor : color,\n            lineColor,\n            buttonColor,\n            buttonBgColor,\n            buttonBorderColor,\n            icons,\n            padding,\n            textAlign,\n            textBaseline,\n            textOverflow,\n            treeInfo,\n            treeNodeSpace: TREE_NODE_SPACE,\n            isMultilineText,\n            autoWrapText,\n            lineHeight,\n            lineClamp,\n          })\n        }\n        columnUtils.drawActionButton(\n          grid,\n          context,\n          INLINE_INPUT_EDITOR_STATE_ID,\n          helper,\n          style\n        )\n        columnUtils.drawAttachArea(\n          grid,\n          getRecord(),\n          context,\n          helper,\n          this._cellStyle\n        )\n      }\n    )\n  }\n  public bindGridEvent<T>(grid: ListGridAPI<T>, cellId: LayoutObjectId): any[] {\n    const expand = (cell: CellAddress, all: boolean) => {\n      if (grid.dataSource instanceof TreeDataSource) {\n        const recordIndex = grid.getRecordIndexByRow(cell.row)\n        grid.dataSource.expand(recordIndex, all)\n      }\n    }\n\n    const collapse = (cell: CellAddress, all: boolean) => {\n      if (grid.dataSource instanceof TreeDataSource) {\n        const recordIndex = grid.getRecordIndexByRow(cell.row)\n        grid.dataSource.collapse(recordIndex, all)\n      }\n    }\n\n    const toggle = (cell: CellAddress, all: boolean) => {\n      if (grid.dataSource instanceof TreeDataSource) {\n        const recordIndex = grid.getRecordIndexByRow(cell.row)\n        grid.dataSource.toggle(recordIndex, all)\n      }\n    }\n\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n\n    const doMouseMove = (e: any) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (isPromise(grid.getRowRecord(e.row))) {\n        return\n      }\n      if (this._canToggle) {\n        const treeInfo = _getTreeInfo(grid, e.row)\n        if (\n          treeInfo &&\n          this._canToggle({\n            col: e.col,\n            event: e.event,\n            row: e.row,\n            treeInfo,\n            type: 'over',\n          }) === false\n        ) {\n          return\n        }\n      }\n      const state = (grid as any)[BUTTON_COLUMN_STATE_ID]\n      const actionState = (grid as any)[COLUMN_ACTION_STATE_ID]\n      grid.getElement().style.cursor =\n        _isTreeNodeSpace(grid, e.col, e.row, e.event) ||\n        (state && state.mouseActive) ||\n        (actionState && actionState.mouseActive)\n          ? 'pointer'\n          : ''\n    }\n\n    const doMouseLeave = (e: any) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      grid.getElement().style.cursor = ''\n    }\n\n    return [\n      // click\n      grid.listen(DG_EVENT_TYPE.CLICK_CELL, (e) => {\n        if (!isTarget(e.col, e.row)) {\n          return\n        }\n        if (isPromise(grid.getRowRecord(e.row))) {\n          return\n        }\n        if (!_isTreeNodeSpace(grid, e.col, e.row, e.event)) {\n          return\n        }\n        const treeInfo = _getTreeInfo(grid, e.row)\n        if (!treeInfo) {\n          return\n        }\n        const isAll = e.event.shiftKey\n        const type: ToggledType = treeInfo.expanded\n          ? isAll\n            ? 'collapseAll'\n            : 'collapse'\n          : isAll\n          ? 'expandAll'\n          : 'expand'\n        const params = {\n          col: e.col,\n          event: e.event,\n          row: e.row,\n          treeInfo,\n          type,\n        }\n\n        if (this._canToggle && this._canToggle(params) === false) {\n          return\n        }\n        grid.selectCellRange(e.col, e.row, e.col, e.row)\n        toggle(\n          {\n            col: e.col,\n            row: e.row,\n          },\n          isAll\n        )\n        if (this._toggled) {\n          this._toggled(params)\n        }\n        event.cancel(e.event)\n        return false\n      }),\n      // mouse move\n      grid.listen(DG_EVENT_TYPE.MOUSEENTER_CELL, doMouseMove),\n      grid.listen(DG_EVENT_TYPE.MOUSEOVER_CELL, doMouseMove),\n      grid.listen(DG_EVENT_TYPE.MOUSEMOVE_CELL, doMouseMove),\n      grid.listen(DG_EVENT_TYPE.MOUSELEAVE_CELL, doMouseLeave),\n      grid.listen(DG_EVENT_TYPE.MOUSEOUT_CELL, doMouseLeave),\n      // key down\n      grid.listen(DG_EVENT_TYPE.KEYDOWN, (e) => {\n        const keys = [KEY_DOWN, KEY_ENTER, KEY_LEFT, KEY_RIGHT, KEY_UP]\n        if (\n          keys.indexOf(e.keyCode) === -1 ||\n          (!e.event.ctrlKey && !e.event.metaKey)\n        ) {\n          return\n        }\n        const sel = grid.selection.select\n        const cell = {\n          col: sel.col,\n          row: sel.row,\n        }\n        if (!isTarget(cell.col, cell.row)) {\n          return\n        }\n        if (isPromise(grid.getRowRecord(cell.row))) {\n          return\n        }\n        const treeInfo = _getTreeInfo(grid, cell.row)\n        if (!treeInfo) {\n          return\n        }\n        let type: ToggledType\n        if (e.keyCode === KEY_DOWN || e.keyCode === KEY_RIGHT) {\n          type = e.keyCode === KEY_DOWN ? 'expandAll' : 'expand'\n        } else if (e.keyCode === KEY_UP || e.keyCode === KEY_LEFT) {\n          type = e.keyCode === KEY_UP ? 'collapseAll' : 'collapse'\n        } else {\n          type = treeInfo.expanded\n            ? e.event.shiftKey\n              ? 'collapseAll'\n              : 'collapse'\n            : e.event.shiftKey\n            ? 'expandAll'\n            : 'expand'\n        }\n        const params = {\n          col: cell.col,\n          event: e.event,\n          row: cell.row,\n          treeInfo,\n          type,\n        }\n\n        if (this._canToggle && this._canToggle(params) === false) {\n          return\n        }\n        if (e.keyCode === KEY_DOWN || e.keyCode === KEY_RIGHT) {\n          expand(cell, e.keyCode === KEY_DOWN)\n        } else if (e.keyCode === KEY_UP || e.keyCode === KEY_LEFT) {\n          collapse(cell, e.keyCode === KEY_UP)\n        } else {\n          toggle(cell, e.event.shiftKey)\n        }\n        if (this._toggled) {\n          this._toggled(params)\n        }\n        event.cancel(e.event)\n        return treeInfo.isLeaf // 只有叶子节点允许不阻止后续事件执行\n      }),\n    ]\n  }\n  protected drawEditingInternal(\n    context: CellContext,\n    style: TreeStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    super.drawEditingInternal(context, style, helper, grid, info)\n    const textAlign = style.textAlign\n    const textBaseline = style.textBaseline\n    const color = style.color\n    const treeInfo = _getTreeInfo(grid, context.row)\n    const textOverflow = style.textOverflow\n    const autoWrapText = style.autoWrapText\n    const lineHeight = style.lineHeight\n    const lineClamp = style.lineClamp\n    const record = info.getRecord()\n    const isMultilineText = getOrApply(this.multilineText, record)\n    helper.tree('', context, {\n      color,\n      padding: columnUtils.getActionTextPadding(context, helper, style),\n      textAlign,\n      textBaseline,\n      textOverflow,\n      treeInfo,\n      treeNodeSpace: TREE_NODE_SPACE,\n      isMultilineText,\n      autoWrapText,\n      lineHeight,\n      lineClamp,\n    })\n  }\n}\n","import { CellContext, GridCanvasHelperAPI } from '../../ts-types'\nimport { DrawCellInfo, GridInternal } from '../../ts-types-internal'\nimport { BaseColumn } from './BaseColumn'\nimport { RadioStyle } from '../style/RadioStyle'\nimport { getRadioColumnStateId } from '../../internal/symbolManager'\nimport { isDef } from '../../internal/utils'\nimport { toBoolean } from '../utils'\n\nconst RADIO_COLUMN_STATE_ID = getRadioColumnStateId()\n\nexport class RadioColumn<T> extends BaseColumn<T, boolean> {\n  public get StyleClass(): typeof RadioStyle {\n    return RadioStyle\n  }\n  public clone(): RadioColumn<T> {\n    return new RadioColumn(this)\n  }\n  public convertInternal(value: unknown): boolean {\n    return toBoolean(value)\n  }\n  public drawInternal(\n    value: boolean,\n    context: CellContext,\n    style: RadioStyle,\n    helper: GridCanvasHelperAPI,\n    grid: GridInternal<T>,\n    _info: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      checkColor,\n      uncheckBorderColor,\n      checkBorderColor,\n      uncheckBgColor,\n      checkBgColor,\n    } = style\n\n    const { col, row } = context\n    const range = grid.getCellRange(col, row)\n    const cellKey = `${range.start.col}:${range.start.row}`\n    const elapsed = grid[RADIO_COLUMN_STATE_ID]?.elapsed[cellKey]\n\n    const opt: Parameters<GridCanvasHelperAPI['radioButton']>[2] = {\n      textAlign,\n      textBaseline,\n      checkColor,\n      uncheckBorderColor,\n      checkBorderColor,\n      uncheckBgColor,\n      checkBgColor,\n    }\n    if (isDef(elapsed)) {\n      opt.animElapsedTime = elapsed\n    }\n    helper.radioButton(value, context, opt)\n  }\n}\n","import { ColumnTypeOption } from '../ts-types'\nimport { BaseColumn } from './type/BaseColumn'\nimport { BaseCheckColumn } from './type/BaseCheckColumn'\nimport { BranchGraphColumn } from './type/BranchGraphColumn'\nimport { ButtonColumn } from './type/ButtonColumn'\nimport { CheckColumn } from './type/CheckColumn'\nimport { SwitchColumn } from './type/SwitchColumn'\nimport { Column } from './type/Column'\nimport { DateColumn } from './type/DateColumn'\nimport { DrawColumn } from './type/DrawColumn'\nimport { IconColumn } from './type/IconColumn'\nimport { ImageColumn } from './type/ImageColumn'\nimport { LookupColumn } from './type/LookupColumn'\nimport { MenuColumn } from './type/MenuColumn'\nimport { MultilineTextColumn } from './type/MultilineTextColumn'\nimport { NumberColumn } from './type/NumberColumn'\nimport { PercentCompleteBarColumn } from './type/PercentCompleteBarColumn'\nimport { TreeColumn } from './type/TreeColumn'\nimport { RadioColumn } from './type/RadioColumn'\n\nexport const TYPES = {\n  DEFAULT: new Column<any>(),\n  NUMBER: new NumberColumn<any>(),\n  CHECK: new CheckColumn<any>(),\n  RADIO: new RadioColumn<any>(),\n  BUTTON: new ButtonColumn<any>(),\n  IMAGE: new ImageColumn<any>(),\n  MULTILINETEXT: new MultilineTextColumn<any>(),\n  DATE: new DateColumn<any>(),\n  LOOKUP: new LookupColumn<any, any>(),\n  SWITCH: new SwitchColumn<any>(),\n  TREE: new TreeColumn<any>(),\n  DRAW: new DrawColumn<any>(),\n}\n\nexport {\n  BaseColumn,\n  BaseCheckColumn,\n  Column,\n  NumberColumn,\n  CheckColumn,\n  RadioColumn,\n  SwitchColumn,\n  ButtonColumn,\n  ImageColumn,\n  PercentCompleteBarColumn,\n  IconColumn,\n  BranchGraphColumn,\n  MenuColumn,\n  MultilineTextColumn,\n  DateColumn,\n  LookupColumn,\n  TreeColumn,\n  DrawColumn,\n}\n\nexport function of<T>(\n  columnType: ColumnTypeOption | BaseColumn<T, any> | null | undefined\n): BaseColumn<T, any> {\n  if (!columnType) {\n    return TYPES.DEFAULT\n  } else if (typeof columnType === 'string') {\n    const key = columnType.toUpperCase() as keyof typeof TYPES\n    return TYPES[key] || of(null)\n  } else {\n    return columnType\n  }\n}\n","import {\n  ACTIONS,\n  BaseAction,\n  Editor,\n  BaseCheckEditor,\n  BaseInputEditor,\n  BaseActionInput,\n  Action as ColumnAction,\n  CheckEditor,\n  RadioEditor,\n  SwitchEditor,\n  ButtonAction,\n  SmallDialogInputEditor,\n  InlineInputEditor,\n  InlineTextAreaEditor,\n  InlineLookupEditor,\n  InlineMenuEditor,\n  of as actionOf,\n  ImmutableActions,\n} from './columns/action'\nimport {\n  EVENT_TYPE,\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style as ColumnStyle,\n  NumberStyle,\n  CheckStyle,\n  RadioStyle,\n  SwitchStyle,\n  ButtonStyle,\n  ImageStyle,\n  IconStyle,\n  PercentCompleteBarStyle,\n  MultilineTextStyle,\n  MenuStyle,\n  DateStyle,\n  LookupStyle,\n  TreeStyle,\n  DrawStyle,\n  of as styleOf,\n} from './columns/style'\nimport {\n  TYPES,\n  BaseColumn,\n  BaseCheckColumn,\n  Column,\n  NumberColumn,\n  CheckColumn,\n  RadioColumn,\n  SwitchColumn,\n  ButtonColumn,\n  ImageColumn,\n  PercentCompleteBarColumn,\n  IconColumn,\n  BranchGraphColumn,\n  MenuColumn,\n  MultilineTextColumn,\n  DateColumn,\n  LookupColumn,\n  TreeColumn,\n  DrawColumn,\n  of as typeOf,\n} from './columns/type'\n\nconst action = {\n  ACTIONS: ACTIONS as ImmutableActions,\n  BaseAction,\n  Editor,\n  BaseCheckEditor,\n  BaseInputEditor,\n  BaseActionInput,\n  Action: ColumnAction,\n  CheckEditor,\n  RadioEditor,\n  SwitchEditor,\n  ButtonAction,\n  SmallDialogInputEditor,\n  InlineInputEditor,\n  InlineTextAreaEditor,\n  InlineLookupEditor,\n  InlineMenuEditor,\n  of: actionOf,\n}\n\nconst style = {\n  EVENT_TYPE,\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style: ColumnStyle,\n  NumberStyle,\n  CheckStyle,\n  RadioStyle,\n  SwitchStyle,\n  ButtonStyle,\n  ImageStyle,\n  IconStyle,\n  PercentCompleteBarStyle,\n  MultilineTextStyle,\n  MenuStyle,\n  DateStyle,\n  LookupStyle,\n  TreeStyle,\n  DrawStyle,\n  of: styleOf,\n}\n\nconst type = {\n  TYPES,\n  BaseColumn,\n  BaseCheckColumn,\n  Column,\n  NumberColumn,\n  CheckColumn,\n  RadioColumn,\n  SwitchColumn,\n  ButtonColumn,\n  ImageColumn,\n  PercentCompleteBarColumn,\n  IconColumn,\n  BranchGraphColumn,\n  MenuColumn,\n  MultilineTextColumn,\n  DateColumn,\n  LookupColumn,\n  TreeColumn,\n  DrawColumn,\n  of: typeOf,\n}\n\n/**\n * columns\n */\nexport const columns = { action, type, style }\n","import { array } from './utils'\n\nconst TYPE_PUNCTURE = 'p'\nconst TYPE_UNIT = 'u'\nconst TYPE_OPERATOR = 'o'\nconst TYPE_NUMBER = 'n'\n\nconst NODE_TYPE_UNIT = 'u'\nconst NODE_TYPE_BINARY_EXPRESSION = 'b'\nconst NODE_TYPE_NUMBER = 'n'\n\ntype Ops = '-' | '+' | '*' | '/'\ntype PuncToken = {\n  value: string\n  type: typeof TYPE_PUNCTURE\n}\ntype UnitToken = {\n  value: string\n  type: typeof TYPE_UNIT\n}\ntype OpToken = {\n  value: Ops\n  type: typeof TYPE_OPERATOR\n}\ntype NumToken = {\n  value: string\n  type: typeof TYPE_NUMBER\n}\ntype Token = PuncToken | UnitToken | OpToken | NumToken\ntype UnitNode = {\n  nodeType: typeof NODE_TYPE_UNIT\n  unit: string\n  value: number\n}\ntype BinaryNode = {\n  nodeType: typeof NODE_TYPE_BINARY_EXPRESSION\n  left: Node\n  op: OpToken\n  right: Node\n}\ntype NumNode = {\n  nodeType: typeof NODE_TYPE_NUMBER\n  value: number\n}\ntype Node = UnitNode | BinaryNode | NumNode\n\nfunction createError(calc: string): Error {\n  return new Error(`calc parse error: ${calc}`)\n}\n\n/**\n * tokenize\n * @param calc - calc expression\n * @returns tokens\n */\nfunction tokenize(calc: string): Token[] {\n  let exp = calc.replace(/calc\\(/g, '(')\n  const reUnit = /^[-+]?(\\d*\\.\\d+|\\d+)[a-z%]+/i\n  const reNum = /^[-+]?(\\d*\\.\\d+|\\d+)/i\n  const reOp = /^[-+*/]/\n\n  const tokens: Token[] = []\n  let re\n  while ((exp = exp.trim())) {\n    if (exp[0] === '(' || exp[0] === ')') {\n      tokens.push({ value: exp[0], type: TYPE_PUNCTURE })\n      exp = exp.slice(1)\n    } else if ((re = reUnit.exec(exp))) {\n      tokens.push({ value: re[0], type: TYPE_UNIT })\n      exp = exp.slice(re[0].length)\n    } else if ((re = reNum.exec(exp))) {\n      tokens.push({ value: re[0], type: TYPE_NUMBER })\n      exp = exp.slice(re[0].length)\n    } else if ((re = reOp.exec(exp))) {\n      tokens.push({\n        value: re[0] as Ops,\n        type: TYPE_OPERATOR,\n      })\n      exp = exp.slice(re[0].length)\n    } else {\n      throw createError(calc)\n    }\n  }\n  return tokens\n}\n\nconst PRECEDENCE = {\n  '*': 3,\n  '/': 3,\n  '+': 2,\n  '-': 2,\n}\n\nfunction lex(tokens: Token[], calc: string): Node {\n  function buildBinaryExpNode(stack: (Node | OpToken)[]): BinaryNode {\n    const right = stack.pop() as Node\n    const op = stack.pop() as OpToken\n    const left = stack.pop() as Node\n\n    if (\n      !left ||\n      !left.nodeType ||\n      !op ||\n      op.type !== TYPE_OPERATOR ||\n      !right ||\n      !right.nodeType\n    ) {\n      throw createError(calc)\n    }\n    return {\n      nodeType: NODE_TYPE_BINARY_EXPRESSION,\n      left,\n      op,\n      right,\n    }\n  }\n\n  const stack: (Node | OpToken)[] = []\n\n  while (tokens.length) {\n    const token = tokens.shift() as Token\n    if (token.type === TYPE_PUNCTURE && token.value === '(') {\n      let deep = 0\n      const closeIndex = array.findIndex(tokens, (t) => {\n        if (t.type === TYPE_PUNCTURE && t.value === '(') {\n          deep++\n        } else if (t.type === TYPE_PUNCTURE && t.value === ')') {\n          if (!deep) {\n            return true\n          }\n          deep--\n        }\n        return false\n      })\n      if (closeIndex === -1) {\n        throw createError(calc)\n      }\n      stack.push(lex(tokens.slice(0, closeIndex), calc))\n      tokens.splice(0, closeIndex + 1)\n    } else if (token.type === TYPE_OPERATOR) {\n      if (stack.length >= 3) {\n        const beforeOp = (stack[stack.length - 2] as OpToken).value\n        if (PRECEDENCE[token.value] <= PRECEDENCE[beforeOp]) {\n          stack.push(buildBinaryExpNode(stack))\n        }\n      }\n      stack.push(token)\n    } else if (token.type === TYPE_UNIT) {\n      const { value } = token\n      const num = parseFloat(value)\n      const unit = /[a-z%]+/i.exec(value)?.[0] || ''\n      stack.push({\n        nodeType: NODE_TYPE_UNIT,\n        value: num,\n        unit,\n      })\n    } else if (token.type === TYPE_NUMBER) {\n      stack.push({\n        nodeType: NODE_TYPE_NUMBER,\n        value: parseFloat(token.value),\n      })\n    }\n  }\n  while (stack.length > 1) {\n    stack.push(buildBinaryExpNode(stack))\n  }\n  return stack[0] as Node\n}\n\nfunction parse(calcStr: string): Node {\n  const tokens = tokenize(calcStr)\n  return lex(tokens, calcStr)\n}\n\nfunction calcNode(node: Node, context: CalcContext): number {\n  if (node.nodeType === NODE_TYPE_BINARY_EXPRESSION) {\n    const left = calcNode(node.left, context)\n    const right = calcNode(node.right, context)\n\n    switch (node.op.value) {\n      case '+':\n        return left + right\n      case '-':\n        return left - right\n      case '*':\n        return left * right\n      case '/':\n        return left / right\n      default:\n        throw new Error(`calc error. unknown operator: ${node.op.value}`)\n    }\n  } else if (node.nodeType === NODE_TYPE_UNIT) {\n    switch (node.unit) {\n      case '%':\n        return (node.value * context.full) / 100\n      case 'em':\n        return node.value * context.em\n      case 'px':\n        return node.value\n      default:\n        throw new Error(`calc error. unknown unit: ${node.unit}`)\n    }\n  } else if (node.nodeType === NODE_TYPE_NUMBER) {\n    return node.value\n  }\n  throw new Error('calc error.')\n}\n\nfunction toPxInternal(value: string, context: CalcContext): number {\n  const ast = parse(value)\n  return calcNode(ast, context)\n}\n\ntype CalcContext = {\n  full: number\n  em: number\n}\n\nexport function toPx(value: string | number, context: CalcContext): number {\n  if (typeof value === 'string') {\n    return toPxInternal(value.trim(), context)\n  }\n  return value - 0\n}\n","import { EventHandler } from './EventHandler'\nimport { isNode } from './utils'\n\nconst handler = new EventHandler()\n\nlet ratio: number\n\nfunction setRatio() {\n  if (isNode) {\n    ratio = 1\n  } else {\n    ratio = Math.ceil(window.devicePixelRatio || 1)\n    if (ratio > 1 && ratio % 2 !== 0) {\n      ratio += 1\n    }\n  }\n}\n\nsetRatio()\n\nif (!isNode) {\n  handler.on(window, 'resize', setRatio)\n}\n\nexport default {\n  transform(canvas: HTMLCanvasElement) {\n    const ctx = canvas.getContext('2d')\n\n    const getAttribute = canvas.getAttribute\n    const setAttribute = canvas.setAttribute\n    canvas.getAttribute = ((me) => (name: string) => {\n      let result = getAttribute.apply(me, [name]) as any\n      if (name === 'width' || name === 'height') {\n        result /= ratio\n      }\n      return result\n    })(canvas)\n    canvas.setAttribute = ((me) => (name: string, val: string) => {\n      const wh = name === 'width' || name === 'height'\n      if (wh) {\n        val = ratio * Number(val) + ''\n      }\n      const result = setAttribute.apply(me, [name, val])\n      if (wh && ctx) {\n        ctx.scale(ratio, ratio)\n      }\n      return result\n    })(canvas)\n\n    Object.defineProperty(canvas, 'width', {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return canvas.getAttribute('width')\n      },\n      set: (val) => {\n        canvas.setAttribute('width', Math.floor(val) + '')\n      },\n    })\n    Object.defineProperty(canvas, 'height', {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return canvas.getAttribute('height')\n      },\n      set: (val) => {\n        canvas.setAttribute('height', Math.floor(val) + '')\n      },\n    })\n    if (ctx) {\n      const drawImage = ctx.drawImage\n      ctx.drawImage = ((me) => (img: HTMLCanvasElement, ...args: any[]) => {\n        if (img !== canvas || ratio === 1) {\n          return drawImage.apply(me, [img].concat(args) as any)\n        }\n        me.save()\n        try {\n          me.scale(1 / ratio, 1 / ratio)\n          if (args.length > 4) {\n            args[4] *= ratio\n            args[5] *= ratio\n          } else {\n            args[0] *= ratio\n            args[1] *= ratio\n          }\n          return drawImage.apply(me, [img].concat(args) as any)\n        } finally {\n          me.restore()\n        }\n      })(ctx)\n    }\n    return canvas\n  },\n}\n","const indexFirst = (ary: number[], elm: number) => {\n  let low = 0\n  let high = ary.length - 1\n  while (low <= high) {\n    const i = Math.floor((low + high) / 2)\n    if (ary[i] === elm) {\n      return i\n    } else if (ary[i] > elm) {\n      high = i - 1\n    } else {\n      low = i + 1\n    }\n  }\n  return high < 0 ? 0 : high\n}\n\nexport default class NumberMap<T> {\n  private _keys: number[]\n  private _vals: { [key: number]: T }\n  private _sorted: boolean\n  public constructor() {\n    this._keys = []\n    this._vals = {}\n    this._sorted = false\n  }\n  public put(key: number, value: T) {\n    if (!(key in this._vals)) {\n      this._keys.push(key)\n      this._sorted = false\n    }\n    this._vals[key] = value\n  }\n  public get(key: number) {\n    return this._vals[key]\n  }\n  public has(key: number) {\n    return this._vals[key] !== null\n  }\n  public each(\n    keyFrom: number,\n    keyTo: number,\n    fn: (value: T, key: number) => void\n  ) {\n    const keys = this._keys\n    const length = keys.length\n    if (!this._sorted) {\n      keys.sort((a, b) => {\n        if (a < b) {\n          return -1\n        }\n        if (a > b) {\n          return 1\n        }\n        return 0\n      })\n      this._sorted = true\n    }\n\n    for (let i = indexFirst(keys, keyFrom); i < length; i++) {\n      const key = keys[i]\n      if (keyFrom <= key && key <= keyTo) {\n        fn(this.get(key), key)\n      } else if (keyTo < key) {\n        return\n      }\n    }\n  }\n}\n","import { ScrollableAPI } from '../ts-types'\nimport { EventHandler } from './EventHandler'\nimport style from './style'\nimport { browser, event } from './utils'\n\nconst MAX_SCROLL = browser.heightLimit - 1000\n\nexport default class Scrollbar implements ScrollableAPI {\n  private _handler: EventHandler\n  private _scrollable: HTMLDivElement\n  private _height: number\n  private _width: number\n  private _endPointElement: HTMLDivElement\n  private _p: number\n  private _perfectScrollbar: any\n  public constructor() {\n    this._handler = new EventHandler()\n\n    this._scrollable = document.createElement('div')\n    this._scrollable.classList.add('grid-scrollable')\n    this._height = 0\n    this._width = 0\n\n    this._perfectScrollbar = new (window as any).PerfectScrollbar(\n      this._scrollable,\n      {\n        minScrollbarLength: 24,\n      }\n    )\n    this._handler.on(this._scrollable, 'click', (e) => {\n      if (e.target !== this._scrollable) {\n        event.cancel(e)\n      }\n    })\n\n    this._p = 1\n\n    this._endPointElement = document.createElement('div')\n    this._endPointElement.classList.add('grid-scroll-end-point')\n    this._update()\n    this._scrollable.appendChild(this._endPointElement)\n  }\n  public calcTop(top: number) {\n    const relativeTop = top - this.scrollTop\n    return this._scrollable.scrollTop + relativeTop\n  }\n  public getElement() {\n    return this._scrollable\n  }\n  public setScrollSize(width: number, height: number) {\n    this._width = width\n    this._height = height\n    this._update()\n  }\n  public get scrollWidth() {\n    return this._width\n  }\n  public set scrollWidth(width: number) {\n    this._width = width\n    this._update()\n  }\n  public get scrollHeight() {\n    return this._height\n  }\n  public set scrollHeight(height: number) {\n    this._height = height\n    this._update()\n  }\n  public get scrollLeft() {\n    return Math.max(Math.ceil(this._scrollable.scrollLeft), 0)\n  }\n  public set scrollLeft(scrollLeft: number) {\n    this._scrollable.scrollLeft = scrollLeft\n  }\n  public get scrollTop() {\n    return Math.max(Math.ceil(this._scrollable.scrollTop / this._p), 0)\n  }\n  public set scrollTop(scrollTop: number) {\n    this._scrollable.scrollTop = scrollTop * this._p\n  }\n  public onScroll(fn: EventListener) {\n    this._handler.on(this._scrollable, 'scroll', fn)\n  }\n  public dispose() {\n    this._handler.dispose()\n  }\n  public update() {\n    this._update()\n  }\n  private _update() {\n    let domHeight\n    if (this._height > MAX_SCROLL) {\n      const sbSize = style.getScrollBarSize()\n      const { offsetHeight } = this._scrollable\n      const vScrollRange = MAX_SCROLL - offsetHeight + sbSize\n      const rScrollRange = this._height - offsetHeight + sbSize\n      this._p = vScrollRange / rScrollRange\n      domHeight = MAX_SCROLL\n    } else {\n      this._p = 1\n      domHeight = this._height\n    }\n    domHeight -= 1\n    const domWidth = this._width - 1\n\n    this._endPointElement.style.top = `${domHeight.toFixed()}px`\n    this._endPointElement.style.left = `${domWidth.toFixed()}px`\n\n    this._perfectScrollbar.update()\n  }\n}\n","import { ScrollableAPI } from '../ts-types'\nimport { EventHandler } from './EventHandler'\nimport style from './style'\nimport { browser } from './utils'\n\nconst MAX_SCROLL = browser.heightLimit - 1000\n\nexport default class Scrollable implements ScrollableAPI {\n  private _handler: EventHandler\n  private _scrollable: HTMLDivElement\n  private _height: number\n  private _width: number\n  private _endPointElement: HTMLDivElement\n  private _p: number\n  private _canvas: HTMLCanvasElement\n  public constructor(canvas: HTMLCanvasElement) {\n    this._canvas = canvas\n    this._handler = new EventHandler()\n\n    this._scrollable = document.createElement('div')\n    this._scrollable.classList.add('grid-scrollable')\n    this._height = 0\n    this._width = 0\n\n    this._p = 1\n\n    this._endPointElement = document.createElement('div')\n    this._endPointElement.classList.add('grid-scroll-end-point')\n    this._update()\n    this._scrollable.appendChild(this._endPointElement)\n\n    // const mousewheelevt = (/Firefox/i.test(navigator.userAgent)) ?\n    //     \"DOMMouseScroll\" : \"mousewheel\"; // FF doesn\"t recognize mousewheel as of FF3.x\n    // this._handler.on(this._scrollable, mousewheelevt, (evt) => {\n    //     const delta = evt.detail ? evt.detail * (-120) : evt.wheelDelta;\n    //     const point = Math.min(Math.abs(delta) / 12, this.scrollHeight / 5);\n    //     this.scrollTop += delta < 0 ? point : -point;\n    // });\n  }\n  public calcTop(top: number) {\n    const relativeTop = top - this.scrollTop\n    return this._scrollable.scrollTop + relativeTop\n  }\n  public getElement() {\n    return this._scrollable\n  }\n  public setScrollSize(width: number, height: number) {\n    this._width = width\n    this._height = height\n    this._update()\n  }\n  public get scrollWidth() {\n    return this._width\n  }\n  public set scrollWidth(width: number) {\n    this._width = width\n    this._update()\n  }\n  public get scrollHeight() {\n    return this._height\n  }\n  public set scrollHeight(height: number) {\n    this._height = height\n    this._update()\n  }\n  public get scrollLeft() {\n    return Math.max(Math.ceil(this._scrollable.scrollLeft), 0)\n  }\n  public set scrollLeft(scrollLeft: number) {\n    this._scrollable.scrollLeft = scrollLeft\n  }\n  public get scrollTop() {\n    return Math.max(Math.ceil(this._scrollable.scrollTop / this._p), 0)\n  }\n  public set scrollTop(scrollTop: number) {\n    this._scrollable.scrollTop = scrollTop * this._p\n  }\n  public onScroll(fn: EventListener) {\n    this._handler.on(this._scrollable, 'scroll', fn)\n  }\n  public dispose() {\n    this._handler.dispose()\n  }\n  public update() {\n    this._update()\n  }\n  private _update() {\n    let domHeight\n    const sbSize = style.getScrollBarSize()\n    if (this._height > MAX_SCROLL) {\n      const offsetHeight = this._scrollable.offsetHeight\n      const vScrollRange = MAX_SCROLL - offsetHeight + sbSize\n      const rScrollRange = this._height - offsetHeight + sbSize\n      this._p = vScrollRange / rScrollRange\n      domHeight = MAX_SCROLL\n    } else {\n      this._p = 1\n      domHeight = this._height\n    }\n    const domWidth = this._width\n\n    // TODO: windows 下横纵滚动条都存在时，显示多余空白问题\n    // const isWindows = /windows|win32/i.test(window.navigator.userAgent);\n    const top = domHeight > this._canvas.height ? domHeight : domHeight - sbSize\n    const left = domWidth > this._canvas.width ? domWidth : domWidth - sbSize\n\n    this._endPointElement.style.top = `${top.toFixed()}px`\n    this._endPointElement.style.left = `${left.toFixed()}px`\n\n    // 不让滚动条位置超出范围\n    const maxScrollTop = Math.max(0, top - this._canvas.height)\n    if (this._scrollable.scrollTop > maxScrollTop) {\n      this._scrollable.scrollTop = maxScrollTop\n    }\n    const maxScrollLeft = Math.max(0, left - this._canvas.width)\n    if (this._scrollable.scrollLeft > maxScrollLeft) {\n      this._scrollable.scrollLeft = maxScrollLeft\n    }\n  }\n}\n","import { EventHandler } from '../../internal/EventHandler'\nimport { event } from '../../internal/utils'\nimport { DrawGrid } from '../DrawGrid'\n\n/**\n * managing mouse down moving\n */\nexport abstract class BaseMouseDownMover {\n  private _handler: EventHandler\n  private _events: any\n  private _started: boolean\n  private _moved: boolean\n  private _grid: DrawGrid\n  private _mouseEndPoint: { x: number; y: number } | null\n  public constructor(grid: DrawGrid) {\n    this._grid = grid\n    this._handler = new EventHandler()\n    this._events = {}\n    this._started = false\n    this._moved = false\n    this._mouseEndPoint = null\n  }\n  public get grid() {\n    return this._grid\n  }\n  public moving(e: Event) {\n    return !!this._started\n  }\n  public lastMoving(e: Event) {\n    // 必要的控制以防止点击事件在mouseup后立即作出反应\n    if (this.moving(e)) {\n      return true\n    }\n    const last = this._mouseEndPoint\n    if (!last) {\n      return false\n    }\n    const pt = this._grid._getMouseAbstractPoint(e)\n    return !!pt && pt.x === last.x && pt.y === last.y\n  }\n  public dispose() {\n    this._handler.dispose()\n  }\n  protected _bindMoveAndUp(e: Event) {\n    const events = this._events\n    const handler = this._handler\n    if (!event.isTouchEvent(e)) {\n      events.mousemove = handler.on(document.body, 'mousemove', (event) =>\n        this._mouseMove(event)\n      )\n      events.mouseup = handler.on(document.body, 'mouseup', (event) =>\n        this._mouseUp(event)\n      )\n    } else {\n      events.touchmove = handler.on(\n        document.body,\n        'touchmove',\n        (event) => this._mouseMove(event),\n        {\n          passive: false,\n        }\n      )\n      events.touchend = handler.on(document.body, 'touchend', (event) =>\n        this._mouseUp(event)\n      )\n      events.touchcancel = handler.on(document.body, 'touchcancel', (event) =>\n        this._mouseUp(event)\n      )\n    }\n    this._started = true\n    this._moved = false\n  }\n  protected _mouseMove(e: Event) {\n    if (!event.isTouchEvent(e)) {\n      if (event.getMouseButtons(e as MouseEvent) !== 1) {\n        this._mouseUp(e)\n        return\n      }\n    }\n    this._moved =\n      this._moveInternal(e) || this._moved /* calculation on after */\n\n    event.cancel(e)\n  }\n  protected abstract _moveInternal(e: Event): boolean\n  protected _mouseUp(e: Event) {\n    const events = this._events\n    const handler = this._handler\n    handler.off(events.mousemove)\n    handler.off(events.touchmove)\n    handler.off(events.mouseup)\n    handler.off(events.touchend)\n    // handler.off(events.mouseleave);\n    handler.off(events.touchcancel)\n\n    this._upInternal(e)\n\n    // 必要的控制以防止点击事件在mouseup后立即作出反应\n    if (this._moved) {\n      // 如果发生了移动\n      this._mouseEndPoint = this._grid._getMouseAbstractPoint(e)\n      setTimeout(() => {\n        this._mouseEndPoint = null\n        this._started = false\n      }, 10)\n    } else {\n      this._started = false\n    }\n\n    event.cancel(e)\n  }\n  protected _upInternal(e: Event) {\n    // nothing\n  }\n  protected _vibrate(e: Event) {\n    if (navigator.vibrate && event.isTouchEvent(e)) {\n      navigator.vibrate(50)\n    }\n  }\n}\n","import { CellAddress } from '../../ts-types'\nimport { event } from '../../internal/utils'\nimport { BaseMouseDownMover } from './BaseMouseDownMover'\nimport { DG_EVENT_TYPE } from './DG_EVENT_TYPE'\n\n/**\n * managing cell selection operation with mouse\n */\nexport class CellSelector extends BaseMouseDownMover {\n  private _cell: CellAddress = { col: -1, row: -1 }\n  public start(e: MouseEvent | TouchEvent) {\n    const cell = this._getTargetCell(e)\n    if (!cell) {\n      this.grid._forceFocusCell()\n      event.cancel(e)\n      return\n    }\n    this.grid.fireListeners(DG_EVENT_TYPE.MOUSE_SELECTED_START, e)\n    this.grid._moveFocusCell(cell.col, cell.row, e.shiftKey)\n\n    this._bindMoveAndUp(e)\n\n    this._cell = cell\n\n    event.cancel(e)\n    this._vibrate(e)\n  }\n  public select(e: MouseEvent | TouchEvent) {\n    const cell = this._getTargetCell(e)\n    if (!cell) {\n      return\n    }\n    this.grid._moveFocusCell(cell.col, cell.row, e.shiftKey)\n    this._cell = cell\n  }\n  protected _upInternal(e: MouseEvent | TouchEvent) {\n    this.grid.fireListeners(DG_EVENT_TYPE.MOUSE_SELECTED_END, e)\n  }\n  protected _moveInternal(e: Event) {\n    const cell = this._getTargetCell(e)\n    if (!cell) {\n      return false\n    }\n    const oldCol = this._cell.col\n    const oldRow = this._cell.row\n    const newCol = cell.col\n    const newRow = cell.row\n    if (oldCol === newCol && oldRow === newRow) {\n      return false\n    }\n    const grid = this.grid\n    grid._moveFocusCell(newCol, newRow, true, true)\n\n    // make visible\n    const makeVisibleCol = (() => {\n      if (newCol < oldCol && 0 < newCol) {\n        // move left\n        return newCol - 1\n      } else if (oldCol < newCol && newCol + 1 < grid.colCount) {\n        // move right\n        return newCol + 1\n      }\n      return newCol\n    })()\n    const makeVisibleRow = (() => {\n      if (newRow < oldRow && 0 < newRow) {\n        // move up\n        return newRow - 1\n      } else if (oldRow < newRow && newRow + 1 < grid.rowCount) {\n        // move down\n        return newRow + 1\n      }\n      return newRow\n    })()\n    if (makeVisibleCol !== newCol || makeVisibleRow !== newRow) {\n      grid.makeVisibleCell(makeVisibleCol, makeVisibleRow)\n    }\n    this._cell = cell\n    return true\n  }\n  private _getTargetCell(e: Event) {\n    const grid = this.grid\n    const abstractPos = grid._getMouseAbstractPoint(e)\n    if (!abstractPos) {\n      return null\n    }\n    const cell = grid.getCellAt(abstractPos.x, abstractPos.y)\n    if (cell.col < 0 || cell.row < 0) {\n      return null\n    }\n    return cell\n  }\n}\n","import { event } from '../../internal/utils'\nimport { DrawGrid } from '../DrawGrid'\nimport { BaseMouseDownMover } from './BaseMouseDownMover'\n\nimport { DG_EVENT_TYPE } from './DG_EVENT_TYPE'\n\n/**\n * managing row width changing operation with mouse\n */\nexport class ColumnResizer extends BaseMouseDownMover {\n  private _targetCol: number\n  private _x: number\n  private _preX: number\n  private _invalidateAbsoluteLeft: number\n  public constructor(grid: DrawGrid) {\n    super(grid)\n    this._targetCol = -1\n    this._x = 0\n    this._preX = 0\n    this._invalidateAbsoluteLeft = 0\n  }\n  public start(col: number, e: Event) {\n    let pageX\n    if (!event.isTouchEvent(e)) {\n      ;({ pageX } = e as MouseEvent)\n    } else {\n      ;({ pageX } = (e as TouchEvent).changedTouches[0])\n    }\n\n    this._x = pageX\n    this._preX = 0\n\n    this.grid._resetColWidthOffset(col)\n    this._bindMoveAndUp(e)\n\n    this._targetCol = col\n    // 由于有合并单元格，所以起始刷新列始终从 0 开始计算\n    // this._invalidateAbsoluteLeft = this.grid._getColsWidth(0, col - 1)\n\n    event.cancel(e)\n    this._vibrate(e)\n  }\n  protected _moveInternal(e: Event) {\n    const pageX = event.isTouchEvent(e)\n      ? (e as TouchEvent).changedTouches[0].pageX\n      : (e as MouseEvent).pageX\n\n    const x = pageX - this._x\n    const moveX = x - this._preX\n    this._preX = x\n    const pre = this.grid.getColWidth(this._targetCol)\n    let afterSize = this.grid._adjustColWidth(this._targetCol, pre + moveX)\n    if (afterSize < 10 && moveX < 0) {\n      afterSize = 10\n    }\n    this.grid._storeAutoColWidthExprs()\n    this.grid.setColWidth(this._targetCol, afterSize)\n\n    const rect = this.grid._getVisibleRect()\n    rect.left = this._invalidateAbsoluteLeft\n    this.grid._invalidateRect(rect)\n\n    this.grid.fireListeners(DG_EVENT_TYPE.RESIZE_COLUMN, {\n      col: this._targetCol,\n    })\n\n    return true\n  }\n  protected _upInternal(e: Event) {\n    if (this.grid.updateScroll()) {\n      this.grid.invalidate()\n    }\n  }\n}\n","import Rect from '../../internal/Rect'\nimport { DrawLayers } from '../draw-grid/DrawLayers'\nimport { DrawGrid } from '../DrawGrid'\nimport { Selection } from './Selection'\nimport { CellRange, CellContext, CellSelection } from '../../ts-types'\n\nexport function createCellRange(\n  startCol: number,\n  startRow: number,\n  endCol: number,\n  endRow: number\n): CellRange {\n  return {\n    start: { col: startCol, row: startRow },\n    end: { col: endCol, row: endRow },\n  }\n}\n\n/**\n * Context of cell drawing\n */\nexport class DrawCellContext implements CellContext {\n  private _col: number\n  private _row: number\n  private _mode: number\n  private _range: CellRange\n  private _ctx: CanvasRenderingContext2D | null\n  private _rect: Rect | null\n  private _drawRect: Rect | null\n  private _drawing: boolean\n  private _selection: Selection\n  private _drawLayers: DrawLayers\n  private _childContexts: DrawCellContext[]\n  private _cancel?: boolean\n  private _grid?: DrawGrid\n  private _onTerminate?: () => void\n  private _rectFilter: ((base: Rect) => Rect) | null = null\n  /**\n   * constructor\n   */\n  public constructor(\n    col: number,\n    row: number,\n    ctx: CanvasRenderingContext2D,\n    rect: Rect,\n    drawRect: Rect | null,\n    drawing: boolean,\n    selection: Selection,\n    drawLayers: DrawLayers\n  ) {\n    this._col = col\n    this._row = row\n    this._mode = 0\n    this._range = createCellRange(col, row, col, row)\n    this._ctx = ctx\n    this._rect = rect\n    this._drawRect = drawRect\n    this._drawing = drawing\n    this._selection = selection\n    this._drawLayers = drawLayers\n    this._childContexts = []\n  }\n  public get drawing() {\n    if (this._mode === 0) {\n      return this._drawing\n    } else {\n      return true\n    }\n  }\n  public get row() {\n    return this._row\n  }\n  public get col() {\n    return this._col\n  }\n  public get range() {\n    return this._range\n  }\n  public set range(range) {\n    this._range = range\n  }\n  public cancel() {\n    this._cancel = true\n    this._childContexts.forEach((ctx) => {\n      ctx.cancel()\n    })\n  }\n  /**\n   * select status.\n   */\n  public getSelection(): CellSelection {\n    return {\n      border: this._selection.border(this._col, this._row),\n      dragged: this._selection.drag.inDrag(this._col, this._row),\n      select: this._selection.drag.select,\n      range: this._selection.range,\n    }\n  }\n  /**\n   * Canvas context.\n   */\n  public getContext(): CanvasRenderingContext2D {\n    if (this._mode === 0) {\n      return this._ctx as CanvasRenderingContext2D\n    } else {\n      return (this._grid as DrawGrid)._getInitContext()\n    }\n  }\n  /**\n   * Rectangle of cell.\n   */\n  public getRect(): Rect {\n    const rectFilter = this._rectFilter\n    return rectFilter\n      ? rectFilter(this._getRectInternal())\n      : this._getRectInternal()\n  }\n  public setRectFilter(rectFilter: (base: Rect) => Rect): void {\n    this._rectFilter = rectFilter\n  }\n  /**\n   * Rectangle of Drawing range.\n   */\n  public getDrawRect(): Rect | null {\n    if (this._cancel) {\n      return null\n    }\n    if (this._mode === 0) {\n      return this._drawRect\n    } else {\n      if (this._isOutOfRange()) {\n        return null\n      }\n      const absoluteRect = (this._grid as DrawGrid).getCellRect(\n        this._col,\n        this._row\n      )\n      return this._toRelativeDrawRect(absoluteRect)\n    }\n  }\n  /**\n   * get Context of current state\n   */\n  public toCurrentContext(): DrawCellContext {\n    if (this._mode === 0) {\n      return this\n    } else {\n      const absoluteRect = (this._grid as DrawGrid).getCellRect(\n        this._col,\n        this._row\n      )\n      const rect = (this._grid as DrawGrid)._toRelativeRect(absoluteRect)\n      const drawRect = this._isOutOfRange()\n        ? null\n        : this._toRelativeDrawRect(absoluteRect)\n      const context = new DrawCellContext(\n        this._col,\n        this._row,\n        this.getContext(),\n        rect,\n        drawRect,\n        this.drawing,\n        this._selection,\n        this._drawLayers\n      )\n      // toCurrentContext 调用 this.toCurrentContext\n      context.toCurrentContext = this.toCurrentContext.bind(this)\n      this._childContexts.push(context)\n      if (this._cancel) {\n        context.cancel()\n      }\n      context._rectFilter = this._rectFilter\n      return context\n    }\n  }\n  public addLayerDraw(\n    level: number,\n    fn: (ctx: CanvasRenderingContext2D) => void\n  ) {\n    this._drawLayers.addDraw(level, fn)\n  }\n  public _delayMode(grid: DrawGrid, onTerminate: () => void) {\n    this._mode = 1\n    this._ctx = null\n    this._rect = null\n    this._drawRect = null\n    this._grid = grid\n    this._onTerminate = onTerminate\n  }\n  /**\n   * terminate\n   */\n  public terminate(): void {\n    if (this._mode !== 0) {\n      this._onTerminate?.()\n    }\n  }\n  private _getRectInternal(): Rect {\n    if (this._mode === 0) {\n      return this._rect as Rect\n    } else {\n      if (this._rect) {\n        return this._rect\n      }\n      return (this._grid as DrawGrid).getCellRelativeRect(this._col, this._row)\n    }\n  }\n  private _isOutOfRange(): boolean {\n    const { colCount, rowCount } = this._grid as DrawGrid\n    return colCount <= this._col || rowCount <= this._row\n  }\n  private _toRelativeDrawRect(absoluteRect: Rect): Rect | null {\n    const grid = this._grid as DrawGrid\n    const visibleRect = grid._getVisibleRect()\n    let rect = absoluteRect.copy()\n    if (!rect.intersection(visibleRect)) {\n      return null\n    }\n\n    const isFrozenCell = grid.isFrozenCell(this._col, this._row)\n    if (grid.frozenColCount >= 0 && (!isFrozenCell || !isFrozenCell.col)) {\n      const fRect = grid.getCellRect(grid.frozenColCount - 1, this._row)\n      rect = Rect.bounds(\n        Math.max(rect.left, fRect.right),\n        rect.top,\n        rect.right,\n        rect.bottom\n      )\n    }\n    if (grid.frozenRowCount >= 0 && (!isFrozenCell || !isFrozenCell.row)) {\n      const fRect = grid.getCellRect(this._col, grid.frozenRowCount - 1)\n      rect = Rect.bounds(\n        rect.left,\n        Math.max(rect.top, fRect.bottom),\n        rect.right,\n        rect.bottom\n      )\n    }\n\n    if (!rect.intersection(visibleRect)) {\n      return null\n    }\n    rect.offsetLeft(-visibleRect.left)\n    rect.offsetTop(-visibleRect.top)\n\n    return rect\n  }\n}\n","export class DrawLayer {\n  private _level: number\n  private _list: ((ctx: CanvasRenderingContext2D) => void)[]\n  public constructor(level: number) {\n    this._level = level\n    this._list = []\n  }\n  public get level() {\n    return this._level\n  }\n  public addDraw(fn: (ctx: CanvasRenderingContext2D) => void) {\n    this._list.push(fn)\n  }\n  public draw(ctx: CanvasRenderingContext2D) {\n    this._list.forEach((fn) => {\n      ctx.save()\n      try {\n        fn(ctx)\n      } finally {\n        ctx.restore()\n      }\n    })\n  }\n}\n","import { DrawLayer } from './DrawLayer'\n\n/**\n * This class manages the drawing process for each layer\n */\nexport class DrawLayers {\n  private _layers: {\n    [key: number]: DrawLayer\n  }\n  public constructor() {\n    this._layers = {}\n  }\n  public addDraw(level: number, fn: (ctx: CanvasRenderingContext2D) => void) {\n    const l =\n      this._layers[level] || (this._layers[level] = new DrawLayer(level))\n    l.addDraw(fn)\n  }\n  public draw(ctx: CanvasRenderingContext2D) {\n    const list = []\n    for (const k in this._layers) {\n      if (this._layers.hasOwnProperty(k)) {\n        list.push(this._layers[k])\n      }\n    }\n    list.sort((a, b) => a.level - b.level)\n    list.forEach((l) => l.draw(ctx))\n  }\n}\n","import {\n  ScrollableAPI,\n  KeyboardEventListener,\n  KeydownEvent,\n  EventListenerId,\n} from '../../ts-types'\nimport {\n  KEY_TAB,\n  KEY_ALPHA_C,\n  KEY_ALPHA_V,\n  KEY_DOWN,\n  KEY_END,\n  KEY_HOME,\n  KEY_LEFT,\n  KEY_RIGHT,\n  KEY_UP,\n  KEY_ENTER,\n  KEY_ALPHA_A,\n  KEY_DEL,\n  KEY_BS,\n} from '../../core/draw-grid/KEY_CODE'\nimport { EventHandler } from '../../internal/EventHandler'\nimport Rect from '../../internal/Rect'\nimport style from '../../internal/style'\nimport {\n  event,\n  browser,\n  isDescendantElement,\n  isDef,\n  array,\n} from '../../internal/utils'\nimport { DrawGrid } from '../DrawGrid'\nimport { EventTarget } from '../EventTarget'\n\nfunction _setSafeInputValue(input: HTMLInputElement, value: string) {\n  const type = input.type\n  input.type = ''\n  input.value = value\n  if (type) {\n    input.type = type\n  }\n}\n\n/**\n * Manage focus\n */\nexport class FocusControl extends EventTarget {\n  private _grid: DrawGrid\n  private _scrollable: ScrollableAPI\n  private _handler: EventHandler\n  private _input: HTMLInputElement\n  private _isComposition: boolean = false\n  private _compositionEnd: NodeJS.Timeout | undefined\n  private _inputStatus?: { [key: string]: string }\n  private _keyDownMoveCallback?: KeyboardEventListener\n  public constructor(\n    grid: DrawGrid,\n    parentElement: HTMLElement,\n    scrollable: ScrollableAPI\n  ) {\n    super()\n    this._grid = grid\n    this._scrollable = scrollable\n    const handler = (this._handler = new EventHandler())\n    const input = (this._input = document.createElement('input'))\n    input.classList.add('grid-focus-control')\n    input.readOnly = true\n    parentElement.appendChild(input)\n\n    handler.on(input, 'compositionstart', (e) => {\n      input.classList.add('composition')\n      input.style.font = grid.font || '16px sans-serif'\n      this._isComposition = true\n      if (this._compositionEnd) {\n        clearTimeout(this._compositionEnd)\n        delete this._compositionEnd\n      }\n      grid.focus()\n    })\n    let lastInputValue: any\n    const inputClear = () => {\n      lastInputValue = input.value\n      if (this._isComposition) {\n        return\n      }\n      if (lastInputValue !== '') {\n        _setSafeInputValue(input, '')\n      }\n    }\n\n    const handleCompositionEnd = () => {\n      this._isComposition = false\n      input.classList.remove('composition')\n      input.style.font = ''\n      const value = input.value\n\n      inputClear()\n\n      if (!input.readOnly) {\n        this.fireListeners('input', value)\n      }\n\n      if (this._compositionEnd) {\n        clearTimeout(this._compositionEnd)\n        delete this._compositionEnd\n      }\n    }\n    handler.on(input, 'compositionend', (e) => {\n      this._compositionEnd = setTimeout(handleCompositionEnd, 0)\n    })\n    handler.on(input, 'keypress', (e) => {\n      if (this._isComposition) {\n        return\n      }\n      if (!input.readOnly && e.key && e.key.length === 1) {\n        if (e.ctrlKey || e.metaKey) {\n          if (e.key === 'c') {\n            // copy! for Firefox & Safari\n          } else if (e.key === 'v') {\n            // paste! for Firefox & Safari\n          } else if (e.key === 'x') {\n            // cut! for Firefox & Safari\n          }\n        } else {\n          if (e.key === ' ') {\n            // Since the full-width space cannot be determined, it is processed by \"input\".\n            return\n          }\n          this.fireListeners('input', e.key)\n          event.cancel(e)\n        }\n      }\n      inputClear()\n    })\n    handler.on(input, 'keydown', (e) => {\n      if (this._isComposition) {\n        if (this._compositionEnd) {\n          handleCompositionEnd()\n          event.cancel(e)\n        }\n        return\n      }\n      const keyCode = event.getKeyCode(e)\n      let stopCellMove = false\n      const evt: KeydownEvent = {\n        keyCode,\n        event: e,\n        stopCellMoving() {\n          stopCellMove = true\n        },\n      }\n      const results = this.fireListeners('keydown', evt)\n      if (array.findIndex(results, (v) => v === false) >= 0) {\n        return\n      }\n\n      if (!input.readOnly && lastInputValue && browser.Safari) {\n        // for Safari\n        this.fireListeners('input', lastInputValue)\n      }\n      if (!stopCellMove) this.fireKeyDownMove(keyCode, e)\n      if (\n        this._grid.keyboardOptions?.deleteCellValueOnDel &&\n        (keyCode === KEY_DEL || keyCode === KEY_BS)\n      ) {\n        this.fireListeners('delete', e)\n      }\n\n      inputClear()\n    })\n    handler.on(input, 'keyup', (e) => {\n      if (this._isComposition) {\n        if (this._compositionEnd) {\n          handleCompositionEnd()\n        }\n      }\n      inputClear()\n    })\n\n    handler.on(input, 'input', (e: InputEvent) => {\n      if (e.data === ' ' || e.data === '　') {\n        // Since the full-width space cannot be determined on \"keypress\", it is processed by \"input\".\n        this.fireListeners('input', e.data)\n      }\n      inputClear()\n    })\n    if (browser.IE) {\n      handler.on(document, 'keydown', (e) => {\n        if (e.target !== input) {\n          return\n        }\n        const keyCode = event.getKeyCode(e)\n        if (keyCode === KEY_ALPHA_C && e.ctrlKey) {\n          // When text is not selected copy-event is not emit, on IE.\n          _setSafeInputValue(input, 'dummy')\n          input.select()\n          setTimeout(() => {\n            _setSafeInputValue(input, '')\n          }, 100)\n        } else if (keyCode === KEY_ALPHA_V && e.ctrlKey) {\n          // When input is read-only paste-event is not emit, on IE.\n          if (input.readOnly) {\n            input.readOnly = false\n            setTimeout(() => {\n              input.readOnly = true\n              _setSafeInputValue(input, '')\n            }, 10)\n          }\n        }\n      })\n    }\n    if (browser.Edge) {\n      handler.once(document, 'keydown', (e: Event) => {\n        if (!isDescendantElement(parentElement, e.target as HTMLElement)) {\n          return\n        }\n        // When the input has focus on the first page opening,\n        // the paste-event and copy-event is not emit, on Edge.\n        const dummyInput = document.createElement('input')\n        grid.getElement().appendChild(dummyInput)\n        dummyInput.focus()\n        input.focus()\n        if (dummyInput.parentElement) {\n          dummyInput.parentElement.removeChild(dummyInput)\n        }\n      })\n    }\n    handler.on(document, 'paste', (e: Event) => {\n      if (this._isComposition) {\n        return\n      }\n      if (!isDescendantElement(parentElement, e.target as HTMLElement)) {\n        return\n      }\n      setTimeout(() => {\n        inputClear()\n      }, 100)\n      let pasteText\n      if (browser.IE) {\n        // IE\n        pasteText = (window as any).clipboardData.getData('Text')\n      } else {\n        const clipboardData = (e as ClipboardEvent).clipboardData\n        if (clipboardData) {\n          if (clipboardData.items) {\n            // Chrome & Firefox & Edge\n            pasteText = clipboardData.getData('text/plain')\n          } else {\n            // Safari\n            if (\n              -1 !==\n              Array.prototype.indexOf.call(clipboardData.types, 'text/plain')\n            ) {\n              pasteText = clipboardData.getData('Text')\n            }\n          }\n        }\n      }\n      if (isDef(pasteText) && pasteText.length) {\n        this.fireListeners('paste', { value: pasteText, event: e })\n      }\n    })\n    const copy = (data: any, e: ClipboardEvent) => {\n      if (isDef(data)) {\n        event.cancel(e)\n        if (browser.IE) {\n          const cData = (window as any).clipboardData\n          if (cData) {\n            cData.setData('Text', data) // IE\n          }\n        } else {\n          const cData = e.clipboardData\n          if (cData) {\n            cData.setData('text/plain', data) // Chrome, Firefox\n          }\n        }\n      }\n    }\n    handler.on(document, 'copy', (e: Event) => {\n      if (this._isComposition) {\n        return\n      }\n      if (!isDescendantElement(parentElement, e.target as HTMLElement)) {\n        return\n      }\n      _setSafeInputValue(input, '')\n      const data = array.find(this.fireListeners('copy', e), isDef)\n      copy(data, e as ClipboardEvent)\n    })\n    handler.on(document, 'cut', (e: Event) => {\n      if (this._isComposition) {\n        return\n      }\n      if (!isDescendantElement(parentElement, e.target as HTMLElement)) {\n        return\n      }\n      _setSafeInputValue(input, '')\n      const data = array.find(this.fireListeners('cut', e), isDef)\n      copy(data, e as ClipboardEvent)\n    })\n    handler.on(input, 'focus', (e) => {\n      this.fireListeners('focus', e)\n    })\n    handler.on(input, 'blur', (e) => {\n      this.fireListeners('blur', e)\n    })\n  }\n  public fireKeyDownMove(keyCode: number, e: KeyboardEvent): void {\n    const fn = this._keyDownMoveCallback\n    if (!fn) {\n      return\n    }\n    if (this._isComposition) {\n      return\n    }\n    if (\n      keyCode === KEY_LEFT ||\n      keyCode === KEY_UP ||\n      keyCode === KEY_RIGHT ||\n      keyCode === KEY_DOWN ||\n      keyCode === KEY_HOME ||\n      keyCode === KEY_END\n    ) {\n      fn(e)\n    } else if (\n      this._grid.keyboardOptions?.moveCellOnTab &&\n      keyCode === KEY_TAB\n    ) {\n      fn(e)\n    } else if (\n      this._grid.keyboardOptions?.moveCellOnEnter &&\n      keyCode === KEY_ENTER\n    ) {\n      fn(e)\n    } else if (\n      this._grid.keyboardOptions?.selectAllOnCtrlA &&\n      keyCode === KEY_ALPHA_A &&\n      (e.ctrlKey || e.metaKey)\n    ) {\n      fn(e)\n    }\n  }\n  public onKeyDownMove(fn: KeyboardEventListener): void {\n    this._keyDownMoveCallback = fn\n  }\n  public onKeyDown(fn: (e: KeydownEvent) => void): EventListenerId {\n    return this.listen('keydown', fn)\n  }\n  public onInput(fn: (value: string) => void): EventListenerId {\n    return this.listen('input', fn)\n  }\n  public onDelete(fn: (e: KeyboardEvent) => void): EventListenerId {\n    return this.listen('delete', fn)\n  }\n  public onCopy(fn: (e: ClipboardEvent) => void): EventListenerId {\n    return this.listen('copy', fn)\n  }\n  public onPaste(\n    fn: (e: { value: string; event: ClipboardEvent }) => void\n  ): EventListenerId {\n    return this.listen('paste', fn)\n  }\n  public onCut(fn: (e: ClipboardEvent) => void): EventListenerId {\n    return this.listen('cut', fn)\n  }\n  public onFocus(fn: (e: FocusEvent) => void): EventListenerId {\n    return this.listen('focus', fn)\n  }\n  public onBlur(fn: (e: FocusEvent) => void): EventListenerId {\n    return this.listen('blur', fn)\n  }\n  public focus() {\n    // this._input.value = \"\";\n    this._input.focus()\n  }\n  public setFocusRect(rect: Rect) {\n    const input = this._input\n    const top = this._scrollable.calcTop(rect.top)\n    // 位置：相对 但是，如果IE不是position：relative，则不能使用最大值\n    input.style.top = `${(top - style.getScrollBarSize()).toFixed()}px`\n    input.style.left = `${rect.left.toFixed()}px`\n    input.style.width = `${rect.width.toFixed()}px`\n    input.style.height = `${rect.height.toFixed()}px`\n  }\n  public get editMode() {\n    return !this._input.readOnly\n  }\n  public set editMode(editMode) {\n    this._input.readOnly = !editMode\n  }\n  public resetInputStatus() {\n    const el = this._input\n    if (!el.classList.contains('grid-focus-control--stored-status')) {\n      return\n    }\n    const composition = el.classList.contains('composition')\n\n    const attrs = el.attributes\n    const removeNames = []\n    for (let i = 0, n = attrs.length; i < n; i++) {\n      const att = attrs[i]\n      if (!this._inputStatus?.hasOwnProperty(att.nodeName)) {\n        removeNames.push(att.name)\n      }\n    }\n    removeNames.forEach((removeName) => {\n      el.removeAttribute(removeName)\n    })\n    for (const name in this._inputStatus) {\n      if (this._inputStatus.hasOwnProperty(name)) {\n        el.setAttribute(name, this._inputStatus[name])\n      }\n    }\n    if (composition) {\n      el.classList.add('composition')\n      el.style.font = this._grid.font || '16px sans-serif'\n    } else {\n      el.classList.remove('composition')\n    }\n    el.classList.remove('grid-focus-control--stored-status')\n  }\n  public storeInputStatus() {\n    const el = this._input\n    if (el.classList.contains('grid-focus-control--stored-status')) {\n      return\n    }\n    const inputStatus: FocusControl['_inputStatus'] = (this._inputStatus = {})\n    const atts = el.attributes\n    for (let i = 0, n = atts.length; i < n; i++) {\n      const att = atts[i]\n      inputStatus[att.name] = att.value\n    }\n    el.classList.add('grid-focus-control--stored-status')\n  }\n  public setDefaultInputStatus() {\n    // 有一种情况，滚动逐渐逐渐变化，所以不要在这里设置。\n    // this._input.style.font = this._grid.font || \"16px sans-serif\";\n  }\n  public get input() {\n    return this._input\n  }\n  public dispose() {\n    super.dispose()\n    this._handler.dispose()\n  }\n}\n","import { array } from '../../internal/utils'\nimport { DG_EVENT_TYPE } from './DG_EVENT_TYPE'\nimport { DrawGrid } from '../DrawGrid'\nimport { EventTarget } from '../EventTarget'\nimport {\n  BeforeSelectedCellEvent,\n  AfterSelectedCellEvent,\n  AnyFunction,\n  CellAddress,\n  CellRange,\n} from '../../ts-types'\n\n/**\n * Selected area management\n */\nexport class Selection extends EventTarget {\n  private _grid: DrawGrid\n  private _sel: CellAddress\n  private _focus: CellAddress\n  private _start: CellAddress\n  private _end: CellAddress\n  private _drag?: {\n    sel: CellAddress\n    focus: CellAddress\n    start: CellAddress\n    end: CellAddress\n  }\n  private _isWraped: boolean = false\n  private _updateRange: (range: CellRange) => CellRange\n  public constructor(\n    grid: DrawGrid,\n    updateRange: (range: CellRange) => CellRange\n  ) {\n    super()\n    this._grid = grid\n\n    this._sel = { col: 0, row: 0 }\n    this._focus = { col: 0, row: 0 }\n\n    this._start = { col: 0, row: 0 }\n    this._end = { col: 0, row: 0 }\n\n    this._updateRange = updateRange\n  }\n  public get range(): CellRange {\n    const start = this._start\n    const end = this._end\n    const startCol = Math.min(start.col, end.col)\n    const startRow = Math.min(start.row, end.row)\n    const endCol = Math.max(start.col, end.col)\n    const endRow = Math.max(start.row, end.row)\n    return {\n      end: {\n        col: endCol,\n        row: endRow,\n      },\n      start: {\n        col: startCol,\n        row: startRow,\n      },\n    }\n  }\n  public set range(range: CellRange) {\n    const startCol = Math.min(range.start.col, range.end.col)\n    const startRow = Math.min(range.start.row, range.end.row)\n    const endCol = Math.max(range.start.col, range.end.col)\n    const endRow = Math.max(range.start.row, range.end.row)\n\n    this._wrapFireSelectedEvent(() => {\n      this._setSelectCell(startCol, startRow)\n      this._setFocusCell(endCol, endRow, true)\n      this._grid._updatedSelection()\n    })\n  }\n  public get focus(): CellAddress {\n    const col = this._focus.col\n    const row = this._focus.row\n    return { col, row }\n  }\n  public get select(): CellAddress {\n    const col = this._sel.col\n    const row = this._sel.row\n    return { col, row }\n  }\n  public set select(cell: CellAddress) {\n    this._wrapFireSelectedEvent(() => {\n      const { col = 0, row = 0 } = cell || {}\n      this._setSelectCell(col, row)\n      this._setFocusCell(col, row, true)\n      this._grid._updatedSelection()\n    })\n  }\n  public get dragging() {\n    return !!this._drag\n  }\n  public get drag() {\n    const me = this\n    return {\n      get select() {\n        const sel = me._drag ? me._drag.sel : me._sel\n        return {\n          col: sel.col,\n          row: sel.row,\n        }\n      },\n      get range() {\n        const start = me._drag ? me._drag.start : me._start\n        const end = me._drag ? me._drag.end : me._end\n        const startCol = Math.min(start.col, end.col)\n        const startRow = Math.min(start.row, end.row)\n        const endCol = Math.max(start.col, end.col)\n        const endRow = Math.max(start.row, end.row)\n        return {\n          end: {\n            col: endCol,\n            row: endRow,\n          },\n          start: {\n            col: startCol,\n            row: startRow,\n          },\n        }\n      },\n      inRange(col: number, row: number) {\n        const startCol = this.range.start.col\n        const startRow = this.range.start.row\n        const endCol = this.range.end.col\n        const endRow = this.range.end.row\n        return (\n          startCol <= col && col <= endCol && startRow <= row && row <= endRow\n        )\n      },\n      inDrag(col: number, row: number) {\n        const inOldRange = this.inRange(col, row)\n        const inNewRange = me.inRange(col, row)\n        return (inOldRange && !inNewRange) || (!inOldRange && inNewRange)\n      },\n    }\n  }\n  public inRange(col: number, row: number) {\n    const startCol = Math.min(this._start.col, this._end.col)\n    const startRow = Math.min(this._start.row, this._end.row)\n    const endCol = Math.max(this._start.col, this._end.col)\n    const endRow = Math.max(this._start.row, this._end.row)\n    return startCol <= col && col <= endCol && startRow <= row && row <= endRow\n  }\n  public border(col: number, row: number) {\n    const range = this.range\n    const inRange =\n      range.start.col <= col &&\n      col <= range.end.col &&\n      range.start.row <= row &&\n      row <= range.end.row\n    return {\n      bottom: inRange ? range.end.row === row : false,\n      left: inRange ? range.start.col === col : false,\n      right: inRange ? range.end.col === col : false,\n      top: inRange ? range.start.row === row : false,\n    }\n  }\n  public fireSelectedEvent() {\n    this._wrapFireSelectedEvent(() => {\n      // nothing\n    })\n  }\n  public startDrag() {\n    this._drag = {\n      end: this._end,\n      focus: this._focus,\n      sel: this._sel,\n      start: this._start,\n    }\n  }\n  public stopDrag() {\n    if (this._drag) {\n      this.fireListeners(DG_EVENT_TYPE.SELECTED_CELL, {\n        after: {\n          col: this._sel.col,\n          row: this._sel.row,\n        },\n        col: this._drag.sel.col,\n        row: this._drag.sel.row,\n        selected: false,\n      })\n      this.fireListeners(DG_EVENT_TYPE.SELECTED_CELL, {\n        before: {\n          col: this._drag.sel.col,\n          row: this._drag.sel.row,\n        },\n        col: this._sel.col,\n        row: this._sel.row,\n        selected: true,\n      })\n      const oldStartCol = this.drag.range.start.col\n      const oldStartRow = this.drag.range.start.row\n      const oldEndCol = this.drag.range.end.col\n      const oldEndRow = this.drag.range.end.row\n      const newStartCol = this.range.start.col\n      const newStartRow = this.range.start.row\n      const newEndCol = this.range.end.col\n      const newEndRow = this.range.end.row\n      delete this._drag\n      this._grid.invalidateGridRect(\n        oldStartCol,\n        oldStartRow,\n        oldEndCol,\n        oldEndRow\n      )\n      this._grid.invalidateGridRect(\n        newStartCol,\n        newStartRow,\n        newEndCol,\n        newEndRow\n      )\n    }\n  }\n  public _updateGridRange() {\n    const { rowCount, colCount } = this._grid\n    const points = [this._sel, this._focus, this._start, this._end]\n    let needChange = false\n    for (const point of points) {\n      if (colCount <= point.col || rowCount <= point.row) {\n        needChange = true\n        break\n      }\n    }\n    if (!needChange || !rowCount || !colCount) {\n      // rowCount 或 colCount 为 0 时，暂不触发事件\n      return false\n    }\n    this._wrapFireSelectedEvent(() => {\n      points.forEach((p) => {\n        p.col = Math.min(colCount - 1, p.col)\n        p.row = Math.min(rowCount - 1, p.row)\n      })\n    })\n    return true\n  }\n  public _setFocusCell(col: number, row: number, keepSelect: boolean): void {\n    this._wrapFireSelectedEvent(() => {\n      if (!keepSelect || this._grid.singleSelection) {\n        this._setSelectCell(col, row)\n      } else {\n        this._setSelectCell(this._sel.col, this._sel.row)\n      }\n      this._focus = { col, row }\n      this._end = { col, row }\n    })\n  }\n  public _forceUpdateRange() {\n    const range = this._updateRange(this.range)\n    if (range) {\n      this._start = range.start\n      this._end = range.end\n    }\n  }\n  private _setSelectCell(col: number, row: number): void {\n    this._wrapFireSelectedEvent(() => {\n      this._sel = { col, row }\n      this._start = { col, row }\n    })\n  }\n  private _wrapFireSelectedEvent(callback: AnyFunction): void {\n    if (this._isWraped) {\n      callback()\n    } else {\n      this._isWraped = true\n      try {\n        const backup = {\n          end: {\n            col: this._end.col,\n            row: this._end.row,\n          },\n          focus: {\n            col: this._focus.col,\n            row: this._focus.row,\n          },\n          sel: {\n            col: this._sel.col,\n            row: this._sel.row,\n          },\n          start: {\n            col: this._start.col,\n            row: this._start.row,\n          },\n        }\n        const before: BeforeSelectedCellEvent = {\n          col: this._sel.col,\n          row: this._sel.row,\n          selected: false,\n        } as BeforeSelectedCellEvent\n        callback()\n        this._forceUpdateRange()\n        const after: AfterSelectedCellEvent = {\n          before: {\n            col: before.col,\n            row: before.row,\n          },\n          col: this._sel.col,\n          row: this._sel.row,\n          selected: true,\n        }\n        before.after = {\n          col: after.col,\n          row: after.row,\n        }\n        if (!this.dragging) {\n          const results = this.fireListeners(\n            DG_EVENT_TYPE.SELECTED_CELL,\n            before\n          )\n          if (array.findIndex(results, (v) => v === false) >= 0) {\n            this._end = backup.end\n            this._focus = backup.focus\n            this._sel = backup.sel\n            this._start = backup.start\n          } else {\n            this.fireListeners(DG_EVENT_TYPE.SELECTED_CELL, after)\n          }\n        }\n      } finally {\n        this._isWraped = false\n      }\n    }\n  }\n}\n","import { CellRange, CellAddress } from '../../ts-types'\nimport { event, array } from '../../internal/utils'\nimport { BaseMouseDownMover } from './BaseMouseDownMover'\nimport { DG_EVENT_TYPE } from './DG_EVENT_TYPE'\nimport { createCellRange } from './DrawCellContext'\n\n/**\n * managing selection size changing operation with mouse\n */\nexport class SelectionResizer extends BaseMouseDownMover {\n  private _oldRange: CellRange = createCellRange(-1, -1, -1, -1)\n  private _newRange: CellRange = createCellRange(-1, -1, -1, -1)\n  private _cell: CellAddress = { col: -1, row: -1 }\n  public start(e: MouseEvent | TouchEvent) {\n    const cellAndRange = this._getTargetCellAndRange(e)\n    if (!cellAndRange) {\n      return false\n    }\n    this._oldRange = this.grid.selection.range\n    this.grid.selection.startDrag()\n\n    this._bindMoveAndUp(e)\n\n    this._newRange = cellAndRange.range\n    this._cell = cellAndRange.cell\n\n    event.cancel(e)\n    this._vibrate(e)\n  }\n  public canStart() {\n    return array.find(\n      this.grid.fireListeners(\n        DG_EVENT_TYPE.CAN_DRAG_SELECTION,\n        this.grid.selection.range\n      ),\n      (v) => v === true\n    )\n  }\n  protected _moveInternal(e: Event) {\n    const cellAndRange = this._getTargetCellAndRange(e)\n    if (!cellAndRange || !this._oldRange) {\n      return false\n    }\n    const newRange = cellAndRange.range\n    const newCell = cellAndRange.cell\n\n    if (\n      newRange.start.col === this._newRange.start.col &&\n      newRange.start.row === this._newRange.start.row &&\n      newRange.end.col === this._newRange.end.col &&\n      newRange.end.row === this._newRange.end.row\n    ) {\n      return false\n    }\n\n    if (\n      array.find(\n        this.grid.fireListeners(DG_EVENT_TYPE.DRAG_SELECTION, {\n          dragDone: false,\n          newRange,\n          oldRange: this._oldRange,\n        }),\n        (v) => v === false\n      ) === false\n    ) {\n      return false\n    }\n\n    const oldCol = this._cell.col\n    const oldRow = this._cell.row\n    const newCol = newCell.col\n    const newRow = newCell.row\n    if (oldCol === newCol && oldRow === newRow) {\n      return false\n    }\n\n    const grid = this.grid\n    grid._moveFocusCell(newRange.start.col, newRange.start.row, false, true)\n    grid._moveFocusCell(newRange.end.col, newRange.end.row, true, true)\n\n    // make visible\n    const makeVisibleCol = (() => {\n      if (newCol < oldCol && 0 < newCol) {\n        // move left\n        return newCol - 1\n      } else if (oldCol < newCol && newCol + 1 < grid.colCount) {\n        // move right\n        return newCol + 1\n      }\n      return newCol\n    })()\n    const makeVisibleRow = (() => {\n      if (newRow < oldRow && 0 < newRow) {\n        // move up\n        return newRow - 1\n      } else if (oldRow < newRow && newRow + 1 < grid.rowCount) {\n        // move down\n        return newRow + 1\n      }\n      return newRow\n    })()\n    if (makeVisibleCol !== newCol || makeVisibleRow !== newRow) {\n      grid.makeVisibleCell(makeVisibleCol, makeVisibleRow)\n    }\n    this._newRange = newRange\n    this._cell = newCell\n    return true\n  }\n  protected _upInternal(e: Event) {\n    this.grid.fireListeners(DG_EVENT_TYPE.DRAG_SELECTION, {\n      dragDone: true,\n      newRange: this._newRange,\n      oldRange: this._oldRange,\n    })\n    this.grid.selection.stopDrag()\n  }\n  private _getTargetCellAndRange(e: Event) {\n    const grid = this.grid\n    const abstractPos = grid._getMouseAbstractPoint(e)\n    if (!abstractPos) {\n      return null\n    }\n    if (!this._oldRange) {\n      return null\n    }\n\n    // \\    A    /\n    //   ---t---\n    //   |\\   E|\n    // D l  X  r B\n    //   |F   \\|\n    //   ---b---\n    // /    C    \\\n\n    let startCol = this._oldRange.start.col\n    let startRow = this._oldRange.start.row\n    let endCol = this._oldRange.end.col\n    let endRow = this._oldRange.end.row\n    const x = abstractPos.x\n    const y = abstractPos.y\n    const cell = grid.getCellAt(x, y)\n    if (cell.col < 0 || cell.row < 0) {\n      return null\n    }\n    const startRect = grid.getCellRect(\n      this._oldRange.start.col,\n      this._oldRange.start.row\n    )\n    const endRect = grid.getCellRect(\n      this._oldRange.end.col,\n      this._oldRange.end.row\n    )\n    const top = startRect.top\n    const left = startRect.left\n    const right = endRect.right\n    const bottom = endRect.bottom\n    let x1 = left\n    let y1 = top\n    let x2 = right\n    let y2 = bottom\n    const ab = (y1 - y2) * x + (x2 - x1) * y + x1 * y2 - x2 * y1 <= 0 // A 或 B\n    x1 = right\n    y1 = top\n    x2 = left\n    y2 = bottom\n    const ad = (y1 - y2) * x + (x2 - x1) * y + x1 * y2 - x2 * y1 > 0 // A 或 D\n\n    if (\n      cell.row >= startRow &&\n      cell.row <= endRow &&\n      cell.col >= startCol &&\n      cell.col <= endCol\n    ) {\n      if (ab) {\n        // E\n        endRow = cell.row\n      } else {\n        // F\n        endCol = cell.col\n      }\n    } else {\n      if (ab && ad) {\n        // A\n        startRow = cell.row\n      } else if (ab && !ad) {\n        // B\n        endCol = cell.col\n      } else if (!ab && ad) {\n        // D\n        startCol = cell.col\n      } else {\n        // C\n        endRow = cell.row\n      }\n    }\n    const range: CellRange = createCellRange(startCol, startRow, endCol, endRow)\n\n    return {\n      cell,\n      range,\n    }\n  }\n}\n","import { PasteRangeBoxValues } from '../ts-types'\n\nexport function parsePasteRangeBoxValues(value: string): PasteRangeBoxValues {\n  const normalizeValue = value.replace(/\\r?\\n$/, '')\n  const lines = normalizeValue.split(/(?:\\r?\\n)|[\\u2028\\u2029]/g)\n  const values = lines.map((line) => line.split(/\\t/g))\n  const colCount = values.reduce((n, cells) => Math.max(n, cells.length), 0)\n  return {\n    colCount,\n    rowCount: values.length,\n    getCellValue(offsetCol: number, offsetRow: number): string {\n      return values[offsetRow]?.[offsetCol] || ''\n    },\n  }\n}\n","import {\n  BorderMode,\n  CellAddress,\n  CellRange,\n  DrawGridEventHandlersEventMap,\n  DrawGridEventHandlersReturnMap,\n  PasteCellEvent,\n  CellContext,\n  PasteRangeBoxValues,\n  DrawGridKeyboardOptions,\n  ScrollableAPI,\n  KeydownEvent,\n} from '../ts-types'\nimport {\n  KEY_DOWN,\n  KEY_END,\n  KEY_HOME,\n  KEY_LEFT,\n  KEY_RIGHT,\n  KEY_UP,\n  KEY_TAB,\n  KEY_ENTER,\n  KEY_ALPHA_A,\n} from '../core/draw-grid/KEY_CODE'\nimport { toPx } from '../internal/calc'\nimport { getFontSize } from '../internal/canvases'\nimport { EventHandler } from '../internal/EventHandler'\nimport hiDPI from '../internal/hiDPI'\nimport NumberMap from '../internal/NumberMap'\nimport Rect from '../internal/Rect'\nimport Scrollbar from '../internal/Scrollbar'\nimport Scrollable from '../internal/Scrollable'\nimport style from '../internal/style'\nimport { event, array, isDef, isPromise, browser } from '../internal/utils'\nimport { EventTarget } from './EventTarget'\n\nimport { CellSelector } from './draw-grid/CellSelector'\nimport { ColumnResizer } from './draw-grid/ColumnResizer'\nimport { DrawCellContext } from './draw-grid/DrawCellContext'\nimport { DrawLayers } from './draw-grid/DrawLayers'\nimport { FocusControl } from './draw-grid/FocusControl'\nimport { Selection } from './draw-grid/Selection'\nimport { SelectionResizer } from './draw-grid/SelectionResizer'\nimport { parsePasteRangeBoxValues } from '../internal/paste-utils'\nimport { DG_EVENT_TYPE } from './draw-grid/DG_EVENT_TYPE'\nimport { getDrawGridSymbol } from '../internal/symbolManager'\n\nconst _ = getDrawGridSymbol()\n\nfunction _getTargetRowAt(\n  this: DrawGrid,\n  absoluteY: number\n): { row: number; top: number } | null {\n  const internal = this.getTargetRowAtInternal(absoluteY)\n  if (isDef(internal)) {\n    return internal\n  }\n  const findBefore = (\n    startRow: number,\n    startBottom: number\n  ): {\n    top: number\n    row: number\n  } | null => {\n    let bottom = startBottom\n    for (let row = startRow; row >= 0; row--) {\n      const height = _getRowHeight.call(this, row)\n      const top = bottom - height\n      if (top <= absoluteY && absoluteY < bottom) {\n        return {\n          row,\n          top,\n        }\n      }\n      bottom = top\n    }\n    return null\n  }\n  const findAfter = (\n    startRow: number,\n    startBottom: number\n  ): {\n    top: number\n    row: number\n  } | null => {\n    let top = startBottom - _getRowHeight.call(this, startRow)\n    const { rowCount } = this[_]\n    for (let row = startRow; row < rowCount; row++) {\n      const height = _getRowHeight.call(this, row)\n      const bottom = top + height\n      if (top <= absoluteY && absoluteY < bottom) {\n        return {\n          row,\n          top,\n        }\n      }\n      top = bottom\n    }\n    return null\n  }\n  const candRow = Math.min(\n    Math.ceil(absoluteY / this.defaultRowHeight),\n    this.rowCount - 1\n  )\n  const candBottom = _getRowsHeight.call(this, 0, candRow)\n  if (absoluteY >= candBottom) {\n    return findAfter(candRow, candBottom)\n  } else {\n    return findBefore(candRow, candBottom)\n  }\n}\nfunction _getTargetColAt(\n  this: DrawGrid,\n  absoluteX: number\n): {\n  left: number\n  col: number\n} | null {\n  let left = 0\n  const { colCount } = this[_]\n  for (let col = 0; col < colCount; col++) {\n    const width = _getColWidth.call(this, col)\n    const right = left + width\n    if (right > absoluteX) {\n      return {\n        col,\n        left,\n      }\n    }\n    left = right\n  }\n  return null\n}\nfunction _getTargetFrozenRowAt(\n  this: DrawGrid,\n  absoluteY: number\n): {\n  top: number\n  row: number\n} | null {\n  if (!this[_].frozenRowCount) {\n    return null\n  }\n  let top = this[_].scroll.top\n  const rowCount = this[_].frozenRowCount\n  for (let row = 0; row < rowCount; row++) {\n    const height = _getRowHeight.call(this, row)\n    const bottom = top + height\n    if (bottom > absoluteY) {\n      return {\n        row,\n        top,\n      }\n    }\n    top = bottom\n  }\n  return null\n}\nfunction _getTargetFrozenColAt(\n  this: DrawGrid,\n  absoluteX: number\n): {\n  left: number\n  col: number\n} | null {\n  if (!this[_].frozenColCount) {\n    return null\n  }\n  let left = this[_].scroll.left\n  const colCount = this[_].frozenColCount\n  for (let col = 0; col < colCount; col++) {\n    const width = _getColWidth.call(this, col)\n    const right = left + width\n    if (right > absoluteX) {\n      return {\n        col,\n        left,\n      }\n    }\n    left = right\n  }\n  return null\n}\nfunction _getFrozenRowsRect(this: DrawGrid): Rect | null {\n  if (!this[_].frozenRowCount) {\n    return null\n  }\n  const top = this[_].scroll.top\n  let height = 0\n  const rowCount = this[_].frozenRowCount\n  for (let row = 0; row < rowCount; row++) {\n    height += _getRowHeight.call(this, row)\n  }\n  return new Rect(this[_].scroll.left, top, this[_].canvas.width, height)\n}\nfunction _getFrozenColsRect(this: DrawGrid): Rect | null {\n  if (!this[_].frozenColCount) {\n    return null\n  }\n  const left = this[_].scroll.left\n  let width = 0\n  const colCount = this[_].frozenColCount\n  for (let col = 0; col < colCount; col++) {\n    width += _getColWidth.call(this, col)\n  }\n  return new Rect(left, this[_].scroll.top, width, this[_].canvas.height)\n}\nfunction _getCellDrawing(\n  this: DrawGrid,\n  col: number,\n  row: number\n): DrawCellContext | null {\n  if (!this[_].drawCells[row]) {\n    return null\n  }\n  return this[_].drawCells[row][col]\n}\nfunction _putCellDrawing(\n  this: DrawGrid,\n  col: number,\n  row: number,\n  context: DrawCellContext\n): void {\n  if (!this[_].drawCells[row]) {\n    this[_].drawCells[row] = {}\n  }\n  this[_].drawCells[row][col] = context\n}\nfunction _removeCellDrawing(this: DrawGrid, col: number, row: number): void {\n  if (!this[_].drawCells[row]) {\n    return\n  }\n  delete this[_].drawCells[row][col]\n  if (Object.keys(this[_].drawCells[row]).length === 0) {\n    delete this[_].drawCells[row]\n  }\n}\nfunction _drawCell(\n  this: DrawGrid,\n  ctx: CanvasRenderingContext2D,\n  col: number,\n  absoluteLeft: number,\n  width: number,\n  row: number,\n  absoluteTop: number,\n  height: number,\n  visibleRect: Rect,\n  skipAbsoluteTop: number,\n  skipAbsoluteLeft: number,\n  drawLayers: DrawLayers\n): void {\n  const rect = new Rect(\n    absoluteLeft - visibleRect.left,\n    absoluteTop - visibleRect.top,\n    width,\n    height\n  )\n\n  const drawRect = Rect.bounds(\n    Math.max(absoluteLeft, skipAbsoluteLeft) - visibleRect.left,\n    Math.max(absoluteTop, skipAbsoluteTop) - visibleRect.top,\n    rect.right,\n    rect.bottom\n  )\n\n  if (drawRect.height > 0 && drawRect.width > 0) {\n    ctx.save()\n    try {\n      const cellDrawing = _getCellDrawing.call(this, col, row)\n      if (cellDrawing) {\n        cellDrawing.cancel()\n      }\n      const dcContext = new DrawCellContext(\n        col,\n        row,\n        ctx,\n        rect,\n        drawRect,\n        !!cellDrawing,\n        this[_].selection,\n        drawLayers\n      )\n      const p = this.onDrawCell(col, row, dcContext)\n      if (isPromise(p)) {\n        // 延迟绘图\n        _putCellDrawing.call(this, col, row, dcContext)\n\n        const pCol = col\n        dcContext._delayMode(this, () => {\n          _removeCellDrawing.call(this, pCol, row)\n        })\n        ;(p as any).then(() => {\n          dcContext.terminate()\n        })\n      }\n    } finally {\n      ctx.restore()\n    }\n  }\n}\nfunction _drawRow(\n  this: DrawGrid,\n  ctx: CanvasRenderingContext2D,\n  initFrozenCol: { col: number; left: number } | null,\n  initCol: { col: number; left: number } | null,\n  drawRight: number,\n  row: number,\n  absoluteTop: number,\n  height: number,\n  visibleRect: Rect,\n  skipAbsoluteTop: number,\n  drawLayers: DrawLayers\n): void {\n  const colCount = this[_].colCount\n  const drawOuter = (col: number, absoluteLeft: number) => {\n    // 在数据范围之外绘制\n    if (\n      col >= colCount - 1 &&\n      this[_].canvas.width > absoluteLeft - visibleRect.left\n    ) {\n      const outerLeft = absoluteLeft - visibleRect.left\n      if (this.underlayBackgroundColor === 'transparent') {\n        ctx.clearRect(\n          outerLeft,\n          absoluteTop - visibleRect.top,\n          this[_].canvas.width - outerLeft,\n          height\n        )\n      } else {\n        ctx.save()\n        ctx.beginPath()\n        ctx.fillStyle = this.underlayBackgroundColor || '#F6F6F6'\n        ctx.rect(\n          outerLeft,\n          absoluteTop - visibleRect.top,\n          this[_].canvas.width - outerLeft,\n          height\n        )\n        ctx.fill()\n        ctx.restore()\n      }\n    }\n  }\n\n  let skipAbsoluteLeft = 0\n  if (initFrozenCol) {\n    let absoluteLeft = initFrozenCol.left\n    const count = this[_].frozenColCount\n    for (let col = initFrozenCol.col; col < count; col++) {\n      const width = _getColWidth.call(this, col)\n\n      _drawCell.call(\n        this,\n        ctx,\n        col,\n        absoluteLeft,\n        width,\n        row,\n        absoluteTop,\n        height,\n        visibleRect,\n        skipAbsoluteTop,\n        0,\n        drawLayers\n      )\n\n      absoluteLeft += width\n      if (drawRight <= absoluteLeft) {\n        // 在绘图范围之外（结束）\n        drawOuter(col, absoluteLeft)\n        return\n      }\n    }\n    skipAbsoluteLeft = absoluteLeft\n  }\n\n  if (initCol) {\n    let colAbsoluteLeft = initCol.left\n    for (let col = initCol.col; col < colCount; col++) {\n      const width = _getColWidth.call(this, col)\n      _drawCell.call(\n        this,\n        ctx,\n        col,\n        colAbsoluteLeft,\n        width,\n        row,\n        absoluteTop,\n        height,\n        visibleRect,\n        skipAbsoluteTop,\n        skipAbsoluteLeft,\n        drawLayers\n      )\n\n      colAbsoluteLeft += width\n      if (drawRight <= colAbsoluteLeft) {\n        // 在绘图范围之外（结束）\n        drawOuter(col, colAbsoluteLeft)\n        return\n      }\n    }\n    drawOuter(colCount - 1, colAbsoluteLeft)\n  }\n}\nlet _isPreciseColWidth = false\nfunction _toPxWidth(grid: DrawGrid, width: number | string) {\n  // 解决100%出现滚动条问题，此办法会导致右侧有空白，空白部分由_initColWidthsOffset负责填充\n  // return Math.round(toPx(width, grid[_].calcWidthContext));\n  const w = toPx(width, grid[_].calcWidthContext)\n  return _isPreciseColWidth ? w : Math.floor(w)\n}\nfunction _getColPreciseWidth(grid: DrawGrid, col: number) {\n  try {\n    _isPreciseColWidth = true\n    return grid.getColWidth(col)\n  } finally {\n    _isPreciseColWidth = false\n  }\n}\nfunction _initColWidthsOffset(grid: DrawGrid) {\n  const colWidthsOffset: {\n    [col: number]: number\n  } = {}\n  let total = 0\n  for (let col = 0; col < grid.colCount; col++) {\n    const w1 = grid.getColWidth(col)\n    const w2 = _getColPreciseWidth(grid, col)\n    if (w1 !== w2) {\n      total += w2 - w1\n      colWidthsOffset[col] = 0\n    }\n  }\n  total = Math.round(total)\n  if (total > 0) {\n    for (const col in colWidthsOffset) {\n      if (colWidthsOffset.hasOwnProperty(col)) {\n        colWidthsOffset[col] += 1\n        total--\n        if (!total) {\n          break\n        }\n      }\n    }\n  }\n\n  grid[_].colWidthsOffset = colWidthsOffset\n}\nfunction _adjustColWidth(\n  this: DrawGrid,\n  col: number,\n  orgWidth: number\n): number {\n  return this._adjustColWidth(col, orgWidth)\n}\nfunction _applyColWidthLimits(\n  limits: {\n    min?: number\n    max?: number\n  } | null,\n  orgWidth: number\n): number {\n  if (!limits) {\n    return orgWidth\n  }\n\n  if (limits.min) {\n    if (limits.min > orgWidth) {\n      return limits.min\n    }\n  }\n  if (limits.max) {\n    if (limits.max < orgWidth) {\n      return limits.max\n    }\n  }\n  return orgWidth\n}\n/**\n * Gets the definition of the column width.\n * @param col - number of column\n * @returns width definition\n */\nfunction _getColWidthDefine(this: DrawGrid, col: number): string | number {\n  const width = this[_].colWidthsMap.get(col)\n  if (width) {\n    return width\n  }\n  return this.defaultColWidth\n}\n/**\n * Gets the column width limits.\n * @param col - number of column\n * @returns the column width limits\n */\nfunction _getColWidthLimits(\n  this: DrawGrid,\n  col: number\n): {\n  min?: number\n  max?: number\n  minDef?: string | number\n  maxDef?: string | number\n} | null {\n  const limit = this[_].colWidthsLimit[col]\n  if (!limit) {\n    return null\n  }\n\n  const result: {\n    min?: number\n    max?: number\n    minDef?: string | number\n    maxDef?: string | number\n  } = {}\n\n  if (limit.min) {\n    result.min = _toPxWidth(this, limit.min)\n    result.minDef = limit.min\n  }\n  if (limit.max) {\n    result.max = _toPxWidth(this, limit.max)\n    result.maxDef = limit.max\n  }\n  return result\n}\n/**\n * Checks if the given width definition is `auto`.\n * @param width - width definition to check\n * @returns `true ` if the given width definition is `auto`\n */\nfunction isAutoDefine(width: string | number): width is 'auto' {\n  return !!(\n    width &&\n    typeof width === 'string' &&\n    width.toLowerCase() === 'auto'\n  )\n}\n/**\n * Creates a formula to calculate the auto width.\n * @returns formula\n */\nfunction _calcAutoColWidthExpr(this: DrawGrid): string {\n  const others = []\n  let autoCount = 0\n  const hasLimitsOnAuto = []\n  for (let col = 0; col < this[_].colCount; col++) {\n    const def = _getColWidthDefine.call(this, col)\n    const limits = _getColWidthLimits.call(this, col)\n    if (isAutoDefine(def)) {\n      if (limits) {\n        hasLimitsOnAuto.push(limits)\n      }\n      autoCount++\n    } else {\n      let expr = typeof def === 'number' ? `${def}px` : def\n      if (limits) {\n        const orgWidth = _toPxWidth(this, expr)\n        const newWidth = _applyColWidthLimits(limits, orgWidth)\n        if (orgWidth !== newWidth) {\n          expr = `${newWidth}px`\n        }\n      }\n      others.push(expr)\n    }\n  }\n  if (hasLimitsOnAuto.length && others.length) {\n    const autoPx =\n      _toPxWidth(this, `calc(100% - (${others.join(' + ')}))`) / autoCount\n    for (let index = 0; index < hasLimitsOnAuto.length; index++) {\n      const limits = hasLimitsOnAuto[index]\n      if (limits.min && autoPx < limits.min) {\n        others.push(\n          typeof limits.minDef === 'number'\n            ? `${limits.minDef}px`\n            : limits.minDef\n        )\n        autoCount--\n      } else if (limits.max && limits.max < autoPx) {\n        others.push(\n          typeof limits.maxDef === 'number'\n            ? `${limits.maxDef}px`\n            : limits.maxDef\n        )\n        autoCount--\n      }\n    }\n    if (autoCount <= 0) {\n      return `${autoPx}px`\n    }\n  }\n  if (others.length) {\n    return `calc((100% - (${others.join(' + ')})) / ${autoCount})`\n  } else {\n    return `${100 / autoCount}%`\n  }\n}\n/**\n * Calculate the pixels of width from the definition of width.\n * @param width - width definition\n * @returns the pixels of width\n */\nfunction _colWidthDefineToPxWidth(\n  this: DrawGrid,\n  width: string | number\n): number {\n  if (isAutoDefine(width)) {\n    return _toPxWidth(this, _calcAutoColWidthExpr.call(this))\n  }\n  return _toPxWidth(this, width)\n}\nfunction _getColWidth(this: DrawGrid, col: number): number {\n  const width = _getColWidthDefine.call(this, col)\n  return _adjustColWidth.call(\n    this,\n    col,\n    _colWidthDefineToPxWidth.call(this, width)\n  )\n}\nfunction _setColWidth(\n  this: DrawGrid,\n  col: number,\n  width: string | number\n): void {\n  this[_].colWidthsMap.put(col, width)\n}\n\nfunction _getRowHeight(this: DrawGrid, row: number): number {\n  const internal = this.getRowHeightInternal(row)\n  if (typeof internal === 'number') {\n    return Number(internal)\n  }\n  const height = this[_].rowHeightsMap.get(row)\n  if (height) {\n    return height\n  }\n  return this.defaultRowHeight\n}\nfunction _getRowsHeight(\n  this: DrawGrid,\n  startRow: number,\n  endRow: number\n): number {\n  const internal = this.getRowsHeightInternal(startRow, endRow)\n  if (typeof internal === 'number') {\n    return Number(internal)\n  }\n  const rowCount = endRow - startRow + 1\n  let h = this.defaultRowHeight * rowCount\n  this[_].rowHeightsMap.each(startRow, endRow, (height: number): void => {\n    h += height - this.defaultRowHeight\n  })\n  return h\n}\nfunction _setRowHeight(this: DrawGrid, row: number, height: number): void {\n  this[_].rowHeightsMap.put(row, height)\n}\nfunction _getUnderlayWidth(this: DrawGrid) {\n  let bodyWidth = this.getElement().clientWidth\n  for (let col = 0; col < this.frozenColCount; col++) {\n    bodyWidth -= this.getColWidth(col)\n  }\n  if (bodyWidth < 0) {\n    bodyWidth = 0\n  }\n  let w = 0\n  if (this.underlayColCount >= 0) {\n    if (this.underlayColWidth === 'auto') {\n      w = this.underlayColCount * _toPxWidth(this, this.defaultColWidth)\n    } else {\n      w = this.underlayColCount * this.underlayColWidth\n    }\n  } else {\n    w = bodyWidth\n    if (this.underlayColWidth === 'auto') {\n      const startCol = Math.max(\n        this.colCount + this.underlayColCount,\n        this.frozenColCount,\n        0\n      )\n      for (let col = startCol; col < this.colCount; col++) {\n        w -= this.getColWidth(col)\n      }\n    } else {\n      w += this.underlayColCount * this.underlayColWidth\n    }\n  }\n  if (w < 0) {\n    w = 0\n  } else if (w > bodyWidth) {\n    w = bodyWidth\n  }\n  return w\n}\nfunction _getScrollWidth(this: DrawGrid) {\n  const w = this._getColsWidth(0, this[_].colCount - 1)\n  const underlayWidth = _getUnderlayWidth.call(this)\n  return w + underlayWidth\n}\nfunction _getUnderlayHeight(this: DrawGrid) {\n  let bodyHeight = this.getElement().clientHeight\n  for (let row = 0; row < this.frozenRowCount; row++) {\n    bodyHeight -= this.getRowHeight(row)\n  }\n  if (bodyHeight < 0) {\n    bodyHeight = 0\n  }\n  let h = 0\n  if (this.underlayRowCount >= 0) {\n    if (this.underlayRowHeight === 'auto') {\n      h = this.underlayRowCount * this.defaultRowHeight\n    } else {\n      h = this.underlayRowCount * this.underlayRowHeight\n    }\n  } else {\n    h = bodyHeight\n    if (this.underlayRowHeight === 'auto') {\n      const startRow = Math.max(\n        this.rowCount + this.underlayRowCount,\n        this.frozenRowCount,\n        0\n      )\n      for (let row = startRow; row < this.rowCount; row++) {\n        h -= this.getRowHeight(row)\n      }\n    } else {\n      h += this.underlayRowCount * this.underlayRowHeight\n    }\n  }\n  if (h < 0) {\n    h = 0\n  } else if (h > bodyHeight) {\n    h = bodyHeight\n  }\n  return h\n}\nfunction _getScrollHeight(this: DrawGrid) {\n  const internal = this.getScrollHeightInternal(this[_].rowCount)\n  if (typeof internal === 'number') {\n    return Number(internal)\n  }\n  let h = this.defaultRowHeight * this[_].rowCount\n  this[_].rowHeightsMap.each(0, this[_].rowCount - 1, (height: number) => {\n    h += height - this.defaultRowHeight\n  })\n  const underlayHeight = _getUnderlayHeight.call(this)\n  return h + underlayHeight\n}\nfunction _onScroll(this: DrawGrid, _e: Event): void {\n  const lastLeft = this[_].scroll.left\n  const lastTop = this[_].scroll.top\n  const moveX = this[_].scrollable.scrollLeft - lastLeft\n  const moveY = this[_].scrollable.scrollTop - lastTop\n\n  // 保留下一个计算信息\n  this[_].scroll = {\n    left: this[_].scrollable.scrollLeft,\n    top: this[_].scrollable.scrollTop,\n  }\n  const visibleRect = this._getVisibleRect()\n  if (\n    Math.abs(moveX) >= visibleRect.width ||\n    Math.abs(moveY) >= visibleRect.height\n  ) {\n    // 完全重绘\n    this._invalidateRect(visibleRect)\n  } else {\n    // 不同的重绘\n    const context = this[_].context\n    if (context) {\n      context.drawImage(this[_].canvas, -moveX, -moveY)\n    }\n\n    if (moveX !== 0) {\n      // 计算水平移动的重绘范围\n      const redrawRect = visibleRect.copy()\n      if (moveX < 0) {\n        redrawRect.width = -moveX\n        if (this[_].frozenColCount > 0) {\n          // 当有固定列时绘制固定数量的列\n          const frozenRect = _getFrozenColsRect.call(this)\n          if (frozenRect) {\n            redrawRect.width += frozenRect.width\n          }\n        }\n      } else if (moveX > 0) {\n        redrawRect.left = redrawRect.right - moveX\n      }\n\n      // 重绘\n      this._invalidateRect(redrawRect)\n\n      if (moveX > 0) {\n        if (this[_].frozenColCount > 0) {\n          // 当有固定列固定列图时\n          const frozenRect = _getFrozenColsRect.call(this)\n          if (frozenRect) {\n            this._invalidateRect(frozenRect)\n          }\n        }\n      }\n    }\n    if (moveY !== 0) {\n      // 计算纵向移动的重绘范围\n      const redrawRect = visibleRect.copy()\n      if (moveY < 0) {\n        redrawRect.height = -moveY\n        if (this[_].frozenRowCount > 0) {\n          // 有固定线时固定线图\n          const frozenRect = _getFrozenRowsRect.call(this)\n          if (frozenRect) {\n            redrawRect.height += frozenRect.height\n          }\n        }\n      } else if (moveY > 0) {\n        redrawRect.top = redrawRect.bottom - moveY\n      }\n\n      // 重绘\n      this._invalidateRect(redrawRect)\n\n      if (moveY > 0) {\n        if (this[_].frozenRowCount > 0) {\n          // 有固定线时固定线图\n          const frozenRect = _getFrozenRowsRect.call(this)\n          if (frozenRect) {\n            this._invalidateRect(frozenRect)\n          }\n        }\n      }\n    }\n  }\n}\nfunction _onTabKeyDown(this: DrawGrid, shiftKey: boolean): void {\n  const grid = this\n  const focusCell = grid.selection.focus\n  const col = shiftKey\n    ? grid.getMoveLeftColByKeyDownInternal(focusCell)\n    : grid.getMoveRightColByKeyDownInternal(focusCell)\n  if (0 <= col && col < grid.colCount) {\n    grid._moveFocusCell(col, focusCell.row, false)\n  } else if (0 > col) {\n    grid._moveFocusCell(grid.colCount - 1, focusCell.row, false)\n  } else {\n    grid._moveFocusCell(0, focusCell.row, false)\n  }\n}\nfunction _onEnterKeyDown(this: DrawGrid, shiftKey: boolean): void {\n  const grid = this\n  const focusCell = grid.selection.focus\n  const row = shiftKey\n    ? grid.getMoveUpRowByKeyDownInternal(focusCell)\n    : grid.getMoveDownRowByKeyDownInternal(focusCell)\n  if (0 <= row && row < grid.rowCount) {\n    grid._moveFocusCell(focusCell.col, row, false)\n    // } else if (0 > row) {\n    //   grid._moveFocusCell(focusCell.col, grid.rowCount - 1, false)\n    // } else {\n    //   grid._moveFocusCell(focusCell.col, 0, false)\n  }\n}\nfunction _onKeyDownMove(this: DrawGrid, e: KeyboardEvent): void {\n  const { shiftKey, ctrlKey, metaKey, altKey } = e\n  const keyCode = event.getKeyCode(e)\n  if (altKey) {\n    return\n  }\n  const focusCell = shiftKey ? this.selection.focus : this.selection.select\n  if (keyCode === KEY_LEFT) {\n    if (ctrlKey || metaKey) {\n      move(this, null, 'W')\n    } else {\n      if (!hmove.call(this, 'W')) {\n        return\n      }\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_UP) {\n    if (e.ctrlKey || e.metaKey) {\n      move(this, 'N', null)\n    } else {\n      if (!vmove.call(this, 'N')) {\n        return\n      }\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_RIGHT) {\n    if (e.ctrlKey || e.metaKey) {\n      move(this, null, 'E')\n    } else {\n      if (!hmove.call(this, 'E')) {\n        return\n      }\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_DOWN) {\n    if (e.ctrlKey || e.metaKey) {\n      move(this, 'S', null)\n    } else {\n      if (!vmove.call(this, 'S')) {\n        return\n      }\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_HOME) {\n    if (e.ctrlKey || e.metaKey) {\n      move(this, 'N', 'W')\n    } else {\n      move(this, null, 'W')\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_END) {\n    if (e.ctrlKey || e.metaKey) {\n      move(this, 'S', 'E')\n    } else {\n      move(this, null, 'E')\n    }\n    event.cancel(e)\n  } else if (keyCode === KEY_TAB && this.keyboardOptions?.moveCellOnTab) {\n    _onTabKeyDown.call(this, shiftKey)\n    event.cancel(e)\n  } else if (keyCode === KEY_ENTER && this.keyboardOptions?.moveCellOnEnter) {\n    _onEnterKeyDown.call(this, shiftKey)\n    event.cancel(e)\n  } else if (\n    keyCode === KEY_ALPHA_A &&\n    this.keyboardOptions?.selectAllOnCtrlA &&\n    (ctrlKey || metaKey)\n  ) {\n    let startCol = 0\n    let startRow = 0\n    if (shiftKey) {\n      if (\n        this.keyboardOptions?.selectAllOptions?.shiftCtrlA?.excludeFrozenCol\n      ) {\n        startCol = this.frozenRowCount\n      }\n      if (\n        this.keyboardOptions?.selectAllOptions?.shiftCtrlA?.excludeFrozenRow\n      ) {\n        startRow = this.frozenRowCount\n      }\n    } else {\n      if (this.keyboardOptions?.selectAllOptions?.ctrlA?.excludeFrozenCol) {\n        startCol = this.frozenRowCount\n      }\n      if (this.keyboardOptions?.selectAllOptions?.ctrlA?.excludeFrozenRow) {\n        startRow = this.frozenRowCount\n      }\n    }\n    this.selection.range = {\n      start: { col: startCol, row: startRow },\n      end: { col: this.colCount - 1, row: this.rowCount - 1 },\n    }\n    this.invalidate()\n    event.cancel(e)\n  }\n\n  function move(\n    grid: DrawGrid,\n    vDir: 'N' | 'S' | null,\n    hDir: 'W' | 'E' | null\n  ): void {\n    const row =\n      vDir === 'S' ? grid.rowCount - 1 : vDir === 'N' ? 0 : focusCell.row\n    const col =\n      hDir === 'E' ? grid.colCount - 1 : hDir === 'W' ? 0 : focusCell.col\n    grid._moveFocusCell(col, row, shiftKey)\n  }\n\n  function vmove(this: DrawGrid, vDir: 'N' | 'S'): boolean {\n    let row: number\n    if (vDir === 'S') {\n      row = this.getMoveDownRowByKeyDownInternal(focusCell)\n      if (this.rowCount <= row) {\n        return false\n      }\n    } else {\n      row = this.getMoveUpRowByKeyDownInternal(focusCell)\n      if (row < 0) {\n        return false\n      }\n    }\n    const { col } = focusCell\n    this._moveFocusCell(col, row, shiftKey)\n    return true\n  }\n\n  function hmove(\n    this: DrawGrid,\n    hDir: 'W' | 'E',\n    shiftKeyFlg: boolean = shiftKey\n  ): boolean {\n    let col: number\n    if (hDir === 'E') {\n      col = this.getMoveRightColByKeyDownInternal(focusCell)\n      if (this.colCount <= col) {\n        return false\n      }\n    } else {\n      col = this.getMoveLeftColByKeyDownInternal(focusCell)\n      if (col < 0) {\n        return false\n      }\n    }\n    const { row } = focusCell\n    this._moveFocusCell(col, row, shiftKeyFlg)\n    return true\n  }\n}\nfunction _bindEvents(this: DrawGrid): void {\n  const { handler, element, scrollable } = this[_]\n  const getCellEventArgsSet = <EVT extends TouchEvent | MouseEvent>(\n    e: EVT\n  ): {\n    abstractPos?: { x: number; y: number }\n    cell?: CellAddress\n    eventArgs?: CellAddress & { event: EVT }\n  } => {\n    const abstractPos = this._getMouseAbstractPoint(e)\n    if (!abstractPos) {\n      return {}\n    }\n    const cell = this.getCellAt(abstractPos.x, abstractPos.y)\n    if (cell.col < 0 || cell.row < 0) {\n      return {\n        abstractPos,\n        cell,\n      }\n    }\n    const eventArgs = {\n      col: cell.col,\n      event: e,\n      row: cell.row,\n    }\n    return {\n      abstractPos,\n      cell,\n      eventArgs,\n    }\n  }\n  const canResizeColumn = (col: number): boolean => {\n    const limit = this[_].colWidthsLimit[col]\n    let canResize = this.disableColumnResize !== true\n    if (limit && canResize) {\n      canResize = limit.disableResize !== true\n      if (canResize && limit.min && limit.max) {\n        canResize = limit.max !== limit.min\n      }\n    }\n    return canResize\n    // if (!limit || !limit.min || !limit.max) {\n    //     return true;\n    // }\n    // return limit.max !== limit.min;\n  }\n  handler.on(element, 'mousedown', (e: Event) => {\n    const eventArgsSet = getCellEventArgsSet(e as MouseEvent)\n    const abstractPos = eventArgsSet.abstractPos\n    const eventArgs = eventArgsSet.eventArgs\n    if (!abstractPos) {\n      return\n    }\n    if (eventArgs) {\n      const results = this.fireListeners(\n        DG_EVENT_TYPE.MOUSEDOWN_CELL,\n        eventArgs\n      )\n      if (array.findIndex(results, (v) => !v) >= 0) {\n        return\n      }\n    }\n    if (event.getMouseButtons(e as MouseEvent) !== 1) {\n      return\n    }\n    if (_getResizeSelectionAt.call(this, abstractPos.x, abstractPos.y)) {\n      this[_].selectionResizer.start(e as MouseEvent)\n    } else {\n      const resizeCol = _getResizeColAt.call(this, abstractPos.x, abstractPos.y)\n      if (resizeCol >= 0 && canResizeColumn(resizeCol)) {\n        // 改变宽度\n        this[_].columnResizer.start(resizeCol, e)\n      } else {\n        // 选择\n        this[_].cellSelector.start(e as MouseEvent)\n      }\n    }\n  })\n  handler.on(element, 'mouseup', (e: Event) => {\n    if (!this.hasListeners(DG_EVENT_TYPE.MOUSEUP_CELL)) {\n      return\n    }\n    const eventArgs = getCellEventArgsSet(e as MouseEvent).eventArgs\n    if (eventArgs) {\n      this.fireListeners(DG_EVENT_TYPE.MOUSEUP_CELL, eventArgs)\n    }\n  })\n  let doubleTapBefore: CellAddress | null | undefined = null\n  let longTouchId: NodeJS.Timer | null = null\n  handler.on(element, 'touchstart', (e: Event) => {\n    if (!doubleTapBefore) {\n      doubleTapBefore = getCellEventArgsSet(e as TouchEvent).eventArgs\n      setTimeout(() => {\n        doubleTapBefore = null\n      }, 350)\n    } else {\n      const eventArgs = getCellEventArgsSet(e as TouchEvent).eventArgs\n      if (\n        eventArgs &&\n        eventArgs.col === doubleTapBefore.col &&\n        eventArgs.row === doubleTapBefore.row\n      ) {\n        this.fireListeners(DG_EVENT_TYPE.DBLTAP_CELL, eventArgs)\n      } else if (!eventArgs) {\n        this.fireListeners(DG_EVENT_TYPE.DBLTAP_UNDERLAY)\n      }\n\n      doubleTapBefore = null\n\n      if (e.defaultPrevented) {\n        return\n      }\n    }\n\n    longTouchId = setTimeout(() => {\n      // 长按选择模式时\n      longTouchId = null\n      const abstractPos = this._getMouseAbstractPoint(e as TouchEvent)\n      if (!abstractPos) {\n        return\n      }\n\n      if (_getResizeSelectionAt.call(this, abstractPos.x, abstractPos.y)) {\n        this[_].selectionResizer.start(e as TouchEvent)\n      } else {\n        const resizeCol = _getResizeColAt.call(\n          this,\n          abstractPos.x,\n          abstractPos.y,\n          15\n        )\n        if (resizeCol >= 0 && canResizeColumn(resizeCol)) {\n          // 改变宽度\n          this[_].columnResizer.start(resizeCol, e)\n        } else {\n          // 选择\n          this[_].cellSelector.start(e as TouchEvent)\n        }\n      }\n    }, 500)\n  })\n\n  function cancel(e: Event) {\n    if (longTouchId) {\n      clearTimeout(longTouchId)\n      longTouchId = null\n    }\n  }\n  handler.on(element, 'touchcancel', cancel)\n  handler.on(element, 'touchmove', cancel)\n  handler.on(element, 'touchend', (e) => {\n    if (longTouchId) {\n      clearTimeout(longTouchId)\n      this[_].cellSelector.select(e as TouchEvent)\n      longTouchId = null\n    }\n  })\n\n  let isMouseover = false\n  let mouseEnterCell: CellAddress | null = null\n  let mouseOverCell: CellAddress | null = null\n  const onMouseenterCell = (\n    cell: CellAddress & { event: Event },\n    related?: CellAddress\n  ): void => {\n    this.fireListeners(DG_EVENT_TYPE.MOUSEENTER_CELL, {\n      col: cell.col,\n      row: cell.row,\n      event: cell.event,\n      related,\n    })\n    mouseEnterCell = cell\n  }\n  const onMouseleaveCell = (related?: CellAddress): CellAddress | undefined => {\n    const beforeMouseCell = mouseEnterCell\n    mouseEnterCell = null\n    if (beforeMouseCell) {\n      this.fireListeners(DG_EVENT_TYPE.MOUSELEAVE_CELL, {\n        col: beforeMouseCell.col,\n        row: beforeMouseCell.row,\n        related,\n      })\n    }\n    return beforeMouseCell || undefined\n  }\n  const onMouseoverCell = (\n    cell: CellAddress & { event: Event },\n    related?: CellAddress\n  ): void => {\n    this.fireListeners(DG_EVENT_TYPE.MOUSEOVER_CELL, {\n      col: cell.col,\n      row: cell.row,\n      event: cell.event,\n      related,\n    })\n    mouseOverCell = cell\n  }\n  const onMouseoutCell = (related?: CellAddress): CellAddress | undefined => {\n    const beforeMouseCell = mouseOverCell\n    mouseOverCell = null\n    if (beforeMouseCell) {\n      this.fireListeners(DG_EVENT_TYPE.MOUSEOUT_CELL, {\n        col: beforeMouseCell.col,\n        row: beforeMouseCell.row,\n        related,\n      })\n    }\n    return beforeMouseCell || undefined\n  }\n  const scrollElement = scrollable.getElement()\n  handler.on(scrollElement, 'mouseover', (e) => {\n    isMouseover = true\n  })\n  handler.on(scrollElement, 'mouseout', (e) => {\n    isMouseover = false\n    onMouseoutCell()\n  })\n\n  handler.on(element, 'mouseleave', (e) => {\n    onMouseleaveCell()\n  })\n\n  handler.on(element, 'mousemove', (e) => {\n    const eventArgsSet = getCellEventArgsSet(e as MouseEvent)\n    const abstractPos = eventArgsSet.abstractPos\n    const eventArgs = eventArgsSet.eventArgs\n    if (eventArgs) {\n      const beforeMouseCell = mouseEnterCell\n      if (beforeMouseCell) {\n        this.fireListeners(DG_EVENT_TYPE.MOUSEMOVE_CELL, eventArgs)\n        if (\n          beforeMouseCell.col !== eventArgs.col ||\n          beforeMouseCell.row !== eventArgs.row\n        ) {\n          const enterCell = {\n            col: eventArgs.col,\n            row: eventArgs.row,\n          }\n          const outCell = onMouseoutCell(enterCell)\n          const leaveCell = onMouseleaveCell(enterCell)\n          onMouseenterCell(eventArgs, leaveCell)\n          if (isMouseover) {\n            onMouseoverCell(eventArgs, outCell)\n          }\n        } else if (isMouseover && !mouseOverCell) {\n          onMouseoverCell(eventArgs)\n        }\n      } else {\n        onMouseenterCell(eventArgs)\n        if (isMouseover) {\n          onMouseoverCell(eventArgs)\n        }\n        this.fireListeners(DG_EVENT_TYPE.MOUSEMOVE_CELL, eventArgs)\n      }\n    } else {\n      onMouseoutCell()\n      onMouseleaveCell()\n    }\n    if (\n      this[_].columnResizer.moving(e) ||\n      this[_].selectionResizer.moving(e) ||\n      this[_].cellSelector.moving(e)\n    ) {\n      return\n    }\n    const elementStyle = element.style\n    if (!abstractPos) {\n      if (\n        elementStyle.cursor === 'col-resize' ||\n        elementStyle.cursor === 'crosshair'\n      ) {\n        elementStyle.cursor = ''\n      }\n      return\n    }\n    if (_getResizeSelectionAt.call(this, abstractPos.x, abstractPos.y)) {\n      elementStyle.cursor = 'crosshair'\n    } else {\n      const resizeCol = _getResizeColAt.call(this, abstractPos.x, abstractPos.y)\n      if (resizeCol >= 0 && canResizeColumn(resizeCol)) {\n        elementStyle.cursor = 'col-resize'\n      } else {\n        if (\n          elementStyle.cursor === 'col-resize' ||\n          elementStyle.cursor === 'crosshair'\n        ) {\n          elementStyle.cursor = ''\n        }\n      }\n    }\n  })\n  handler.on(element, 'click', (e) => {\n    if (\n      this[_].columnResizer.lastMoving(e) ||\n      this[_].selectionResizer.moving(e) ||\n      this[_].cellSelector.lastMoving(e)\n    ) {\n      return\n    }\n    if (\n      !this.hasListeners(DG_EVENT_TYPE.CLICK_CELL) &&\n      !this.hasListeners(DG_EVENT_TYPE.CLICK_UNDERLAY)\n    ) {\n      return\n    }\n    if (browser.Chrome && e.eventPhase === Event.AT_TARGET) {\n      // 解决 Chrome 下，单元格输入状态使用鼠标选择，当鼠标在输入框action按钮处抬起时触发动作问题\n      return\n    }\n    const eventArgs = getCellEventArgsSet(e as MouseEvent).eventArgs\n    if (!eventArgs) {\n      this.fireListeners(DG_EVENT_TYPE.CLICK_UNDERLAY)\n    } else {\n      this.fireListeners(DG_EVENT_TYPE.CLICK_CELL, eventArgs)\n    }\n  })\n  handler.on(element, 'contextmenu', (e) => {\n    if (!this.hasListeners(DG_EVENT_TYPE.CONTEXTMENU_CELL)) {\n      return\n    }\n    const { eventArgs } = getCellEventArgsSet(e)\n    if (!eventArgs) {\n      return\n    }\n    this.fireListeners(DG_EVENT_TYPE.CONTEXTMENU_CELL, eventArgs)\n  })\n  handler.on(element, 'dblclick', (e) => {\n    if (\n      !this.hasListeners(DG_EVENT_TYPE.DBLCLICK_CELL) &&\n      !this.hasListeners(DG_EVENT_TYPE.DBLCLICK_UNDERLAY)\n    ) {\n      return\n    }\n    const eventArgs = getCellEventArgsSet(e as MouseEvent).eventArgs\n    if (!eventArgs) {\n      this.fireListeners(DG_EVENT_TYPE.DBLCLICK_UNDERLAY)\n    } else {\n      this.fireListeners(DG_EVENT_TYPE.DBLCLICK_CELL, eventArgs)\n    }\n  })\n  this[_].focusControl.onKeyDown((evt: KeydownEvent) => {\n    const results = this.fireListeners(DG_EVENT_TYPE.KEYDOWN, evt)\n    if (array.findIndex(results, (v) => v === false) >= 0) {\n      return false\n    }\n  })\n  this[_].selection.listen(DG_EVENT_TYPE.SELECTED_CELL, (data) => {\n    const results = this.fireListeners(\n      DG_EVENT_TYPE.SELECTED_CELL,\n      data,\n      data.selected\n    )\n    if (array.findIndex(results, (v) => v === false) >= 0) {\n      return false\n    }\n  })\n\n  scrollable.onScroll((e) => {\n    _onScroll.call(this, e)\n    this.fireListeners(DG_EVENT_TYPE.SCROLL, { event: e })\n  })\n  this[_].focusControl.onKeyDownMove((e) => {\n    _onKeyDownMove.call(this, e as KeyboardEvent)\n  })\n  const getCopyValue = () => {\n    let copyValue = ''\n    const range = this[_].selection.range\n    const copyRange = this.getCopyRangeInternal(range)\n    for (let row = copyRange.start.row; row <= copyRange.end.row; row++) {\n      for (let col = copyRange.start.col; col <= copyRange.end.col; col++) {\n        const copyCellValue = this.getCopyCellValue(col, row, copyRange)\n        if (isPromise(copyCellValue)) {\n          // 无法获取异步数据\n        } else {\n          const strCellValue = `${copyCellValue}`\n          if (/^\\[object .*\\]$/.exec(strCellValue)) {\n            // object 忽视\n          } else {\n            copyValue += strCellValue\n          }\n        }\n\n        if (col < copyRange.end.col) {\n          copyValue += '\\t'\n        }\n      }\n      if (row < copyRange.end.row) {\n        copyValue += '\\n'\n      }\n    }\n    return copyValue\n  }\n  this[_].focusControl.onCopy((e: ClipboardEvent) => {\n    let copyValue = getCopyValue()\n    let value = array.find(this.fireListeners(DG_EVENT_TYPE.COPY, e), isDef)\n    if (isDef(value)) {\n      copyValue = value\n    }\n    return copyValue\n  })\n  this[_].focusControl.onCut((e: ClipboardEvent) => {\n    let copyValue = getCopyValue()\n    let value = array.find(this.fireListeners(DG_EVENT_TYPE.CUT, e), isDef)\n    if (isDef(value)) {\n      copyValue = value\n    }\n    return copyValue\n  })\n  this[_].focusControl.onPaste(\n    (e: { value: string; event: ClipboardEvent }) => {\n      const value = e.value\n      const event = e.event\n      const pasteValue = this.hasListeners(DG_EVENT_TYPE.PASTE)\n        ? array.find(\n            this.fireListeners(DG_EVENT_TYPE.PASTE, value, event),\n            isDef\n          )\n        : value\n      if (isDef(pasteValue)) {\n        const normalizeValue = pasteValue.replace(/\\r?\\n$/, '')\n        const { col, row } = this[_].selection.select\n        const multi = /[\\r\\n\\u2028\\u2029\\t]/.test(normalizeValue) // is multi cell values\n        let rangeBoxValues: PasteRangeBoxValues | null = null\n        const pasteCellEvent: PasteCellEvent = {\n          col,\n          row,\n          value: pasteValue,\n          normalizeValue,\n          multi,\n          get rangeBoxValues(): PasteRangeBoxValues {\n            return (\n              rangeBoxValues ??\n              (rangeBoxValues = parsePasteRangeBoxValues(normalizeValue))\n            )\n          },\n          event,\n        }\n        this.fireListeners(DG_EVENT_TYPE.PASTE_CELL, pasteCellEvent)\n      }\n    }\n  )\n  this[_].focusControl.onInput((value) => {\n    const col = this[_].selection.select.col\n    const row = this[_].selection.select.row\n    this.fireListeners(DG_EVENT_TYPE.INPUT_CELL, { col, row, value })\n  })\n  this[_].focusControl.onDelete((event) => {\n    const { col, row } = this[_].selection.select\n    this.fireListeners(DG_EVENT_TYPE.DELETE_CELL, { col, row, event })\n  })\n  this[_].focusControl.onFocus((e: FocusEvent) => {\n    this.fireListeners(DG_EVENT_TYPE.FOCUS_GRID, e)\n    this[_].focusedGrid = true\n\n    const col = this[_].selection.select.col\n    const row = this[_].selection.select.row\n    this.invalidateCell(col, row)\n  })\n  this[_].focusControl.onBlur((e: FocusEvent) => {\n    this.fireListeners(DG_EVENT_TYPE.BLUR_GRID, e)\n    this[_].focusedGrid = false\n\n    const col = this[_].selection.select.col\n    const row = this[_].selection.select.row\n    this.invalidateCell(col, row)\n  })\n}\nfunction _getResizeSelectionAt(\n  this: DrawGrid,\n  abstractX: number,\n  abstractY: number,\n  offset = 7\n): boolean {\n  const range = this.selection.range\n  const cellRect = this.getCellRect(range.end.col, range.end.row)\n  return !!(\n    cellRect.bottom - offset <= abstractY &&\n    abstractY <= cellRect.bottom &&\n    cellRect.right - offset <= abstractX &&\n    abstractX <= cellRect.right &&\n    this.canDragSelection\n  )\n}\nfunction _getResizeColAt(\n  this: DrawGrid,\n  abstractX: number,\n  abstractY: number,\n  offset = 5\n): number {\n  const grid = this\n  if (grid[_].frozenRowCount <= 0) {\n    return -1\n  }\n  const frozenRect = _getFrozenRowsRect.call(this)\n  if (frozenRect && !frozenRect.inPoint(abstractX, abstractY)) {\n    return -1\n  }\n  const cell = grid.getCellAt(abstractX, abstractY)\n  const cellRect = grid.getCellRect(cell.col, cell.row)\n  if (abstractX < cellRect.left + offset) {\n    return cell.col - 1\n  }\n  if (cellRect.right - offset < abstractX) {\n    return cell.col\n  }\n  return -1\n}\nfunction _getScrollableVisibleRect(this: DrawGrid): Rect {\n  let frozenColsWidth = 0\n  if (this[_].frozenColCount > 0) {\n    // 当有固定列时绘制固定数量的列\n    const frozenRect = _getFrozenColsRect.call(this)\n    if (frozenRect) {\n      frozenColsWidth = frozenRect.width\n    }\n  }\n  let frozenRowsHeight = 0\n  if (this[_].frozenRowCount > 0) {\n    // 当有固定列时绘制固定数量的列\n    const frozenRect = _getFrozenRowsRect.call(this)\n    if (frozenRect) {\n      frozenRowsHeight = frozenRect.height\n    }\n  }\n  return new Rect(\n    this[_].scrollable.scrollLeft + frozenColsWidth,\n    this[_].scrollable.scrollTop + frozenRowsHeight,\n    this[_].canvas.width - frozenColsWidth,\n    this[_].canvas.height - frozenRowsHeight\n  )\n}\n\nexport interface DrawGridProtected {\n  element: HTMLElement\n  scrollable: ScrollableAPI\n  handler: EventHandler\n  selection: Selection\n  focusControl: FocusControl\n  canvas: HTMLCanvasElement\n  context: CanvasRenderingContext2D\n  rowCount: number\n  colCount: number\n  frozenColCount: number\n  frozenRowCount: number\n  defaultRowHeight?: number\n  defaultColWidth?: string | number\n  highlightBorderWidth?: string | number\n  font?: string\n  underlayRowCount: number\n  underlayColCount: number\n  underlayRowHeight: number | 'auto'\n  underlayColWidth: number | 'auto'\n  underlayBackgroundColor?: string\n  borderColor: string\n  borderWidth: number\n  borderMode: BorderMode\n  keyboardOptions?: DrawGridKeyboardOptions\n  singleSelection: boolean\n  disableColumnResize: boolean\n  rowHeightsMap: NumberMap<number>\n  colWidthsMap: NumberMap<string | number>\n  colWidthsLimit: {\n    [col: number]: {\n      max?: string | number\n      min?: string | number\n      disableResize?: boolean\n    }\n  }\n  colWidthsOffset: {\n    [col: number]: number\n  }\n  calcWidthContext: {\n    _: DrawGridProtected\n    full: number\n    em: number\n  }\n\n  columnResizer: ColumnResizer\n  selectionResizer: SelectionResizer\n  cellSelector: CellSelector\n\n  drawCells: { [row: number]: { [col: number]: DrawCellContext } }\n  cellTextOverflows: { [at: string]: string }\n  cellTypeOverflows: {\n    [at: string]: string\n  }\n  focusedGrid: boolean\n\n  config:\n    | {\n        [name: string]: any\n      }\n    | undefined\n  scroll: {\n    left: number\n    top: number\n  }\n  disposables?: { dispose(): void }[] | null\n}\n\nexport interface DrawGridConstructorOptions {\n  rowCount?: number\n  colCount?: number\n  frozenColCount?: number\n  frozenRowCount?: number\n  /**\n   * Default grid row height. default 40\n   */\n  defaultRowHeight?: number\n  /**\n   * Default grid col width. default 80\n   */\n  defaultColWidth?: number | string\n  highlightBorderWidth?: number | string\n  font?: string\n  underlayRowCount?: number\n  underlayColCount?: number\n  underlayRowHeight?: number | 'auto'\n  underlayColWidth?: number | 'auto'\n  underlayBackgroundColor?: string\n  borderMode?: BorderMode\n  borderColor?: string\n  borderWidth?: number\n  keyboardOptions?: DrawGridKeyboardOptions\n  /**\n   * Canvas parent element\n   */\n  parentElement?: HTMLElement | null\n  /**\n   * Disable column resizing\n   */\n  disableColumnResize?: boolean\n  singleSelection?: boolean\n}\n\ninterface IDisposable {\n  dispose: () => void\n}\n\nfunction createRootElement() {\n  const element = document.createElement('div')\n  element.classList.add('kaka-grid')\n  return element\n}\n\n/**\n * DrawGrid\n */\nexport abstract class DrawGrid extends EventTarget {\n  public static get EVENT_TYPE(): typeof DG_EVENT_TYPE {\n    return DG_EVENT_TYPE\n  }\n  private [_]: DrawGridProtected\n  /**\n   * constructor\n   *\n   * <pre>\n   * Constructor options\n   * -----\n   * rowCount: grid row count.default 10\n   * colCount: grid col count.default 10\n   * frozenColCount: default 0\n   * frozenRowCount: default 0\n   * defaultRowHeight: default grid row height. default 40\n   * defaultColWidth: default grid col width. default 80\n   * highlightBorderWidth: default grid highlight border width. default 2\n   * parentElement: canvas parentElement\n   * font: default font\n   * underlayRowCount: default 0\n   * underlayColCount: default 0\n   * underlayRowHeight: default 'auto'\n   * underlayColWidth: default 'auto'\n   * underlayBackgroundColor: underlay background color\n   * singleSelection: default false\n   * disableColumnResize: default false\n   * -----\n   * </pre>\n   */\n  public constructor(options: DrawGridConstructorOptions = {}) {\n    super()\n    const {\n      rowCount = 10,\n      colCount = 10,\n      frozenColCount = 0,\n      frozenRowCount = 0,\n      defaultRowHeight,\n      defaultColWidth,\n      highlightBorderWidth,\n      font,\n      underlayRowCount = 0,\n      underlayColCount = 0,\n      underlayRowHeight = 'auto',\n      underlayColWidth = 'auto',\n      underlayBackgroundColor,\n      borderMode = 'none',\n      borderColor = '',\n      borderWidth = 0,\n      keyboardOptions,\n      parentElement,\n      singleSelection,\n      disableColumnResize,\n    } = options\n    const protectedSpace = (this[_] = {} as DrawGridProtected)\n    style.initDocument()\n    protectedSpace.element = createRootElement()\n\n    protectedSpace.canvas = hiDPI.transform(document.createElement('canvas'))\n    protectedSpace.context = protectedSpace.canvas.getContext('2d', {\n      alpha: false,\n    }) as CanvasRenderingContext2D\n\n    protectedSpace.scrollable = style.isPerfectScrollbar()\n      ? new Scrollbar()\n      : new Scrollable(protectedSpace.canvas)\n    protectedSpace.handler = new EventHandler()\n    protectedSpace.selection = new Selection(this, (range: CellRange) => {\n      return this.updateSelectionRange(range)\n    })\n    protectedSpace.focusControl = new FocusControl(\n      this,\n      protectedSpace.scrollable.getElement(),\n      protectedSpace.scrollable\n    )\n\n    protectedSpace.rowCount = rowCount\n    protectedSpace.colCount = colCount\n    protectedSpace.frozenColCount = frozenColCount\n    protectedSpace.frozenRowCount = frozenRowCount\n    protectedSpace.underlayRowCount = underlayRowCount\n    protectedSpace.underlayColCount = underlayColCount\n    protectedSpace.underlayRowHeight = underlayRowHeight\n    protectedSpace.underlayColWidth = underlayColWidth\n    protectedSpace.borderMode = borderMode\n    protectedSpace.borderColor = borderColor\n    protectedSpace.borderWidth = borderWidth\n\n    protectedSpace.defaultRowHeight = defaultRowHeight\n    protectedSpace.defaultColWidth = defaultColWidth\n    protectedSpace.highlightBorderWidth = highlightBorderWidth\n\n    protectedSpace.font = font\n    protectedSpace.underlayBackgroundColor = underlayBackgroundColor\n    protectedSpace.keyboardOptions = keyboardOptions || {}\n    protectedSpace.keyboardOptions.moveCellOnEnter =\n      protectedSpace.keyboardOptions.moveCellOnEnter ?? true\n    protectedSpace.keyboardOptions.moveCellOnTab =\n      protectedSpace.keyboardOptions.moveCellOnTab ?? true\n    protectedSpace.singleSelection = !!singleSelection\n    protectedSpace.disableColumnResize =\n      !!disableColumnResize || !!(options as any).disableColResize\n\n    /////\n    protectedSpace.rowHeightsMap = new NumberMap<number>()\n    protectedSpace.colWidthsMap = new NumberMap<number | string>()\n    protectedSpace.colWidthsLimit = {}\n    protectedSpace.colWidthsOffset = {}\n    protectedSpace.calcWidthContext = {\n      _: protectedSpace,\n      get full(): number {\n        return this._.canvas.width\n      },\n      get em(): number {\n        return getFontSize(this._.context, this._.font).width\n      },\n    }\n\n    protectedSpace.columnResizer = new ColumnResizer(this)\n    protectedSpace.selectionResizer = new SelectionResizer(this)\n    protectedSpace.cellSelector = new CellSelector(this)\n\n    protectedSpace.drawCells = {}\n    protectedSpace.cellTextOverflows = {}\n    protectedSpace.cellTypeOverflows = {}\n    protectedSpace.focusedGrid = false\n\n    protectedSpace.element.appendChild(protectedSpace.canvas)\n    protectedSpace.element.appendChild(protectedSpace.scrollable.getElement())\n    protectedSpace.scroll = {\n      left: 0,\n      top: 0,\n    }\n    this.updateScroll()\n    if (parentElement) {\n      parentElement.appendChild(protectedSpace.element)\n      this.updateSize()\n    } else {\n      this.updateSize()\n    }\n    _bindEvents.call(this)\n    this.bindEventsInternal()\n  }\n  /**\n   * Get root element.\n   * @returns root element\n   */\n  public getElement(): HTMLElement {\n    return this[_].element\n  }\n  /**\n   * Get canvas element.\n   */\n  public get canvas(): HTMLCanvasElement {\n    return this[_].canvas\n  }\n  /**\n   * Focus the grid.\n   * @returns\n   */\n  public focus(): void {\n    const { col, row } = this[_].selection.select\n    this.focusCell(col, row)\n  }\n  public hasFocusGrid(): boolean {\n    return this[_].focusedGrid\n  }\n  /**\n   * Selection instance.\n   */\n  public get selection(): Selection {\n    return this[_].selection\n  }\n  /**\n   * Number of rows.\n   */\n  public get rowCount(): number {\n    return this[_].rowCount\n  }\n  public set rowCount(rowCount: number) {\n    this[_].rowCount = rowCount\n    this.updateScroll()\n    if (this[_].selection._updateGridRange()) {\n      const { col, row } = this[_].selection.focus\n      this.makeVisibleCell(col, row)\n      this.setFocusCursor(col, row)\n    }\n  }\n  /**\n   * Number of columns.\n   */\n  public get colCount(): number {\n    return this[_].colCount\n  }\n  public set colCount(colCount: number) {\n    this[_].colCount = colCount\n    this.updateScroll()\n    if (this[_].selection._updateGridRange()) {\n      const { col, row } = this[_].selection.focus\n      this.makeVisibleCell(col, row)\n      this.setFocusCursor(col, row)\n    }\n  }\n  /**\n   * Number of frozen columns.\n   */\n  public get frozenColCount(): number {\n    return this[_].frozenColCount\n  }\n  public set frozenColCount(frozenColCount: number) {\n    this[_].frozenColCount = frozenColCount\n  }\n  /**\n   * Number of frozen rows.\n   */\n  public get frozenRowCount(): number {\n    return this[_].frozenRowCount\n  }\n  public set frozenRowCount(frozenRowCount: number) {\n    this[_].frozenRowCount = frozenRowCount\n  }\n  /**\n   * Default row height.\n   *\n   */\n  public get defaultRowHeight(): number {\n    return this[_].defaultRowHeight || this.getDefaultRowHeight()\n  }\n  public set defaultRowHeight(defaultRowHeight: number) {\n    this[_].defaultRowHeight = defaultRowHeight\n  }\n  /**\n   * Default column width.\n   */\n  public get defaultColWidth(): string | number {\n    return this[_].defaultColWidth || this.getDefaultColWidth()\n  }\n  public set defaultColWidth(defaultColWidth: string | number) {\n    this[_].defaultColWidth = defaultColWidth\n  }\n  /**\n   * Highlight Border Width.\n   */\n  public get highlightBorderWidth(): string | number {\n    return this[_].highlightBorderWidth || this.getHighlightBorderWidth()\n  }\n  public set highlightBorderWidth(highlightBorderWidth: string | number) {\n    this[_].highlightBorderWidth = highlightBorderWidth\n  }\n  /**\n   * Font definition as a string.\n   */\n  public get font(): string {\n    return this[_].font || this.getDefaultFont()\n  }\n  public set font(font) {\n    this[_].font = font\n  }\n  /**\n   * Number of underlay rows.\n   */\n  public get underlayRowCount(): number {\n    return this[_].underlayRowCount\n  }\n  public set underlayRowCount(underlayRowCount: number) {\n    this[_].underlayRowCount = underlayRowCount\n  }\n  /**\n   * Number of underlay cols.\n   */\n  public get underlayColCount(): number {\n    return this[_].underlayColCount\n  }\n  public set underlayColCount(underlayColCount: number) {\n    this[_].underlayColCount = underlayColCount\n  }\n  /**\n   * Height of underlay row.\n   */\n  public get underlayRowHeight(): number | 'auto' {\n    return this[_].underlayRowHeight\n  }\n  public set underlayRowHeight(underlayRowHeight: number | 'auto') {\n    this[_].underlayRowHeight = underlayRowHeight\n  }\n  /**\n   * Width of underlay col.\n   */\n  public get underlayColWidth(): number | 'auto' {\n    return this[_].underlayColWidth\n  }\n  public set underlayColWidth(underlayColWidth: number | 'auto') {\n    this[_].underlayColWidth = underlayColWidth\n  }\n  /**\n   * Background color of the underlay.\n   */\n  public get underlayBackgroundColor(): string {\n    return (\n      this[_].underlayBackgroundColor ||\n      this.getDefaultUnderlayBackgroundColor()\n    )\n  }\n  public set underlayBackgroundColor(underlayBackgroundColor) {\n    this[_].underlayBackgroundColor = underlayBackgroundColor\n  }\n  /**\n   * Border color of the grid.\n   */\n  public get borderColor(): string {\n    return this[_].borderColor || this.getDefaultBorderColor()\n  }\n  public set borderColor(borderColor) {\n    this[_].borderColor = borderColor\n  }\n  /**\n   * Border width of the grid.\n   */\n  public get borderWidth(): number {\n    return this[_].borderWidth || this.getDefaultBorderWidth()\n  }\n  public set borderWidth(borderWidth) {\n    this[_].borderWidth = borderWidth\n  }\n  /**\n   * Border mode of the grid.\n   */\n  public get borderMode(): BorderMode {\n    return this[_].borderMode || this.getDefaultBorderMode()\n  }\n  public set borderMode(borderMode) {\n    this[_].borderMode = borderMode\n  }\n  public get keyboardOptions(): DrawGridKeyboardOptions | null {\n    return this[_].keyboardOptions ?? null\n  }\n  public set keyboardOptions(keyboardOptions) {\n    this[_].keyboardOptions = keyboardOptions ?? undefined\n  }\n  /**\n   * Single selection.\n   */\n  public get singleSelection(): boolean {\n    return this[_].singleSelection\n  }\n  public set singleSelection(singleSelection: boolean) {\n    this[_].singleSelection = singleSelection\n  }\n  /**\n   * Disable column resize.\n   */\n  public get disableColumnResize(): boolean {\n    return this[_].disableColumnResize\n  }\n  public set disableColumnResize(disableColumnResize: boolean) {\n    this[_].disableColumnResize = disableColumnResize\n  }\n  public get disableColResize(): boolean {\n    window.console.warn(\n      \"'disableColResize' is deprecated, please use 'disableColumnResize' instead\"\n    )\n    return this.disableColumnResize\n  }\n  public set disableColResize(disableColumnResize: boolean) {\n    window.console.warn(\n      \"'disableColResize' is deprecated, please use 'disableColumnResize' instead\"\n    )\n    this.disableColumnResize = disableColumnResize\n  }\n  public get canDragSelection() {\n    return this[_].selectionResizer.canStart()\n  }\n  public configure(\n    name: 'fadeinWhenCallbackInPromise',\n    value?: boolean\n  ): boolean\n  public configure(name: string, value?: any): any {\n    const cfg = this[_].config || (this[_].config = {})\n    if (isDef(value)) {\n      cfg[name] = value\n    }\n    return cfg[name]\n  }\n  /**\n   * Apply the changed size.\n   * @returns\n   */\n  public updateSize(): void {\n    // Update size of canvas\n    const { canvas } = this[_]\n    canvas.style.width = ''\n    canvas.style.height = ''\n\n    let width = canvas.offsetWidth\n    if (!width) {\n      // for legacy\n      const parent = canvas.parentElement\n      if (parent !== null) {\n        width = parent.offsetWidth - style.getScrollBarSize()\n      }\n    }\n    width = Math.floor(width)\n\n    let height = canvas.offsetHeight\n    if (!height) {\n      // for legacy\n      const parent = canvas.parentElement\n      if (parent !== null) {\n        height = parent.offsetHeight - style.getScrollBarSize()\n      }\n    }\n    height = Math.floor(height)\n\n    canvas.width = width\n    canvas.height = height\n\n    canvas.style.width = `${width}px`\n    canvas.style.height = `${height}px`\n\n    const sel = this[_].selection.select\n    this[_].focusControl.setFocusRect(\n      this.getFocusRectInternal(sel.col, sel.row)\n    )\n  }\n  /**\n   * Apply the changed scroll size.\n   * @returns `true` if there was a change in the scroll size\n   */\n  public updateScroll(): boolean {\n    _initColWidthsOffset(this)\n    const { scrollable } = this[_]\n    const newHeight = _getScrollHeight.call(this)\n    const newWidth = _getScrollWidth.call(this)\n    if (\n      newHeight === scrollable.scrollHeight &&\n      newWidth === scrollable.scrollWidth\n    ) {\n      scrollable.update()\n      return false\n    } else {\n      scrollable.setScrollSize(newWidth, newHeight)\n      this[_].scroll = {\n        left: scrollable.scrollLeft,\n        top: scrollable.scrollTop,\n      }\n      return true\n    }\n  }\n  /**\n   * Get the row height of the given the row index.\n   * @param row - The row index\n   * @returns The row height\n   */\n  public getRowHeight(row: number): number {\n    return _getRowHeight.call(this, row)\n  }\n  /**\n   * Set the row height of the given the row index.\n   * @param row - The row index\n   * @param height - The row height\n   * @returns\n   */\n  public setRowHeight(row: number, height: number): void {\n    _setRowHeight.call(this, row, height)\n  }\n  /**\n   * Get the column width of the given the column index.\n   * @param col - The column index\n   * @returns The column width\n   */\n  public getColWidth(col: number): number {\n    return _getColWidth.call(this, col)\n  }\n  /**\n   * Set the column widtht of the given the column index.\n   * @param col - The column index\n   * @param width - The column width\n   * @returns\n   */\n  public setColWidth(col: number, width: number | string): void {\n    _setColWidth.call(this, col, width)\n  }\n  /**\n   * Get the column max width of the given the column index.\n   * @param col - The column index\n   * @returns The column max width\n   */\n  public getMaxColWidth(col: number): string | number | undefined {\n    const obj = this[_].colWidthsLimit[col]\n    return (obj && obj.max) || undefined\n  }\n  /**\n   * Set the column max width of the given the column index.\n   * @param col - The column index\n   * @param maxWidth - The column max width\n   * @returns\n   */\n  public setMaxColWidth(col: number, maxWidth: number | string): void {\n    const obj =\n      this[_].colWidthsLimit[col] || (this[_].colWidthsLimit[col] = {})\n    obj.max = maxWidth\n  }\n  /**\n   * Get the column min width of the given the column index.\n   * @param col - The column index\n   * @returns The column min width\n   */\n  public getMinColWidth(col: number): string | number | undefined {\n    const obj = this[_].colWidthsLimit[col]\n    return (obj && obj.min) || undefined\n  }\n  /**\n   * Set the column min width of the given the column index.\n   * @param col - The column index\n   * @param minWidth - The column min width\n   * @returns\n   */\n  public setMinColWidth(col: number, minWidth: number | string): void {\n    const obj =\n      this[_].colWidthsLimit[col] || (this[_].colWidthsLimit[col] = {})\n    obj.min = minWidth\n  }\n  /**\n   * Get the column disable resize of the given the column index.\n   * @param col - The column index\n   * @returns The column disable resize\n   */\n  public getColDisableResize(col: number) {\n    const obj = this[_].colWidthsLimit[col]\n    return (obj && obj.disableResize) || undefined\n  }\n  /**\n   * Set the column disable resize of the given the column index.\n   * @param col - The column index\n   * @param disableResize - The column disable resize\n   * @returns\n   */\n  public setColDisableResize(col: number, disableResize: boolean) {\n    const obj =\n      this[_].colWidthsLimit[col] || (this[_].colWidthsLimit[col] = {})\n    obj.disableResize = disableResize\n  }\n  /**\n   * Get the rect of the cell.\n   * @param col - index of column, of the cell\n   * @param row - index of row, of the cell\n   * @returns the rect of the cell.\n   */\n  public getCellRect(col: number, row: number): Rect {\n    const isFrozenCell = this.isFrozenCell(col, row)\n\n    let absoluteLeft = this._getColsWidth(0, col - 1)\n    const width = _getColWidth.call(this, col)\n    if (isFrozenCell && isFrozenCell.col) {\n      absoluteLeft += this[_].scroll.left\n    }\n\n    let absoluteTop = _getRowsHeight.call(this, 0, row - 1)\n    const height = _getRowHeight.call(this, row)\n    if (isFrozenCell && isFrozenCell.row) {\n      absoluteTop += this[_].scroll.top\n    }\n    return new Rect(absoluteLeft, absoluteTop, width, height)\n  }\n  /**\n   * Get the relative rectangle of the cell.\n   * @param col - index of column, of the cell\n   * @param row - index of row, of the cell\n   * @returns the rect of the cell.\n   */\n  public getCellRelativeRect(col: number, row: number): Rect {\n    return this._toRelativeRect(this.getCellRect(col, row))\n  }\n  /**\n   * Get the rectangle of the cells area.\n   * @param startCol - index of the starting column, of the cell\n   * @param startRow - index of the starting row, of the cell\n   * @param endCol - index of the ending column, of the cell\n   * @param endRow - index of the ending row, of the cell\n   * @returns the rect of the cells.\n   */\n  public getCellsRect(\n    startCol: number,\n    startRow: number,\n    endCol: number,\n    endRow: number\n  ) {\n    const isFrozenStartCell = this.isFrozenCell(startCol, startRow)\n    const isFrozenEndCell = this.isFrozenCell(endCol, endRow)\n\n    let absoluteLeft = this._getColsWidth(0, startCol - 1)\n    let width = this._getColsWidth(startCol, endCol)\n    if (isFrozenStartCell && isFrozenStartCell.col) {\n      const scrollLeft = this[_].scroll.left\n      absoluteLeft += scrollLeft\n      if (!isFrozenEndCell || !isFrozenEndCell.col) {\n        width -= scrollLeft\n        width = Math.max(\n          width,\n          this._getColsWidth(startCol, this.frozenColCount - 1)\n        )\n      }\n    }\n    let absoluteTop = _getRowsHeight.call(this, 0, startRow - 1)\n    let height = _getRowsHeight.call(this, startRow, endRow)\n    if (isFrozenStartCell && isFrozenStartCell.row) {\n      const scrollTop = this[_].scroll.top\n      absoluteTop += scrollTop\n      if (!isFrozenEndCell || !isFrozenEndCell.row) {\n        height -= scrollTop\n        height = Math.max(\n          height,\n          this._getColsWidth(startRow, this.frozenRowCount - 1)\n        )\n      }\n    }\n    return new Rect(absoluteLeft, absoluteTop, width, height)\n  }\n  public getCellRangeRect(range: CellRange): Rect {\n    return this.getCellsRect(\n      range.start.col,\n      range.start.row,\n      range.end.col,\n      range.end.row\n    )\n  }\n  public isFrozenCell(\n    col: number,\n    row: number\n  ): {\n    row: boolean\n    col: boolean\n  } | null {\n    const { frozenRowCount, frozenColCount } = this[_]\n    const isFrozenRow = frozenRowCount > 0 && row < frozenRowCount\n    const isFrozenCol = frozenColCount > 0 && col < frozenColCount\n    if (isFrozenRow || isFrozenCol) {\n      return {\n        col: isFrozenCol,\n        row: isFrozenRow,\n      }\n    } else {\n      return null\n    }\n  }\n  public getRowAt(absoluteY: number): number {\n    const frozen = _getTargetFrozenRowAt.call(this, absoluteY)\n    if (frozen) {\n      return frozen.row\n    }\n    const row = _getTargetRowAt.call(this, absoluteY)\n    return row ? row.row : -1\n  }\n  public getColAt(absoluteX: number): number {\n    const frozen = _getTargetFrozenColAt.call(this, absoluteX)\n    if (frozen) {\n      return frozen.col\n    }\n    const col = _getTargetColAt.call(this, absoluteX)\n    return col ? col.col : -1\n  }\n  public getCellAt(absoluteX: number, absoluteY: number): CellAddress {\n    return {\n      col: this.getColAt(absoluteX),\n      row: this.getRowAt(absoluteY),\n    }\n  }\n  /**\n   * Scroll to where cell is visible.\n   * @param col - The column index.\n   * @param row - The row index\n   * @returns\n   */\n  public makeVisibleCell(col: number, row: number): void {\n    const isFrozenCell = this.isFrozenCell(col, row)\n    if (isFrozenCell && isFrozenCell.col && isFrozenCell.row) {\n      return\n    }\n    const rect = this.getCellRect(col, row)\n    const visibleRect = _getScrollableVisibleRect.call(this)\n    if (visibleRect.contains(rect)) {\n      return\n    }\n    const { scrollable } = this[_]\n    if (!isFrozenCell || !isFrozenCell.col) {\n      if (rect.left < visibleRect.left) {\n        scrollable.scrollLeft -= visibleRect.left - rect.left\n      } else if (visibleRect.right < rect.right) {\n        scrollable.scrollLeft -= visibleRect.right - rect.right\n      }\n    }\n    if (!isFrozenCell || !isFrozenCell.row) {\n      if (rect.top < visibleRect.top) {\n        scrollable.scrollTop -= visibleRect.top - rect.top\n      } else if (visibleRect.bottom < rect.bottom) {\n        scrollable.scrollTop -= visibleRect.bottom - rect.bottom\n      }\n    }\n  }\n  /**\n   * Moves the focus cursor to the given cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @returns\n   */\n  public setFocusCursor(col: number, row: number): void {\n    const focusControl = this[_].focusControl\n    const oldEditMode = focusControl.editMode\n\n    focusControl.setFocusRect(this.getFocusRectInternal(col, row))\n\n    this._updatedSelection()\n\n    if (oldEditMode && !focusControl.editMode) {\n      focusControl.resetInputStatus()\n    }\n  }\n  public _updatedSelection(): void {\n    const { focusControl } = this[_]\n    const { col: selCol, row: selRow } = this[_].selection.select\n    const results = this.fireListeners(DG_EVENT_TYPE.EDITABLEINPUT_CELL, {\n      col: selCol,\n      row: selRow,\n    })\n\n    const editMode = array.findIndex(results, (v) => !!v) >= 0\n    focusControl.editMode = editMode\n\n    if (editMode) {\n      focusControl.storeInputStatus()\n      focusControl.setDefaultInputStatus()\n      this.fireListeners(DG_EVENT_TYPE.MODIFY_STATUS_EDITABLEINPUT_CELL, {\n        col: selCol,\n        row: selRow,\n        input: focusControl.input,\n      })\n    }\n  }\n  /**\n   * Focus the cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @returns\n   */\n  public focusCell(col: number, row: number): void {\n    const startCol = this.selection.range.start.col\n    const startRow = this.selection.range.start.row\n    const endCol = this.selection.range.end.col\n    const endRow = this.selection.range.end.row\n\n    this.setFocusCursor(col, row)\n\n    // Failure occurs in IE if focus is not last\n    this._forceFocusCell()\n\n    // Invalidate Grid\n    this.selection.select = {\n      col,\n      row,\n    }\n    this.invalidateGridRect(startCol, startRow, endCol, endRow)\n    this.invalidateCell(col, row)\n  }\n  /**\n   * Redraws the range of the given cell.\n   * @param col - The column index of cell.\n   * @param row - The row index of cell.\n   * @returns\n   */\n  public invalidateCell(col: number, row: number): void {\n    this.invalidateGridRect(col, row)\n  }\n  /**\n   * Redraws the range of the given cells.\n   * @param startCol - index of the starting column, of the cell\n   * @param startRow - index of the starting row, of the cell\n   * @param endCol - index of the ending column, of the cell\n   * @param endRow - index of the ending row, of the cell\n   * @returns\n   */\n  public invalidateGridRect(\n    startCol: number,\n    startRow: number,\n    endCol = startCol,\n    endRow = startRow\n  ): void {\n    const offset = this.getOffsetInvalidateCells()\n    if (offset > 0) {\n      startCol -= offset\n      startRow -= offset\n      endCol += offset\n      endRow += offset\n    }\n\n    const visibleRect = this._getVisibleRect()\n    const cellsRect = this.getCellsRect(startCol, startRow, endCol, endRow)\n    const invalidateTarget = visibleRect.intersection(cellsRect)\n    if (invalidateTarget) {\n      const { frozenColCount, frozenRowCount } = this[_]\n      if (frozenColCount > 0 && endCol >= frozenColCount) {\n        const frozenRect = _getFrozenColsRect.call(this)\n        if (frozenRect && frozenRect.intersection(invalidateTarget)) {\n          invalidateTarget.left = Math.min(\n            frozenRect.right - 1,\n            frozenRect.left\n          )\n        }\n      }\n\n      if (frozenRowCount > 0 && endRow >= frozenRowCount) {\n        const frozenRect = _getFrozenRowsRect.call(this)\n        if (frozenRect && frozenRect.intersection(invalidateTarget)) {\n          invalidateTarget.top = Math.min(\n            frozenRect.bottom - 1,\n            invalidateTarget.top\n          )\n        }\n      }\n\n      this._invalidateRect(invalidateTarget)\n    }\n  }\n  invalidateCellRange(range: CellRange): void {\n    this.invalidateGridRect(\n      range.start.col,\n      range.start.row,\n      range.end.col,\n      range.end.row\n    )\n  }\n  /**\n   * Redraws the whole grid.\n   * @returns\n   */\n  public invalidate(): void {\n    const visibleRect = this._getVisibleRect()\n    this._invalidateRect(visibleRect)\n  }\n  /**\n   * Get the number of scrollable rows fully visible in the grid. visibleRowCount does not include the frozen rows counted by the frozenRowCount property. It does not include any partially visible rows on the bottom of the grid.\n   * @returns\n   */\n  public get visibleRowCount(): number {\n    const { frozenRowCount } = this\n    const visibleRect = this._getVisibleRect()\n    const visibleTop =\n      frozenRowCount > 0\n        ? visibleRect.top + _getRowsHeight.call(this, 0, frozenRowCount - 1)\n        : visibleRect.top\n\n    const initRow = _getTargetRowAt.call(this, visibleTop)\n    if (!initRow) {\n      return 0\n    }\n    const startRow = Math.max(\n      initRow.top >= visibleTop ? initRow.row : initRow.row + 1,\n      frozenRowCount\n    )\n    let absoluteTop = _getRowsHeight.call(this, 0, startRow - 1)\n    let count = 0\n    const { rowCount } = this\n    for (let row = startRow; row < rowCount; row++) {\n      const height = _getRowHeight.call(this, row)\n      const bottom = absoluteTop + height\n      if (visibleRect.bottom < bottom) {\n        break\n      }\n      count++\n      absoluteTop = bottom\n    }\n    return count\n  }\n  /**\n   * Get the number of scrollable columns fully visible in the grid. visibleColCount does not include the frozen columns counted by the frozenColCount property. It does not include any partially visible columns on the right of the grid.\n   * @returns\n   */\n  public get visibleColCount(): number {\n    const { frozenColCount } = this\n    const visibleRect = this._getVisibleRect()\n    const visibleLeft =\n      frozenColCount > 0\n        ? visibleRect.left + this._getColsWidth(0, frozenColCount - 1)\n        : visibleRect.left\n\n    const initCol = _getTargetColAt.call(this, visibleLeft)\n    if (!initCol) {\n      return 0\n    }\n    const startCol = Math.max(\n      initCol.left >= visibleLeft ? initCol.col : initCol.col + 1,\n      frozenColCount\n    )\n    let absoluteLeft = this._getColsWidth(0, startCol - 1)\n    let count = 0\n    const { colCount } = this\n    for (let col = startCol; col < colCount; col++) {\n      const width = _getColWidth.call(this, col)\n      const right = absoluteLeft + width\n      if (visibleRect.right < right) {\n        break\n      }\n      count++\n      absoluteLeft = right\n    }\n    return count\n  }\n  /**\n   * Get the index of the first row in the scrollable region that is visible.\n   * @returns\n   */\n  public get topRow(): number {\n    const { frozenRowCount } = this\n    const visibleRect = this._getVisibleRect()\n    const visibleTop =\n      frozenRowCount > 0\n        ? visibleRect.top + _getRowsHeight.call(this, 0, frozenRowCount - 1)\n        : visibleRect.top\n\n    const initRow = _getTargetRowAt.call(this, visibleTop)\n    if (!initRow) {\n      return 0\n    }\n    return Math.max(\n      initRow.top >= visibleTop ? initRow.row : initRow.row + 1,\n      frozenRowCount\n    )\n  }\n  /**\n   * Get the index of the first column in the scrollable region that is visible.\n   * @returns\n   */\n  public get leftCol(): number {\n    const { frozenColCount } = this\n    const visibleRect = this._getVisibleRect()\n    const visibleLeft =\n      frozenColCount > 0\n        ? visibleRect.left + this._getColsWidth(0, frozenColCount - 1)\n        : visibleRect.left\n\n    const initCol = _getTargetColAt.call(this, visibleLeft)\n    if (!initCol) {\n      return 0\n    }\n    return Math.max(\n      initCol.left >= visibleLeft ? initCol.col : initCol.col + 1,\n      frozenColCount\n    )\n  }\n  /**\n   * gets or sets the number of pixels that an element's content is scrolled vertically\n   */\n  public get scrollTop(): number {\n    return this[_].scrollable.scrollTop\n  }\n  public set scrollTop(scrollTop) {\n    this[_].scrollable.scrollTop = scrollTop\n  }\n  /**\n   * gets or sets the number of pixels that an element's content is scrolled from its left edge\n   */\n  public get scrollLeft(): number {\n    return this[_].scrollable.scrollLeft\n  }\n  public set scrollLeft(scrollLeft) {\n    this[_].scrollable.scrollLeft = scrollLeft\n  }\n  /**\n   * Get the overflowed text in the cell rectangle, from the given cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @returns The text overflowing the cell rect.\n   */\n  public getCellOverflowText(col: number, row: number): string | null {\n    let overflowText = this.getCellOverflowTextInternal({ col, row }) || null\n    if (!overflowText) {\n      const key = `${col}:${row}`\n      overflowText = this[_].cellTextOverflows[key] || null\n    }\n    return overflowText\n  }\n  /**\n   * Set the overflowed text in the cell rectangle, to the given cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @param overflowText - The overflowed text in the cell rectangle.\n   * @returns\n   */\n  public setCellOverflowText(\n    col: number,\n    row: number,\n    overflowText: string | false\n  ) {\n    const key = `${col}:${row}`\n    if (overflowText) {\n      this[_].cellTextOverflows[key] =\n        typeof overflowText === 'string' ? overflowText.trim() : ''\n    } else {\n      delete this[_].cellTextOverflows[key]\n    }\n  }\n  /**\n   * Get the overflowed type in the cell rectangle, from the given cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @returns The type overflowing the cell rect.\n   */\n  public getCellOverflowType(col: number, row: number): string | null {\n    let overflowType = this.getCellOverflowTypeInternal({ col, row }) || null\n    if (!overflowType) {\n      const key = `${col}:${row}`\n      overflowType = this[_].cellTypeOverflows[key] || null\n    }\n    return overflowType\n  }\n  /**\n   * Set the overflowed type in the cell rectangle, to the given cell.\n   * @param col - The column index.\n   * @param row - The row index\n   * @param overflowType - The overflowed type in the cell rectangle.\n   * @returns\n   */\n  public setCellOverflowType(\n    col: number,\n    row: number,\n    overflowType: string | false\n  ) {\n    const key = `${col}:${row}`\n    if (overflowType) {\n      this[_].cellTypeOverflows[key] =\n        typeof overflowType === 'string' ? overflowType.trim() : ''\n    } else {\n      delete this[_].cellTypeOverflows[key]\n    }\n  }\n  public addDisposable(disposable: IDisposable) {\n    if (\n      !disposable ||\n      !disposable.dispose ||\n      typeof disposable.dispose !== 'function'\n    ) {\n      throw new Error('not disposable!')\n    }\n    const disposables = (this[_].disposables = this[_].disposables || [])\n    disposables.push(disposable)\n  }\n  /**\n   * Dispose the grid instance.\n   * @returns\n   */\n  public dispose() {\n    super.dispose()\n    const protectedSpace = this[_]\n    protectedSpace.handler.dispose()\n    protectedSpace.scrollable.dispose()\n    protectedSpace.focusControl.dispose()\n    protectedSpace.columnResizer.dispose()\n    protectedSpace.selectionResizer.dispose()\n    protectedSpace.cellSelector.dispose()\n    if (protectedSpace.disposables) {\n      protectedSpace.disposables.forEach((disposable: IDisposable) =>\n        disposable.dispose()\n      )\n      protectedSpace.disposables = null\n    }\n\n    const parentElement = protectedSpace.element.parentElement\n    if (parentElement) {\n      parentElement.removeChild(protectedSpace.element)\n    }\n  }\n  public getAttachCellsArea(range: CellRange) {\n    return {\n      element: this.getElement(),\n      rect: this.getAttachCellsAreaInternal(range),\n      padding: this.getAttachCellsPaddingInternal(range),\n    }\n  }\n  public onKeyDownMove(evt: KeyboardEvent): void {\n    _onKeyDownMove.call(this, evt)\n  }\n  public _getMouseAbstractPoint(evt: Event) {\n    let e: Touch | MouseEvent\n    if (event.isTouchEvent(evt)) {\n      e = evt.changedTouches[0]\n    } else {\n      e = evt as MouseEvent\n    }\n    const clientX = e.clientX || e.pageX + window.scrollX\n    const clientY = e.clientY || e.pageY + window.scrollY\n    const rect = this[_].canvas.getBoundingClientRect()\n    if (rect.right <= clientX) {\n      return null\n    }\n    if (rect.bottom <= clientY) {\n      return null\n    }\n    const x = clientX - rect.left + this[_].scroll.left\n    const y = clientY - rect.top + this[_].scroll.top\n    return { x, y }\n  }\n  public _getMouseRelativePoint(e: Event) {\n    const abstractPos = this._getMouseAbstractPoint(e)\n    if (abstractPos) {\n      return {\n        x: abstractPos.x - this[_].scroll.left,\n        y: abstractPos.y - this[_].scroll.top,\n      }\n    } else {\n      return null\n    }\n  }\n  public _getColsWidth(startCol: number, endCol: number) {\n    const defaultColPxWidth = _colWidthDefineToPxWidth.call(\n      this,\n      this.defaultColWidth\n    )\n    const colCount = endCol - startCol + 1\n    let w = defaultColPxWidth * colCount\n    this[_].colWidthsMap.each(\n      startCol,\n      endCol,\n      (width: number | string, col: number) => {\n        w +=\n          _adjustColWidth.call(\n            this,\n            col,\n            _colWidthDefineToPxWidth.call(this, width)\n          ) - defaultColPxWidth\n      }\n    )\n    for (let col = startCol; col <= endCol; col++) {\n      if (this[_].colWidthsMap.has(col)) {\n        continue\n      }\n      const adj = _adjustColWidth.call(this, col, defaultColPxWidth)\n      if (adj !== defaultColPxWidth) {\n        w += adj - defaultColPxWidth\n      }\n    }\n    return w\n  }\n  public _moveFocusCell(\n    col: number,\n    row: number,\n    shiftKey: boolean,\n    silence?: boolean\n  ) {\n    const offset = this.getOffsetInvalidateCells()\n\n    function extendRange(range: any) {\n      if (offset > 0) {\n        range.start.col -= offset\n        range.start.row -= offset\n        range.end.col += offset\n        range.end.row += offset\n      }\n      return range\n    }\n\n    const beforeRange = extendRange(this.selection.range)\n    const beforeRect = this.getCellRangeRect(beforeRange)\n\n    this.selection._setFocusCell(col, row, shiftKey)\n    if (!silence) {\n      this.makeVisibleCell(col, row)\n    }\n    this.setFocusCursor(col, row)\n    this._forceFocusCell()\n\n    const afterRange = extendRange(this.selection.range)\n    const afterRect = this.getCellRangeRect(afterRange)\n\n    if (afterRect.intersection(beforeRect)) {\n      const invalidateRect = Rect.max(afterRect, beforeRect)\n      this._invalidateRect(invalidateRect)\n    } else {\n      this._invalidateRect(beforeRect)\n      this._invalidateRect(afterRect)\n    }\n  }\n  public _forceFocusCell() {\n    this[_].focusControl.focus()\n  }\n  public _resetColWidthOffset(col: number) {\n    delete this[_].colWidthsOffset[col]\n  }\n  public _adjustColWidth(col: number, orgWidth: number) {\n    const offset = this[_].colWidthsOffset[col] || 0\n    const limits = _getColWidthLimits.call(this, col)\n    return Math.max(_applyColWidthLimits(limits, orgWidth), 0) + offset\n  }\n  public _getVisibleRect() {\n    const left = this[_].scroll.left\n    const top = this[_].scroll.top\n    const width = this[_].canvas.width\n    const height = this[_].canvas.height\n    return new Rect(left, top, width, height)\n  }\n  public _invalidateRect(drawRect: Rect) {\n    const ctx = this._getInitContext()\n    if (ctx) {\n      const visibleRect = this._getVisibleRect()\n      const rowCount = this[_].rowCount\n\n      const initRow = _getTargetRowAt.call(\n        this,\n        Math.max(visibleRect.top, drawRect.top)\n      ) || {\n        row: rowCount,\n        top: _getRowsHeight.call(this, 0, rowCount - 1),\n      }\n      const initCol = _getTargetColAt.call(\n        this,\n        Math.max(visibleRect.left, drawRect.left)\n      ) || {\n        col: this[_].colCount,\n        left: this._getColsWidth(0, this[_].colCount - 1),\n      }\n      const drawBottom = Math.min(visibleRect.bottom, drawRect.bottom)\n      const drawRight = Math.min(visibleRect.right, drawRect.right)\n\n      const initFrozenRow = _getTargetFrozenRowAt.call(\n        this,\n        Math.max(visibleRect.top, drawRect.top)\n      )\n      const initFrozenCol = _getTargetFrozenColAt.call(\n        this,\n        Math.max(visibleRect.left, drawRect.left)\n      )\n\n      const drawLayers = new DrawLayers()\n\n      const drawGridBorder = () => {\n        const isContent = this.borderMode === 'content-border'\n        const isGrid = this.borderMode === 'grid-border'\n        if (isGrid || isContent) {\n          let width = this[_].canvas.width\n          let height = this[_].canvas.height\n          if (isContent) {\n            let w =\n              this._getColsWidth(0, this[_].colCount - 1) - visibleRect.left\n            let h = _getRowsHeight.call(this, 0, rowCount - 1) - visibleRect.top\n            width = Math.min(this[_].canvas.width, w)\n            height = Math.min(this[_].canvas.height, h)\n          }\n          ctx.save()\n          try {\n            ctx.beginPath()\n            ctx.lineWidth = this.borderWidth || 0\n            ctx.strokeStyle = this.borderColor || 'transparent'\n            ctx.rect(\n              0 + ctx.lineWidth / 2,\n              0 + ctx.lineWidth / 2,\n              width - ctx.lineWidth,\n              height - ctx.lineWidth\n            )\n            ctx.stroke()\n          } finally {\n            ctx.restore()\n          }\n        }\n      }\n\n      const drawOuter = (row: number, absoluteTop: number) => {\n        // 在数据范围之外绘制\n        if (\n          row >= rowCount - 1 &&\n          this[_].canvas.height > absoluteTop - visibleRect.top\n        ) {\n          const outerTop = absoluteTop - visibleRect.top\n          if (this.underlayBackgroundColor === 'transparent') {\n            ctx.clearRect(\n              0,\n              outerTop,\n              this[_].canvas.width,\n              this[_].canvas.height - outerTop\n            )\n          } else {\n            ctx.save()\n            ctx.beginPath()\n            ctx.fillStyle = this.underlayBackgroundColor || '#F6F6F6'\n            ctx.rect(\n              0,\n              outerTop,\n              this[_].canvas.width,\n              this[_].canvas.height - outerTop\n            )\n            ctx.fill()\n            ctx.restore()\n          }\n        }\n      }\n\n      let skipAbsoluteTop = 0\n      if (initFrozenRow) {\n        let absoluteTop = initFrozenRow.top\n        const count = this[_].frozenRowCount\n        for (let row = initFrozenRow.row; row < count; row++) {\n          const height = _getRowHeight.call(this, row)\n          _drawRow.call(\n            this,\n            ctx,\n            initFrozenCol,\n            initCol,\n            drawRight,\n            row,\n            absoluteTop,\n            height,\n            visibleRect,\n            0,\n            drawLayers\n          )\n          absoluteTop += height\n          if (drawBottom <= absoluteTop) {\n            // 在绘制范围之外（结束）\n            drawOuter(row, absoluteTop)\n            drawGridBorder()\n            drawLayers.draw(ctx)\n            return\n          }\n        }\n        skipAbsoluteTop = absoluteTop\n      }\n\n      let rowAbsoluteTop = initRow.top\n      for (let row = initRow.row; row < rowCount; row++) {\n        const height = _getRowHeight.call(this, row)\n\n        // 绘制行\n        _drawRow.call(\n          this,\n          ctx,\n          initFrozenCol,\n          initCol,\n          drawRight,\n          row,\n          rowAbsoluteTop,\n          height,\n          visibleRect,\n          skipAbsoluteTop,\n          drawLayers\n        )\n\n        rowAbsoluteTop += height\n        if (drawBottom <= rowAbsoluteTop) {\n          // 在绘制范围之外（结束）\n          drawOuter(row, rowAbsoluteTop)\n          drawGridBorder()\n          drawLayers.draw(ctx)\n          return\n        }\n      }\n      drawOuter(rowCount - 1, rowAbsoluteTop)\n      drawGridBorder()\n\n      drawLayers.draw(ctx)\n    }\n  }\n  public _getInitContext() {\n    const ctx = this[_].context\n    if (ctx) {\n      // 初始化\n      ctx.fillStyle = 'white'\n      ctx.strokeStyle = 'black'\n      ctx.textAlign = 'left'\n      ctx.textBaseline = 'top'\n      ctx.lineWidth = 1\n      ctx.font = this.font || '16px sans-serif'\n    }\n    return ctx\n  }\n  public _toRelativeRect(absoluteRect: Rect) {\n    const rect = absoluteRect.copy()\n    const visibleRect = this._getVisibleRect()\n    rect.offsetLeft(-visibleRect.left)\n    rect.offsetTop(-visibleRect.top)\n\n    return rect\n  }\n  /**\n   * Overwrites the definition of a column whose width is set to `auto` with the current auto width formula.\n   * @param grid - grid instance\n   * @returns\n   */\n  public _storeAutoColWidthExprs() {\n    let expr = null\n    for (let col = 0; col < this[_].colCount; col++) {\n      const def = _getColWidthDefine.call(this, col)\n      if (isAutoDefine(def)) {\n        _setColWidth.call(\n          this,\n          col,\n          expr || (expr = _calcAutoColWidthExpr.call(this))\n        )\n      }\n    }\n  }\n  public resize() {\n    if (this.getElement().offsetParent) {\n      // 只在元素可见时刷新\n      this.updateSize()\n      this.updateScroll()\n      this.invalidate()\n    }\n  }\n  /**\n   * Get the value of cell with the copy action.\n   * <p>\n   * Please implement\n   * </p>\n   *\n   * @param col - Column index of cell.\n   * @param row - Row index of cell.\n   * @returns the value of cell\n   */\n  protected getCopyCellValue(\n    _col: number,\n    _row: number,\n    _range: CellRange\n  ): string | Promise<string> | void {\n    // Please implement get cell value!!\n  }\n  /**\n   * Draw a cell\n   * <p>\n   * Please implement cell drawing.\n   * </p>\n   *\n   * @param col - Column index of cell.\n   * @param row - Row index of cell.\n   * @param context - context of cell drawing.\n   * @returns\n   */\n  protected abstract onDrawCell(\n    col: number,\n    row: number,\n    context: CellContext\n  ): Promise<void> | void\n  protected bindEventsInternal() {\n    // nothing\n  }\n  protected getTargetRowAtInternal(\n    _absoluteY: number\n  ): { row: number; top: number } | void {\n    // 忽略继承的设置继承和实现的计算\n  }\n  protected getRowsHeightInternal(\n    _startRow: number,\n    _endRow: number\n  ): number | void {\n    // 忽略继承的设置继承和实现的计算\n  }\n  protected getRowHeightInternal(_row: number): number | void {\n    // 忽略继承的设置继承和实现的计算\n  }\n  protected getScrollHeightInternal(_row?: number): number | void {\n    // 忽略继承的设置继承和实现的计算\n  }\n  protected getMoveLeftColByKeyDownInternal({ col }: CellAddress): number {\n    return col - 1\n  }\n  protected getMoveRightColByKeyDownInternal({ col }: CellAddress): number {\n    return col + 1\n  }\n  protected getMoveUpRowByKeyDownInternal({ row }: CellAddress): number {\n    return row - 1\n  }\n  protected getMoveDownRowByKeyDownInternal({ row }: CellAddress): number {\n    return row + 1\n  }\n  protected getOffsetInvalidateCells(): number {\n    return 0\n  }\n  protected getCopyRangeInternal(range: CellRange): CellRange {\n    return range\n  }\n  protected getAttachCellsAreaInternal(range: CellRange) {\n    return this._toRelativeRect(this.getCellRangeRect(range))\n  }\n  protected getAttachCellsPaddingInternal(\n    _range: CellRange\n  ): [number, number, number, number] {\n    return [0, 3, 0, 3]\n  }\n  protected getFocusRectInternal(col: number, row: number) {\n    return this.getCellRect(col, row)\n  }\n  protected getDefaultRowHeight() {\n    return 40\n  }\n  protected getDefaultColWidth() {\n    return 80\n  }\n  protected getHighlightBorderWidth() {\n    return 2\n  }\n  protected updateSelectionRange(range: CellRange) {\n    return range\n  }\n  protected getCellOverflowTextInternal(_cell: CellAddress) {\n    return ''\n  }\n  protected getCellOverflowTypeInternal(_cell: CellAddress) {\n    return ''\n  }\n  protected getDefaultBorderMode() {\n    return 'none'\n  }\n  fireListeners<TYPE extends keyof DrawGridEventHandlersEventMap>(\n    type: TYPE,\n    ...event: DrawGridEventHandlersEventMap[TYPE]\n  ): DrawGridEventHandlersReturnMap[TYPE][] {\n    return super.fireListeners(type, ...event)\n  }\n  protected abstract getDefaultFont(): string\n  protected abstract getDefaultUnderlayBackgroundColor(): string\n  protected abstract getDefaultBorderColor(): string\n  protected abstract getDefaultBorderWidth(): number\n}\n","import { DrawGrid } from './core/DrawGrid'\nimport { DG_EVENT_TYPE, DrawGridEvents } from './core/draw-grid/DG_EVENT_TYPE'\n\n/**\n * core modules\n */\nexport const core = { DrawGrid, EVENT_TYPE: DG_EVENT_TYPE as DrawGridEvents }\n","import { DataSource, DataSourceParam } from './DataSource'\nimport {\n  FieldData,\n  FieldDef,\n  MaybePromise,\n  MaybePromiseOrUndef,\n} from '../ts-types'\nimport { PromiseCacheValue } from './internal/types'\n\nfunction _setFieldCache<T, F extends FieldDef<T>>(\n  fCache: { [index: number]: Map<FieldDef<T>, any> },\n  index: number,\n  field: F,\n  value: PromiseCacheValue<any>\n): void {\n  const recCache = fCache[index] || (fCache[index] = new Map())\n  recCache.set(field, value)\n}\n/**\n * grid data source for caching Promise data\n */\nexport class CachedDataSource<T> extends DataSource<T> {\n  private _rCache: { [index: number]: any }\n  private _fCache: { [index: number]: Map<FieldDef<T>, any> }\n  static get EVENT_TYPE(): typeof DataSource.EVENT_TYPE {\n    return DataSource.EVENT_TYPE\n  }\n  static ofArray<T>(array: T[]): CachedDataSource<T> {\n    return new CachedDataSource({\n      get: (index: number): T => array[index],\n      length: array.length,\n      source: array,\n    })\n  }\n  constructor(opt?: DataSourceParam<T>) {\n    super(opt)\n    this._rCache = {}\n    this._fCache = {}\n  }\n  protected getOriginal(index: number): MaybePromiseOrUndef<T> {\n    if (this._rCache && this._rCache[index]) {\n      return this._rCache[index]\n    }\n    return super.getOriginal(index)\n  }\n  protected getOriginalField<F extends FieldDef<T>>(\n    index: number,\n    field: F\n  ): FieldData {\n    const rowCache = this._fCache && this._fCache[index]\n    if (rowCache) {\n      const cache = rowCache.get(field)\n      if (cache) {\n        return cache\n      }\n    }\n    return super.getOriginalField(index, field)\n  }\n  protected setOriginalField<F extends FieldDef<T>>(\n    index: number,\n    field: F,\n    value: any\n  ): MaybePromise<boolean> {\n    const fCache = this._fCache\n    if (fCache && fCache[index]) {\n      delete fCache[index] // clear row cache\n    }\n    return super.setOriginalField(index, field, value)\n  }\n  public clearCache(): void {\n    if (this._rCache) {\n      this._rCache = {}\n    }\n    if (this._fCache) {\n      this._fCache = {}\n    }\n  }\n  protected fieldPromiseCallBackInternal<F extends FieldDef<T>>(\n    index: number,\n    field: F,\n    value: PromiseCacheValue<any>\n  ): void {\n    _setFieldCache(this._fCache, index, field, value)\n  }\n  protected recordPromiseCallBackInternal(\n    index: number,\n    record: PromiseCacheValue<T>\n  ): void {\n    this._rCache[index] = record\n  }\n  public dispose(): void {\n    super.dispose()\n  }\n}\n","import { MaybePromiseOrUndef } from '../../ts-types'\nimport { isPromise } from '../../internal/utils'\nimport { DataSource } from '../DataSource'\n\nexport class DataSourceIterator<T> {\n  private _dataSource: DataSource<T>\n  private _curIndex: number\n  private _data: MaybePromiseOrUndef<T>[]\n  public constructor(dataSource: DataSource<T>) {\n    this._dataSource = dataSource\n    this._curIndex = -1\n    this._data = []\n  }\n  public hasNext(): boolean {\n    const next = this._curIndex + 1\n    return this._dataSource.length > next\n  }\n  public next(): MaybePromiseOrUndef<T> {\n    const next = this._curIndex + 1\n    const data = this._getIndexData(next)\n    this._curIndex = next\n    return data\n  }\n  public movePrev(): void {\n    this._curIndex--\n  }\n  private _getIndexData(index: number, nest?: boolean): MaybePromiseOrUndef<T> {\n    const dataSource = this._dataSource\n    const data = this._data\n    if (index < data.length) {\n      return data[index]\n    }\n\n    if (dataSource.length <= index) {\n      return undefined\n    }\n    const record = this._dataSource.get(index)\n    data[index] = record\n    if (isPromise(record)) {\n      record.then((val) => {\n        data[index] = val\n      })\n      if (!nest) {\n        for (let i = 1; i <= 100; i++) {\n          this._getIndexData(index + i, true)\n        }\n      }\n    }\n    return record\n  }\n}\n","import { isPromise } from '../../internal/utils'\nimport { DataSource } from '../DataSource'\nimport { FilterDataSource } from '../FilterDataSource'\nimport { DataSourceIterator } from './DataSourceIterator'\nimport { MaybePromiseOrUndef } from '../../ts-types'\n\nexport type Filter<T> = (record: T | undefined) => boolean\n\nexport class FilterData<T> {\n  private _owner: FilterDataSource<T>\n  private _dataSourceItr: DataSourceIterator<T>\n  private _filter: Filter<T>\n  private _filteredList: (T | undefined)[]\n  private _queues: (Promise<T | undefined> | null)[]\n  private _cancel: boolean = false\n  public constructor(\n    dc: FilterDataSource<T>,\n    original: DataSource<T>,\n    filter: Filter<T>\n  ) {\n    this._owner = dc\n    this._dataSourceItr = new DataSourceIterator(original)\n    this._filter = filter\n    this._filteredList = []\n    this._queues = []\n  }\n  public get filter() {\n    return this._filter\n  }\n  public get(index: number): MaybePromiseOrUndef<T> {\n    if (this._cancel) {\n      return undefined\n    }\n    const filteredList = this._filteredList\n    if (index < filteredList.length) {\n      return filteredList[index]\n    }\n    const queues = this._queues\n    const indexQueue = queues[index]\n    if (indexQueue) {\n      return indexQueue\n    }\n    return queues[index] || this._findIndex(index)\n  }\n  public cancel(): void {\n    this._cancel = true\n  }\n  private _findIndex(index: number): MaybePromiseOrUndef<T> {\n    if (window.Promise) {\n      const timeout = Date.now() + 100\n      let count = 0\n      return this._findIndexWithTimeout(index, () => {\n        count++\n        if (count >= 100) {\n          count = 0\n          return timeout < Date.now()\n        }\n        return false\n      })\n    }\n    return this._findIndexWithTimeout(index, () => false)\n  }\n  private _findIndexWithTimeout(\n    index: number,\n    testTimeout: () => boolean\n  ): MaybePromiseOrUndef<T> {\n    const filteredList = this._filteredList\n    const filter = this._filter\n    const dataSourceItr = this._dataSourceItr\n\n    const queues = this._queues\n\n    while (dataSourceItr.hasNext()) {\n      if (this._cancel) {\n        return undefined\n      }\n      const record = dataSourceItr.next()\n      if (isPromise(record)) {\n        dataSourceItr.movePrev()\n        return (queues[index] = record.then((value: any) => {\n          queues[index] = null\n          return this.get(index)\n        }))\n      }\n      if (filter(record)) {\n        filteredList.push(record)\n        if (index < filteredList.length) {\n          return filteredList[index]\n        }\n      }\n      if (testTimeout()) {\n        const promise = new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(undefined)\n          }, 300)\n        })\n        const queue = promise.then(() => {\n          queues[index] = null\n          return this.get(index)\n        })\n        queues[index] = queue\n        return queue\n      }\n    }\n    const dc = this._owner\n    dc.length = filteredList.length\n    return undefined\n  }\n}\n","import { EventHandler } from '../internal/EventHandler'\nimport { DataSource } from './DataSource'\nimport { FilterData, Filter } from './filter/FilterData'\nimport { MaybePromiseOrUndef, FieldDef, MaybePromise } from '../ts-types'\n\n/**\n * grid data source for filter\n */\nexport class FilterDataSource<T> extends DataSource<T> {\n  private _dataSource: DataSource<T>\n  private _handler: EventHandler\n  private _filterData: FilterData<T> | null = null\n  public static get EVENT_TYPE(): typeof DataSource.EVENT_TYPE {\n    return DataSource.EVENT_TYPE\n  }\n  public constructor(dataSource: DataSource<T>, filter: Filter<T>) {\n    super(dataSource)\n    this._dataSource = dataSource\n    this.filter = filter\n    const handler = (this._handler = new EventHandler())\n    handler.on(dataSource, FilterDataSource.EVENT_TYPE.UPDATED_ORDER, () => {\n      // reset\n      this.filter = this.filter\n    })\n    for (const k in FilterDataSource.EVENT_TYPE) {\n      if (FilterDataSource.EVENT_TYPE.hasOwnProperty(k)) {\n        const type = (FilterDataSource.EVENT_TYPE as any)[k]\n        handler.on(dataSource as any, type, (...args) =>\n          this.fireListeners(type, ...args)\n        )\n      }\n    }\n  }\n  public get filter(): Filter<T> | null {\n    return this._filterData?.filter || null\n  }\n  public set filter(filter) {\n    if (this._filterData) {\n      this._filterData.cancel()\n    }\n    this._filterData = filter\n      ? new FilterData(this, this._dataSource, filter)\n      : null\n    this.setLength(this._dataSource.length)\n  }\n  protected getOriginal(index: number): MaybePromiseOrUndef<T> {\n    if (!this._filterData) {\n      return super.getOriginal(index)\n    }\n    return this._filterData.get(index)\n  }\n  public sort(field: FieldDef<T>, order: 'desc' | 'asc'): MaybePromise<void> {\n    return this._dataSource.sort(field, order)\n  }\n  get source(): any {\n    return this._dataSource.source\n  }\n  get dataSource(): DataSource<T> {\n    return this._dataSource\n  }\n  public dispose(): void {\n    this._handler.dispose()\n    super.dispose()\n  }\n  protected refreshInternal() {\n    this.filter = this.filter\n  }\n}\n","import { DataSource } from './DataSource'\n\nenum aggregateType {\n  count,\n  sum,\n  avg,\n  max,\n  min,\n}\n\ninterface IPivotBase {\n  field: string\n}\n\ninterface IPivotColumn extends IPivotBase {\n  aggregate: aggregateType\n}\n\ninterface IPivotRow extends IPivotBase {}\n\ninterface IPivotCol extends IPivotBase {}\n\ninterface IPivotDataSourceOptions {\n  rowPivots: IPivotRow[]\n  colPivots: IPivotCol[]\n  columns: IPivotColumn[]\n}\n\ninterface IPivotKeysMap<T> {\n  [rowKey: string]: {\n    [colKey: string]: T[]\n  }\n}\n\ninterface IPivotDistinctMap {\n  [field: string]: string[]\n}\n\ninterface IPivotDistinctKeysMap {\n  [field: string]: {\n    [value: string]: boolean\n  }\n}\n\nfunction _getPivotRecordKey<T>(\n  record: T,\n  pivots: IPivotBase[],\n  distinctKeys: IPivotDistinctKeysMap\n) {\n  const keys = []\n  for (const i of pivots) {\n    const field = i.field\n    const value = JSON.stringify((record as any)[i.field]) || ''\n    distinctKeys[field] = distinctKeys[field] || {}\n    distinctKeys[field][value] = true\n    keys.push(value)\n  }\n  return keys.join('_')\n}\n\n/**\n * grid data source for pivot\n */\nexport class PivotDataSource<T> extends DataSource<T> {\n  public static get EVENT_TYPE() {\n    return DataSource.EVENT_TYPE\n  }\n  private _dataSource: DataSource<T>\n  private _options: IPivotDataSourceOptions\n  private _records: T[] = []\n  private _keysMap: IPivotKeysMap<T> = {}\n  private _distinctMap: IPivotDistinctMap = {}\n  public constructor(\n    dataSource: DataSource<T>,\n    options: IPivotDataSourceOptions\n  ) {\n    super(dataSource)\n    this._dataSource = dataSource\n\n    this._options = options\n\n    this.refresh()\n  }\n  public get options() {\n    return this._options\n  }\n  protected getOriginal(index: number) {\n    return this._records[index]\n  }\n  public refresh() {\n    this._keysMap = {}\n    const distinctKeys: IPivotDistinctKeysMap = {}\n    const rowPivots = this._options.rowPivots || []\n    const colPivots = this._options.colPivots || []\n    const begin = new Date()\n    for (let i = 0; i < this._dataSource.length; i++) {\n      const record = this._dataSource.get(i)\n      const rowKey = _getPivotRecordKey(record, rowPivots, distinctKeys)\n      const colKey = _getPivotRecordKey(record, colPivots, distinctKeys)\n      this._keysMap[rowKey] = this._keysMap[rowKey] || {}\n      this._keysMap[rowKey][colKey] = this._keysMap[rowKey][colKey] || []\n      this._keysMap[rowKey][colKey].push(record as any)\n    }\n    this._distinctMap = {}\n    for (const field in distinctKeys) {\n      if (distinctKeys.hasOwnProperty(field)) {\n        this._distinctMap[field] = []\n        const keys = distinctKeys[field]\n        for (const key in keys) {\n          if (keys.hasOwnProperty(key)) {\n            this._distinctMap[field].push(key)\n          }\n        }\n      }\n    }\n    const end = new Date()\n    const s = Number(end) - Number(begin)\n    // TODO: data.ts PivotDataSource.ts\n    window.console.log(s)\n    this._records = [] // 显示记录列表\n    this.length = this._records.length\n  }\n}\n","import { CachedDataSource } from './data/CachedDataSource'\nimport { DataSource } from './data/DataSource'\nimport { FilterDataSource } from './data/FilterDataSource'\nimport { PivotDataSource } from './data/PivotDataSource'\nimport { TreeDataSource } from './data/TreeDataSource'\n\n/**\n * data modules\n */\nexport const data = {\n  CachedDataSource,\n  DataSource,\n  FilterDataSource,\n  PivotDataSource,\n  TreeDataSource,\n}\n","import {\n  ListGridAPI,\n  EventListenerId,\n  BaseHeaderActionOption,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\n\nexport interface IBaseHeaderActionOptions<T> {\n  disabled?: boolean | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean)\n}\n\nexport class BaseAction<T> {\n  protected _disabled:\n    | boolean\n    | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean)\n  public constructor(option: BaseHeaderActionOption<T> = {}) {\n    this._disabled = option.disabled || false\n  }\n  public get disabled():\n    | boolean\n    | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean) {\n    return this._disabled\n  }\n  public set disabled(disabled) {\n    if (this._disabled !== disabled) {\n      this._disabled = disabled\n      this.onChangeDisabledInternal()\n    }\n  }\n  public clone(): BaseAction<T> {\n    return new BaseAction(this)\n  }\n  public bindGridEvent(\n    _grid: ListGridAPI<T>,\n    _cellId: LayoutObjectId\n  ): EventListenerId[] {\n    return []\n  }\n  public onChangeDisabledInternal(): void {\n    // nothing\n  }\n}\n","import {\n  ListGridAPI,\n  CellAddress,\n  LayoutObjectId,\n  EventListenerId,\n} from '../../ts-types'\nimport { DG_EVENT_TYPE } from '../../core/draw-grid/DG_EVENT_TYPE'\nimport { event } from '../../internal/utils'\nimport { KEY_ENTER, KEY_SPACE } from '../../core/draw-grid/KEY_CODE'\n\nexport function bindCellClickAction<T>(\n  grid: ListGridAPI<T>,\n  cellId: LayoutObjectId,\n  {\n    action,\n    mouseOver,\n    mouseOut,\n  }: {\n    action: (cell: CellAddress) => void\n    mouseOver?: (cell: CellAddress) => boolean\n    mouseOut?: (cell: CellAddress) => void\n  }\n): EventListenerId[] {\n  function isTarget(col: number, row: number): boolean {\n    return grid.getLayoutCellId(col, row) === cellId\n  }\n  let inMouse: boolean\n  return [\n    // click\n    grid.listen(DG_EVENT_TYPE.CLICK_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      action({\n        col: e.col,\n        row: e.row,\n      })\n    }),\n    // mouse move\n    grid.listen(DG_EVENT_TYPE.MOUSEOVER_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (mouseOver) {\n        if (\n          !mouseOver({\n            col: e.col,\n            row: e.row,\n          })\n        ) {\n          return\n        }\n      }\n      grid.getElement().style.cursor = 'pointer'\n      inMouse = true\n    }),\n    // 当MOUSEENTER从侧面看，因为它与'col-resize'的处理冲突，移动被监视和处理\n    grid.listen(DG_EVENT_TYPE.MOUSEMOVE_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (inMouse && !grid.getElement().style.cursor) {\n        grid.getElement().style.cursor = 'pointer'\n      }\n    }),\n    grid.listen(DG_EVENT_TYPE.MOUSEOUT_CELL, (e) => {\n      if (!isTarget(e.col, e.row)) {\n        return\n      }\n      if (mouseOut) {\n        mouseOut({\n          col: e.col,\n          row: e.row,\n        })\n      }\n      grid.getElement().style.cursor = ''\n      inMouse = false\n    }),\n  ]\n}\nexport function bindCellKeyAction<T>(\n  grid: ListGridAPI<T>,\n  cellId: LayoutObjectId,\n  {\n    action,\n    acceptKeys = [],\n  }: {\n    action: (option: CellAddress) => void\n    acceptKeys?: number[]\n  }\n) {\n  acceptKeys = [...acceptKeys, KEY_ENTER, KEY_SPACE]\n  function isTarget(col: number, row: number): boolean {\n    return grid.getLayoutCellId(col, row) === cellId\n  }\n  return [\n    // enter key down\n    grid.listen(DG_EVENT_TYPE.KEYDOWN, (e) => {\n      if (acceptKeys.indexOf(e.keyCode) === -1) {\n        return\n      }\n      if (grid.keyboardOptions?.moveCellOnEnter && e.keyCode === KEY_ENTER) {\n        // When moving with the enter key, no action is taken with the enter key.\n        return\n      }\n      const sel = grid.selection.select\n      if (!isTarget(sel.col, sel.row)) {\n        return\n      }\n      action({\n        col: sel.col,\n        row: sel.row,\n      })\n      event.cancel(e.event)\n    }),\n  ]\n}\n","import { ListGridAPI, CellAddress } from '../../ts-types'\n\nexport const isHeaderDisabledCell = <T>(\n  option: boolean | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean),\n  grid: ListGridAPI<T>,\n  cell: CellAddress\n) => {\n  if (typeof option === 'function') {\n    return !!option(grid, cell)\n  }\n  return !!option\n}\n","import { CellAddress, EventListenerId, LayoutObjectId } from '../../ts-types'\nimport { GridInternal, CheckHeaderState } from '../../ts-types-internal'\nimport { bindCellClickAction, bindCellKeyAction } from './actionBind'\nimport { BaseAction } from './BaseAction'\nimport { animate } from '../../internal/animate'\nimport { isHeaderDisabledCell } from './action-utils'\nimport { KEY_ENTER, KEY_SPACE } from '../../core/draw-grid/KEY_CODE'\n\nexport abstract class BaseCheckAction<T> extends BaseAction<T> {\n  public bindGridEvent(\n    grid: GridInternal<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    const state = this.getState(grid)\n\n    const action = ({ col, row }: CellAddress) => {\n      const range = grid.getCellRange(col, row)\n      const cellKey = `${range.start.col}:${range.start.row}`\n      if (\n        isHeaderDisabledCell(this.disabled, grid, {\n          col: range.start.col,\n          row: range.start.row,\n        }) ||\n        state.block[cellKey]\n      ) {\n        return\n      }\n      const checked = grid.getHeaderValue(range.start.col, range.start.row)\n      grid.setHeaderValue(range.start.col, range.start.row, !checked)\n\n      const onChange = () => {\n        // checkbox animation\n        animate(200, (point) => {\n          if (point === 1) {\n            delete state.elapsed[cellKey]\n          } else {\n            state.elapsed[cellKey] = point\n          }\n          grid.invalidateCellRange(range)\n        })\n      }\n      onChange()\n    }\n    return [\n      ...bindCellClickAction(grid, cellId, {\n        action,\n        mouseOver: (e) => {\n          const range = grid.getCellRange(e.col, e.row)\n          if (\n            isHeaderDisabledCell(this.disabled, grid, {\n              col: range.start.col,\n              row: range.start.row,\n            })\n          ) {\n            return false\n          }\n          state.mouseActiveCell = {\n            col: e.col,\n            row: e.row,\n          }\n          grid.invalidateCellRange(range)\n          return true\n        },\n        mouseOut: (e) => {\n          delete state.mouseActiveCell\n          const range = grid.getCellRange(e.col, e.row)\n          grid.invalidateCellRange(range)\n        },\n      }),\n      ...bindCellKeyAction(grid, cellId, {\n        action,\n        acceptKeys: [KEY_ENTER, KEY_SPACE],\n      }),\n    ]\n  }\n  protected abstract getState(grid: GridInternal<T>): CheckHeaderState\n}\n","import { CheckHeaderState, GridInternal } from '../../ts-types-internal'\nimport { obj } from '../../internal/utils'\nimport { BaseCheckAction } from './BaseCheckAction'\nimport { getCheckHeaderStateId } from '../../internal/symbolManager'\n\nconst CHECK_HEADER_STATE_ID = getCheckHeaderStateId()\n\nexport class CheckHeaderAction<T> extends BaseCheckAction<T> {\n  public clone(): CheckHeaderAction<T> {\n    return new CheckHeaderAction(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[CHECK_HEADER_STATE_ID]\n    if (!state) {\n      state = { elapsed: {}, block: {} }\n      obj.setReadonly(grid, CHECK_HEADER_STATE_ID, state)\n    }\n    return state\n  }\n}\n","import { GridInternal, CheckHeaderState } from '../../ts-types-internal'\nimport { obj } from '../../internal/utils'\nimport { BaseCheckAction } from './BaseCheckAction'\nimport { getSwitchHeaderStateId } from '../../internal/symbolManager'\n\nconst SWITCH_HEADER_STATE_ID = getSwitchHeaderStateId()\n\nexport class SwitchHeaderAction<T> extends BaseCheckAction<T> {\n  public clone(): SwitchHeaderAction<T> {\n    return new SwitchHeaderAction(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[SWITCH_HEADER_STATE_ID]\n    if (!state) {\n      state = { elapsed: {}, block: {} }\n      obj.setReadonly(grid, SWITCH_HEADER_STATE_ID, state)\n    }\n    return state\n  }\n}\n","import {\n  SortState,\n  SortOption,\n  SortHeaderActionOption,\n  ListGridAPI,\n  EventListenerId,\n  CellAddress,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { isHeaderDisabledCell } from './action-utils'\nimport { bindCellClickAction } from './actionBind'\nimport { BaseAction } from './BaseAction'\n\nexport class SortHeaderAction<T> extends BaseAction<T> {\n  private _sort: SortOption<T>\n  public constructor(option: SortHeaderActionOption<T> = {}) {\n    super(option)\n    this._sort = option.sort ?? true\n  }\n  public get sort(): SortOption<T> {\n    return this._sort\n  }\n  public set sort(sort) {\n    this._sort = sort\n    this.onChangeDisabledInternal()\n  }\n  public clone(): SortHeaderAction<T> {\n    return new SortHeaderAction(this)\n  }\n  private _executeSort(newState: SortState, grid: ListGridAPI<T>): void {\n    if (typeof this._sort === 'function') {\n      this._sort({\n        order: newState.order || 'asc',\n        col: newState.col,\n        row: newState.row,\n        grid,\n      })\n    } else {\n      const fieldRow =\n        Math.min(grid.recordRowCount - 1, newState.row) + grid.frozenRowCount\n      const field = grid.getField(newState.col, fieldRow)\n      if (field == null) {\n        return\n      }\n      grid.dataSource.sort(field, newState.order || 'asc')\n    }\n  }\n  public bindGridEvent(\n    grid: ListGridAPI<T>,\n    cellId: LayoutObjectId\n  ): EventListenerId[] {\n    function isTarget(col: number, row: number): boolean {\n      return grid.getLayoutCellId(col, row) === cellId\n    }\n    const action = (cell: CellAddress): void => {\n      if (isHeaderDisabledCell(this.disabled, grid, cell)) {\n        return\n      }\n      const state = grid.sortState as SortState\n      let newState: SortState\n      const range = grid.getCellRange(cell.col, cell.row)\n      if (isTarget(state.col, cell.row)) {\n        newState = {\n          col: range.start.col,\n          order: state.order === 'asc' ? 'desc' : 'asc',\n          row: range.start.row,\n        }\n      } else {\n        newState = {\n          col: range.start.col,\n          order: 'asc',\n          row: range.start.row,\n        }\n      }\n      grid.sortState = newState\n      this._executeSort(newState, grid)\n      grid.invalidateGridRect(0, 0, grid.colCount - 1, grid.rowCount - 1)\n    }\n\n    return [\n      ...bindCellClickAction(grid, cellId, {\n        action,\n        mouseOver: (e) => {\n          if (isHeaderDisabledCell(this.disabled, grid, e)) {\n            return false\n          }\n          return true\n        },\n      }),\n    ]\n  }\n}\n","import { ListGridAPI, CellAddress } from '../../ts-types'\nimport { SortHeaderAction } from '../action/SortHeaderAction'\n\nexport class ImmutableSortHeaderAction<T> extends SortHeaderAction<T> {\n  public get disabled():\n    | boolean\n    | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean) {\n    return this._disabled\n  }\n}\n","import { HeaderActionOption, SortOption } from '../ts-types'\nimport { BaseAction } from './action/BaseAction'\nimport { BaseCheckAction } from './action/BaseCheckAction'\nimport { CheckHeaderAction } from './action/CheckHeaderAction'\nimport { SwitchHeaderAction } from './action/SwitchHeaderAction'\nimport { SortHeaderAction } from './action/SortHeaderAction'\nimport { ImmutableCheckHeaderAction } from './immutable/ImmutableCheckHeaderAction'\nimport { ImmutableSortHeaderAction } from './immutable/ImmutableSortHeaderAction'\nimport { ImmutableSwitchHeaderAction } from './immutable/ImmutableSwitchHeaderAction'\nimport { BaseHeaderDefine } from '../list-grid/layout-map/api'\n\nexport interface ImmutableHeaderActions {\n  SORT: ImmutableSortHeaderAction<any>\n  CHECK: ImmutableCheckHeaderAction<any>\n  SWITCH: ImmutableSwitchHeaderAction<any>\n}\n\nexport const ACTIONS: ImmutableHeaderActions = {\n  SORT: new ImmutableSortHeaderAction<any>(),\n  CHECK: new ImmutableCheckHeaderAction<any>(),\n  SWITCH: new ImmutableSwitchHeaderAction<any>(),\n}\n\nexport {\n  BaseAction,\n  BaseCheckAction,\n  SortHeaderAction,\n  CheckHeaderAction,\n  SwitchHeaderAction,\n}\n\nexport function of<T>(\n  headerAction: HeaderActionOption | BaseAction<T> | null | undefined\n): BaseAction<T> | undefined {\n  if (!headerAction) {\n    return undefined\n  } else if (typeof headerAction === 'string') {\n    const key = headerAction.toUpperCase() as keyof typeof ACTIONS\n    return ACTIONS[key] || of(null)\n  } else {\n    return headerAction\n  }\n}\n\nexport function ofCell<T>(\n  headerCell: BaseHeaderDefine<T>\n): BaseAction<T> | undefined {\n  if (headerCell.sort) {\n    if (typeof headerCell.sort === 'function') {\n      const sortMethod = headerCell.sort\n      // 0.9.0 Backward compatibility\n      const sort: SortOption<T> = ({ order, col, grid }): void =>\n        sortMethod.call(headerCell, order, col, grid)\n      return new ImmutableSortHeaderAction({ sort } as any)\n    }\n    return ACTIONS.SORT\n  }\n  return of(headerCell.headerAction)\n}\n","import { ListGridAPI, CellAddress } from '../../ts-types'\nimport { CheckHeaderAction } from '../action/CheckHeaderAction'\n\nexport class ImmutableCheckHeaderAction<T> extends CheckHeaderAction<T> {\n  public get disabled():\n    | boolean\n    | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean) {\n    return this._disabled\n  }\n}\n","import { ListGridAPI, CellAddress } from '../../ts-types'\nimport { SwitchHeaderAction } from '../action/SwitchHeaderAction'\n\nexport class ImmutableSwitchHeaderAction<T> extends SwitchHeaderAction<T> {\n  public get disabled():\n    | boolean\n    | ((grid: ListGridAPI<T>, cell: CellAddress) => boolean) {\n    return this._disabled\n  }\n}\n","import { BaseStyleOption, ColorDef, ColumnStyle } from '../../ts-types'\nimport { EventTarget } from '../../core/EventTarget'\n\nconst HEADER_BASE_STYLE_EVENT_TYPE = {\n  CHANGE_STYLE: 'change_style',\n}\n\nlet defaultHeaderBaseStyle: BaseStyle\n\nexport class BaseStyle extends EventTarget implements ColumnStyle {\n  public static get EVENT_TYPE(): { CHANGE_STYLE: string } {\n    return HEADER_BASE_STYLE_EVENT_TYPE\n  }\n  public static get DEFAULT(): BaseStyle {\n    return defaultHeaderBaseStyle\n      ? defaultHeaderBaseStyle\n      : (defaultHeaderBaseStyle = new BaseStyle())\n  }\n  private _bgColor?: ColorDef\n  public constructor({ bgColor }: BaseStyleOption = {}) {\n    super()\n    this._bgColor = bgColor\n  }\n  public get bgColor(): ColorDef | undefined {\n    return this._bgColor\n  }\n  public set bgColor(bgColor) {\n    this._bgColor = bgColor\n    this.doChangeStyle()\n  }\n  public doChangeStyle(): void {\n    this.fireListeners(HEADER_BASE_STYLE_EVENT_TYPE.CHANGE_STYLE)\n  }\n  public clone(): BaseStyle {\n    return new BaseStyle(this)\n  }\n}\n","import { BaseStyle } from './BaseStyle'\nimport { BaseStdStyleOption } from '../../ts-types'\n\nlet defaultHeaderBaseStdStyle: BaseStdStyle\n\nexport class BaseStdStyle extends BaseStyle {\n  public static get DEFAULT(): BaseStdStyle {\n    return defaultHeaderBaseStdStyle\n      ? defaultHeaderBaseStdStyle\n      : (defaultHeaderBaseStdStyle = new BaseStdStyle())\n  }\n  private _textAlign: CanvasTextAlign\n  private _textBaseline: CanvasTextBaseline\n  public constructor(style: BaseStdStyleOption = {}) {\n    super(style)\n    this._textAlign = style.textAlign || 'left'\n    this._textBaseline = style.textBaseline || 'middle'\n  }\n  public get textAlign(): CanvasTextAlign {\n    return this._textAlign\n  }\n  public set textAlign(textAlign) {\n    this._textAlign = textAlign\n    this.doChangeStyle()\n  }\n  public get textBaseline(): CanvasTextBaseline {\n    return this._textBaseline\n  }\n  public set textBaseline(textBaseline) {\n    this._textBaseline = textBaseline\n    this.doChangeStyle()\n  }\n  public clone(): BaseStdStyle {\n    return new BaseStdStyle(this)\n  }\n}\n","import { BaseStdStyle } from './BaseStdStyle'\nimport {\n  ColorDef,\n  HeaderStdStyleOption,\n  TextOverflow,\n  LineClamp,\n} from '../../ts-types'\n\nlet defaultHeaderStyle: Style\n\nexport class Style extends BaseStdStyle {\n  public static get DEFAULT(): Style {\n    return defaultHeaderStyle\n      ? defaultHeaderStyle\n      : (defaultHeaderStyle = new Style())\n  }\n  private _color?: ColorDef\n  private _font?: string\n  private _padding?: number | string | (number | string)[]\n  private _textOverflow: TextOverflow\n  private _lineHeight: string | number\n  private _autoWrapText: boolean\n  private _lineClamp: LineClamp\n  public constructor(style: HeaderStdStyleOption = {}) {\n    super(style)\n    this._color = style.color\n    this._font = style.font\n    this._padding = style.padding\n    this._textOverflow = style.textOverflow || 'ellipsis'\n    this._lineHeight = style.lineHeight || '1em'\n    this._autoWrapText = style.autoWrapText || false\n    this._lineClamp = style.lineClamp || 'auto'\n  }\n  public get color(): ColorDef | undefined {\n    return this._color\n  }\n  public set color(color) {\n    this._color = color\n    this.doChangeStyle()\n  }\n  public get font(): string | undefined {\n    return this._font\n  }\n  public set font(font) {\n    this._font = font\n    this.doChangeStyle()\n  }\n  public get padding(): number | string | (number | string)[] | undefined {\n    return this._padding\n  }\n  public set padding(padding) {\n    this._padding = padding\n    this.doChangeStyle()\n  }\n  public get textOverflow(): TextOverflow {\n    return this._textOverflow\n  }\n  public set textOverflow(textOverflow) {\n    this._textOverflow = textOverflow\n    this.doChangeStyle()\n  }\n  public get lineHeight(): string | number {\n    return this._lineHeight\n  }\n  public set lineHeight(lineHeight) {\n    this._lineHeight = lineHeight\n    this.doChangeStyle()\n  }\n  public get lineClamp(): LineClamp {\n    return this._lineClamp\n  }\n  public set lineClamp(lineClamp) {\n    this._lineClamp = lineClamp\n    this.doChangeStyle()\n  }\n  public get autoWrapText(): boolean {\n    return this._autoWrapText\n  }\n  public set autoWrapText(autoWrapText) {\n    this._autoWrapText = autoWrapText\n    this.doChangeStyle()\n  }\n  public clone(): Style {\n    return new Style(this)\n  }\n}\n","import { Style } from './Style'\nimport { ColorDef, HeaderCheckStyleOption } from '../../ts-types'\nimport { defaults } from '../../internal/utils'\n\nlet defaultHeaderBaseCheckStyle: BaseCheckStyle\nexport class BaseCheckStyle extends Style {\n  public static get DEFAULT(): BaseCheckStyle {\n    return defaultHeaderBaseCheckStyle\n      ? defaultHeaderBaseCheckStyle\n      : (defaultHeaderBaseCheckStyle = new BaseCheckStyle())\n  }\n  private _uncheckBgColor?: ColorDef\n  private _checkBgColor?: ColorDef\n  private _borderColor?: ColorDef\n  public constructor(style: HeaderCheckStyleOption = {}) {\n    super(defaults(style, { textAlign: 'center' }))\n    this._uncheckBgColor = style.uncheckBgColor\n    this._checkBgColor = style.checkBgColor\n    this._borderColor = style.borderColor\n  }\n  public get uncheckBgColor(): ColorDef | undefined {\n    return this._uncheckBgColor\n  }\n  public set uncheckBgColor(uncheckBgColor) {\n    this._uncheckBgColor = uncheckBgColor\n    this.doChangeStyle()\n  }\n  public get checkBgColor(): ColorDef | undefined {\n    return this._checkBgColor\n  }\n  public set checkBgColor(checkBgColor) {\n    this._checkBgColor = checkBgColor\n    this.doChangeStyle()\n  }\n  public get borderColor(): ColorDef | undefined {\n    return this._borderColor\n  }\n  public set borderColor(borderColor) {\n    this._borderColor = borderColor\n    this.doChangeStyle()\n  }\n  public clone(): BaseCheckStyle {\n    return new BaseCheckStyle(this)\n  }\n}\n","import { BaseCheckStyle } from './BaseCheckStyle'\nimport { CheckHeaderStyleOption } from '../../ts-types'\n\nlet defaultCheckHeaderStyle: CheckHeaderStyle\nexport class CheckHeaderStyle extends BaseCheckStyle {\n  public static get DEFAULT(): CheckHeaderStyle {\n    return defaultCheckHeaderStyle\n      ? defaultCheckHeaderStyle\n      : (defaultCheckHeaderStyle = new CheckHeaderStyle())\n  }\n  public constructor(style: CheckHeaderStyleOption = {}) {\n    super(style)\n  }\n  public clone(): CheckHeaderStyle {\n    return new CheckHeaderStyle(this)\n  }\n}\n","import { Style } from './Style'\nimport { SortHeaderStyleOption, ColorDef } from '../../ts-types'\n\nlet defaultSortHeaderStyle: SortHeaderStyle\nexport class SortHeaderStyle extends Style {\n  public static get DEFAULT(): SortHeaderStyle {\n    return defaultSortHeaderStyle\n      ? defaultSortHeaderStyle\n      : (defaultSortHeaderStyle = new SortHeaderStyle())\n  }\n  private _sortArrowColor?: ColorDef\n  public constructor(style: SortHeaderStyleOption = {}) {\n    super(style)\n    this._sortArrowColor = style.sortArrowColor\n  }\n  public get sortArrowColor(): ColorDef | undefined {\n    return this._sortArrowColor\n  }\n  public set sortArrowColor(sortArrowColor) {\n    this._sortArrowColor = sortArrowColor\n    this.doChangeStyle()\n  }\n  public clone(): SortHeaderStyle {\n    return new SortHeaderStyle(this)\n  }\n}\n","import { BaseCheckStyle } from './BaseCheckStyle'\nimport { SwitchHeaderStyleOption } from '../../ts-types'\n\nlet defaultSwitchHeaderStyle: SwitchHeaderStyle\nexport class SwitchHeaderStyle extends BaseCheckStyle {\n  public static get DEFAULT(): SwitchHeaderStyle {\n    return defaultSwitchHeaderStyle\n      ? defaultSwitchHeaderStyle\n      : (defaultSwitchHeaderStyle = new SwitchHeaderStyle())\n  }\n  public constructor(style: SwitchHeaderStyleOption = {}) {\n    super(style)\n  }\n  public clone(): SwitchHeaderStyle {\n    return new SwitchHeaderStyle(this)\n  }\n}\n","import { MultilineTextHeaderStyleOption } from '../../ts-types'\nimport { Style } from './Style'\n\nlet defaultMultilineTextStyle: MultilineTextHeaderStyle\nexport class MultilineTextHeaderStyle extends Style {\n  static get DEFAULT(): MultilineTextHeaderStyle {\n    return defaultMultilineTextStyle\n      ? defaultMultilineTextStyle\n      : (defaultMultilineTextStyle = new MultilineTextHeaderStyle())\n  }\n  constructor(style: MultilineTextHeaderStyleOption = {}) {\n    super(style)\n  }\n  public clone(): MultilineTextHeaderStyle {\n    return new MultilineTextHeaderStyle(this)\n  }\n}\n","import { HeaderStyleOption } from '../ts-types'\nimport { BaseStyle } from './style/BaseStyle'\nimport { BaseStdStyle } from './style/BaseStdStyle'\nimport { BaseCheckStyle } from './style/BaseCheckStyle'\nimport { CheckHeaderStyle } from './style/CheckHeaderStyle'\nimport { SortHeaderStyle } from './style/SortHeaderStyle'\nimport { SwitchHeaderStyle } from './style/SwitchHeaderStyle'\nimport { MultilineTextHeaderStyle } from './style/MultilineTextHeaderStyle'\nimport { Style } from './style/Style'\n\nexport {\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style,\n  SortHeaderStyle,\n  CheckHeaderStyle,\n  SwitchHeaderStyle,\n  MultilineTextHeaderStyle,\n}\n\nexport function of<T>(\n  headerStyle: HeaderStyleOption | null | undefined,\n  headerValues: T,\n  StyleClass: typeof BaseStyle\n): BaseStyle {\n  if (headerStyle) {\n    if (headerStyle instanceof BaseStyle) {\n      return headerStyle\n    } else if (typeof headerStyle === 'function') {\n      return of((headerStyle as any)(headerValues), headerValues, StyleClass)\n    } else if (typeof headerStyle === 'string') {\n      if (headerValues && headerStyle in headerValues) {\n        return of((headerValues as any)[headerStyle], headerValues, StyleClass)\n      } else {\n        return new StyleClass({})\n      }\n    } else {\n      return new StyleClass(headerStyle)\n    }\n  } else {\n    return StyleClass.DEFAULT\n  }\n}\n","import * as styleContents from '../style'\nimport {\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  CellContext,\n  HeaderStyleOption,\n  EventListenerId,\n  LayoutObjectId,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { BaseStyle } from '../style/BaseStyle'\nimport { isDef } from '../../internal/utils'\n\nexport abstract class BaseHeader<T> {\n  public constructor(_options = {}) {\n    this.onDrawCell = this.onDrawCell.bind(this) // 修复范围\n  }\n  public get StyleClass(): typeof BaseStyle {\n    return BaseStyle\n  }\n  public onDrawCell(\n    cellValue: unknown,\n    info: DrawCellInfo<T>,\n    context: CellContext,\n    grid: ListGridAPI<T>\n  ) {\n    const { style, drawCellBase } = info\n    const helper = grid.getGridCanvasHelper()\n    drawCellBase()\n    // 文字\n    this.drawInternal(\n      this.convertInternal(cellValue),\n      context,\n      styleContents.of(\n        style as HeaderStyleOption,\n        grid.headerValues,\n        this.StyleClass\n      ),\n      helper,\n      grid,\n      info\n    )\n  }\n  public convertInternal(value: unknown): string {\n    if (typeof value === 'function') {\n      value = value()\n    }\n    return isDef(value) ? `${value}` : ''\n  }\n  public abstract drawInternal(\n    value: string,\n    context: CellContext,\n    style: BaseStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void\n  public bindGridEvent(\n    _grid: ListGridAPI<T>,\n    _cellId: LayoutObjectId\n  ): EventListenerId[] {\n    return []\n  }\n}\n","import {\n  GridCanvasHelperAPI,\n  CellContext,\n  InlineAPI,\n  InlineCheckOption,\n} from '../../ts-types'\nimport {\n  GridInternal,\n  DrawCellInfo,\n  CheckHeaderState,\n} from '../../ts-types-internal'\nimport { isDef } from '../../internal/utils'\nimport { BaseHeader } from './BaseHeader'\nimport { BaseCheckStyle } from '../style/BaseCheckStyle'\n\nexport abstract class BaseCheckHeader<T> extends BaseHeader<T> {\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: BaseCheckStyle,\n    helper: GridCanvasHelperAPI,\n    grid: GridInternal<T>,\n    { drawCellBase }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      borderColor,\n      checkBgColor,\n      uncheckBgColor,\n      bgColor,\n      color,\n      font,\n      textOverflow,\n    } = style\n\n    if (bgColor) {\n      drawCellBase({\n        bgColor,\n      })\n    }\n\n    const { col, row } = context\n    const range = grid.getCellRange(col, row)\n    const cellKey = `${range.start.col}:${range.start.row}`\n    const state = this.getState(grid)\n    const elapsed = state?.elapsed[cellKey]\n\n    const checked = grid.getHeaderValue(range.start.col, range.start.row)\n\n    const opt: InlineCheckOption = {\n      textAlign,\n      textBaseline,\n      borderColor,\n      checkBgColor,\n      uncheckBgColor,\n    }\n    if (isDef(elapsed)) {\n      opt.animElapsedTime = elapsed\n    }\n    const inlineCheck = this.getInlineCheck(helper, !!checked, context, opt)\n\n    helper.text([inlineCheck, value], context, {\n      color,\n      font,\n      textAlign,\n      textBaseline,\n      textOverflow,\n    })\n  }\n  protected abstract getState(grid: GridInternal<T>): CheckHeaderState\n  protected abstract getInlineCheck(\n    helper: GridCanvasHelperAPI,\n    checked: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): InlineAPI\n}\n","import {\n  GridCanvasHelperAPI,\n  CellContext,\n  InlineAPI,\n  InlineCheckOption,\n} from '../../ts-types'\nimport { CheckHeaderState, GridInternal } from '../../ts-types-internal'\nimport { CheckHeaderStyle } from '../style/CheckHeaderStyle'\nimport { BaseCheckHeader } from './BaseCheckHeader'\nimport { getCheckHeaderStateId } from '../../internal/symbolManager'\nimport { obj } from '../../internal/utils'\n\nconst CHECK_HEADER_STATE_ID = getCheckHeaderStateId()\n\nexport class CheckHeader<T> extends BaseCheckHeader<T> {\n  public get StyleClass(): typeof CheckHeaderStyle {\n    return CheckHeaderStyle\n  }\n  public clone(): CheckHeader<T> {\n    return new CheckHeader(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[CHECK_HEADER_STATE_ID]\n    if (!state) {\n      state = { elapsed: {}, block: {} }\n      obj.setReadonly(grid, CHECK_HEADER_STATE_ID, state)\n    }\n    return state\n  }\n  protected getInlineCheck(\n    helper: GridCanvasHelperAPI,\n    checked: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): InlineAPI {\n    return helper.buildCheckBoxInline(checked, context, opt)\n  }\n}\n","import { icons } from '../../internal/icons'\nimport { CellContext, GridCanvasHelperAPI } from '../../ts-types'\n\nexport default {\n  loadIcons<T>(\n    icon: any,\n    context: CellContext,\n    helper: GridCanvasHelperAPI,\n    callback: (icon: any, context: CellContext) => void\n  ) {\n    if (icon) {\n      const iconList = icons.toNormarizeArray(icon)\n      iconList.forEach((i: any) => {\n        helper.testFontLoad(i.font, i.content, context)\n      })\n      icon = iconList\n    }\n    callback(icon, context)\n  },\n}\n","import { CellContext, GridCanvasHelperAPI, ListGridAPI } from '../../ts-types'\nimport { isDef } from '../../internal/utils'\nimport { BaseHeader } from './BaseHeader'\nimport headerUtils from './headerUtils'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { Style } from '../style/Style'\n\nexport class Header<T> extends BaseHeader<T> {\n  public get StyleClass(): typeof Style {\n    return Style\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: Style,\n    helper: GridCanvasHelperAPI,\n    _grid: ListGridAPI<T>,\n    { drawCellBase, getHeaderIcon }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      color,\n      font,\n      bgColor,\n      textOverflow,\n      padding,\n      lineHeight,\n      autoWrapText,\n      lineClamp,\n    } = style\n\n    if (bgColor) {\n      drawCellBase({\n        bgColor,\n      })\n    }\n    const v = isDef(value) ? value + '' : ''\n    const multiLines = v\n      .replace(/\\r?\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .split('\\n')\n    helper.testFontLoad(font, value, context)\n    headerUtils.loadIcons(\n      getHeaderIcon(),\n      context,\n      helper,\n      (icons: any, ctx: CellContext) => {\n        if (multiLines.length > 1) {\n          helper.multilineText(multiLines, ctx, {\n            color,\n            font,\n            icons,\n            textAlign,\n            textBaseline,\n            textOverflow,\n            padding,\n            lineHeight,\n            autoWrapText,\n            lineClamp,\n          })\n        } else {\n          helper.text(value, ctx, {\n            color,\n            font,\n            icons,\n            padding,\n            textAlign,\n            textBaseline,\n            textOverflow,\n          })\n        }\n      }\n    )\n  }\n}\n","import {\n  CellContext,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  SortState,\n} from '../../ts-types'\nimport { DrawCellInfo, SimpleColumnIconOption } from '../../ts-types-internal'\nimport { BaseHeader } from './BaseHeader'\nimport { SortHeaderStyle } from '../style/SortHeaderStyle'\nimport { getFontSize } from '../../internal/canvases'\nimport { isDef, cellInRange } from '../../internal/utils'\n\nexport class SortHeader<T> extends BaseHeader<T> {\n  public get StyleClass(): typeof SortHeaderStyle {\n    return SortHeaderStyle\n  }\n  public drawInternal(\n    value: string,\n    context: CellContext,\n    style: SortHeaderStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    { drawCellBase }: DrawCellInfo<T>\n  ): void {\n    const textAlign = style.textAlign\n    const textBaseline = style.textBaseline || 'middle'\n    const color = style.color\n    const bgColor = style.bgColor\n    const padding = style.padding\n    const lineHeight = style.lineHeight\n    const autoWrapText = style.autoWrapText\n    const lineClamp = style.lineClamp\n    const font = style.font\n    const textOverflow = style.textOverflow\n    const sortArrowColor = style.sortArrowColor\n\n    if (bgColor) {\n      drawCellBase({\n        bgColor,\n      })\n    }\n\n    const state = grid.sortState as SortState\n    let order = undefined\n    const col = context.col\n    const row = context.row\n    const range = grid.getCellRange(col, row)\n    if (cellInRange(range, state.col, state.row)) {\n      ;({ order } = state)\n    }\n\n    const ctx = context.getContext()\n    const arrowSize = getFontSize(ctx, font).width * 1.2\n\n    const v = isDef(value) ? value + '' : ''\n    const multilines = v\n      .replace(/\\r?\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .split('\\n')\n    const icons: SimpleColumnIconOption[] = [\n      {\n        color:\n          helper.getColor(\n            sortArrowColor || helper.theme.header.sortArrowColor,\n            col,\n            row,\n            ctx\n          ) || 'rgba(0, 0, 0, 0.38)',\n        name: isDef(order)\n          ? order === 'asc'\n            ? 'arrowDownward'\n            : 'arrowUpward'\n          : undefined,\n        width: arrowSize,\n      },\n    ]\n    if (multilines.length > 1) {\n      helper.multilineText(multilines, context, {\n        autoWrapText,\n        color,\n        font,\n        icons,\n        lineClamp,\n        lineHeight,\n        padding,\n        textAlign,\n        textBaseline,\n        textOverflow,\n      })\n    } else {\n      helper.text(multilines, context, {\n        color,\n        font,\n        icons,\n        padding,\n        textAlign,\n        textBaseline,\n        textOverflow,\n      })\n    }\n  }\n}\n","import {\n  GridCanvasHelperAPI,\n  CellContext,\n  InlineAPI,\n  InlineCheckOption,\n} from '../../ts-types'\nimport { GridInternal, CheckHeaderState } from '../../ts-types-internal'\nimport { SwitchHeaderStyle } from '../style/SwitchHeaderStyle'\nimport { BaseCheckHeader } from './BaseCheckHeader'\nimport { getSwitchHeaderStateId } from '../../internal/symbolManager'\nimport { obj } from '../../internal/utils'\n\nconst SWITCH_HEADER_STATE_ID = getSwitchHeaderStateId()\n\nexport class SwitchHeader<T> extends BaseCheckHeader<T> {\n  public get StyleClass(): typeof SwitchHeaderStyle {\n    return SwitchHeaderStyle\n  }\n  public clone(): SwitchHeader<T> {\n    return new SwitchHeader(this)\n  }\n  protected getState(grid: GridInternal<T>): CheckHeaderState {\n    let state = grid[SWITCH_HEADER_STATE_ID]\n    if (!state) {\n      state = { elapsed: {}, block: {} }\n      obj.setReadonly(grid, SWITCH_HEADER_STATE_ID, state)\n    }\n    return state\n  }\n  protected getInlineCheck(\n    helper: GridCanvasHelperAPI,\n    checked: boolean,\n    context: CellContext,\n    opt: InlineCheckOption\n  ): InlineAPI {\n    return helper.buildSwitchBtnInline(checked, context, opt)\n  }\n}\n","import { CellContext, GridCanvasHelperAPI } from '../../ts-types'\nimport { DrawCellInfo, GridInternal } from '../../ts-types-internal'\nimport { BaseHeader } from './BaseHeader'\nimport { MultilineTextHeaderStyle } from '../style/MultilineTextHeaderStyle'\n\nexport class MultilineTextHeader<T> extends BaseHeader<T> {\n  get StyleClass(): typeof MultilineTextHeaderStyle {\n    return MultilineTextHeaderStyle\n  }\n  clone(): MultilineTextHeader<T> {\n    return new MultilineTextHeader(this)\n  }\n  drawInternal(\n    value: string,\n    context: CellContext,\n    style: MultilineTextHeaderStyle,\n    helper: GridCanvasHelperAPI,\n    _grid: GridInternal<T>,\n    { drawCellBase }: DrawCellInfo<T>\n  ): void {\n    const {\n      textAlign,\n      textBaseline,\n      color,\n      font,\n      bgColor,\n      lineHeight,\n      autoWrapText,\n      lineClamp,\n      textOverflow,\n    } = style\n\n    if (bgColor) {\n      drawCellBase({\n        bgColor,\n      })\n    }\n    const multilines = value\n      .replace(/\\r?\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .split('\\n')\n    helper.testFontLoad(font, value, context)\n    helper.multilineText(multilines, context, {\n      textAlign,\n      textBaseline,\n      color,\n      font,\n      lineHeight,\n      autoWrapText,\n      lineClamp,\n      textOverflow,\n    })\n  }\n}\n","import { HeaderTypeOption } from '../ts-types'\nimport { BaseHeader } from './type/BaseHeader'\nimport { BaseCheckHeader } from './type/BaseCheckHeader'\nimport { CheckHeader } from './type/CheckHeader'\nimport { Header } from './type/Header'\nimport { SortHeader } from './type/SortHeader'\nimport { SwitchHeader } from './type/SwitchHeader'\nimport { MultilineTextHeader } from './type/MultilineTextHeader'\nimport { BaseHeaderDefine } from '../list-grid/layout-map/api'\n\nexport const TYPES = {\n  DEFAULT: new Header<any>(),\n  SORT: new SortHeader<any>(),\n  CHECK: new CheckHeader<any>(),\n  SWITCH: new SwitchHeader<any>(),\n  MULTILINETEXT: new MultilineTextHeader<any>(),\n}\n\nexport {\n  BaseHeader,\n  BaseCheckHeader,\n  Header,\n  SortHeader,\n  CheckHeader,\n  SwitchHeader,\n  MultilineTextHeader,\n}\n\nexport function of<T>(\n  headerType: HeaderTypeOption | BaseHeader<T> | null | undefined\n): BaseHeader<T> {\n  if (!headerType) {\n    return TYPES.DEFAULT\n  } else if (typeof headerType === 'string') {\n    const key = headerType.toUpperCase() as keyof typeof TYPES\n    return TYPES[key] || of(null)\n  } else {\n    return headerType\n  }\n}\n\nexport function ofCell<T>(headerCell: BaseHeaderDefine<T>): BaseHeader<T> {\n  if (headerCell.sort) {\n    return TYPES.SORT\n  }\n\n  return of(headerCell.headerType)\n}\n","import {\n  ACTIONS,\n  BaseAction,\n  BaseCheckAction,\n  SortHeaderAction,\n  CheckHeaderAction,\n  SwitchHeaderAction,\n  of as headerActionOf,\n  ofCell as headerActionOfCell,\n  ImmutableHeaderActions,\n} from './header/action'\nimport {\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style,\n  SortHeaderStyle,\n  CheckHeaderStyle,\n  SwitchHeaderStyle,\n  MultilineTextHeaderStyle,\n  of as headerStyleOf,\n} from './header/style'\nimport {\n  TYPES,\n  BaseHeader,\n  BaseCheckHeader,\n  Header,\n  SortHeader,\n  CheckHeader,\n  SwitchHeader,\n  MultilineTextHeader,\n  of as headerTypeOf,\n  ofCell as headerTypeOfCell,\n} from './header/type'\n\nconst action = {\n  ACTIONS: ACTIONS as ImmutableHeaderActions,\n  BaseAction,\n  BaseCheckAction,\n  SortHeaderAction,\n  CheckHeaderAction,\n  SwitchHeaderAction,\n  of: headerActionOf,\n  ofCell: headerActionOfCell,\n}\n\nconst style = {\n  BaseStyle,\n  BaseStdStyle,\n  BaseCheckStyle,\n  Style,\n  SortHeaderStyle,\n  CheckHeaderStyle,\n  SwitchHeaderStyle,\n  MultilineTextHeaderStyle,\n  of: headerStyleOf,\n}\n\nconst type = {\n  TYPES,\n  BaseHeader,\n  BaseCheckHeader,\n  Header,\n  SortHeader,\n  CheckHeader,\n  SwitchHeader,\n  MultilineTextHeader,\n  of: headerTypeOf,\n  ofCell: headerTypeOfCell,\n}\n\n/**\n * headers\n */\nexport const headers = { action, style, type }\n","import { Theme } from '../themes/theme'\n\nexport const themes: { [key: string]: Theme } = {}\n","import { ThemeDefine, StylePropertyFunctionArg } from '../ts-types'\n\nfunction DEFAULT_BG_COLOR(args: StylePropertyFunctionArg): string {\n  const { row, grid } = args\n  if (row < grid.frozenRowCount) {\n    return '#FFF'\n  }\n  const index = grid.getRecordIndexByRow(row)\n  if (!(index & 1)) {\n    return '#FFF'\n  } else {\n    return '#F6F6F6'\n  }\n}\nconst cacheLinearGradient: { [key: string]: CanvasGradient } = {}\nfunction getLinearGradient(\n  context: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  right: number,\n  bottom: number,\n  colorStops: { [key: number]: string }\n): CanvasGradient {\n  const stopsKey = []\n  for (const stop in colorStops) {\n    if (colorStops.hasOwnProperty(stop)) {\n      stopsKey.push(`${stop}@${colorStops[stop]}`)\n    }\n  }\n  const key = `${left}/${top}/${right}/${bottom}/${stopsKey.join(',')}`\n  const ret = cacheLinearGradient[key]\n  if (ret) {\n    return ret\n  }\n  const grad = context.createLinearGradient(left, top, left, bottom)\n  for (const stop in colorStops) {\n    if (colorStops.hasOwnProperty(stop)) {\n      grad.addColorStop(Number(stop), colorStops[stop])\n    }\n  }\n  return (cacheLinearGradient[key] = grad)\n}\nfunction FROZEN_ROWS_BG_COLOR(args: StylePropertyFunctionArg): CanvasGradient {\n  const col = args.col\n  const grid = args.grid\n  const frozenRowCount = args.grid.frozenRowCount\n  const context = args.context\n\n  const rect = grid.getCellRelativeRect(col, 0)\n  const left = rect.left\n  const top = rect.top\n  const bottom = grid.getCellRelativeRect(col, frozenRowCount - 1).bottom\n\n  return getLinearGradient(context, left, top, left, bottom, {\n    0: '#FFF',\n    1: '#D3D3D3',\n  })\n}\n/**\n * basic theme\n * @name BASIC\n * @type {Object}\n * @memberof kakaGrid.themes.choices\n */\nexport default {\n  borderColor: '#000',\n  button: {\n    bgColor: '#2196F3',\n    color: '#FFF',\n  },\n  checkbox: {\n    borderColor: '#000',\n    checkBgColor: 'rgb(76, 73, 72)',\n    uncheckBgColor: '#FFF',\n  },\n  radioButton: {\n    checkColor: 'rgb(76, 73, 72)',\n    checkBorderColor: '#000',\n    uncheckBorderColor: '#000',\n    uncheckBgColor: '#FFF',\n    checkBgColor: '#FFF',\n  },\n  color: '#000',\n  defaultBgColor: DEFAULT_BG_COLOR,\n  frozenRowsBgColor: FROZEN_ROWS_BG_COLOR,\n  // frozenRowsBorderColor: \"#000\",\n  // frozenRowsColor: \"#000\",\n  header: {\n    sortArrowColor: 'rgba(0, 0, 0, 0.38)',\n  },\n  highlightBorderColor: '#5E9ED6',\n  selectionBgColor: '#CCE0FF',\n  selectionDragBgColor: '#EAF2FF',\n  switch: {\n    borderColor: '#000',\n    checkBgColor: '#008CD6', // '3BCD4F'\n    uncheckBgColor: '#FFF',\n  },\n  tree: {\n    lineColor: 'rgb(76, 73, 72)',\n    buttonColor: 'rgb(76, 73, 72)',\n    buttonBgColor: 'transparent',\n    buttonBorderColor: 'rgb(76, 73, 72)',\n    linkColor: 'rgb(76, 73, 72)',\n  },\n  underlayBackgroundColor: '#F6F6F6',\n} as ThemeDefine\n","import { ThemeDefine, StylePropertyFunctionArg } from '../ts-types'\n\nfunction FROZEN_ROWS_BORDER_COLOR(args: StylePropertyFunctionArg) {\n  const row = args.row\n  const frozenRowCount = args.grid.frozenRowCount\n  if (frozenRowCount - 1 === row) {\n    return ['#f2f2f2', '#f2f2f2', '#ccc7c7', '#f2f2f2']\n  } else {\n    return ['#f2f2f2']\n  }\n}\nfunction BORDER_COLOR(args: StylePropertyFunctionArg) {\n  const { col, row, grid } = args\n  const { colCount, frozenColCount, recordRowCount } = grid\n  let top: string | null = '#ccc7c7'\n  let bottom: string | null = '#ccc7c7'\n  if (recordRowCount > 1) {\n    const startRow = grid.getRecordStartRowByRecordIndex(\n      grid.getRecordIndexByRow(row)\n    )\n    const endRow = startRow + recordRowCount - 1\n    if (startRow !== row) {\n      top = null\n    }\n    if (endRow !== row) {\n      bottom = null\n    }\n  }\n  if (frozenColCount - 1 === col) {\n    return [top, '#f2f2f2', bottom, null]\n  }\n  if (colCount - 1 === col) {\n    return [top, '#f2f2f2', bottom, null]\n  }\n\n  return [top, null, bottom, null]\n}\n/**\n * material design theme\n * @name MATERIAL_DESIGN\n * @type {Object}\n * @memberof kakaGrid.themes.choices\n */\nexport default {\n  borderColor: BORDER_COLOR,\n  button: {\n    bgColor: '#2196F3',\n    color: '#FFF',\n  },\n  checkbox: {\n    borderColor: 'rgba(0, 0, 0, 0.26)',\n    checkBgColor: 'rgb(76, 73, 72)',\n    // uncheckBgColor: \"#FFF\",\n  },\n  radioButton: {\n    checkColor: 'rgb(76, 73, 72)',\n    checkBorderColor: 'rgb(76, 73, 72)',\n    uncheckBorderColor: 'rgb(189, 189, 189)',\n    // uncheckBgColor: \"#FFF\",\n    // checkBgColor: \"#FFF\",\n  },\n  color: 'rgba(0, 0, 0, 0.87)',\n  defaultBgColor: '#FFF',\n  // frozenRowsBgColor: \"#FFF\",\n  frozenRowsBorderColor: FROZEN_ROWS_BORDER_COLOR,\n  frozenRowsColor: 'rgba(0, 0, 0, 0.54)',\n  header: {\n    sortArrowColor: 'rgba(0, 0, 0, 0.38)',\n  },\n  highlightBorderColor: '#5E9ED6',\n  selectionBgColor: '#CCE0FF',\n  selectionDragBgColor: '#EAF2FF',\n  switch: {\n    borderColor: '#BFBFBF', // 'D9D9D9'\n    checkBgColor: '#008CD6', // '3BCD4F'\n    // uncheckBgColor: \"#FFF\",\n  },\n  tree: {\n    lineColor: 'rgba(0, 0, 0, 0.3)',\n    buttonColor: 'rgba(0, 0, 0, 0.45)',\n    buttonBgColor: 'transparent',\n    buttonBorderColor: 'rgba(0, 0, 0, 0.3)',\n    linkColor: 'rgba(0, 0, 0, 0.3)',\n  },\n  underlayBackgroundColor: '#FFF',\n  // gridBorderColor: 'transparent',\n  // gridBorderWidth: 0,\n} as ThemeDefine\n","import { getChainSafe } from '../internal/utils'\nimport { getThemeSymbol } from '../internal/symbolManager'\nimport {\n  ColorPropertyDefine,\n  ColorsPropertyDefine,\n  PartialThemeDefine,\n  ThemeDefine,\n  RequiredThemeDefine,\n  StylePropertyFunctionArg,\n} from '../ts-types'\n//private symbol\nconst _ = getThemeSymbol()\n\nfunction getProp<T extends ColorPropertyDefine | ColorsPropertyDefine | number>(\n  obj: PartialThemeDefine,\n  superObj: ThemeDefine,\n  names: string[],\n  defNames?: string[]\n): T {\n  return (\n    getChainSafe(obj, ...names) ||\n    getChainSafe(superObj, ...names) ||\n    (defNames && getChainSafe(obj, ...defNames)) ||\n    (defNames && getChainSafe(superObj, ...defNames))\n  )\n}\n\nexport class Theme implements RequiredThemeDefine {\n  private [_]: {\n    obj: PartialThemeDefine\n    superTheme: ThemeDefine\n  }\n  private _checkbox: RequiredThemeDefine['checkbox'] | null = null\n  private _radioButton: RequiredThemeDefine['radioButton'] | null = null\n  private _button: RequiredThemeDefine['button'] | null = null\n  private _header: RequiredThemeDefine['header'] | null = null\n  private _switch: RequiredThemeDefine['switch'] | null = null\n  private _tree: RequiredThemeDefine['tree'] | null = null\n  public constructor(obj: ThemeDefine)\n  public constructor(obj: PartialThemeDefine, superTheme: ThemeDefine)\n  public constructor(\n    obj: PartialThemeDefine | ThemeDefine,\n    superTheme?: ThemeDefine\n  ) {\n    this[_] = {\n      obj,\n      superTheme: superTheme as ThemeDefine,\n    }\n  }\n  public get underlayBackgroundColor(): string {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['underlayBackgroundColor'])\n  }\n  // font\n  public get font(): string {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['font'])\n  }\n  public get frozenRowsFont(): string {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['frozenRowsFont'])\n  }\n  // color\n  public get color(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['color'])\n  }\n  public get frozenRowsColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['frozenRowsColor'], ['color'])\n  }\n  // background\n  public get defaultBgColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['defaultBgColor'])\n  }\n  public get frozenRowsBgColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['frozenRowsBgColor'], ['defaultBgColor'])\n  }\n  public get focusBgColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['focusBgColor'])\n  }\n  public get selectionBgColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['selectionBgColor'], ['defaultBgColor'])\n  }\n  public get selectionDragBgColor(): ColorPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(\n      obj,\n      superTheme,\n      ['selectionDragBgColor'],\n      ['selectionBgColor']\n    )\n  }\n  public get highlightBgColor(): ColorPropertyDefine {\n    if (this.hasProperty(['highlightBgColor'])) {\n      const { obj, superTheme } = this[_]\n      return getProp(obj, superTheme, ['highlightBgColor'])\n    }\n    return (args: StylePropertyFunctionArg): any => {\n      const color =\n        args.row < args.grid.frozenRowCount\n          ? this.frozenRowsBgColor\n          : this.defaultBgColor\n      if (typeof color === 'function') {\n        return color(args)\n      }\n      return color\n    }\n  }\n  // border\n  public get borderColor(): ColorsPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['borderColor'])\n  }\n  public get frozenRowsBorderColor(): ColorsPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['frozenRowsBorderColor'], ['borderColor'])\n  }\n  public get highlightBorderColor(): ColorsPropertyDefine {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['highlightBorderColor'], ['borderColor'])\n  }\n  // grid border\n  public get gridBorderColor(): string {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['gridBorderColor'])\n  }\n  public get gridBorderWidth(): number {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['gridBorderWidth'])\n  }\n  // size\n  public get defaultRowHeight(): number {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['defaultRowHeight'])\n  }\n  public get defaultColWidth(): number {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['defaultColWidth'])\n  }\n  public get highlightBorderWidth(): number {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return getProp(obj, superTheme, ['highlightBorderWidth'])\n  }\n  // other\n  public get checkbox(): RequiredThemeDefine['checkbox'] {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return (\n      this._checkbox ||\n      (this._checkbox = {\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['checkbox', 'uncheckBgColor'],\n            ['defaultBgColor']\n          )\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['checkbox', 'checkBgColor'],\n            ['color']\n          )\n        },\n        get borderColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['checkbox', 'borderColor'])\n        },\n      })\n    )\n  }\n  public get radioButton(): RequiredThemeDefine['radioButton'] {\n    const { obj, superTheme } = this[_]\n    return (\n      this._radioButton ||\n      (this._radioButton = {\n        get checkColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['radioButton', 'checkColor'],\n            ['color']\n          )\n        },\n        get uncheckBorderColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['radioButton', 'uncheckBorderColor'],\n            ['borderColor']\n          )\n        },\n        get checkBorderColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['radioButton', 'checkBorderColor'],\n            ['borderColor']\n          )\n        },\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['radioButton', 'uncheckBgColor'],\n            ['defaultBgColor']\n          )\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['radioButton', 'checkBgColor'],\n            ['defaultBgColor']\n          )\n        },\n      })\n    )\n  }\n  public get button(): RequiredThemeDefine['button'] {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return (\n      this._button ||\n      (this._button = {\n        get color(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['button', 'color'], ['color'])\n        },\n        get bgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['button', 'bgColor'],\n            ['defaultBgColor']\n          )\n        },\n      })\n    )\n  }\n  public get header(): RequiredThemeDefine['header'] {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return (\n      this._header ||\n      (this._header = {\n        get sortArrowColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['header', 'sortArrowColor'])\n        },\n      })\n    )\n  }\n  public get switch(): RequiredThemeDefine['switch'] {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return (\n      this._switch ||\n      (this._switch = {\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['switch', 'uncheckBgColor'],\n            ['defaultBgColor']\n          )\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['switch', 'checkBgColor'], ['color'])\n        },\n        get borderColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['switch', 'borderColor'])\n        },\n      })\n    )\n  }\n  public get tree(): RequiredThemeDefine['tree'] {\n    const obj = this[_].obj\n    const superTheme = this[_].superTheme\n    return (\n      this._tree ||\n      (this._tree = {\n        get lineColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['tree', 'lineColor'])\n        },\n        get buttonColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['tree', 'buttonColor'], ['color'])\n        },\n        get buttonBgColor(): ColorPropertyDefine {\n          return getProp(\n            obj,\n            superTheme,\n            ['tree', 'buttonBgColor'],\n            ['defaultBgColor']\n          )\n        },\n        get buttonBorderColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['tree', 'buttonBorderColor'])\n        },\n        get linkColor(): ColorPropertyDefine {\n          return getProp(obj, superTheme, ['tree', 'linkColor'])\n        },\n      })\n    )\n  }\n  public hasProperty(names: string[]): boolean {\n    const { obj, superTheme } = this[_]\n    return hasThemeProperty(obj, names) || hasThemeProperty(superTheme, names)\n  }\n  public extends(obj: PartialThemeDefine): Theme {\n    return new Theme(obj, this)\n  }\n}\n\nfunction hasThemeProperty(obj: PartialThemeDefine, names: string[]): boolean {\n  if (obj instanceof Theme) {\n    return obj.hasProperty(names)\n  } else {\n    let o: any = obj\n    if (!o) {\n      return false\n    }\n    for (let index = 0; index < names.length; index++) {\n      const name = names[index]\n      o = o[name]\n      if (!o) {\n        return false\n      }\n    }\n    return !!o\n  }\n}\n","import { getIgnoreCase, extend } from './internal/utils'\nimport { themes as plugins } from './plugins/themes'\nimport basicTheme from './themes/BASIC'\nimport materialDesignTheme from './themes/MATERIAL_DESIGN'\nimport { Theme } from './themes/theme'\nimport { ThemeDefine } from './ts-types'\n\nconst BASIC = new Theme(basicTheme)\nconst MATERIAL_DESIGN = new Theme(materialDesignTheme)\n\nconst builtin: { [key: string]: Theme } = {\n  BASIC,\n  MATERIAL_DESIGN,\n}\nlet defTheme = MATERIAL_DESIGN\n\nconst theme = { Theme }\nfunction of(value: ThemeDefine | string | undefined | null): Theme | null {\n  if (!value) {\n    return null\n  }\n  if (typeof value === 'string') {\n    const t = getIgnoreCase(getChoices(), value)\n    if (t) {\n      return t\n    }\n    return null\n  }\n  if (value instanceof Theme) {\n    return value\n  }\n  return new Theme(value)\n}\n\nfunction getDefault(): Theme {\n  return defTheme\n}\nfunction setDefault(defaultTheme: Theme): void {\n  defTheme = of(defaultTheme) || defTheme\n}\nfunction getChoices(): { [key: string]: Theme } {\n  return extend(builtin, plugins)\n}\n\nexport const themes = {\n  BASIC,\n  MATERIAL_DESIGN,\n  theme,\n  of,\n  getDefault,\n  setDefault,\n  getChoices,\n}\n","type RGBA = { r: number; g: number; b: number; a: number }\nconst rgbMap: { [key: string]: RGBA } = {}\nfunction styleColorToRGB(color: string): RGBA | null {\n  const dummy = document.createElement('div')\n  const { style } = dummy\n  style.color = color\n  style.position = 'fixed'\n  style.height = '1px'\n  style.width = '1px'\n  style.opacity = '0'\n  document.body.appendChild(dummy)\n  const { color: styleColor } = (\n    document.defaultView || window\n  ).getComputedStyle(dummy, '')\n  document.body.removeChild(dummy)\n  return colorToRGB0(styleColor || '')\n}\n\nfunction hexToNum(hex: string): number {\n  return parseInt(hex, 16)\n}\n\nfunction createRGB(r: number, g: number, b: number, a = 1): RGBA {\n  return { r, g, b, a }\n}\nfunction tripleHexToRGB({ 1: r, 2: g, 3: b }: string): RGBA {\n  return createRGB(hexToNum(r + r), hexToNum(g + g), hexToNum(b + b))\n}\nfunction sextupleHexToRGB({\n  1: r1,\n  2: r2,\n  3: g1,\n  4: g2,\n  5: b1,\n  6: b2,\n}: string): RGBA {\n  return createRGB(hexToNum(r1 + r2), hexToNum(g1 + g2), hexToNum(b1 + b2))\n}\n\nfunction testRGB({ r, g, b, a }: RGBA): boolean {\n  return (\n    0 <= r &&\n    r <= 255 &&\n    0 <= g &&\n    g <= 255 &&\n    0 <= b &&\n    b <= 255 &&\n    0 <= a &&\n    a <= 1\n  )\n}\nfunction rateToByte(r: number): number {\n  return Math.ceil((r * 255) / 100)\n}\nfunction colorToRGB0(color: string): RGBA | null {\n  if (/^#[0-9a-f]{3}$/i.exec(color)) {\n    return tripleHexToRGB(color)\n  }\n  if (/^#[0-9a-f]{6}$/i.exec(color)) {\n    return sextupleHexToRGB(color)\n  }\n  let ret = /^rgb\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)$/i.exec(\n    color\n  )\n  if (ret) {\n    const rgb = createRGB(Number(ret[1]), Number(ret[2]), Number(ret[3]))\n    if (testRGB(rgb)) {\n      return rgb\n    }\n  }\n  ret = /^rgba\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d(\\.\\d)?)\\s*\\)$/i.exec(\n    color\n  )\n  if (ret) {\n    const rgb = createRGB(\n      Number(ret[1]),\n      Number(ret[2]),\n      Number(ret[3]),\n      Number(ret[4])\n    )\n    if (testRGB(rgb)) {\n      return rgb\n    }\n  }\n  ret = /^rgb\\(\\s*(\\d{1,3}(\\.\\d)?)%\\s*,\\s*(\\d{1,3}(\\.\\d)?)%\\s*,\\s*(\\d{1,3}(\\.\\d)?)%\\s*\\)$/i.exec(\n    color\n  )\n  if (ret) {\n    const rgb = createRGB(\n      rateToByte(Number(ret[1])),\n      rateToByte(Number(ret[3])),\n      rateToByte(Number(ret[5]))\n    )\n    if (testRGB(rgb)) {\n      return rgb\n    }\n  }\n  ret = /^rgba\\(\\s*(\\d{1,3}(\\.\\d)?)%\\s*,\\s*(\\d{1,3}(\\.\\d)?)%\\s*,\\s*(\\d{1,3}(\\.\\d)?)%\\s*,\\s*(\\d(\\.\\d)?)\\s*\\)$/i.exec(\n    color\n  )\n  if (ret) {\n    const rgb = createRGB(\n      rateToByte(Number(ret[1])),\n      rateToByte(Number(ret[3])),\n      rateToByte(Number(ret[5])),\n      Number(ret[7])\n    )\n    if (testRGB(rgb)) {\n      return rgb\n    }\n  }\n  return null\n}\nfunction colorToRGB(color: string): RGBA {\n  if (typeof color !== 'string') {\n    return createRGB(0, 0, 0, 0)\n  }\n  color = color.toLowerCase().trim()\n  if (rgbMap[color]) {\n    return rgbMap[color]\n  }\n  return colorToRGB0(color) || (rgbMap[color] = styleColorToRGB(color) as RGBA)\n}\nexport function calcElapsedColor(\n  startColor: string,\n  endColor: string,\n  elapsedTime: number\n): string {\n  const startColorRGB = colorToRGB(startColor)\n  const endColorRGB = colorToRGB(endColor)\n  const getRGB = (colorName: keyof RGBA): number => {\n    const start = startColorRGB[colorName]\n    const end = endColorRGB[colorName]\n    if (elapsedTime >= 1) {\n      return end\n    }\n    if (elapsedTime <= 0) {\n      return start\n    }\n    const diff = start - end\n    return Math.ceil(start - diff * elapsedTime)\n  }\n  return `rgb(${getRGB('r')}, ${getRGB('g')}, ${getRGB('b')})`\n}","import {\n  PaddingOption,\n  calcBasePosition,\n  calcStartPosition,\n  getFontSize,\n} from '../internal/canvases'\nimport { calcElapsedColor } from '../internal/color'\nimport { ColorDef } from '../ts-types'\n\nconst { ceil, PI } = Math\n\nfunction strokeColorsRect(\n  ctx: CanvasRenderingContext2D,\n  borderColors: [\n    ColorDef | null,\n    ColorDef | null,\n    ColorDef | null,\n    ColorDef | null\n  ],\n  left: number,\n  top: number,\n  width: number,\n  height: number\n): void {\n  type Position = { x: number; y: number }\n  function strokeRectLines(\n    positions: [Position, Position, Position, Position, Position]\n  ): void {\n    for (let i = 0; i < borderColors.length; i++) {\n      const color = borderColors[i]\n      const preColor = borderColors[i - 1]\n      if (color) {\n        if (preColor !== color) {\n          if (preColor) {\n            ctx.strokeStyle = preColor\n            ctx.stroke()\n          }\n          const pos1 = positions[i]\n          ctx.beginPath()\n          ctx.moveTo(pos1.x, pos1.y)\n        }\n        const pos2 = positions[i + 1]\n        ctx.lineTo(pos2.x, pos2.y)\n      } else {\n        if (preColor) {\n          ctx.strokeStyle = preColor\n          ctx.stroke()\n        }\n      }\n    }\n    const pColor = borderColors[borderColors.length - 1]\n    if (pColor) {\n      ctx.strokeStyle = pColor\n      ctx.stroke()\n    }\n  }\n  if (\n    borderColors[0] === borderColors[1] &&\n    borderColors[0] === borderColors[2] &&\n    borderColors[0] === borderColors[3]\n  ) {\n    if (borderColors[0]) {\n      ctx.strokeStyle = borderColors[0]\n      ctx.strokeRect(left, top, width, height)\n    }\n  } else {\n    strokeRectLines([\n      { x: left, y: top },\n      { x: left + width, y: top },\n      { x: left + width, y: top + height },\n      { x: left, y: top + height },\n      { x: left, y: top },\n    ])\n  }\n}\nfunction roundRect(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  radius: number\n): void {\n  ctx.beginPath()\n  ctx.arc(left + radius, top + radius, radius, -PI, -0.5 * PI, false)\n  ctx.arc(left + width - radius, top + radius, radius, -0.5 * PI, 0, false)\n  ctx.arc(\n    left + width - radius,\n    top + height - radius,\n    radius,\n    0,\n    0.5 * PI,\n    false\n  )\n  ctx.arc(left + radius, top + height - radius, radius, 0.5 * PI, PI, false)\n  ctx.closePath()\n}\nfunction fillRoundRect(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  radius: number\n) {\n  roundRect(ctx, left, top, width, height, radius)\n  ctx.fill()\n}\nfunction strokeRoundRect(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  radius: number\n) {\n  roundRect(ctx, left, top, width, height, radius)\n  ctx.stroke()\n}\nfunction fillCircle(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number\n): void {\n  const min = Math.min(width, height) / 2\n  ctx.beginPath()\n  ctx.arc(left + min, top + min, min, 0, 2 * Math.PI)\n  ctx.closePath()\n  ctx.fill()\n}\nfunction strokeCircle(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number\n): void {\n  const min = Math.min(width, height) / 2\n  ctx.beginPath()\n  ctx.arc(left + min, top + min, min, 0, 2 * Math.PI)\n  ctx.closePath()\n  ctx.stroke()\n}\n\nexport type FillTextRectOption = {\n  offset?: number\n  padding?: PaddingOption\n}\nfunction fillTextRect(\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  { offset = 2, padding }: FillTextRectOption = {}\n): void {\n  const rect = {\n    bottom: top + height,\n    height,\n    left,\n    right: left + width,\n    top,\n    width,\n  }\n  ctx.save()\n  try {\n    ctx.beginPath()\n    ctx.rect(rect.left, rect.top, rect.width, rect.height)\n    // clip\n    ctx.clip()\n\n    // 文字\n    const pos = calcBasePosition(ctx, rect, {\n      offset,\n      padding,\n    })\n\n    ctx.fillText(text, pos.x, pos.y)\n  } finally {\n    ctx.restore()\n  }\n}\n\nexport type DrawInlineImageRectOption = {\n  offset?: number\n  padding?: PaddingOption\n}\nfunction drawInlineImageRect(\n  ctx: CanvasRenderingContext2D,\n  image: HTMLImageElement,\n  srcLeft: number,\n  srcTop: number,\n  srcWidth: number,\n  srcHeight: number,\n  destWidth: number,\n  destHeight: number,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  { offset = 2, padding }: DrawInlineImageRectOption = {}\n): void {\n  const rect = {\n    bottom: top + height,\n    height,\n    left,\n    right: left + width,\n    top,\n    width,\n  }\n  ctx.save()\n  try {\n    ctx.beginPath()\n    ctx.rect(rect.left, rect.top, rect.width, rect.height)\n    // clip\n    ctx.clip()\n\n    // 文字\n    const pos = calcStartPosition(ctx, rect, destWidth, destHeight, {\n      offset,\n      padding,\n    })\n\n    ctx.drawImage(\n      image,\n      srcLeft,\n      srcTop,\n      srcWidth || destWidth,\n      srcHeight || destHeight,\n      pos.x,\n      pos.y,\n      destWidth,\n      destHeight\n    )\n  } finally {\n    ctx.restore()\n  }\n}\n\n/**\n * Returns an object containing the width of the checkbox.\n * @param ctx - canvas context\n * @returns Object containing the width of the checkbox\n */\nfunction measureCheckbox(ctx: CanvasRenderingContext2D): { width: number } {\n  return {\n    width: getFontSize(ctx, null).width,\n  }\n}\n\n/**\n * Returns an object containing the width of the radio button.\n * @param ctx - canvas context\n * @returns Object containing the width of the radio button\n */\nfunction measureRadioButton(ctx: CanvasRenderingContext2D): { width: number } {\n  return {\n    width: getFontSize(ctx, null).width,\n  }\n}\n\nexport type DrawCheckboxOption = {\n  uncheckBgColor?: ColorDef\n  checkBgColor?: ColorDef\n  borderColor?: ColorDef\n  boxSize?: number\n}\n/**\n * draw Checkbox\n * @param ctx - canvas context\n * @param x - The x coordinate where to start drawing the checkbox (relative to the canvas)\n * @param y - The y coordinate where to start drawing the checkbox (relative to the canvas)\n * @param check - checkbox check status\n * @param option - option\n * @returns\n */\nfunction drawCheckbox(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  check: number | boolean,\n  {\n    uncheckBgColor = '#FFF',\n    checkBgColor = 'rgb(76, 73, 72)',\n    borderColor = '#000',\n    boxSize = measureCheckbox(ctx).width,\n  }: DrawCheckboxOption = {}\n): void {\n  const checkPoint = typeof check === 'number' ? (check > 1 ? 1 : check) : 1\n\n  ctx.save()\n  try {\n    ctx.fillStyle = check ? checkBgColor : uncheckBgColor\n    const leftX = ceil(x)\n    const topY = ceil(y)\n    const size = ceil(boxSize)\n\n    fillRoundRect(ctx, leftX - 1, topY - 1, size + 1, size + 1, boxSize / 5)\n    ctx.lineWidth = 1\n    ctx.strokeStyle = borderColor\n    strokeRoundRect(ctx, leftX - 0.5, topY - 0.5, size, size, boxSize / 5)\n\n    if (check) {\n      ctx.lineWidth = ceil(boxSize / 10)\n      ctx.strokeStyle = uncheckBgColor\n      let leftWidth = boxSize / 4\n      let rightWidth = (boxSize / 2) * 0.9\n      const leftLeftPos = x + boxSize * 0.2\n      const leftTopPos = y + boxSize / 2\n\n      if (checkPoint < 0.5) {\n        leftWidth *= checkPoint * 2\n      }\n\n      ctx.beginPath()\n      ctx.moveTo(leftLeftPos, leftTopPos)\n      ctx.lineTo(leftLeftPos + leftWidth, leftTopPos + leftWidth)\n      if (checkPoint > 0.5) {\n        if (checkPoint < 1) {\n          rightWidth *= (checkPoint - 0.5) * 2\n        }\n        ctx.lineTo(\n          leftLeftPos + leftWidth + rightWidth,\n          leftTopPos + leftWidth - rightWidth\n        )\n      }\n      ctx.stroke()\n    }\n  } finally {\n    ctx.restore()\n  }\n}\n\nexport type DrawRadioButtonOption = {\n  checkColor?: ColorDef\n  borderColor?: ColorDef\n  bgColor?: ColorDef\n  boxSize?: number\n}\n/**\n * draw Radio button\n * @param ctx - canvas context\n * @param x - The x coordinate where to start drawing the radio button (relative to the canvas)\n * @param y - The y coordinate where to start drawing the radio button (relative to the canvas)\n * @param check - radio button check status\n * @param option - option\n * @returns\n */\nfunction drawRadioButton(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  check: number | boolean,\n  {\n    checkColor = 'rgb(76, 73, 72)',\n    borderColor = '#000',\n    bgColor = '#FFF',\n    boxSize = measureRadioButton(ctx).width,\n  }: DrawRadioButtonOption = {}\n): void {\n  const ratio = typeof check === 'number' ? (check > 1 ? 1 : check) : 1\n\n  ctx.save()\n  try {\n    ctx.fillStyle = bgColor\n    const leftX = ceil(x)\n    const topY = ceil(y)\n    const size = ceil(boxSize)\n    fillCircle(ctx, leftX - 1, topY - 1, size + 1, size + 1)\n\n    ctx.lineWidth = 1\n    ctx.strokeStyle = borderColor\n    strokeCircle(ctx, leftX - 0.5, topY - 0.5, size, size)\n    if (check) {\n      const checkSize = (size * ratio) / 2\n      const padding = (size - checkSize) / 2\n      ctx.fillStyle = checkColor\n      fillCircle(\n        ctx,\n        ceil((leftX - 0.5 + padding) * 100) / 100,\n        ceil((topY - 0.5 + padding) * 100) / 100,\n        ceil(checkSize * 100) / 100,\n        ceil(checkSize * 100) / 100\n      )\n    }\n  } finally {\n    ctx.restore()\n  }\n}\n\nexport type DrawSwitchOption = {\n  uncheckBgColor?: ColorDef\n  checkBgColor?: ColorDef\n  borderColor?: ColorDef\n  btnSize?: { width: number; height: number }\n}\n/**\n * draw Switch Button\n * @param ctx - canvas context\n * @param x - The x coordinate where to start drawing the switch (relative to the canvas)\n * @param y - The y coordinate where to start drawing the switch (relative to the canvas)\n * @param check - switch check status\n * @param option - option\n * @returns\n */\nfunction drawSwitchBtn(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  check: boolean,\n  animElapsedTime: number,\n  {\n    uncheckBgColor = '#FFF',\n    checkBgColor = '#3BCD4F',\n    borderColor = '#D9D9D9',\n    btnSize = { width: 52, height: 32 },\n  }: DrawSwitchOption = {}\n) {\n  animElapsedTime =\n    animElapsedTime > 1 ? 1 : animElapsedTime < 0 ? 0 : animElapsedTime\n  const borderWidth = btnSize.height * 0.078125\n\n  ctx.save()\n  try {\n    ctx.fillStyle = check ? checkBgColor : borderColor\n    const bX = ceil(x) - 1\n    const bY = ceil(y) - 1\n    const bW = ceil(btnSize.width + 1)\n    const bH = ceil(btnSize.height + 1)\n    fillRoundRect(ctx, bX, bY, bW, bH, bH / 2)\n\n    const scale = check ? 1 - animElapsedTime : animElapsedTime\n    ctx.fillStyle = uncheckBgColor\n    const cW = (bW - borderWidth * 2) * scale\n    const cH = (bH - borderWidth * 2) * scale\n    const cX = bX + bW / 2 - cW / 2\n    const cY = bY + bH / 2 - cH / 2\n    fillRoundRect(ctx, cX, cY, cW, cH, cH / 2)\n\n    const offsetScale = check ? animElapsedTime : 1 - animElapsedTime\n    ctx.shadowColor = borderColor as string\n    ctx.shadowOffsetX = 0\n    ctx.shadowOffsetY = 2\n    ctx.shadowBlur = 3\n    const sW = bH - borderWidth * 2\n    const sH = sW\n    const sX = bX + borderWidth + (bW - borderWidth * 2 - sW) * offsetScale\n    const sY = bY + borderWidth\n    fillRoundRect(ctx, sX, sY, sW, sH, sH / 2)\n  } finally {\n    ctx.restore()\n  }\n}\n\nfunction drawSwitchButton(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  check: boolean,\n  animElapsedTime: number,\n  {\n    uncheckBgColor = '#FFF',\n    checkBgColor = '#008CD6',\n    borderColor = '#BFBFBF',\n    btnSize = { width: 44, height: 22 },\n  }: DrawSwitchOption = {}\n) {\n  animElapsedTime =\n    animElapsedTime > 1 ? 1 : animElapsedTime < 0 ? 0 : animElapsedTime\n  const borderWidth = (btnSize.height * 2) / 22\n  const fontSize = (btnSize.height * 12) / 22\n  const textMargin = (btnSize.height * 14) / 22\n\n  ctx.save()\n  try {\n    let backgroundFillStyle\n    let trueFillStyle\n    let falseFillStyle\n    if (0 < animElapsedTime && animElapsedTime < 1) {\n      backgroundFillStyle = check\n        ? calcElapsedColor(\n            borderColor as string,\n            checkBgColor as string,\n            animElapsedTime\n          )\n        : calcElapsedColor(\n            checkBgColor as string,\n            borderColor as string,\n            animElapsedTime\n          )\n      trueFillStyle = check\n        ? calcElapsedColor(\n            borderColor as string,\n            uncheckBgColor as string,\n            animElapsedTime\n          )\n        : calcElapsedColor(\n            uncheckBgColor as string,\n            borderColor as string,\n            animElapsedTime\n          )\n      falseFillStyle = check\n        ? calcElapsedColor(\n            uncheckBgColor as string,\n            checkBgColor as string,\n            animElapsedTime\n          )\n        : calcElapsedColor(\n            checkBgColor as string,\n            uncheckBgColor as string,\n            animElapsedTime\n          )\n    } else {\n      backgroundFillStyle = check ? checkBgColor : borderColor\n      trueFillStyle = check ? uncheckBgColor : borderColor\n      falseFillStyle = check ? checkBgColor : uncheckBgColor\n    }\n    const bX = x\n    const bY = y\n    const bW = btnSize.width\n    const bH = btnSize.height\n    ctx.fillStyle = backgroundFillStyle\n    fillRoundRect(ctx, bX, bY, bW, bH, bH / 2)\n\n    ctx.textAlign = 'center'\n    ctx.textBaseline = 'middle'\n    ctx.font = `${fontSize}px sans-serif`\n    ctx.fillStyle = trueFillStyle\n    ctx.fillText('是', bX + textMargin, bY + bH / 2)\n    ctx.fillStyle = falseFillStyle\n    ctx.fillText('否', bX + bW - textMargin, bY + bH / 2)\n\n    const offsetScale = check ? animElapsedTime : 1 - animElapsedTime\n    const sW = bH - borderWidth * 2\n    const sH = sW\n    const sX = bX + borderWidth + (bW - borderWidth * 2 - sW) * offsetScale\n    const sY = bY + borderWidth\n    ctx.fillStyle = uncheckBgColor\n    fillRoundRect(ctx, sX, sY, sW, sH, sH / 2)\n  } finally {\n    ctx.restore()\n  }\n}\n\nexport type DrawButtonOption = {\n  backgroundColor?: ColorDef\n  bgColor?: ColorDef\n  radius?: number\n  shadow?: {\n    color?: string\n    blur?: number\n    offsetX?: number\n    offsetY?: number\n    offset?: { x?: number; y?: number }\n  }\n}\nfunction drawButton(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  option: DrawButtonOption = {}\n): void {\n  const {\n    backgroundColor = '#FFF',\n    bgColor = backgroundColor,\n    radius = 4,\n    shadow = {},\n  } = option\n\n  ctx.save()\n  try {\n    ctx.fillStyle = bgColor\n\n    if (shadow) {\n      const {\n        color = 'rgba(0, 0, 0, 0.24)',\n        blur = 1,\n        offsetX = 0,\n        offsetY = 2,\n        offset: { x: ox = offsetX, y: oy = offsetY } = {},\n      } = shadow\n\n      ctx.shadowColor = color\n      ctx.shadowBlur = blur // 模糊\n      ctx.shadowOffsetX = ox\n      ctx.shadowOffsetY = oy\n    }\n\n    fillRoundRect(ctx, ceil(left), ceil(top), ceil(width), ceil(height), radius)\n  } finally {\n    ctx.restore()\n  }\n}\n\n/**\n * canvasHelper\n */\nexport const canvasHelper = {\n  drawButton,\n  drawCheckbox,\n  drawInlineImageRect,\n  drawRadioButton,\n  drawSwitchButton,\n  drawSwitchBtn,\n  fillRoundRect,\n  fillTextRect,\n  measureCheckbox,\n  measureRadioButton,\n  roundRect,\n  strokeColorsRect,\n  strokeRoundRect,\n  fillCircle,\n  strokeCircle,\n}\n\nexport type CanvasHelper = {\n  drawButton: typeof drawButton\n  drawCheckbox: typeof drawCheckbox\n  drawInlineImageRect: typeof drawInlineImageRect\n  drawRadioButton: typeof drawRadioButton\n  drawSwitchButton: typeof drawSwitchButton\n  drawSwitchBtn: typeof drawSwitchBtn\n  fillRoundRect: typeof fillRoundRect\n  fillTextRect: typeof fillTextRect\n  measureCheckbox: typeof measureCheckbox\n  measureRadioButton: typeof measureRadioButton\n  roundRect: typeof roundRect\n  strokeColorsRect: typeof strokeColorsRect\n  strokeRoundRect: typeof strokeRoundRect\n  fillCircle: typeof fillCircle\n  strokeCircle: typeof strokeCircle\n}\n","import { canvasHelper, CanvasHelper } from './tools/canvasHelper'\n\n/**\n * tools\n */\nexport const tools: {\n  canvasHelper: CanvasHelper\n} = { canvasHelper }\n","import { columns } from '../../../columns'\nimport { headers } from '../../../headers'\nimport { ColumnData, HeaderData } from '../api'\n\nlet seqId = -1\n\nexport function newEmptyHeaderData(): HeaderData<any> {\n  return {\n    id: seqId--,\n    define: {},\n    headerType: headers.type.of(null), // default\n  }\n}\n\nexport function newEmptyColumnData(): ColumnData<any> {\n  return {\n    id: seqId--,\n    define: {},\n    columnType: columns.type.of(null), // default\n    style: null,\n  }\n}\n\nexport class EmptyDataCache<T> {\n  private headers: HeaderData<T>[][] = []\n  private columns: ColumnData<T>[][] = []\n  getHeader(col: number, row: number): HeaderData<T> {\n    const rows = this.headers[row] || (this.headers[row] = [])\n    return rows[col] || (rows[col] = newEmptyHeaderData())\n  }\n  getBody(col: number, row: number): ColumnData<T> {\n    const rows = this.columns[row] || (this.columns[row] = [])\n    return rows[col] || (rows[col] = newEmptyColumnData())\n  }\n}\n","import { CellRange, LayoutObjectId } from '../../../ts-types'\nimport { columns } from '../../../columns'\nimport { headers } from '../../../headers'\nimport {\n  ColumnData,\n  ColumnDefine,\n  GroupHeaderDefine,\n  HeaderData,\n  HeadersDefine,\n  LayoutMapAPI,\n} from '../api'\nimport { EmptyDataCache } from './utils'\n\nlet seqId = 0\nexport class SimpleHeaderLayoutMap<T> implements LayoutMapAPI<T> {\n  private _headerObjects: HeaderData<T>[]\n  private _headerObjectMap: { [key in LayoutObjectId]: HeaderData<T> }\n  private _headerCellIds: number[][]\n  private _columns: ColumnData<T>[]\n  readonly bodyRowCount: number = 1\n  private _emptyDataCache = new EmptyDataCache()\n  constructor(header: HeadersDefine<T>) {\n    this._columns = []\n    this._headerCellIds = []\n\n    this._headerObjects = this._addHeaders(0, header, [])\n    this._headerObjectMap = this._headerObjects.reduce((o, e) => {\n      o[e.id as number] = e\n      return o\n    }, {} as { [key in LayoutObjectId]: HeaderData<T> })\n\n    this._setupHeaderSpan()\n  }\n  get columnWidths(): ColumnData<T>[] {\n    return this._columns\n  }\n  get headerRowCount(): number {\n    return this._headerCellIds.length\n  }\n  get colCount(): number {\n    return this._columns.length\n  }\n  get headerObjects(): HeaderData<T>[] {\n    return this._headerObjects\n  }\n  get columnObjects(): ColumnData<T>[] {\n    return this._columns\n  }\n  getCellId(col: number, row: number): LayoutObjectId {\n    if (this.headerRowCount <= row) {\n      return this._columns[col].id\n    }\n    //in header\n    return this._headerCellIds[row][col]\n  }\n  getHeader(col: number, row: number): HeaderData<T> {\n    const id = this.getCellId(col, row)\n    return (\n      this._headerObjectMap[id as number] ||\n      this._emptyDataCache.getHeader(col, row)\n    )\n  }\n  getBody(col: number, _row: number): ColumnData<T> {\n    return this._columns[col] || this._emptyDataCache.getBody(col, 0)\n  }\n  getBodyLayoutRangeById(id: LayoutObjectId): CellRange {\n    for (let col = 0; col < this.colCount; col++) {\n      if (id === this._columns[col].id) {\n        return {\n          start: { col, row: 0 },\n          end: { col, row: 0 },\n        }\n      }\n    }\n    throw new Error(`can not found body layout @id=${id as number}`)\n  }\n  getCellRange(col: number, row: number): CellRange {\n    const result: CellRange = { start: { col, row }, end: { col, row } }\n    if (this.headerRowCount <= row) {\n      return result\n    }\n    //in header\n    const id = this.getCellId(col, row)\n    for (let c = col - 1; c >= 0; c--) {\n      if (id !== this.getCellId(c, row)) {\n        break\n      }\n      result.start.col = c\n    }\n    for (let c = col + 1; c < this.colCount; c++) {\n      if (id !== this.getCellId(c, row)) {\n        break\n      }\n      result.end.col = c\n    }\n    for (let r = row - 1; r >= 0; r--) {\n      if (id !== this.getCellId(col, r)) {\n        break\n      }\n      result.start.row = r\n    }\n    for (let r = row + 1; r < this.headerRowCount; r++) {\n      if (id !== this.getCellId(col, r)) {\n        break\n      }\n      result.end.row = r\n    }\n    return result\n  }\n  getRecordIndexByRow(row: number): number {\n    if (row < this.headerRowCount) {\n      return -1\n    } else {\n      return row - this.headerRowCount\n    }\n  }\n  getRecordStartRowByRecordIndex(index: number): number {\n    return this.headerRowCount + index\n  }\n  private _addHeaders(\n    row: number,\n    header: HeadersDefine<T>,\n    roots: number[]\n  ): HeaderData<T>[] {\n    const results: HeaderData<T>[] = []\n    const rowCells = this._headerCellIds[row] || this._newRow(row)\n    header.forEach((hd) => {\n      const col = this._columns.length\n      const id = seqId++\n      const cell: HeaderData<T> = {\n        id,\n        caption: hd.caption,\n        field: hd.headerField || (hd as ColumnDefine<T>).field,\n        style: hd.headerStyle,\n        headerType: headers.type.ofCell(hd),\n        action: headers.action.ofCell(hd),\n        define: hd,\n        icon: hd.headerIcon,\n        tooltip: hd.headerTooltip,\n        tooltipType: hd.headerTooltipType,\n      }\n      results[id] = cell\n      rowCells[col] = id\n      for (let r = row - 1; r >= 0; r--) {\n        this._headerCellIds[r][col] = roots[r]\n      }\n      if ((hd as GroupHeaderDefine<T>).columns) {\n        this._addHeaders(row + 1, (hd as GroupHeaderDefine<T>).columns, [\n          ...roots,\n          id,\n        ]).forEach((c) => results.push(c))\n      } else {\n        const colDef = hd as ColumnDefine<T>\n        this._columns.push({\n          id: seqId++,\n          field: colDef.field,\n          width: colDef.width,\n          minWidth: colDef.minWidth,\n          maxWidth: colDef.maxWidth,\n          icon: colDef.icon,\n          message: colDef.message,\n          columnType: columns.type.of(colDef.columnType),\n          action: columns.action.of(colDef.action),\n          style: colDef.style,\n          define: colDef,\n          contentHidden: colDef.contentHidden,\n          disableResize: colDef.disableResize,\n          tooltip: colDef.tooltip,\n          tooltipType: colDef.tooltipType,\n        })\n        for (let r = row + 1; r < this._headerCellIds.length; r++) {\n          this._headerCellIds[r][col] = id\n        }\n      }\n    })\n    return results\n  }\n  private _newRow(row: number): number[] {\n    const newRow: number[] = (this._headerCellIds[row] = [])\n    if (!this._columns.length) {\n      return newRow\n    }\n    const prev = this._headerCellIds[row - 1]\n    for (let col = 0; col < prev.length; col++) {\n      newRow[col] = prev[col]\n    }\n    return newRow\n  }\n  private _setupHeaderSpan() {\n    const processed: {\n      [id: number]: boolean\n    } = {}\n    for (let row = 0; row < this._headerCellIds.length; row++) {\n      const cols = this._headerCellIds[row]\n      for (let col = 0; col < cols.length; col++) {\n        const cellId = cols[col]\n        if (!processed[cellId]) {\n          processed[cellId] = true\n          const cell = this._headerObjectMap[cellId]\n\n          let headerRowSpan\n          if ('headerRowSpan' in cell.define) {\n            window.console.warn(\n              \"'headerRowSpan' is deprecated, please use 'rowSpan' instead\"\n            )\n            headerRowSpan = cell.define['headerRowSpan']\n          }\n          let headerColSpan\n          if ('headerColSpan' in cell.define) {\n            window.console.warn(\n              \"'headerColSpan' is deprecated, please use 'colSpan' instead\"\n            )\n            headerColSpan = cell.define['headerColSpan']\n          }\n\n          const rowSpan = Number(cell.define.rowSpan || headerRowSpan || 1)\n          const colSpan = Number(cell.define.colSpan || headerColSpan || 1)\n          if (rowSpan > 1 || colSpan > 1) {\n            for (let i = row; i < row + rowSpan; i++) {\n              for (let j = col; j < col + colSpan; j++) {\n                this._headerCellIds[i][j] = cellId\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","import { columns } from '../../../columns'\nimport { headers } from '../../../headers'\nimport {\n  CellDefine,\n  ColumnData,\n  HeaderBodyLayoutDefine,\n  HeaderCellDefine,\n  HeaderData,\n  LayoutDefine,\n  LayoutMapAPI,\n  WidthData,\n} from '../api'\nimport { CellRange, LayoutObjectId } from '../../../ts-types'\nimport { EmptyDataCache } from './utils'\n\ninterface HasSpans {\n  colSpan?: number\n  rowSpan?: number\n  width?: number | string\n  minWidth?: number | string\n  maxWidth?: number | string\n}\n\nfunction normalizeLayout<T>(\n  layout: LayoutDefine<T>\n): HeaderBodyLayoutDefine<T> {\n  if (Array.isArray(layout)) {\n    return {\n      header: layout,\n      body: layout,\n    }\n  }\n  return layout\n}\n\nlet seqId = 0\n\nclass LayoutObjectGrid<T, D extends HasSpans> {\n  objects: T[] = []\n  objectGrid: T[][] = []\n  objectMap: { [key in LayoutObjectId]: T } = {}\n  columnCount = 0\n  columnWidths: WidthData[] = []\n  constructor(layout: D[][], transform: (d: D, id: LayoutObjectId) => T) {\n    layout.forEach((rowLayout, row) => {\n      let col = 0\n      rowLayout.forEach((cell) => {\n        const id = seqId++\n        const obj = transform(cell, id)\n        this.objects.push(obj)\n        this.objectMap[id] = obj\n        col = this._findStartCell(col, row)\n        const rowSpan = Number(cell.rowSpan ?? 1)\n        const colSpan = Number(cell.colSpan ?? 1)\n        const endRow = row + rowSpan\n        const endCol = col + colSpan\n        for (let rowIndex = row; rowIndex < endRow; rowIndex++) {\n          const objectGridRow = this._getObjectGridRow(rowIndex)\n          for (let colIndex = col; colIndex < endCol; colIndex++) {\n            objectGridRow[colIndex] = obj\n          }\n        }\n        if (colSpan === 1) {\n          this._setWidthDataIfAbsent(col, cell)\n        }\n        this._useColumnIndex(endCol - 1)\n        col = endCol\n      })\n    })\n  }\n  get rowCount(): number {\n    return this.objectGrid.length\n  }\n  private _findStartCell(col: number, row: number): number {\n    const objectGridRow = this._getObjectGridRow(row)\n    for (let index = col; index < objectGridRow.length; index++) {\n      if (!objectGridRow[index]) {\n        return index\n      }\n    }\n    return objectGridRow.length\n  }\n  private _getObjectGridRow(row: number): T[] {\n    return this.objectGrid[row] || (this.objectGrid[row] = [])\n  }\n  private _useColumnIndex(col: number): void {\n    if (this.columnCount > col) {\n      return\n    }\n    this.columnCount = col + 1\n  }\n  private _setWidthDataIfAbsent(col: number, cell: HasSpans): void {\n    if (!this.columnWidths[col]) {\n      if (\n        cell.width != null ||\n        cell.maxWidth != null ||\n        cell.minWidth != null\n      ) {\n        this.columnWidths[col] = {\n          width: cell.width,\n          maxWidth: cell.maxWidth,\n          minWidth: cell.minWidth,\n        }\n      }\n    }\n  }\n}\n\nexport class MultiLayoutMap<T> implements LayoutMapAPI<T> {\n  private _header: LayoutObjectGrid<HeaderData<T>, HeaderCellDefine<T>>\n  private _body: LayoutObjectGrid<ColumnData<T>, CellDefine<T>>\n  private _columnWidths: WidthData[] = []\n  private _columnCount: number\n  private _emptyDataCache = new EmptyDataCache()\n  constructor(layout: LayoutDefine<T>) {\n    const hbLayout = normalizeLayout(layout)\n    const header = (this._header = new LayoutObjectGrid(\n      hbLayout.header,\n      (hd: HeaderCellDefine<T>, id: LayoutObjectId): HeaderData<T> => {\n        return {\n          id,\n          caption: hd.caption,\n          field: hd.headerField || (hd as CellDefine<T>).field,\n          style: hd.headerStyle,\n          headerType: headers.type.ofCell(hd),\n          action: headers.action.ofCell(hd),\n          define: hd,\n          icon: hd.headerIcon,\n          tooltip: hd.headerTooltip,\n          tooltipType: hd.headerTooltipType,\n        }\n      }\n    ))\n    const body = (this._body = new LayoutObjectGrid(\n      hbLayout.body,\n      (colDef: CellDefine<T>, id: LayoutObjectId): ColumnData<T> => {\n        return {\n          id,\n          field: colDef.field,\n          width: colDef.width,\n          minWidth: colDef.minWidth,\n          maxWidth: colDef.maxWidth,\n          icon: colDef.icon,\n          message: colDef.message,\n          columnType: columns.type.of(colDef.columnType),\n          action: columns.action.of(colDef.action),\n          style: colDef.style,\n          define: colDef,\n          contentHidden: colDef.contentHidden,\n          disableResize: colDef.disableResize,\n          tooltip: colDef.tooltip,\n          tooltipType: colDef.tooltipType,\n        }\n      }\n    ))\n    const columnCount = (this._columnCount = Math.max(\n      header.columnCount,\n      body.columnCount\n    ))\n    for (let col = 0; col < columnCount; col++) {\n      const widthDef = header.columnWidths[col] || body.columnWidths[col] || {}\n      this._columnWidths[col] = widthDef\n    }\n  }\n  get columnWidths(): WidthData[] {\n    return this._columnWidths\n  }\n  get headerRowCount(): number {\n    return this._header.rowCount\n  }\n  get bodyRowCount(): number {\n    return this._body.rowCount\n  }\n  get colCount(): number {\n    return this._columnCount\n  }\n  get headerObjects(): HeaderData<T>[] {\n    return this._header.objects\n  }\n  get columnObjects(): ColumnData<T>[] {\n    return this._body.objects\n  }\n  getCellId(col: number, row: number): LayoutObjectId {\n    if (this.headerRowCount <= row) {\n      const bodyRow = row - this.headerRowCount\n      const bodyLayoutRow = bodyRow % this.bodyRowCount\n      return this._body.objectGrid[bodyLayoutRow]?.[col]?.id\n    }\n    //in header\n    return this._header.objectGrid[row]?.[col]?.id\n  }\n  getHeader(col: number, row: number): HeaderData<T> {\n    const id = this.getCellId(col, row)\n    return (\n      this._header.objectMap[id as number] ||\n      this._emptyDataCache.getHeader(col, row)\n    )\n  }\n  getBody(col: number, row: number): ColumnData<T> {\n    const id = this.getCellId(col, row)\n    return (\n      this._body.objectMap[id as number] ||\n      this._emptyDataCache.getBody(col, row)\n    )\n  }\n  getBodyLayoutRangeById(id: LayoutObjectId): CellRange {\n    for (let row = 0; row < this.bodyRowCount; row++) {\n      const objectGridRow = this._body.objectGrid[row]\n      if (!objectGridRow) {\n        continue\n      }\n      for (let col = 0; col < this.colCount; col++) {\n        if (id === objectGridRow[col]?.id) {\n          return this._getCellRange(this._body, col, row, 0)\n        }\n      }\n    }\n    throw new Error(`can not found body layout @id=${id as number}`)\n  }\n  getCellRange(col: number, row: number): CellRange {\n    if (this.headerRowCount <= row) {\n      const recordIndex = this.getRecordIndexByRow(row)\n      const startRow = this.getRecordStartRowByRecordIndex(recordIndex)\n      const bodyRow = row - this.headerRowCount\n      const bodyLayoutRow = bodyRow % this.bodyRowCount\n      return this._getCellRange(this._body, col, bodyLayoutRow, startRow)\n    }\n    //in header\n    return this._getCellRange(this._header, col, row, 0)\n  }\n  getRecordIndexByRow(row: number): number {\n    if (row < this.headerRowCount) {\n      return -1\n    } else {\n      const bodyRow = row - this.headerRowCount\n      return Math.floor(bodyRow / this.bodyRowCount)\n    }\n  }\n  getRecordStartRowByRecordIndex(index: number): number {\n    return this.headerRowCount + index * this.bodyRowCount\n  }\n  private _getCellRange(\n    layout: LayoutObjectGrid<HeaderData<T> | ColumnData<T>, any>,\n    col: number,\n    layoutRow: number,\n    offsetRow: number\n  ): CellRange {\n    const result: CellRange = {\n      start: { col, row: layoutRow + offsetRow },\n      end: { col, row: layoutRow + offsetRow },\n    }\n    const { objectGrid } = layout\n    const id = objectGrid[layoutRow]?.[col]?.id\n    if (id == null) {\n      return result\n    }\n    for (let c = col - 1; c >= 0; c--) {\n      if (id !== objectGrid[layoutRow]?.[c]?.id) {\n        break\n      }\n      result.start.col = c\n    }\n    for (let c = col + 1; c < layout.columnCount; c++) {\n      if (id !== objectGrid[layoutRow]?.[c]?.id) {\n        break\n      }\n      result.end.col = c\n    }\n    for (let r = layoutRow - 1; r >= 0; r--) {\n      if (id !== objectGrid[r]?.[col]?.id) {\n        break\n      }\n      result.start.row = r + offsetRow\n    }\n    for (let r = layoutRow + 1; r < layout.rowCount; r++) {\n      if (id !== objectGrid[r]?.[col]?.id) {\n        break\n      }\n      result.end.row = r + offsetRow\n    }\n    return result\n  }\n}\n","import { LayoutObjectId } from '../ts-types'\nimport { LayoutMapAPI } from './layout-map'\n\nexport class LayoutMap<T> implements LayoutMapAPI<T> {\n  private _layoutMap: LayoutMapAPI<T>\n  public hiddenHeader: boolean\n  constructor(layoutMap: LayoutMapAPI<T>) {\n    this._layoutMap = layoutMap\n  }\n  public get headerRowCount() {\n    return this.hiddenHeader ? 0 : this._layoutMap.headerRowCount\n  }\n  public get bodyRowCount() {\n    return this._layoutMap.bodyRowCount\n  }\n  public get colCount() {\n    return this._layoutMap.colCount\n  }\n\n  public get columnWidths() {\n    return this._layoutMap.columnWidths\n  }\n  public get headerObjects() {\n    return this._layoutMap.headerObjects\n  }\n  public get columnObjects() {\n    return this._layoutMap.columnObjects\n  }\n\n  public getHeader(col: number, row: number) {\n    if (this.hiddenHeader) {\n      row += this._layoutMap.headerRowCount\n    }\n    return this._layoutMap.getHeader(col, row)\n  }\n  public getBody(col: number, row: number) {\n    if (this.hiddenHeader) {\n      row += this._layoutMap.headerRowCount\n    }\n    return this._layoutMap.getBody(col, row)\n  }\n  public getCellId(col: number, row: number) {\n    if (this.hiddenHeader) {\n      row += this._layoutMap.headerRowCount\n    }\n    return this._layoutMap.getCellId(col, row)\n  }\n  public getCellRange(col: number, row: number) {\n    if (this.hiddenHeader) {\n      row += this._layoutMap.headerRowCount\n    }\n    const range = this._layoutMap.getCellRange(col, row)\n    if (this.hiddenHeader) {\n      range.start.row -= this._layoutMap.headerRowCount\n      range.end.row -= this._layoutMap.headerRowCount\n    }\n    return range\n  }\n  public getBodyLayoutRangeById(id: LayoutObjectId) {\n    const range = this._layoutMap.getBodyLayoutRangeById(id)\n    return range\n  }\n  public getRecordIndexByRow(row: number) {\n    if (this.hiddenHeader) {\n      row += this._layoutMap.headerRowCount\n    }\n    return this._layoutMap.getRecordIndexByRow(row)\n  }\n  public getRecordStartRowByRecordIndex(index: number) {\n    let row = this._layoutMap.getRecordStartRowByRecordIndex(index)\n    if (this.hiddenHeader) {\n      row -= this._layoutMap.headerRowCount\n    }\n    return row\n  }\n}\n","import { DG_EVENT_TYPE, DrawGridEvents } from '../core/draw-grid/DG_EVENT_TYPE'\n\nexport interface ListGridEvents extends DrawGridEvents {\n  /**\n   * Indicates when the cell value was changed.\n   */\n  CHANGED_VALUE: 'changed_value'\n  /**\n   * Indicates when the header cell value was changed.\n   */\n  CHANGED_HEADER_VALUE: 'changed_header_value'\n  /**\n   * Indicates when get the cell range.\n   */\n  CELL_RANGE: 'cell_range'\n  /**\n   * Indicates when get the cell value.\n   */\n  CELL_VALUE: 'cell_value'\n}\n\nexport const LG_EVENT_TYPE: ListGridEvents = {\n  ...DG_EVENT_TYPE,\n  CHANGED_HEADER_VALUE: 'changed_header_value' as const,\n  CHANGED_VALUE: 'changed_value' as const,\n  CELL_RANGE: 'cell_range' as const,\n  CELL_VALUE: 'cell_value' as const,\n}\n","import {\n  ListGridAPI,\n  CellContext,\n  GridCanvasHelperAPI,\n  MessageObject,\n  ColumnStyle,\n} from '../../ts-types'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { MessageElement } from './internal/MessageElement'\n\nexport abstract class BaseMessage<T> {\n  private _grid: ListGridAPI<T>\n  private _messageElement: MessageElement | undefined\n  public constructor(grid: ListGridAPI<T>) {\n    this._grid = grid\n  }\n  public dispose() {\n    this.detachMessageElement()\n    if (this._messageElement) {\n      this._messageElement.dispose()\n    }\n    delete this._messageElement\n  }\n  abstract createMessageElementInternal(): MessageElement\n  public drawCellMessageInternal(\n    message: MessageObject,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    // nothing\n  }\n  public attachMessageElement(col: number, row: number, message: any) {\n    const messageElement = this._getMessageElement()\n    messageElement.attach(this._grid, col, row, message)\n  }\n  public moveMessageElement(col: number, row: number) {\n    const messageElement = this._getMessageElement()\n    messageElement.move(this._grid, col, row)\n  }\n  public detachMessageElement() {\n    const messageElement = this._getMessageElement()\n    messageElement.detach()\n  }\n  public drawCellMessage(\n    message: MessageObject,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ) {\n    this.drawCellMessageInternal(message, context, style, helper, grid, info)\n  }\n  private _getMessageElement() {\n    return (\n      this._messageElement ||\n      (this._messageElement = this.createMessageElementInternal())\n    )\n  }\n}\n","import { ListGridAPI, MessageObject } from '../../../ts-types'\nimport { createElement } from '../../../internal/dom'\nimport { EventHandler } from '../../../internal/EventHandler'\nimport style from '../../../internal/style'\n\nimport messageElementCss from './MessageElement.css'\n\nconst CLASSNAME_ME = 'kaka-grid__message-element'\nconst MESSAGE_CLASSNAME_ME = `${CLASSNAME_ME}__message`\nconst HIDDEN_CLASSNAME_ME = `${CLASSNAME_ME}--hidden`\nconst SHOWN_CLASSNAME_ME = `${CLASSNAME_ME}--shown`\n\nfunction createMessageDomElement() {\n  style.inject('messageElement', messageElementCss)\n  const rootElement = createElement('div', {\n    classList: [CLASSNAME_ME, HIDDEN_CLASSNAME_ME],\n  })\n  const messageElement = createElement('span', {\n    classList: [MESSAGE_CLASSNAME_ME],\n  })\n  rootElement.appendChild(messageElement)\n  return rootElement\n}\n\nexport class MessageElement {\n  protected _rootElement: HTMLDivElement\n  protected _messageElement: Element\n  private _handler: EventHandler\n  public constructor() {\n    this._handler = new EventHandler()\n    const rootElement = (this._rootElement = createMessageDomElement())\n    this._messageElement = rootElement.querySelector(\n      `.${MESSAGE_CLASSNAME_ME}`\n    ) as Element\n  }\n  public dispose(): void {\n    this.detach()\n    this._handler.dispose()\n  }\n  public attach<T>(\n    grid: ListGridAPI<T>,\n    col: number,\n    row: number,\n    message: MessageObject\n  ): void {\n    const rootElement = this._rootElement\n    const messageElement = this._messageElement\n\n    rootElement.classList.remove(SHOWN_CLASSNAME_ME)\n    rootElement.classList.add(HIDDEN_CLASSNAME_ME)\n\n    if (this._attachCell(grid, col, row)) {\n      rootElement.classList.add(SHOWN_CLASSNAME_ME)\n      rootElement.classList.remove(HIDDEN_CLASSNAME_ME)\n\n      messageElement.textContent = message.message\n    } else {\n      this._detach()\n    }\n  }\n  public move<T>(grid: ListGridAPI<T>, col: number, row: number): void {\n    const rootElement = this._rootElement\n    if (rootElement && this._attachCell(grid, col, row)) {\n      rootElement.classList.add(SHOWN_CLASSNAME_ME)\n      rootElement.classList.remove(HIDDEN_CLASSNAME_ME)\n    } else {\n      this._detach()\n    }\n  }\n  public detach(): void {\n    this._detach()\n  }\n  private _detach(): void {\n    const rootElement = this._rootElement\n    if (rootElement && rootElement.parentElement) {\n      rootElement.parentElement.removeChild(rootElement)\n      rootElement.classList.remove(SHOWN_CLASSNAME_ME)\n      rootElement.classList.add(HIDDEN_CLASSNAME_ME)\n    }\n  }\n  private _attachCell<T>(\n    grid: ListGridAPI<T>,\n    col: number,\n    row: number\n  ): boolean {\n    const rootElement = this._rootElement\n    const { element, rect } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n    const top = rect.bottom\n    const left = rect.left\n    const width = rect.width\n    const frozenRowCount = grid.frozenRowCount\n    const frozenColCount = grid.frozenColCount\n    if (row >= frozenRowCount && frozenRowCount > 0) {\n      const { rect: frozenRect } = grid.getAttachCellsArea(\n        grid.getCellRange(col, frozenRowCount - 1)\n      )\n      if (top < frozenRect.bottom) {\n        return false // 超出范围\n      }\n    } else {\n      if (top < 0) {\n        return false // 超出范围\n      }\n    }\n    if (col >= frozenColCount && frozenColCount > 0) {\n      const { rect: frozenRect } = grid.getAttachCellsArea(\n        grid.getCellRange(frozenColCount - 1, row)\n      )\n      if (left < frozenRect.right) {\n        return false // 超出范围\n      }\n    } else {\n      if (left < 0) {\n        return false // 超出范围\n      }\n    }\n    const offsetHeight = element.offsetHeight\n    const offsetWidth = element.offsetWidth\n    if (offsetHeight < top) {\n      return false // 超出范围\n    }\n    if (offsetWidth < left) {\n      return false // 超出范围\n    }\n\n    rootElement.style.top = `${top.toFixed()}px`\n    rootElement.style.left = `${left.toFixed()}px`\n    rootElement.style.width = `${width.toFixed()}px`\n    if (rootElement.parentElement !== element) {\n      element.appendChild(rootElement)\n    }\n    return true\n  }\n}\n","import style from '../../../internal/style'\nimport { MessageElement } from './MessageElement'\n\nimport errorMessageElementCss from './ErrorMessageElement.css'\n\nconst CLASSNAME_EME = 'kaka-grid__error-message-element'\nconst MESSAGE_CLASSNAME_EME = `${CLASSNAME_EME}__message`\n\nexport class ErrorMessageElement extends MessageElement {\n  public constructor() {\n    super()\n    style.inject('errorMessageElement', errorMessageElementCss)\n    this._rootElement.classList.add(CLASSNAME_EME)\n    this._messageElement.classList.add(MESSAGE_CLASSNAME_EME)\n  }\n}\n","import { CellContext, ColorDef, GridCanvasHelperAPI } from '../../ts-types'\nimport Rect from '../../internal/Rect'\n\nexport function drawExclamationMarkBox(\n  context: CellContext,\n  style: {\n    bgColor: ColorDef\n    color?: ColorDef\n  },\n  helper: GridCanvasHelperAPI\n): void {\n  const bgColor = style.bgColor\n  const color = style.color\n  const ctx = context.getContext()\n  const rect = context.getRect()\n  // draw box\n  ctx.fillStyle = bgColor\n  const boxRect = (rect as Rect).copy()\n  boxRect.left = boxRect.right - 24\n  ctx.fillRect(boxRect.left, boxRect.top, boxRect.width, boxRect.height - 1)\n\n  // draw exclamation mark\n  const fillColor = color\n  const height = 20\n  const width = height / 5\n  const left = boxRect.left + (boxRect.width - width) / 2\n  const top = boxRect.top + (boxRect.height - height) / 2\n  helper.fillRectWithState(\n    new Rect(left, top, width, (height / 5) * 3),\n    context,\n    { fillColor }\n  )\n  helper.fillRectWithState(\n    new Rect(left, top + (height / 5) * 4, width, height / 5),\n    context,\n    { fillColor }\n  )\n}\n\nexport function drawInformationMarkBox(\n  context: CellContext,\n  style: {\n    bgColor: ColorDef\n    color?: ColorDef\n  },\n  helper: GridCanvasHelperAPI\n) {\n  const bgColor = style.bgColor\n  const color = style.color\n  const ctx = context.getContext()\n  const rect = context.getRect()\n  // draw box\n  ctx.fillStyle = bgColor\n  const boxRect = (rect as Rect).copy()\n  boxRect.left = boxRect.right - 24\n  ctx.fillRect(boxRect.left, boxRect.top, boxRect.width, boxRect.height - 1)\n\n  // draw i mark\n  const fillColor = color\n  const height = 20\n  const width = height / 5\n  const left = boxRect.left + (boxRect.width - width) / 2\n  const top = boxRect.top + (boxRect.height - height) / 2\n  helper.fillRectWithState(new Rect(left, top, width, height / 5), context, {\n    fillColor,\n  })\n  helper.fillRectWithState(\n    new Rect(left, top + (height / 5) * 2, width, (height / 5) * 3),\n    context,\n    { fillColor }\n  )\n}\n","import { BaseMessage } from './BaseMessage'\nimport { ErrorMessageElement } from './internal/ErrorMessageElement'\nimport { drawExclamationMarkBox } from './messageUtils'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport {\n  MessageObject,\n  CellContext,\n  ColumnStyle,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n} from '../../ts-types'\nimport { cellInRange } from '../../internal/utils'\n\nconst RED_A100 = '#ff8a80'\n\nexport class ErrorMessage<T> extends BaseMessage<T> {\n  public createMessageElementInternal() {\n    return new ErrorMessageElement()\n  }\n  public drawCellMessageInternal(\n    message: MessageObject,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    const bgColor = style.bgColor\n    const { select } = context.getSelection()\n\n    if (\n      !cellInRange(\n        grid.getCellRange(context.col, context.row),\n        select.col,\n        select.row\n      ) ||\n      !grid.hasFocusGrid()\n    ) {\n      helper.drawBorderWithClip(context, (ctx) => {\n        drawExclamationMarkBox(\n          context,\n          {\n            bgColor: RED_A100,\n            color: bgColor,\n          },\n          helper\n        )\n      })\n    }\n  }\n}\n","import { drawInformationMarkBox } from './messageUtils'\nimport {\n  MessageObject,\n  CellContext,\n  GridCanvasHelperAPI,\n  ColumnStyle,\n  ListGridAPI,\n} from '../../ts-types'\nimport { BaseMessage } from './BaseMessage'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { MessageElement } from './internal/MessageElement'\nimport { cellInRange } from '../../internal/utils'\n\nconst GREY_L2 = '#e0e0e0'\n\nexport class InfoMessage<T> extends BaseMessage<T> {\n  public createMessageElementInternal(): MessageElement {\n    return new MessageElement()\n  }\n  public drawCellMessageInternal(\n    _message: MessageObject,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    _info: DrawCellInfo<T>\n  ) {\n    const { bgColor } = style\n    const { select } = context.getSelection()\n    if (\n      !cellInRange(\n        grid.getCellRange(context.col, context.row),\n        select.col,\n        select.row\n      ) ||\n      !grid.hasFocusGrid()\n    ) {\n      helper.drawBorderWithClip(context, (_ctx) => {\n        drawInformationMarkBox(\n          context,\n          {\n            bgColor: GREY_L2,\n            color: bgColor,\n          },\n          helper\n        )\n      })\n    }\n  }\n}\n","import style from '../../../internal/style'\nimport { MessageElement } from './MessageElement'\n\nimport warningMessageElementCss from './WarningMessageElement.css'\n\nconst CLASSNAME_WME = 'kaka-grid__warning-message-element'\nconst MESSAGE_CLASSNAME_WME = `${CLASSNAME_WME}__message`\n\nexport class WarningMessageElement extends MessageElement {\n  public constructor() {\n    super()\n    style.inject('warningMessageElement', warningMessageElementCss)\n    this._rootElement.classList.add(CLASSNAME_WME)\n    this._messageElement.classList.add(MESSAGE_CLASSNAME_WME)\n  }\n}\n","import { drawExclamationMarkBox } from './messageUtils'\nimport {\n  MessageObject,\n  CellContext,\n  ColumnStyle,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n} from '../../ts-types'\nimport { BaseMessage } from './BaseMessage'\nimport { DrawCellInfo } from '../../ts-types-internal'\nimport { WarningMessageElement } from './internal/WarningMessageElement'\nimport { cellInRange } from '../../internal/utils'\n\nconst DEEP_ORANGE_A100 = '#ff9e80'\n\nexport class WarningMessage<T> extends BaseMessage<T> {\n  public createMessageElementInternal(): WarningMessageElement {\n    return new WarningMessageElement()\n  }\n  public drawCellMessageInternal(\n    _message: MessageObject,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    _info: DrawCellInfo<T>\n  ): void {\n    const { bgColor } = style\n    const { select } = context.getSelection()\n    if (\n      !cellInRange(\n        grid.getCellRange(context.col, context.row),\n        select.col,\n        select.row\n      ) ||\n      !grid.hasFocusGrid()\n    ) {\n      helper.drawBorderWithClip(context, (ctx) => {\n        drawExclamationMarkBox(\n          context,\n          {\n            bgColor: DEEP_ORANGE_A100,\n            color: bgColor,\n          },\n          helper\n        )\n      })\n    }\n  }\n}\n","import { MessageHandler as Base, DrawCellInfo } from '../../ts-types-internal'\nimport {\n  CellContext,\n  ColumnStyle,\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  Message,\n  MessageObject,\n  CellAddress,\n} from '../../ts-types'\nimport { BaseMessage } from './BaseMessage'\nimport { LG_EVENT_TYPE } from '../../list-grid/LG_EVENT_TYPE'\nimport { ErrorMessage } from './ErrorMessage'\nimport { InfoMessage } from './InfoMessage'\nimport { WarningMessage } from './WarningMessage'\nimport { isPromise } from '../../internal/utils'\n\nconst EMPTY_MESSAGE: MessageObject = {\n  type: 'error',\n  message: null,\n}\n\nconst MESSAGE_INSTANCE_FACTORY = {\n  error<T>(grid: ListGridAPI<T>): BaseMessage<T> {\n    return new ErrorMessage(grid)\n  },\n  info<T>(grid: ListGridAPI<T>): BaseMessage<T> {\n    return new InfoMessage(grid)\n  },\n  warning<T>(grid: ListGridAPI<T>): BaseMessage<T> {\n    return new WarningMessage(grid)\n  },\n}\n\nfunction normalizeMessage(message: Message): MessageObject {\n  if (!message || isPromise(message)) {\n    return EMPTY_MESSAGE\n  }\n  if (typeof message === 'string') {\n    return {\n      message,\n      original: message,\n      type: 'error',\n    }\n  }\n  const type = message.type || 'error'\n  if (type && type in MESSAGE_INSTANCE_FACTORY) {\n    return {\n      type: type.toLowerCase() as MessageObject['type'],\n      message: `${message.message}`,\n      original: message,\n    }\n  }\n  return {\n    type: 'error',\n    message: `${message}`,\n    original: message,\n  }\n}\n\nfunction hasMessage(message: Message): boolean {\n  return !!normalizeMessage(message).message\n}\n\nexport class MessageHandler<T> implements Base<T> {\n  private _grid: ListGridAPI<T>\n  private _messageInstances: {\n    [k in MessageObject['type']]?: BaseMessage<T>\n  }\n  private _attachInfo: {\n    col: number\n    row: number\n    instance: BaseMessage<T>\n  } | null = null\n  public constructor(\n    grid: ListGridAPI<T>,\n    getMessage: (col: number, row: number) => Message\n  ) {\n    this._grid = grid\n    this._messageInstances = {}\n    this._bindGridEvent(grid, getMessage)\n  }\n  public dispose(): void {\n    const messageInstances = this._messageInstances\n    for (const k in messageInstances) {\n      messageInstances[k as MessageObject['type']]?.dispose()\n    }\n  }\n  public drawCellMessage(\n    message: Message,\n    context: CellContext,\n    style: ColumnStyle,\n    helper: GridCanvasHelperAPI,\n    grid: ListGridAPI<T>,\n    info: DrawCellInfo<T>\n  ): void {\n    if (!hasMessage(message)) {\n      return\n    }\n    const instance = this._getMessageInstanceOfMessage(message)\n    instance.drawCellMessage(\n      normalizeMessage(message),\n      context,\n      style,\n      helper,\n      grid,\n      info\n    )\n  }\n  private _attach(col: number, row: number, message: Message): void {\n    const info = this._attachInfo\n    const instance = this._getMessageInstanceOfMessage(message)\n    if (info && info.instance !== instance) {\n      info.instance.detachMessageElement()\n    }\n    instance.attachMessageElement(col, row, normalizeMessage(message))\n    this._attachInfo = { col, row, instance }\n  }\n  private _move(col: number, row: number): void {\n    const info = this._attachInfo\n    if (!info || info.col !== col || info.row !== row) {\n      return\n    }\n    const { instance } = info\n    instance.moveMessageElement(col, row)\n  }\n  private _detach(): void {\n    const info = this._attachInfo\n    if (!info) {\n      return\n    }\n    const { instance } = info\n    instance.detachMessageElement()\n    this._attachInfo = null\n  }\n  private _bindGridEvent(\n    grid: ListGridAPI<T>,\n    getMessage: (col: number, row: number) => Message\n  ): void {\n    const onSelectMessage = (sel: CellAddress): void => {\n      const message = getMessage(sel.col, sel.row)\n      if (!hasMessage(message)) {\n        this._detach()\n      } else {\n        this._attach(sel.col, sel.row, message)\n      }\n    }\n    grid.listen(LG_EVENT_TYPE.SELECTED_CELL, (e) => {\n      if (!e.selected) {\n        return\n      }\n      if (e.before.col === e.col && e.before.row === e.row) {\n        return\n      }\n      onSelectMessage(e)\n    })\n    grid.listen(LG_EVENT_TYPE.SCROLL, () => {\n      const sel = grid.selection.select\n      this._move(sel.col, sel.row)\n    })\n    grid.listen(LG_EVENT_TYPE.CHANGED_VALUE, (e) => {\n      const sel = grid.selection.select\n      if (sel.col !== e.col || sel.row !== e.row) {\n        return\n      }\n      onSelectMessage(e)\n    })\n    grid.listen(LG_EVENT_TYPE.FOCUS_GRID, (_e) => {\n      const sel = grid.selection.select\n      onSelectMessage(sel)\n    })\n    grid.listen(LG_EVENT_TYPE.BLUR_GRID, (_e) => {\n      this._detach()\n    })\n  }\n  private _getMessageInstanceOfMessage(message: Message): BaseMessage<T> {\n    const messageInstances = this._messageInstances\n    const type = normalizeMessage(message).type\n    return (\n      messageInstances[type] ||\n      (messageInstances[type] = MESSAGE_INSTANCE_FACTORY[type](this._grid))\n    )\n  }\n}\n","import { IconDefine } from '../ts-types'\n\nexport const icons: { [key: string]: IconDefine } = {}\n","const parser = new DOMParser()\nconst ELEMENT_NODE = 1\n\nfunction findElement(\n  el: Element,\n  test: (child: Element) => boolean\n): Element | null {\n  for (let i = 0; i < el.childNodes.length; i++) {\n    const child = el.childNodes[i]\n    if (child.nodeType !== ELEMENT_NODE) {\n      continue\n    }\n    if (test(child as Element)) {\n      return child as Element\n    }\n    const r = findElement(child as Element, test)\n    if (r) {\n      return r\n    }\n  }\n  return null\n}\n\nclass Svg {\n  private _svg: HTMLElement\n  private _glyphs: { [key: string]: Element }\n  private _glyphUnis: { [key: string]: Element }\n  private _fontFace: Element | null | undefined\n  private _font: Element | null | undefined\n  public constructor(svgCode: string) {\n    const document = parser.parseFromString(svgCode, 'image/svg+xml')\n    this._svg = document.documentElement as HTMLElement\n    this._glyphs = {}\n    this._glyphUnis = {}\n  }\n  public get svg() {\n    return this._svg\n  }\n  public get fontFaceElement() {\n    if (!this._fontFace) {\n      this._fontFace = this.findElement(\n        (child) => child.tagName.toLowerCase() === 'font-face'\n      )\n    }\n    return this._fontFace\n  }\n  public get fontElement() {\n    if (!this._font) {\n      this._font = this.findElement(\n        (child) => child.tagName.toLowerCase() === 'font'\n      )\n    }\n    return this._font\n  }\n  public findElement(test: (child: Element) => boolean): Element {\n    return findElement(this.svg, test) as Element\n  }\n  public findGlyph(glyphName: string) {\n    return (\n      this._glyphs[glyphName] ||\n      (this._glyphs[glyphName] = this.findElement(\n        (child) => child.getAttribute('glyph-name') === glyphName\n      ))\n    )\n  }\n  public findGlyphByUnicode(unicode: string) {\n    return (\n      this._glyphUnis[unicode] ||\n      (this._glyphUnis[unicode] = this.findElement(\n        (child) => child.getAttribute('unicode') === unicode\n      ))\n    )\n  }\n  public walkAllGlyph(callback: (child: Element) => void) {\n    const walkGlyph = (el: Element, fn: (child: Element) => void) => {\n      for (let i = 0; i < el.childNodes.length; i++) {\n        const child = el.childNodes[i] as Element\n        if (child.nodeType !== ELEMENT_NODE) {\n          continue\n        }\n        const unicode = child.getAttribute('unicode')\n        if (unicode && child.getAttribute('d')) {\n          if (!this._glyphUnis[unicode]) {\n            this._glyphUnis[unicode] = child\n          }\n          const glyphName = child.getAttribute('glyph-name')\n          if (glyphName && !this._glyphs[glyphName]) {\n            this._glyphs[glyphName] = child\n          }\n          fn(child)\n        } else {\n          walkGlyph(child, fn)\n        }\n      }\n    }\n    walkGlyph(this.svg, callback)\n  }\n}\n\nexport default Svg\n","import Svg from './Svg'\nconst ELEMENT_NODE = 1\n\nfunction polygonToPath(polygon: Element) {\n  const points = polygon.getAttribute('points')\n  return `M${points}z`\n}\n\nfunction polylineToPath(polyline: Element) {\n  const points = polyline.getAttribute('points')\n  return `M${points}`\n}\n\nfunction circleToPath(circle: Element) {\n  const cx = Number(circle.getAttribute('cx'))\n  const cy = Number(circle.getAttribute('cy'))\n  const r = Number(circle.getAttribute('r'))\n\n  // https://tyru.github.io/svg-circle-misc-algorithm/\n  const SEGMENTS = 8\n  const ANGLE = (2 * Math.PI) / SEGMENTS\n  const anchorX = (theta: number) => r * Math.cos(theta)\n  const anchorY = (theta: number) => r * Math.sin(theta)\n  const controlX = (theta: number) =>\n    anchorX(theta) + r * Math.tan(ANGLE / 2) * Math.cos(theta - Math.PI / 2)\n  const controlY = (theta: number) =>\n    anchorY(theta) + r * Math.tan(ANGLE / 2) * Math.sin(theta - Math.PI / 2)\n\n  let paths = `M${cx + r} ${cy}`\n  for (let index = 1; index <= SEGMENTS; index++) {\n    const theta = index * ANGLE\n    paths += `Q${controlX(theta) + cx} ${controlY(theta) + cy} ${\n      anchorX(theta) + cx\n    } ${anchorY(theta) + cy}`\n  }\n  return paths\n}\n\nfunction getD(path: Element) {\n  const fill = path.getAttribute('fill')\n  if (fill === 'none') {\n    return ''\n  }\n  return (path.getAttribute('d') as string).replace(/[\\n\\r]/g, '')\n}\n\nfunction elementToPaths(el: Element) {\n  let path = ''\n  switch (el.tagName.toLowerCase()) {\n    case 'path':\n    case 'glyph':\n      path = getD(el)\n      break\n    case 'circle':\n      path = circleToPath(el)\n      break\n    case 'polygon':\n      path = polygonToPath(el)\n      break\n    case 'polyline':\n      path = polylineToPath(el)\n      break\n    case 'g':\n      for (let i = 0; i < el.childNodes.length; i++) {\n        const child = el.childNodes[i]\n        if (child.nodeType !== ELEMENT_NODE) {\n          continue\n        }\n        if (!(child as Element).getAttribute('fill')) {\n          ;(child as Element).setAttribute(\n            'fill',\n            el.getAttribute('fill') as string\n          )\n        }\n        path += elementToPaths(child as Element)\n      }\n      break\n    default:\n      window.console.warn(`unsupported:${el.tagName}`, `@ ${el.innerHTML}`)\n  }\n  return path\n}\n\nfunction buildObject(\n  obj: {\n    offsetX?: number\n    offsetY?: number\n    width?: number\n    height?: number\n    d?: string\n    isGlyph?: boolean\n    html?: string\n  } = {}\n) {\n  const icon: {\n    d: string\n    height: number\n    width: number\n    html: string\n    ud?: boolean // upside Down\n    offsetX?: number\n    offsetY?: number\n  } = {\n    d: obj.d || '',\n    html: obj.html || '',\n    height: obj.height || 0,\n    width: obj.width || 0,\n  }\n  if (obj.isGlyph) {\n    icon.ud = true\n  }\n  if (obj.offsetX !== undefined) {\n    icon.offsetX = obj.offsetX\n  }\n  if (obj.offsetY !== undefined) {\n    icon.offsetY = obj.offsetY\n  }\n  return icon\n}\n\nfunction glyphToJSON(\n  svgCode: string,\n  opt: {\n    glyphName?: string\n    unicode?: string\n  }\n) {\n  const svg = new Svg(svgCode)\n  function findGlyph() {\n    if (opt.glyphName) {\n      return svg.findGlyph(opt.glyphName)\n    } else if (opt.unicode) {\n      return svg.findGlyphByUnicode(opt.unicode)\n    }\n  }\n  const fontFace = svg.fontFaceElement || {\n    getAttribute(qualifiedName: string) {\n      return null\n    },\n  }\n  const font = svg.fontElement || {\n    getAttribute(qualifiedName: string) {\n      return null\n    },\n  }\n  const glyph = findGlyph() as Element\n  // 左下角的x坐标值，同y坐标值，右上角的x坐标值，同y坐标值\n  // const bbox = (fontFace.getAttribute(\"bbox\") || \"\").split(\" \");\n  // bbox.st = {\n  // \tx: bbox[0] - 0,\n  // \ty: bbox[1] - 0,\n  // };\n  // bbox.ed = {\n  // \tx: bbox[2] - 0,\n  // \ty: bbox[3] - 0,\n  // };\n\n  const fontHorizAdvX = Number(font.getAttribute('horiz-adv-x')) || 0\n  const fontVertAdvX = Number(font.getAttribute('vert-adv-x')) || 0\n  const horizAdvX =\n    Number(glyph.getAttribute('horiz-adv-x')) || fontHorizAdvX || 0\n  const vertAdvX = Number(glyph.getAttribute('vert-adv-x')) || fontVertAdvX || 0\n\n  const unitsPerEm = Number(fontFace.getAttribute('units-per-em')) || 1000\n  // const ascent = Number(fontFace.getAttribute(\"ascent\")) || (unitsPerEm - vertAdvX);\n  const descent = Number(fontFace.getAttribute('descent')) || vertAdvX\n\n  let size = unitsPerEm\n  const contentSize = {\n    height: vertAdvX || unitsPerEm,\n    width: horizAdvX || unitsPerEm,\n  }\n  if (horizAdvX > size) {\n    size = horizAdvX\n  }\n  if (vertAdvX > size) {\n    size = vertAdvX\n  }\n\n  let offsetX = 0 // -bbox.st.x || 0;\n  let offsetY = -descent\n  offsetX += Math.round((size - contentSize.width) / 2)\n  offsetY += Math.round((size - contentSize.height) / 2)\n\n  const d = elementToPaths(glyph)\n\n  return buildObject({\n    d,\n    height: size,\n    html: glyph.outerHTML,\n    isGlyph: true,\n    offsetX,\n    offsetY,\n    width: size,\n  })\n}\n\nfunction svgToJSON(svgCode: string) {\n  const svg = new Svg(svgCode).svg\n  const viewBox = (svg.getAttribute('viewBox') || '').split(' ')\n  const width = Number(svg.getAttribute('width') || viewBox[2]) || 0\n  const height = Number(svg.getAttribute('height') || viewBox[3]) || 0\n  const offsetX = 0 - Number(viewBox[0]) || 0\n  const offsetY = 0 - Number(viewBox[1]) || 0\n\n  let d = ''\n  for (let i = 0; i < svg.childNodes.length; i++) {\n    const el = svg.childNodes[i]\n    if (el.nodeType !== ELEMENT_NODE) {\n      continue\n    }\n    d += elementToPaths(el as Element)\n  }\n  return buildObject({\n    d,\n    height,\n    html: svgCode,\n    offsetX,\n    offsetY,\n    width,\n  })\n}\n\nconst svgToIcon = (\n  svgCode: string,\n  opt: {\n    glyphName?: string\n    unicode?: string\n  } = {}\n) => {\n  if (opt.glyphName || opt.unicode) {\n    return glyphToJSON(svgCode, opt)\n  } else {\n    return svgToJSON(svgCode)\n  }\n}\n\nexport default svgToIcon\n","import { IconDefine } from './ts-types'\n\nimport { extend } from './internal/utils'\nimport { icons as plugins } from './plugins/icons'\nimport svgToIcon from './tools/svgToIcon'\n\nimport add from './icons/ic_add_48px.svg'\nimport edit from './icons/ic_edit_48px.svg'\nimport arrowDownward from './icons/ic_arrow_downward_48px.svg'\nimport arrowUpward from './icons/ic_arrow_upward_48px.svg'\nimport star from './icons/ic_star_24px.svg'\nimport starBorder from './icons/ic_star_border_24px.svg'\nimport starHalf from './icons/ic_star_half_24px.svg'\n\nconst builtins = {\n  add: svgToIcon(add),\n  arrowDownward: svgToIcon(arrowDownward),\n  arrowUpward: svgToIcon(arrowUpward),\n  edit: svgToIcon(edit),\n  star: svgToIcon(star),\n  starBorder: svgToIcon(starBorder),\n  starHalf: svgToIcon(starHalf),\n}\n\nexport const svgIcons = {\n  get(): { [key: string]: IconDefine } {\n    return extend(builtins, plugins)\n  },\n}\n","import { CanvasOperations } from './internal'\n\nfunction mag(v: [number, number]): number {\n  return Math.sqrt(v[0] ** 2 + v[1] ** 2)\n}\n\nfunction dot(u: [number, number], v: [number, number]): number {\n  return u[0] * v[0] + u[1] * v[1]\n}\n\nfunction ratio(u: [number, number], v: [number, number]): number {\n  return dot(u, v) / (mag(u) * mag(v))\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max)\n}\n\nfunction angle(u: [number, number], v: [number, number]): number {\n  let sign = 1.0\n  if (u[0] * v[1] - u[1] * v[0] < 0) {\n    sign = -1.0\n  }\n  return sign * Math.acos(clamp(ratio(u, v), -1, 1))\n}\n\nfunction rotClockwise(v: [number, number], angle: number): [number, number] {\n  const cost = Math.cos(angle)\n  const sint = Math.sin(angle)\n  return [cost * v[0] + sint * v[1], -1 * sint * v[0] + cost * v[1]]\n}\n\nfunction rotCounterClockwise(\n  v: [number, number],\n  angle: number\n): [number, number] {\n  const cost = Math.cos(angle)\n  const sint = Math.sin(angle)\n  return [cost * v[0] - sint * v[1], sint * v[0] + cost * v[1]]\n}\n\nfunction midPoint(u: [number, number], v: [number, number]): [number, number] {\n  return [(u[0] - v[0]) / 2.0, (u[1] - v[1]) / 2.0]\n}\n\nfunction meanVec(u: [number, number], v: [number, number]): [number, number] {\n  return [(u[0] + v[0]) / 2.0, (u[1] + v[1]) / 2.0]\n}\n\nfunction pointMul(u: [number, number], v: [number, number]): [number, number] {\n  return [u[0] * v[0], u[1] * v[1]]\n}\n\nfunction scale(c: number, v: [number, number]): [number, number] {\n  return [c * v[0], c * v[1]]\n}\n\nfunction sum(u: [number, number], v: [number, number]): [number, number] {\n  return [u[0] + v[0], u[1] + v[1]]\n}\n// Convert an SVG elliptical arc to a series of canvas commands.\n//\n// x1, y1, x2, y2: start and stop coordinates of the ellipse.\n// rx, ry: radii of the ellipse.\n// phi: rotation of the ellipse.\n// fA: large arc flag.\n// fS: sweep flag.\nfunction ellipseFromEllipticalArc(\n  ctx: CanvasOperations,\n  x1: number,\n  y1: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  fA: number,\n  fS: number,\n  x2: number,\n  y2: number\n): void {\n  // Convert from endpoint to center parametrization, as detailed in:\n  //   http://www.w3.org/TR/SVG/implnote.html#ArcImplementationNotes\n  if (rx === 0 || ry === 0) {\n    ctx.lineTo(x2, y2)\n    return\n  }\n  phi *= Math.PI / 180.0\n  rx = Math.abs(rx)\n  ry = Math.abs(ry)\n  const xPrime = rotClockwise(midPoint([x1, y1], [x2, y2]), phi) // F.6.5.1\n  const xPrime2 = pointMul(xPrime, xPrime)\n  let rx2 = rx ** 2\n  let ry2 = ry ** 2\n\n  const lambda = Math.sqrt(xPrime2[0] / rx2 + xPrime2[1] / ry2)\n  if (lambda > 1) {\n    rx *= lambda\n    ry *= lambda\n    rx2 = rx ** 2\n    ry2 = ry ** 2\n  }\n  let factor = Math.sqrt(\n    Math.abs(rx2 * ry2 - rx2 * xPrime2[1] - ry2 * xPrime2[0]) /\n      (rx2 * xPrime2[1] + ry2 * xPrime2[0])\n  )\n  if (fA === fS) {\n    factor *= -1.0\n  }\n  const cPrime = scale(factor, [(rx * xPrime[1]) / ry, (-ry * xPrime[0]) / rx]) // F.6.5.2\n  const c = sum(rotCounterClockwise(cPrime, phi), meanVec([x1, y1], [x2, y2])) // F.6.5.3\n  const x1UnitVector: [number, number] = [\n    (xPrime[0] - cPrime[0]) / rx,\n    (xPrime[1] - cPrime[1]) / ry,\n  ]\n  const x2UnitVector: [number, number] = [\n    (-1.0 * xPrime[0] - cPrime[0]) / rx,\n    (-1.0 * xPrime[1] - cPrime[1]) / ry,\n  ]\n  const theta = angle([1, 0], x1UnitVector) // F.6.5.5\n  const deltaTheta = angle(x1UnitVector, x2UnitVector) // F.6.5.6\n  const start = theta\n  const end = theta + deltaTheta\n  ctx.save()\n  ctx.translate(c[0], c[1])\n  ctx.rotate(phi)\n  ctx.scale(rx, ry)\n  ctx.arc(0, 0, 1, start, end, !fS)\n  ctx.restore()\n}\n\nexport default class PathCommands {\n  public readonly M: (px: number, py: number) => this\n  public readonly m: (px: number, py: number) => this\n  public readonly L: (px: number, py: number) => this\n  public readonly l: (px: number, py: number) => this\n  public readonly H: (px: number) => this\n  public readonly h: (px: number) => this\n  public readonly V: (py: number) => this\n  public readonly v: (py: number) => this\n  public readonly Z: () => this\n  public readonly z: () => this\n  public readonly C: (\n    cp1x: number,\n    cp1y: number,\n    cp2x: number,\n    cp2y: number,\n    px: number,\n    py: number\n  ) => this\n  public readonly c: (\n    cp1x: number,\n    cp1y: number,\n    cp2x: number,\n    cp2y: number,\n    px: number,\n    py: number\n  ) => this\n  public readonly S: (cpx: number, cpy: number, px: number, py: number) => this\n  public readonly s: (cpx: number, cpy: number, px: number, py: number) => this\n  public readonly Q: (cpx: number, cpy: number, px: number, py: number) => this\n  public readonly q: (cpx: number, cpy: number, px: number, py: number) => this\n  public readonly T: (px: number, py: number) => this\n  public readonly t: (px: number, py: number) => this\n  public readonly A: (\n    rx: number,\n    ry: number,\n    xAxisRotation: number,\n    largeArcFlag: number,\n    sweepFlag: number,\n    px: number,\n    py: number\n  ) => this\n  public readonly a: (\n    rx: number,\n    ry: number,\n    xAxisRotation: number,\n    largeArcFlag: number,\n    sweepFlag: number,\n    px: number,\n    py: number\n  ) => this\n  constructor(ctx: CanvasOperations) {\n    let lMx: number\n    let lMy: number\n    let lx = 0\n    let ly = 0\n    let reflected: {\n      x: number\n      y: number\n    }\n    let lastCommand = ''\n    function makeReflected(): {\n      x: number\n      y: number\n    } {\n      if ('CcSsQqTt'.indexOf(lastCommand) < 0) {\n        return { x: lx, y: ly }\n      }\n      return reflected\n    }\n\n    this.M = (px, py): this => {\n      ctx.moveTo(px, py)\n      lMx = px\n      lMy = py\n      lx = px\n      ly = py\n      lastCommand = 'M'\n      return this\n    }\n    this.m = (px, py): this => this.M(px + lx, py + ly)\n    this.L = (px, py): this => {\n      ctx.lineTo(px, py)\n      lx = px\n      ly = py\n      lastCommand = 'L'\n      return this\n    }\n    this.l = (px, py): this => this.L(px + lx, py + ly)\n    this.H = (px): this => this.L(px, ly)\n    this.h = (px): this => this.H(px + lx)\n    this.V = (py): this => this.L(lx, py)\n    this.v = (py): this => this.V(py + ly)\n    this.Z = (): this => {\n      ctx.closePath()\n      lx = lMx\n      ly = lMy\n      lastCommand = 'Z'\n      return this\n    }\n    this.z = (): this => this.Z()\n    //C x1 y1, x2 y2, x y (or c dx1 dy1, dx2 dy2, dx dy)\n    this.C = (cp1x, cp1y, cp2x, cp2y, px, py): this => {\n      ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, px, py)\n      lx = px\n      ly = py\n      reflected = {\n        x: 2 * px - cp2x,\n        y: 2 * py - cp2y,\n      }\n      lastCommand = 'C'\n      return this\n    }\n    this.c = (cp1x, cp1y, cp2x, cp2y, px, py): this =>\n      this.C(cp1x + lx, cp1y + ly, cp2x + lx, cp2y + ly, px + lx, py + ly)\n    //S x2 y2, x y (or s dx2 dy2, dx dy)\n    this.S = (cpx, cpy, px, py): this => {\n      const { x: cp1x, y: cp1y } = makeReflected(/*lastCommand*/)\n      return this.C(cp1x, cp1y, cpx, cpy, px, py)\n    }\n    this.s = (cpx, cpy, px, py): this =>\n      this.S(cpx + lx, cpy + ly, px + lx, py + ly)\n    //Q x1 y1, x y (or q dx1 dy1, dx dy)\n    this.Q = (cpx, cpy, px, py): this => {\n      ctx.quadraticCurveTo(cpx, cpy, px, py)\n      lx = px\n      ly = py\n      reflected = {\n        x: 2 * px - cpx,\n        y: 2 * py - cpy,\n      }\n      lastCommand = 'Q'\n      return this\n    }\n    this.q = (cpx, cpy, px, py): this =>\n      this.Q(cpx + lx, cpy + ly, px + lx, py + ly)\n    //T x y (or t dx dy)\n    this.T = (px, py): this => {\n      const { x: cpx, y: cpy } = makeReflected()\n      return this.Q(cpx, cpy, px, py)\n    }\n    this.t = (px, py): this => this.T(px + lx, py + ly)\n    //A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n    this.A = (rx, ry, xAxisRotation, largeArcFlag, sweepFlag, px, py): this => {\n      const x1 = lx\n      const y1 = ly\n\n      ellipseFromEllipticalArc(\n        ctx,\n        x1,\n        y1,\n        rx,\n        ry,\n        xAxisRotation,\n        largeArcFlag,\n        sweepFlag,\n        px,\n        py\n      )\n\n      lx = px\n      ly = py\n      lastCommand = 'A'\n      return this\n    }\n    //a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n    this.a = (rx, ry, xAxisRotation, largeArcFlag, sweepFlag, px, py): this =>\n      this.A(rx, ry, xAxisRotation, largeArcFlag, sweepFlag, px + lx, py + ly)\n  }\n}\n","import { AnyFunction } from '../../../ts-types'\nimport { CanvasOperations } from './internal'\nimport PathCommands from './PathCommands'\n\ntype PathCommandName = keyof PathCommands\ntype CanvasOperation = keyof CanvasOperations\n\ntype Tokens = { next(): string | null }\n\nfunction pathTokens(d: string): Tokens {\n  let idx = 0\n  return {\n    next(): string | null {\n      let s = ''\n      while (d.length > idx) {\n        const c = d[idx]\n        idx++\n        if (' ,\\n\\r\\t'.indexOf(c) > -1) {\n          if (s) {\n            return s\n          }\n        } else {\n          const type = '.+-1234567890'.indexOf(c) > -1 ? 'num' : 'str'\n          if (type === 'str') {\n            if (s) {\n              idx--\n              return s\n            }\n            return c\n          }\n          if ('-+'.indexOf(c) > -1) {\n            if (s) {\n              idx--\n              return s\n            }\n          }\n          if (c === '.') {\n            if (s.indexOf('.') > -1) {\n              idx--\n              return s\n            }\n          }\n          s += c\n        }\n      }\n      return s || null\n    },\n  }\n}\n\nfunction command(\n  builder: PathCommandsParser,\n  cmd: PathCommandName,\n  argsProvider: Tokens\n): PathCommandName | null {\n  if (\n    cmd.toUpperCase() === 'M' ||\n    cmd.toUpperCase() === 'L' ||\n    cmd.toUpperCase() === 'T'\n  ) {\n    builder.command(cmd, argsProvider.next(), argsProvider.next())\n    return cmd === 'M' ? 'L' : cmd === 'm' ? 'l' : cmd\n  } else if (cmd.toUpperCase() === 'H' || cmd.toUpperCase() === 'V') {\n    builder.command(cmd, argsProvider.next())\n    return cmd\n  } else if (cmd.toUpperCase() === 'Z') {\n    builder.command(cmd)\n    return cmd\n  } else if (cmd.toUpperCase() === 'C') {\n    builder.command(\n      cmd,\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next()\n    )\n    return cmd\n  } else if (cmd.toUpperCase() === 'S' || cmd.toUpperCase() === 'Q') {\n    builder.command(\n      cmd,\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next()\n    )\n    return cmd\n  } else if (cmd.toUpperCase() === 'A') {\n    builder.command(\n      cmd,\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next(),\n      argsProvider.next()\n    )\n    return cmd\n  } else {\n    // https://developer.mozilla.org/ja/docs/Web/SVG/Tutorial/Paths\n    console.warn(`unsupported:${cmd}`)\n  }\n  return null\n}\n\nexport default class PathCommandsParser implements CanvasOperations {\n  public readonly moveTo: typeof CanvasRenderingContext2D.prototype.moveTo\n  public readonly lineTo: typeof CanvasRenderingContext2D.prototype.lineTo\n  public readonly closePath: typeof CanvasRenderingContext2D.prototype.closePath\n  public readonly bezierCurveTo: typeof CanvasRenderingContext2D.prototype.bezierCurveTo\n  public readonly quadraticCurveTo: typeof CanvasRenderingContext2D.prototype.quadraticCurveTo\n  public readonly save: typeof CanvasRenderingContext2D.prototype.save\n  public readonly translate: typeof CanvasRenderingContext2D.prototype.translate\n  public readonly rotate: typeof CanvasRenderingContext2D.prototype.rotate\n  public readonly scale: typeof CanvasRenderingContext2D.prototype.scale\n  public readonly arc: typeof CanvasRenderingContext2D.prototype.arc\n  public readonly restore: typeof CanvasRenderingContext2D.prototype.restore\n  public readonly arcTo: typeof CanvasRenderingContext2D.prototype.arcTo\n  public readonly ellipse: typeof CanvasRenderingContext2D.prototype.ellipse\n  public readonly rect: typeof CanvasRenderingContext2D.prototype.rect\n  private readonly _commands: PathCommands\n\n  private _ops: { op: CanvasOperation; args: any[] }[] = []\n  constructor() {\n    this._commands = new PathCommands(this as CanvasOperations)\n\n    const buildPush = (op: CanvasOperation) => (...args: any[]): void => {\n      this._ops.push({\n        op,\n        args,\n      })\n    }\n    this.moveTo = buildPush('moveTo')\n    this.lineTo = buildPush('lineTo')\n    this.closePath = buildPush('closePath')\n    this.bezierCurveTo = buildPush('bezierCurveTo')\n    this.quadraticCurveTo = buildPush('quadraticCurveTo')\n    this.save = buildPush('save')\n    this.translate = buildPush('translate')\n    this.rotate = buildPush('rotate')\n    this.scale = buildPush('scale')\n    this.arc = buildPush('arc')\n    this.restore = buildPush('restore')\n    this.arcTo = buildPush('arcTo')\n    this.ellipse = buildPush('ellipse')\n    this.rect = buildPush('rect')\n  }\n\n  command(name: PathCommandName, ...args: any[]): void {\n    const numArgs: any[] = args || []\n    for (let i = 0; i < args.length; i++) {\n      numArgs[i] -= 0\n    }\n    const command: AnyFunction = this._commands[name]\n    command.apply(this, numArgs)\n  }\n  parse(d: string): { op: CanvasOperation; args: any[] }[] {\n    const ops = (this._ops = [])\n    const tokens = pathTokens(d)\n    try {\n      let cmd: string | null\n      let subsequentCommand: PathCommandName = 'Z'\n      while ((cmd = tokens.next())) {\n        if (!isNaN(Number(cmd))) {\n          let fst = true\n          const argsProvider: Tokens = {\n            next() {\n              if (fst) {\n                fst = false\n                return cmd\n              }\n              return tokens.next()\n            },\n          }\n          subsequentCommand =\n            command(this, subsequentCommand, argsProvider) || 'Z'\n        } else {\n          subsequentCommand =\n            command(this, cmd as PathCommandName, tokens) || 'Z'\n        }\n      }\n    } catch (e) {\n      console.log(`Error: ${d}`)\n      throw e\n    }\n    return ops\n  }\n}\n","import { AnyFunction } from '../../../ts-types'\nimport { CanvasOperations } from './internal'\nimport PathCommandsParser from './PathCommandsParser'\n\nconst parser = new PathCommandsParser()\ntype CanvasOperation = keyof CanvasOperations\n\nexport class Path2DShim implements CanvasPath {\n  _ops: { op: CanvasOperation; args: any[] }[]\n  arc(...args: Parameters<typeof Path2D.prototype.arc>): void {\n    this._ops.push({ op: 'arc', args })\n  }\n  arcTo(...args: Parameters<typeof Path2D.prototype.arcTo>): void {\n    this._ops.push({ op: 'arcTo', args })\n  }\n  bezierCurveTo(\n    ...args: Parameters<typeof Path2D.prototype.bezierCurveTo>\n  ): void {\n    this._ops.push({ op: 'bezierCurveTo', args })\n  }\n  closePath(...args: Parameters<typeof Path2D.prototype.closePath>): void {\n    this._ops.push({ op: 'closePath', args })\n  }\n  ellipse(...args: Parameters<typeof Path2D.prototype.ellipse>): void {\n    this._ops.push({ op: 'ellipse', args })\n  }\n  lineTo(...args: Parameters<typeof Path2D.prototype.lineTo>): void {\n    this._ops.push({ op: 'lineTo', args })\n  }\n  moveTo(...args: Parameters<typeof Path2D.prototype.moveTo>): void {\n    this._ops.push({ op: 'moveTo', args })\n  }\n  quadraticCurveTo(\n    ...args: Parameters<typeof Path2D.prototype.quadraticCurveTo>\n  ): void {\n    this._ops.push({ op: 'quadraticCurveTo', args })\n  }\n  rect(...args: Parameters<typeof Path2D.prototype.rect>): void {\n    this._ops.push({ op: 'rect', args })\n  }\n  constructor(arg: string | Path2DShim) {\n    this._ops = []\n    if (arg === undefined) {\n      return\n    }\n    if (typeof arg === 'string') {\n      // try {\n      this._ops = parser.parse(arg)\n      // } catch (e) {\n      // \tthrow e;\n      // }\n    } else if (arg.hasOwnProperty('_ops')) {\n      this._ops = [...arg._ops]\n    } else {\n      throw new Error(`Error: ${typeof arg} is not a valid argument to Path`)\n    }\n  }\n}\n\nconst { CanvasRenderingContext2D } = window\n\nconst originalFill: AnyFunction = CanvasRenderingContext2D.prototype.fill\n;(CanvasRenderingContext2D.prototype as any).fill = function (\n  ...args: Parameters<typeof CanvasRenderingContext2D.prototype.fill>\n): void {\n  if (args[0] instanceof Path2DShim) {\n    const path = args[0]\n    this.beginPath()\n    path._ops.forEach((op) => {\n      const fn: AnyFunction = this[op.op]\n      fn.apply(this, op.args)\n    })\n    originalFill.apply(this, Array.prototype.slice.call(args, 1))\n  } else {\n    originalFill.apply(this, args)\n  }\n}\n","import { Path2DShim } from './legacy/canvas/Path2DShim'\nimport { browser } from './utils'\n\nfunction getPath2D(): typeof Path2D {\n  if (typeof Path2D !== 'undefined' && !browser.Edge) {\n    return Path2D\n  } else {\n    return Path2DShim as any\n  }\n}\n\nexport const path2DManager = {\n  fill(\n    module: any,\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ) {\n    ctx.save()\n    try {\n      const width = module.width\n      const height = module.height\n      const upsideDown = module.ud\n      const offsetX = module.x || 0\n      const offsetY = module.y || 0\n      w = w || width\n      h = h || height\n      const xRate = w / width\n      const yRate = h / (upsideDown ? -height : height)\n      x = x || 0\n      y = upsideDown ? (y || 0) + -height * yRate : y || 0\n\n      ctx.translate(x, y)\n      ctx.scale(xRate, yRate)\n      if (offsetX !== 0 || offsetY !== 0) {\n        ctx.translate(offsetX, offsetY)\n      }\n      const _Path2D = getPath2D()\n      module.path2d = module.path2d || new _Path2D(module.d)\n      ctx.fill(module.path2d)\n    } finally {\n      ctx.restore()\n    }\n  },\n  getPath2D,\n}\n","import { RectProps, ColorDef, AnyFunction, InlineAPI } from '../ts-types'\nimport { GenWordsResult, str, isDef } from '../internal/utils'\nimport { CanvasHelper } from '../tools/canvasHelper'\n\nfunction getWidth(ctx: CanvasRenderingContext2D, content: string): number {\n  return ctx.measureText(content).width\n}\n\nfunction breakWidth(\n  ctx: CanvasRenderingContext2D,\n  content: string,\n  itr: GenWordsResult,\n  candidateIndex: number,\n  width: number\n): {\n  before: Inline | null\n  after: Inline | null\n} {\n  const chars = []\n  let ret = itr.next()\n  for (let i = 0; i < candidateIndex && ret !== null; i++, ret = itr.next()) {\n    chars.push(ret)\n  }\n  let beforeWidth = getWidth(ctx, chars.join(''))\n  if (beforeWidth > width) {\n    while (chars.length) {\n      const c = chars.pop()\n      beforeWidth -= getWidth(ctx, c as string)\n      if (beforeWidth <= width) {\n        break\n      }\n    }\n  } else if (beforeWidth < width) {\n    while (ret !== null) {\n      const charWidth = getWidth(ctx, ret)\n      if (beforeWidth + charWidth > width) {\n        break\n      }\n      chars.push(ret)\n      beforeWidth += charWidth\n      ret = itr.next()\n    }\n  }\n  const beforeContent = chars.join('').replace(/\\s+$/, '')\n  const afterContent = content.slice(beforeContent.length).replace(/^\\s+/, '')\n  return {\n    after: afterContent ? new Inline(afterContent) : null,\n    before: beforeContent ? new Inline(beforeContent) : null,\n  }\n}\n\nexport type InlineDrawOption = {\n  ctx: CanvasRenderingContext2D\n  canvasHelper: CanvasHelper\n  rect: RectProps\n  offset: number\n  offsetLeft: number\n  offsetRight: number\n  offsetTop: number\n  offsetBottom: number\n}\n\nexport class Inline implements InlineAPI {\n  private _content: string\n  public constructor(content?: string) {\n    this._content = isDef(content) ? String(content) : ''\n  }\n  public width(obj: { ctx: CanvasRenderingContext2D }): number {\n    return getWidth(obj.ctx, this._content)\n  }\n  public font(): string | null {\n    return null\n  }\n  public color(): ColorDef | null {\n    return null\n  }\n  public canDraw(): boolean {\n    return true\n  }\n  public onReady(_callback: AnyFunction): void {}\n  public draw({\n    ctx,\n    canvasHelper,\n    rect,\n    offset,\n    offsetLeft,\n    offsetRight,\n    offsetTop,\n    offsetBottom,\n  }: InlineDrawOption): void {\n    canvasHelper.fillTextRect(\n      ctx,\n      this._content,\n      rect.left,\n      rect.top,\n      rect.width,\n      rect.height,\n      {\n        offset: offset + 1,\n        padding: {\n          bottom: offsetBottom,\n          left: offsetLeft,\n          right: offsetRight,\n          top: offsetTop,\n        },\n      }\n    )\n  }\n  public canBreak(): boolean {\n    return !!this._content\n  }\n  public splitIndex(\n    index: number\n  ): {\n    before: Inline | null\n    after: Inline | null\n  } {\n    const content = this._content\n    const itr = str.genChars(content)\n    const chars = []\n    let ret = itr.next()\n    for (let i = 0; i < index && ret !== null; i++, ret = itr.next()) {\n      chars.push(ret)\n    }\n    const beforeContent = chars.join('')\n    const afterContent = content.slice(beforeContent.length)\n    return {\n      after: afterContent ? new Inline(afterContent) : null,\n      before: beforeContent ? new Inline(beforeContent) : null,\n    }\n  }\n  public breakWord(\n    ctx: CanvasRenderingContext2D,\n    width: number\n  ): {\n    before: Inline | null\n    after: Inline | null\n  } {\n    const content = this._content\n    const allWidth = this.width({ ctx })\n    const candidate = Math.floor((this._content.length * width) / allWidth)\n    const itr = str.genWords(content)\n    return breakWidth(ctx, content, itr, candidate, width)\n  }\n  public breakAll(\n    ctx: CanvasRenderingContext2D,\n    width: number\n  ): {\n    before: Inline | null\n    after: Inline | null\n  } {\n    const content = this._content\n    const allWidth = this.width({ ctx })\n    const candidate = Math.floor((this._content.length * width) / allWidth)\n    const itr = str.genChars(content)\n    return breakWidth(ctx, content, itr, candidate, width)\n  }\n  public toString(): string {\n    return this._content\n  }\n}\n","import { AnyFunction, ColorDef } from '../ts-types'\nimport { InlineDrawOption, Inline } from './Inline'\n\nexport type InlineDrawerFunction = (options: InlineDrawOption) => void\nexport class InlineDrawer extends Inline {\n  private _draw: InlineDrawerFunction\n  private _width: number\n  // private _height: number\n  private _color?: ColorDef\n  public constructor({\n    draw,\n    width,\n    // height,\n    color,\n  }: {\n    draw: InlineDrawerFunction\n    width: number\n    height: number\n    color?: ColorDef\n  }) {\n    super()\n\n    this._draw = draw\n    this._width = width\n    // this._height = height\n    this._color = color\n  }\n  public width(_arg: { ctx: CanvasRenderingContext2D }): number {\n    return this._width\n  }\n  public font(): string | null {\n    return null\n  }\n  public color(): ColorDef | null {\n    return this._color ?? null\n  }\n  public canDraw(): boolean {\n    return true\n  }\n  public onReady(_callback: AnyFunction): void {}\n  public draw({\n    ctx,\n    canvasHelper,\n    rect,\n    offset,\n    offsetLeft,\n    offsetRight,\n    offsetTop,\n    offsetBottom,\n  }: InlineDrawOption): void {\n    this._draw({\n      ctx,\n      canvasHelper,\n      rect,\n      offset,\n      offsetLeft,\n      offsetRight,\n      offsetTop,\n      offsetBottom,\n    })\n  }\n  public canBreak(): boolean {\n    return false\n  }\n  public toString(): string {\n    return ''\n  }\n}\n","//see https://github.com/typekit/webfontloader\n\ntype Styles1 = {\n  display: 'block'\n  position: 'absolute'\n  top: '-9999px'\n  left: '-9999px'\n  width: 'auto'\n  height: 'auto'\n  margin: '0'\n  padding: '0'\n  'white-space': 'nowrap'\n  font: string\n}\ntype Styles2 = {\n  'font-variant': 'normal'\n  'font-size': '300px'\n  'font-style': 'normal'\n  'font-weight': '400'\n  'line-height': 'normal'\n}\n\ntype StyleKeys = keyof Styles1 | keyof Styles2\n\nfunction computeStyle(font: string): [Styles1, Styles2] {\n  return [\n    {\n      display: 'block',\n      position: 'absolute',\n      top: '-9999px',\n      left: '-9999px',\n      width: 'auto',\n      height: 'auto',\n      margin: '0',\n      padding: '0',\n      'white-space': 'nowrap',\n      font,\n    },\n    {\n      'font-variant': 'normal',\n      'font-size': '300px',\n      'font-style': 'normal',\n      'font-weight': '400',\n      'line-height': 'normal',\n    },\n  ]\n}\n\nclass FontRuler {\n  private _el: HTMLSpanElement\n  constructor(font: string, testStr: string) {\n    const e = document.createElement('span')\n    e.setAttribute('aria-hidden', 'true')\n    e.textContent = testStr || 'BESbswy'\n\n    computeStyle(font).forEach((style: Styles1 | Styles2) => {\n      for (const k in style) {\n        const key = k as StyleKeys\n        e.style[key as any] = (style as any)[key]\n      }\n    })\n    document.body.appendChild(e)\n    this._el = e\n  }\n  getWidth(): number {\n    return this._el.offsetWidth\n  }\n  remove(): void {\n    document.body.removeChild(this._el)\n  }\n}\n\nexport default FontRuler\n","import { AnyFunction } from '../../../ts-types'\n//see https://github.com/typekit/webfontloader\n\n//http://defghi1977.html.xdomain.jp/tech/canvasMemo/canvasMemo.htm\nimport FontRuler from './FontRuler'\n\nconst LastResortFonts: { [key: string]: string } = {\n  SERIF: 'serif',\n  SANS_SERIF: 'sans-serif',\n}\n\nconst watchRunners: {\n  [font: string]: { [testStr: string]: FontWatchRunner }\n} = {}\n\nclass FontWatchRunner {\n  activeCallbacks: AnyFunction[]\n  inactiveCallbacks: AnyFunction[]\n  status: 'ok' | 'ng' | null\n  lastResortWidths_: { [font: string]: number }\n  fontRulerA_: FontRuler\n  fontRulerB_: FontRuler\n  started_: number\n  static load(\n    font: string,\n    testStr: string,\n    activeCallback: AnyFunction,\n    inactiveCallback: AnyFunction\n  ): void {\n    const c = watchRunners[font] || (watchRunners[font] = {})\n    testStr += ''\n    let runner\n    if (c[testStr]) {\n      runner = c[testStr]\n    } else {\n      runner = c[testStr] = new FontWatchRunner(font, testStr)\n    }\n    runner.then(activeCallback, inactiveCallback)\n  }\n  constructor(font: string, testStr: string) {\n    this.activeCallbacks = []\n    this.inactiveCallbacks = []\n    this.status = null\n    this.lastResortWidths_ = {}\n\n    this.fontRulerA_ = new FontRuler(\n      `${font},${LastResortFonts.SERIF}`,\n      testStr\n    )\n    this.fontRulerB_ = new FontRuler(\n      `${font},${LastResortFonts.SANS_SERIF}`,\n      testStr\n    )\n    const lastResortRulerA = new FontRuler(\n      `4px ${LastResortFonts.SERIF}`,\n      testStr\n    )\n    const lastResortRulerB = new FontRuler(\n      `4px ${LastResortFonts.SANS_SERIF}`,\n      testStr\n    )\n\n    //start\n    this.lastResortWidths_[LastResortFonts.SERIF] = lastResortRulerA.getWidth()\n    this.lastResortWidths_[\n      LastResortFonts.SANS_SERIF\n    ] = lastResortRulerB.getWidth()\n\n    lastResortRulerA.remove()\n    lastResortRulerB.remove()\n\n    this.started_ = Date.now()\n\n    this.check_()\n  }\n  then(activeCallback: AnyFunction, inactiveCallback: AnyFunction): void {\n    if (this.status) {\n      if (this.status !== 'ng') {\n        activeCallback()\n      } else {\n        inactiveCallback()\n      }\n    } else {\n      this.activeCallbacks.push(activeCallback)\n      this.inactiveCallbacks.push(inactiveCallback)\n    }\n  }\n  private check_(): void {\n    const widthA = this.fontRulerA_.getWidth()\n    const widthB = this.fontRulerB_.getWidth()\n\n    if (\n      this.isFallbackFont_(widthA, widthB) ||\n      this.isLastResortFont_(widthA, widthB)\n    ) {\n      if (Date.now() - this.started_ >= 3000) {\n        // timeout\n        if (this.isLastResortFont_(widthA, widthB)) {\n          this.finish_(this.activeCallbacks)\n          this.status = 'ok'\n        } else {\n          this.finish_(this.inactiveCallbacks)\n          this.status = 'ng'\n        }\n      } else {\n        setTimeout(() => {\n          this.check_()\n        }, 50)\n      }\n    } else {\n      this.finish_(this.activeCallbacks)\n      this.status = 'ok'\n    }\n  }\n  isFallbackFont_(a: number, b: number): boolean {\n    return (\n      this.widthMatches_(a, LastResortFonts.SERIF) &&\n      this.widthMatches_(b, LastResortFonts.SANS_SERIF)\n    )\n  }\n  widthsMatchLastResortWidths_(a: number, b: number): boolean {\n    for (const font in LastResortFonts) {\n      if (LastResortFonts.hasOwnProperty(font)) {\n        if (\n          this.widthMatches_(a, LastResortFonts[font]) &&\n          this.widthMatches_(b, LastResortFonts[font])\n        ) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n  widthMatches_(width: number, lastResortFont: string): boolean {\n    return width === this.lastResortWidths_[lastResortFont]\n  }\n  isLastResortFont_(a: number, b: number): boolean {\n    return hasWebKitFallbackBug() && this.widthsMatchLastResortWidths_(a, b)\n  }\n  finish_(callbacks: AnyFunction[]): void {\n    setTimeout(() => {\n      this.fontRulerA_.remove()\n      this.fontRulerB_.remove()\n      callbacks.forEach((cb) => cb())\n    }, 0)\n  }\n}\n\nlet HAS_WEBKIT_FALLBACK_BUG: boolean | null = null\nfunction hasWebKitFallbackBug(): boolean {\n  if (HAS_WEBKIT_FALLBACK_BUG === null) {\n    const match = /AppleWebKit\\/([0-9]+)(?:\\.([0-9]+))/.exec(\n      window.navigator.userAgent\n    )\n\n    HAS_WEBKIT_FALLBACK_BUG =\n      !!match &&\n      (parseInt(match[1], 10) < 536 ||\n        (parseInt(match[1], 10) === 536 && parseInt(match[2], 10) <= 11))\n  }\n  return HAS_WEBKIT_FALLBACK_BUG\n}\n\nexport default FontWatchRunner\n","import FontWatchRunner from './legacy/fontwatch/FontWatchRunner'\nimport { isNode } from './utils'\n\nconst loads: {\n  [font: string]: boolean\n  all: boolean\n} = {\n  all: false,\n}\nlet load: (font: string, testStr: string, callback: () => void) => void\nlet check: (font: string, testStr: string) => boolean\nif (isNode) {\n  load = (font, testStr, callback) => {\n    callback()\n  }\n  check = () => {\n    return false\n  }\n} else {\n  const legacy = !(document as any).fonts\n  load = legacy\n    ? (font: string, testStr: string, callback: () => void) => {\n        // for legacy(IE)\n        if (loads[`${font} @ ${testStr}`]) {\n          callback()\n          return\n        }\n        FontWatchRunner.load(\n          font,\n          testStr,\n          () => {\n            loads[`${font} @ ${testStr}`] = true\n            callback()\n          },\n          () => {\n            loads[`${font} @ ${testStr}`] = true\n            callback()\n          }\n        )\n      }\n    : (font: string, testStr: string, callback: () => void) => {\n        if (loads.all || loads[font]) {\n          callback()\n          return\n        }\n        ;(document as any).fonts.ready.then(() => {\n          loads.all = true\n        })\n        ;(document as any).fonts.load(font).then(() => {\n          loads[font] = true\n          callback()\n        })\n      }\n  check = legacy\n    ? (font: string, testStr: string) => {\n        // for legacy(IE)\n        if (loads[`${font} @ ${testStr}`]) {\n          return true\n        }\n        load(font, testStr, () => {\n          // nothing\n        })\n        return false\n      }\n    : (font: string, testStr: string) => {\n        if (loads.all || loads[font]) {\n          return true\n        }\n        if (!(document as any).fonts.check(font)) {\n          load(font, testStr, () => {\n            // nothing\n          })\n          return false\n        }\n        return true\n      }\n}\n\nexport default {\n  check,\n  load,\n}\n","import * as inlineUtils from './element/inlines'\nimport {\n  GridCanvasHelperAPI,\n  ListGridAPI,\n  RequiredThemeDefine,\n  CellContext,\n  RectProps,\n  ColorPropertyDefine,\n  ColorsPropertyDefine,\n  ColorDef,\n  TextOverflow,\n  TreeInfo,\n  FontPropertyDefine,\n  LineClamp,\n} from './ts-types'\nimport { Inline, InlineDrawOption } from './element/Inline'\nimport { InlineDrawer } from './element/InlineDrawer'\nimport { toPx } from './internal/calc'\nimport { getFontSize, calcStartPosition } from './internal/canvases'\nimport { calcElapsedColor } from './internal/color'\nimport fonts from './internal/fonts'\nimport Rect from './internal/Rect'\nimport { getOrApply, style, isDef, cellInRange } from './internal/utils'\nimport { canvasHelper, DrawButtonOption } from './tools/canvasHelper'\n\nimport { ThemeResolver } from './GridThemeHelper'\nimport { SimpleColumnIconOption } from './ts-types-internal'\n\nexport const TREE_NODE_SPACE = 16\n\nenum SwitchStyle {\n  default,\n  iPhone,\n}\n\nconst SWITCH_STYLE: SwitchStyle = SwitchStyle.default\n\nconst INLINE_ELLIPSIS = inlineUtils.of('\\u2026')\n\ntype ColorsDef = ColorDef | (ColorDef | null)[]\n\nfunction invalidateCell<T>(context: CellContext, grid: ListGridAPI<T>) {\n  grid.invalidateCell(context.col, context.row)\n}\nfunction getColor<T>(\n  color: ColorPropertyDefine,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>,\n  context: CanvasRenderingContext2D\n): ColorDef\nfunction getColor<T>(\n  color: ColorsPropertyDefine,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>,\n  context: CanvasRenderingContext2D\n): ColorsDef\nfunction getColor<T>(\n  color: undefined,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>,\n  context: CanvasRenderingContext2D\n): undefined\nfunction getColor<T>(\n  color: ColorPropertyDefine | ColorsPropertyDefine | undefined,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>,\n  context: CanvasRenderingContext2D\n): ColorDef | ColorsDef | undefined {\n  return getOrApply(color, {\n    col,\n    context,\n    grid,\n    row,\n  })\n}\nfunction getFont<T>(\n  font: FontPropertyDefine | undefined,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>,\n  context: CanvasRenderingContext2D\n): string | undefined {\n  if (font == null) {\n    return undefined\n  }\n  return getOrApply(font, {\n    col,\n    row,\n    grid,\n    context,\n  })\n}\nfunction testFontLoad<T>(\n  font: string | undefined,\n  value: string,\n  context: CellContext,\n  grid: ListGridAPI<T>\n): boolean {\n  if (font) {\n    if (!fonts.check(font, value)) {\n      fonts.load(font, value, () => invalidateCell(context, grid))\n      return false\n    }\n  }\n  return true\n}\nfunction getGridThemeColor<T>(\n  grid: ListGridAPI<T>,\n  theme: RequiredThemeDefine,\n  col: number,\n  row: number,\n  color?: ColorPropertyDefine\n): ColorPropertyDefine {\n  if (!color) {\n    ;({ color } = theme)\n    // header color\n    const isFrozenCell = grid.isFrozenCell(col, row)\n    if (isFrozenCell && isFrozenCell.row) {\n      color = theme.frozenRowsColor\n    }\n  }\n  return color\n}\nfunction getGridThemeFont<T>(\n  grid: ListGridAPI<T>,\n  theme: RequiredThemeDefine,\n  col: number,\n  row: number,\n  font?: FontPropertyDefine\n): FontPropertyDefine {\n  if (!font) {\n    ;({ font } = theme)\n    // header color\n    const isFrozenCell = grid.isFrozenCell(col, row)\n    if (isFrozenCell && isFrozenCell.row) {\n      font = theme.frozenRowsFont\n    }\n  }\n  return font\n}\n\nfunction drawInlines<T>(\n  ctx: CanvasRenderingContext2D,\n  inlines: Inline[],\n  rect: RectProps,\n  offset: number,\n  offsetTop: number,\n  offsetBottom: number,\n  col: number,\n  row: number,\n  grid: ListGridAPI<T>\n): void {\n  function drawInline(\n    inline: Inline,\n    offsetLeft: number,\n    offsetRight: number\n  ): void {\n    if (inline.canDraw()) {\n      ctx.save()\n      try {\n        ctx.fillStyle = getColor(\n          inline.color() || ctx.fillStyle,\n          col,\n          row,\n          grid,\n          ctx\n        )\n        ctx.font = inline.font() || ctx.font\n        inline.draw({\n          canvasHelper,\n          ctx,\n          offset,\n          offsetBottom,\n          offsetLeft,\n          offsetRight,\n          offsetTop,\n          rect,\n        })\n      } finally {\n        ctx.restore()\n      }\n    } else {\n      inline.onReady(() => grid.invalidateCell(col, row))\n      // noop\n    }\n  }\n  if (inlines.length === 1) {\n    // 长度为1时，不需要计算宽度\n    const inline = inlines[0]\n    drawInline(inline, 0, 0)\n  } else if (inlines.length > 1) {\n    const inlineWidths = inlines.map(\n      (inline) => (inline.width({ ctx }) || 0) - 0\n    )\n    let offsetRight = inlineWidths.reduce((a, b) => a + b)\n\n    let offsetLeft = 0\n    inlines.forEach((inline, index) => {\n      const inlineWidth = inlineWidths[index]\n      offsetRight -= inlineWidth\n      drawInline(inline, offsetLeft, offsetRight)\n      offsetLeft += inlineWidth\n    })\n  }\n}\n\nfunction buildInlines(\n  icons: SimpleColumnIconOption[] | undefined,\n  inline: string\n): Inline[] {\n  return inlineUtils.buildInlines(icons, isDef(inline) ? inline : '')\n}\n\nfunction inlineToString(inline: Inline | string): string {\n  return inlineUtils.string(inline)\n}\n\nfunction getOverflowInline(textOverflow?: TextOverflow): Inline {\n  if (!isAllowOverflow(textOverflow) || textOverflow === 'ellipsis') {\n    return INLINE_ELLIPSIS\n  }\n  textOverflow = textOverflow.trim()\n  if (textOverflow.length === 1) {\n    return inlineUtils.of(textOverflow[0])\n  }\n  return INLINE_ELLIPSIS\n}\n\nfunction isAllowOverflow(textOverflow?: TextOverflow): textOverflow is string {\n  return !!(\n    textOverflow &&\n    textOverflow !== 'clip' &&\n    typeof textOverflow === 'string'\n  )\n}\n\nfunction getOverflowInlinesIndex(\n  ctx: CanvasRenderingContext2D,\n  inlines: Inline[],\n  width: number\n): {\n  index: number\n  lineWidth: number\n  remWidth: number\n} | null {\n  const maxWidth = width - 3 /*buffer*/\n  let lineWidth = 0\n  for (let i = 0; i < inlines.length; i++) {\n    const inline = inlines[i]\n    const inlineWidth = (inline.width({ ctx }) || 0) - 0\n    if (lineWidth + inlineWidth > maxWidth) {\n      return {\n        index: i,\n        lineWidth,\n        remWidth: maxWidth - lineWidth,\n      }\n    }\n    lineWidth += inlineWidth\n  }\n  return null\n}\n\nfunction isOverflowInlines(\n  ctx: CanvasRenderingContext2D,\n  inlines: Inline[],\n  width: number\n): boolean {\n  return !!getOverflowInlinesIndex(ctx, inlines, width)\n}\n\nfunction breakWidthInlines(\n  ctx: CanvasRenderingContext2D,\n  inlines: Inline[],\n  width: number\n): {\n  beforeInlines: Inline[]\n  overflow: boolean\n  afterInlines: Inline[]\n} {\n  const indexData = getOverflowInlinesIndex(ctx, inlines, width)\n  if (!indexData) {\n    return {\n      afterInlines: [],\n      beforeInlines: inlines,\n      overflow: false,\n    }\n  }\n  const index = indexData.index\n  const remWidth = indexData.remWidth\n  const inline = inlines[index]\n  const beforeInlines = inlines.slice(0, index)\n  const afterInlines = []\n  if (inline.canBreak()) {\n    const breakWord = inline.breakWord(ctx, remWidth)\n    let before = breakWord.before\n    let after = breakWord.after\n    if (!before && !beforeInlines.length) {\n      ;({ before, after } = inline.breakAll(ctx, remWidth))\n    }\n    if (!before && !beforeInlines.length) {\n      // Always return one char\n      ;({ before, after } = inline.splitIndex(1))\n    }\n    if (before) {\n      beforeInlines.push(before)\n    }\n    if (after) {\n      afterInlines.push(after)\n    }\n    afterInlines.push(...inlines.slice(index + 1))\n  } else {\n    if (!beforeInlines.length) {\n      // Always return one char\n      beforeInlines.push(inline)\n    }\n    afterInlines.push(...inlines.slice(beforeInlines.length))\n  }\n  return {\n    afterInlines,\n    beforeInlines,\n    overflow: true,\n  }\n}\n\nfunction truncateInlines(\n  ctx: CanvasRenderingContext2D,\n  inlines: Inline[],\n  width: number,\n  offset: number,\n  option?: TextOverflow\n): {\n  inlines: Inline[]\n  overflow: boolean\n} {\n  const indexData = getOverflowInlinesIndex(ctx, inlines, width)\n  if (!indexData) {\n    return {\n      inlines,\n      overflow: false,\n    }\n  }\n  const { index, lineWidth } = indexData\n  const inline = inlines[index]\n  const overflowInline = getOverflowInline(option)\n  const ellipsisWidth = overflowInline.width({ ctx })\n  const remWidth = width - lineWidth - ellipsisWidth - offset - 1\n  const result = inlines.slice(0, index)\n  if (inline.canBreak()) {\n    const before = inline.breakAll(ctx, remWidth).before\n    if (before) {\n      result.push(before)\n    }\n  }\n  result.push(overflowInline)\n  return {\n    inlines: result,\n    overflow: true,\n  }\n}\n\nfunction _inlineRect<T>(\n  grid: ListGridAPI<T>,\n  ctx: CanvasRenderingContext2D,\n  inline: string,\n  rect: RectProps,\n  col: number,\n  row: number,\n  {\n    offset,\n    color,\n    textAlign,\n    textBaseline,\n    font,\n    textOverflow,\n    icons,\n  }: {\n    offset: number\n    color?: ColorPropertyDefine\n    textAlign: CanvasTextAlign\n    textBaseline: CanvasTextBaseline\n    font?: string\n    textOverflow?: TextOverflow\n    icons?: SimpleColumnIconOption[]\n  }\n): void {\n  // 文字style\n  ctx.fillStyle = getColor(color || ctx.fillStyle, col, row, grid, ctx)\n  ctx.textAlign = textAlign\n  ctx.textBaseline = textBaseline\n  ctx.font = font || ctx.font\n\n  let inlines = buildInlines(icons, inline)\n  if (\n    isAllowOverflow(textOverflow) &&\n    isOverflowInlines(ctx, inlines, rect.width)\n  ) {\n    const { inlines: truncInlines, overflow } = truncateInlines(\n      ctx,\n      inlines,\n      rect.width,\n      offset,\n      textOverflow\n    )\n    inlines = truncInlines\n    grid.setCellOverflowText(col, row, overflow && inlineToString(inline))\n  } else {\n    grid.setCellOverflowText(col, row, false)\n  }\n\n  drawInlines(ctx, inlines, rect, offset, 0, 0, col, row, grid)\n}\n\nfunction _multiInlineRect<T>(\n  grid: ListGridAPI<T>,\n  ctx: CanvasRenderingContext2D,\n  multiInlines: string[],\n  rect: RectProps,\n  col: number,\n  row: number,\n  {\n    offset,\n    color,\n    textAlign,\n    textBaseline,\n    font,\n    lineHeight,\n    autoWrapText,\n    lineClamp,\n    textOverflow,\n    icons,\n  }: {\n    offset: number\n    color?: ColorPropertyDefine\n    textAlign: CanvasTextAlign\n    textBaseline: CanvasTextBaseline\n    font?: string\n    lineHeight: number\n    autoWrapText?: boolean\n    lineClamp: LineClamp\n    textOverflow?: TextOverflow\n    icons?: SimpleColumnIconOption[]\n  }\n): void {\n  // 文字style\n  ctx.fillStyle = getColor(color || ctx.fillStyle, col, row, grid, ctx)\n  ctx.textAlign = textAlign\n  ctx.textBaseline = textBaseline\n  ctx.font = font || ctx.font\n\n  if (lineClamp === 'auto') {\n    const rectHeight =\n      rect.height - offset * 2 - 2 /*offset added by Inline#draw*/\n    lineClamp = Math.max(Math.floor(rectHeight / lineHeight), 1)\n  }\n\n  let buildedMultiInlines: Inline[][]\n  if (autoWrapText || lineClamp > 0 || isAllowOverflow(textOverflow)) {\n    const width = rect.width\n    buildedMultiInlines = []\n    const procLineClamp =\n      lineClamp > 0\n        ? (inlines: Inline[], hasNext: boolean): boolean => {\n            if (buildedMultiInlines.length + 1 >= lineClamp) {\n              if (inlines.length === 0 && hasNext) {\n                buildedMultiInlines.push([getOverflowInline(textOverflow)])\n                grid.setCellOverflowText(\n                  col,\n                  row,\n                  multiInlines.map(inlineToString).join('\\n')\n                )\n              } else {\n                const tis = truncateInlines(\n                  ctx,\n                  inlines,\n                  width,\n                  offset,\n                  textOverflow\n                )\n                const truncInlines = tis.inlines\n                const overflow = tis.overflow\n                buildedMultiInlines.push(\n                  hasNext && !overflow\n                    ? truncInlines.concat([getOverflowInline(textOverflow)])\n                    : truncInlines\n                )\n                if (overflow || hasNext) {\n                  grid.setCellOverflowText(\n                    col,\n                    row,\n                    multiInlines.map(inlineToString).join('\\n')\n                  )\n                }\n              }\n              return false\n            }\n            return true\n          }\n        : (): boolean => true\n    const procLine = autoWrapText\n      ? (inlines: Inline[], hasNext: boolean): boolean => {\n          if (!procLineClamp(inlines, hasNext)) {\n            return false\n          }\n          while (inlines.length) {\n            if (!procLineClamp(inlines, hasNext)) {\n              return false\n            }\n            const { beforeInlines, afterInlines } = breakWidthInlines(\n              ctx,\n              inlines,\n              width\n            )\n            buildedMultiInlines.push(beforeInlines)\n            inlines = afterInlines\n          }\n          return true\n        }\n      : isAllowOverflow(textOverflow)\n      ? (inlines: Inline[], hasNext: boolean): boolean => {\n          if (!procLineClamp(inlines, hasNext)) {\n            return false\n          }\n          const { inlines: truncInlines, overflow } = truncateInlines(\n            ctx,\n            inlines,\n            width,\n            offset,\n            textOverflow\n          )\n          buildedMultiInlines.push(truncInlines)\n          if (overflow) {\n            grid.setCellOverflowText(\n              col,\n              row,\n              multiInlines.map(inlineToString).join('\\n')\n            )\n          }\n          return true\n        }\n      : (inlines: Inline[], hasNext: boolean): boolean => {\n          if (!procLineClamp(inlines, hasNext)) {\n            return false\n          }\n          buildedMultiInlines.push(inlines)\n          return true\n        }\n    grid.setCellOverflowText(col, row, false)\n    for (let lineRow = 0; lineRow < multiInlines.length; lineRow++) {\n      const inline = multiInlines[lineRow]\n      const buildedInline = buildInlines(\n        lineRow === 0 ? icons : undefined,\n        inline\n      )\n      if (!procLine(buildedInline, lineRow + 1 < multiInlines.length)) {\n        break\n      }\n    }\n  } else {\n    grid.setCellOverflowText(col, row, false)\n    buildedMultiInlines = multiInlines.map((inline, lineRow) =>\n      buildInlines(lineRow === 0 ? icons : undefined, inline)\n    )\n  }\n\n  let paddingTop = 0\n  let paddingBottom = lineHeight * (buildedMultiInlines.length - 1)\n\n  if (ctx.textBaseline === 'top' || ctx.textBaseline === 'hanging') {\n    const em = getFontSize(ctx, ctx.font).height\n    const pad = (lineHeight - em) / 2\n    paddingTop += pad\n    paddingBottom -= pad\n  } else if (\n    ctx.textBaseline === 'bottom' ||\n    ctx.textBaseline === 'alphabetic' ||\n    ctx.textBaseline === 'ideographic'\n  ) {\n    const em = getFontSize(ctx, ctx.font).height\n    const pad = (lineHeight - em) / 2\n    paddingTop -= pad\n    paddingBottom += pad\n  }\n  buildedMultiInlines.forEach((buildedInline) => {\n    drawInlines(\n      ctx,\n      buildedInline,\n      rect,\n      offset,\n      paddingTop,\n      paddingBottom,\n      col,\n      row,\n      grid\n    )\n    paddingTop += lineHeight\n    paddingBottom -= lineHeight\n  })\n}\n\nfunction gridDrawCheckbox<T>(\n  ctx: CanvasRenderingContext2D,\n  rect: RectProps,\n  col: number,\n  row: number,\n  check: boolean,\n  helper: GridCanvasHelper<T>,\n  {\n    animElapsedTime = 1,\n    uncheckBgColor = helper.theme.checkbox.uncheckBgColor,\n    checkBgColor = helper.theme.checkbox.checkBgColor,\n    borderColor = helper.theme.checkbox.borderColor,\n    textAlign = 'center',\n    textBaseline = 'middle',\n  }: {\n    animElapsedTime?: number\n    uncheckBgColor?: ColorPropertyDefine\n    checkBgColor?: ColorPropertyDefine\n    borderColor?: ColorPropertyDefine\n    textAlign?: CanvasTextAlign\n    textBaseline?: CanvasTextBaseline\n  } = {},\n  positionOpt = {}\n) {\n  const boxWidth = canvasHelper.measureCheckbox(ctx).width\n  ctx.textAlign = textAlign\n  ctx.textBaseline = textBaseline\n  const pos = calcStartPosition(\n    ctx,\n    rect,\n    boxWidth + 1 /*分割线+1*/,\n    boxWidth + 1 /*分割线+1*/,\n    positionOpt\n  )\n  uncheckBgColor = helper.getColor(uncheckBgColor, col, row, ctx)\n  checkBgColor = helper.getColor(checkBgColor, col, row, ctx)\n  borderColor = helper.getColor(borderColor, col, row, ctx)\n  if (0 < animElapsedTime && animElapsedTime < 1) {\n    uncheckBgColor = check\n      ? uncheckBgColor\n      : calcElapsedColor(\n          checkBgColor as string,\n          uncheckBgColor as string,\n          animElapsedTime\n        )\n    checkBgColor = check\n      ? calcElapsedColor(\n          uncheckBgColor as string,\n          checkBgColor as string,\n          animElapsedTime\n        )\n      : checkBgColor\n  }\n\n  canvasHelper.drawCheckbox(\n    ctx,\n    pos.x,\n    pos.y,\n    check ? animElapsedTime : false,\n    {\n      borderColor,\n      checkBgColor,\n      uncheckBgColor,\n    }\n  )\n}\n\nfunction gridDrawRadioButton<T>(\n  ctx: CanvasRenderingContext2D,\n  rect: RectProps,\n  col: number,\n  row: number,\n  check: boolean,\n  helper: GridCanvasHelper<T>,\n  {\n    animElapsedTime = 1,\n    checkColor = helper.theme.radioButton.checkColor,\n    uncheckBorderColor = helper.theme.radioButton.uncheckBorderColor,\n    checkBorderColor = helper.theme.radioButton.checkBorderColor,\n    uncheckBgColor = helper.theme.radioButton.uncheckBgColor,\n    checkBgColor = helper.theme.radioButton.checkBgColor,\n    textAlign = 'center',\n    textBaseline = 'middle',\n  }: {\n    animElapsedTime?: number\n    checkColor?: ColorPropertyDefine\n    uncheckBorderColor?: ColorPropertyDefine\n    checkBorderColor?: ColorPropertyDefine\n    uncheckBgColor?: ColorPropertyDefine\n    checkBgColor?: ColorPropertyDefine\n    textAlign?: CanvasTextAlign\n    textBaseline?: CanvasTextBaseline\n  },\n  positionOpt = {}\n): void {\n  const boxWidth = canvasHelper.measureRadioButton(ctx).width\n  ctx.textAlign = textAlign\n  ctx.textBaseline = textBaseline\n  const pos = calcStartPosition(\n    ctx,\n    rect,\n    boxWidth + 1 /*罫線分+1*/,\n    boxWidth + 1 /*罫線分+1*/,\n    positionOpt\n  )\n  checkColor = helper.getColor(checkColor, col, row, ctx)\n  uncheckBorderColor = helper.getColor(uncheckBorderColor, col, row, ctx)\n  checkBorderColor = helper.getColor(checkBorderColor, col, row, ctx)\n  uncheckBgColor = helper.getColor(uncheckBgColor, col, row, ctx)\n  checkBgColor = helper.getColor(checkBgColor, col, row, ctx)\n  let borderColor = check ? checkBorderColor : uncheckBorderColor\n  let bgColor = check ? checkBgColor : uncheckBgColor\n  if (0 < animElapsedTime && animElapsedTime < 1) {\n    borderColor = check\n      ? calcElapsedColor(\n          uncheckBorderColor as string,\n          checkBorderColor as string,\n          animElapsedTime\n        )\n      : calcElapsedColor(\n          checkBorderColor as string,\n          uncheckBorderColor as string,\n          animElapsedTime\n        )\n    bgColor = check\n      ? calcElapsedColor(\n          uncheckBgColor as string,\n          checkBgColor as string,\n          animElapsedTime\n        )\n      : calcElapsedColor(\n          checkBgColor as string,\n          uncheckBgColor as string,\n          animElapsedTime\n        )\n  }\n\n  canvasHelper.drawRadioButton(\n    ctx,\n    pos.x,\n    pos.y,\n    check ? animElapsedTime : 1 - animElapsedTime,\n    {\n      checkColor,\n      borderColor,\n      bgColor,\n    }\n  )\n}\n\nfunction getSwitchBtnSize(rect: RectProps) {\n  if (SWITCH_STYLE === SwitchStyle.default) {\n    return {\n      height: 22,\n      width: 44,\n    }\n  } else {\n    const height = rect.height - rect.height / 4\n    const width = height * 1.625\n    return {\n      height,\n      width,\n    }\n  }\n}\n\nfunction gridDrawSwitchBtn<T>(\n  ctx: CanvasRenderingContext2D,\n  rect: RectProps,\n  col: number,\n  row: number,\n  check: boolean,\n  helper: GridCanvasHelper<T>,\n  info: {\n    animElapsedTime?: number\n    uncheckBgColor?: any\n    checkBgColor?: any\n    borderColor?: any\n    textAlign?: string\n    textBaseline?: string\n  } = {},\n  positionOpt = {}\n) {\n  const animElapsedTime =\n    info.animElapsedTime === undefined ? 1 : info.animElapsedTime\n  let uncheckBgColor = info.uncheckBgColor || helper.theme.switch.uncheckBgColor\n  let checkBgColor = info.checkBgColor || helper.theme.switch.checkBgColor\n  let borderColor = info.borderColor || helper.theme.switch.borderColor\n  const textAlign = info.textAlign || 'center'\n  const textBaseline = info.textBaseline || 'middle'\n\n  const btnSize = getSwitchBtnSize(rect)\n  ctx.textAlign = textAlign as CanvasTextAlign\n  ctx.textBaseline = textBaseline as CanvasTextBaseline\n  const pos = calcStartPosition(\n    ctx,\n    rect,\n    btnSize.width + 1 /*分割线+1*/,\n    btnSize.height + 1 /*分割线+1*/,\n    positionOpt\n  )\n  uncheckBgColor = helper.getColor(uncheckBgColor, col, row, ctx)\n  checkBgColor = helper.getColor(checkBgColor, col, row, ctx)\n  borderColor = helper.getColor(borderColor, col, row, ctx)\n  borderColor = style.toBoxArray(borderColor).find((v) => v)\n  const draw =\n    SWITCH_STYLE === SwitchStyle.default\n      ? canvasHelper.drawSwitchButton\n      : canvasHelper.drawSwitchBtn\n  draw(ctx, pos.x, pos.y, check, animElapsedTime, {\n    borderColor,\n    checkBgColor,\n    uncheckBgColor,\n    btnSize,\n  })\n}\n\nfunction strokeRect(\n  ctx: CanvasRenderingContext2D,\n  color: ColorsDef,\n  left: number,\n  top: number,\n  width: number,\n  height: number\n): void {\n  if (!Array.isArray(color)) {\n    if (color) {\n      ctx.strokeStyle = color\n      ctx.strokeRect(left, top, width, height)\n    }\n  } else {\n    const borderColors = style.toBoxArray(color)\n    canvasHelper.strokeColorsRect(ctx, borderColors, left, top, width, height)\n  }\n}\n\nexport class GridCanvasHelper<T> implements GridCanvasHelperAPI {\n  private _grid: ListGridAPI<T>\n  private _theme: RequiredThemeDefine\n  public constructor(grid: ListGridAPI<T>) {\n    this._grid = grid\n    this._theme = new ThemeResolver(grid)\n  }\n  public createCalculator(\n    context: CellContext,\n    font: string | undefined\n  ): {\n    calcWidth(width: number | string): number\n    calcHeight(height: number | string): number\n  } {\n    return {\n      calcWidth(width: number | string): number {\n        return toPx(width, {\n          get full() {\n            const rect = context.getRect()\n            return rect.width\n          },\n          get em() {\n            return getFontSize(context.getContext(), font).width\n          },\n        })\n      },\n      calcHeight(height: number | string): number {\n        return toPx(height, {\n          get full() {\n            const rect = context.getRect()\n            return rect.height\n          },\n          get em() {\n            return getFontSize(context.getContext(), font).height\n          },\n        })\n      },\n    }\n  }\n  public getColor(\n    color: ColorPropertyDefine,\n    col: number,\n    row: number,\n    ctx: CanvasRenderingContext2D\n  ): ColorDef\n  public getColor(\n    color: ColorsPropertyDefine,\n    col: number,\n    row: number,\n    ctx: CanvasRenderingContext2D\n  ): ColorsDef\n  public getColor(\n    color: ColorPropertyDefine | ColorsPropertyDefine,\n    col: number,\n    row: number,\n    ctx: CanvasRenderingContext2D\n  ): ColorsDef {\n    return getColor(color, col, row, this._grid, ctx)\n  }\n  public toBoxArray(\n    obj: ColorsDef\n  ): [ColorDef | null, ColorDef | null, ColorDef | null, ColorDef | null] {\n    return style.toBoxArray(obj)\n  }\n  public toBoxPixelArray(\n    value: number | string | (number | string)[],\n    context: CellContext,\n    font: string | undefined\n  ): [number, number, number, number] {\n    if (typeof value === 'string' || Array.isArray(value)) {\n      const calculator = this.createCalculator(context, font)\n      const box = style.toBoxArray(value)\n      return [\n        calculator.calcHeight(box[0]),\n        calculator.calcWidth(box[1]),\n        calculator.calcHeight(box[2]),\n        calculator.calcWidth(box[3]),\n      ]\n    }\n    return style.toBoxArray(value)\n  }\n  public get theme(): RequiredThemeDefine {\n    return this._theme\n  }\n  public drawWithClip(\n    context: CellContext,\n    draw: (ctx: CanvasRenderingContext2D) => void\n  ): void {\n    const drawRect = context.getDrawRect()\n    if (!drawRect) {\n      return\n    }\n    const ctx = context.getContext()\n    if (ctx) {\n      ctx.save()\n      try {\n        ctx.beginPath()\n        ctx.rect(drawRect.left, drawRect.top, drawRect.width, drawRect.height)\n        // clip\n        ctx.clip()\n\n        draw(ctx)\n      } finally {\n        ctx.restore()\n      }\n    }\n  }\n  public drawBorderWithClip(\n    context: CellContext,\n    draw: (ctx: CanvasRenderingContext2D) => void\n  ): void {\n    const drawRect = context.getDrawRect()\n    if (!drawRect) {\n      return\n    }\n    const rect = context.getRect()\n    const ctx = context.getContext()\n    if (ctx) {\n      ctx.save()\n      try {\n        ctx.lineCap = 'square'\n\n        // 对于划线clip\n        ctx.beginPath()\n        let clipLeft = drawRect.left\n        let clipWidth = drawRect.width\n        if (drawRect.left === rect.left) {\n          clipLeft += -1\n          clipWidth += 1\n        }\n        let clipTop = drawRect.top\n        let clipHeight = drawRect.height\n        if (drawRect.top === rect.top) {\n          clipTop += -1\n          clipHeight += 1\n        }\n        ctx.rect(clipLeft, clipTop, clipWidth, clipHeight)\n        ctx.clip()\n\n        draw(ctx)\n      } finally {\n        ctx.restore()\n      }\n    }\n  }\n  public getTextRect(\n    text: string,\n    context: CellContext,\n    {\n      padding,\n      offset = 2,\n      textAlign = 'left',\n      textBaseline = 'middle',\n      font,\n      textOverflow = 'clip',\n      icons,\n    }: {\n      padding?: number | string | (number | string)[]\n      offset?: number\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      font?: FontPropertyDefine\n      textOverflow?: TextOverflow\n      icons?: SimpleColumnIconOption[]\n    } = {}\n  ) {\n    let rect = context.getRect()\n    const drawRect = context.getDrawRect()\n    const ctx = context.getContext()\n\n    const { col, row } = context\n    font = getGridThemeFont(this._grid, this.theme, col, row, font)\n\n    if (drawRect && ctx) {\n      ctx.save()\n      try {\n        font = getFont(font, context.col, context.row, this._grid, ctx)\n        if (padding) {\n          const paddingNums = this.toBoxPixelArray(padding, context, font)\n          const left = rect.left + paddingNums[3]\n          const top = rect.top + paddingNums[0]\n          const width = rect.width - paddingNums[1] - paddingNums[3]\n          const height = rect.height - paddingNums[0] - paddingNums[2]\n          rect = new Rect(left, top, width, height)\n        }\n\n        // 文字style\n        ctx.textAlign = textAlign\n        ctx.textBaseline = textBaseline\n        ctx.font = font || ctx.font\n\n        let inlines = buildInlines(icons, text) as Inline[]\n        if (\n          isAllowOverflow(textOverflow) &&\n          isOverflowInlines(ctx, inlines, rect.width)\n        ) {\n          const truncInlines = truncateInlines(\n            ctx,\n            inlines,\n            rect.width,\n            offset,\n            textOverflow\n          ).inlines\n          inlines = truncInlines\n        }\n\n        const inlineWidths = inlines.map(\n          (inline) => (inline.width({ ctx }) || 0) - 0\n        )\n        const offsetBottom = 0\n        const offsetTop = 0\n        let offsetRight =\n          inlineWidths.length > 0 ? inlineWidths.reduce((a, b) => a + b) : 0\n        let offsetLeft = 0\n        let rectLeft = rect.right\n        let rectTop = rect.bottom\n        let rectRight = 0\n        let rectBottom = 0\n        inlines.forEach((inline, index) => {\n          const inlineWidth = inlineWidths[index]\n          offsetRight -= inlineWidth\n          ctx.font = inline.font() || ctx.font\n          const inlineHeight = getFontSize(ctx, ctx.font).height\n          const pos = calcStartPosition(\n            ctx,\n            {\n              bottom: rect.top + rect.height,\n              height: rect.height,\n              left: rect.left,\n              right: rect.left + rect.width,\n              top: rect.top,\n              width: rect.width,\n            },\n            inlineWidth,\n            inlineHeight,\n            {\n              offset: offset + 1,\n              padding: {\n                bottom: offsetBottom,\n                left: offsetLeft,\n                right: offsetRight,\n                top: offsetTop,\n              },\n            }\n          )\n          rectLeft = Math.floor(Math.min(rectLeft, pos.x))\n          rectTop = Math.floor(Math.min(rectTop, pos.y))\n          rectRight = Math.ceil(Math.max(rectRight, pos.x + inlineWidth))\n          rectBottom = Math.ceil(Math.max(rectBottom, pos.y + inlineHeight))\n\n          offsetLeft += inlineWidth\n        })\n        rect = new Rect(\n          Math.min(rectLeft, rectRight),\n          Math.min(rectTop, rectBottom),\n          Math.abs(rectRight - rectLeft),\n          Math.abs(rectBottom - rectTop)\n        )\n      } finally {\n        ctx.restore()\n      }\n    }\n    return rect\n  }\n  public text(\n    text: string,\n    context: CellContext,\n    {\n      padding,\n      offset = 2,\n      color,\n      textAlign = 'left',\n      textBaseline = 'middle',\n      font,\n      textOverflow = 'clip',\n      icons,\n    }: {\n      padding?: number | string | (number | string)[]\n      offset?: number\n      color?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      font?: FontPropertyDefine\n      textOverflow?: TextOverflow\n      icons?: SimpleColumnIconOption[]\n    } = {}\n  ): void {\n    let rect = context.getRect()\n\n    const { col, row } = context\n\n    color = getGridThemeColor(this._grid, this.theme, col, row, color)\n    font = getGridThemeFont(this._grid, this.theme, col, row, font)\n\n    this.drawWithClip(context, (ctx) => {\n      font = getFont(font, context.col, context.row, this._grid, ctx)\n      if (padding) {\n        const paddingNums = this.toBoxPixelArray(padding, context, font)\n        const left = rect.left + paddingNums[3]\n        const top = rect.top + paddingNums[0]\n        const width = rect.width - paddingNums[1] - paddingNums[3]\n        const height = rect.height - paddingNums[0] - paddingNums[2]\n        rect = new Rect(left, top, width, height)\n      }\n      _inlineRect(this._grid, ctx, text, rect, col, row, {\n        color,\n        font,\n        icons,\n        offset,\n        textAlign,\n        textBaseline,\n        textOverflow,\n      })\n    })\n  }\n  public multilineText(\n    multilines: string[],\n    context: CellContext,\n    {\n      padding,\n      offset = 2,\n      color,\n      textAlign = 'left',\n      textBaseline = 'middle',\n      font,\n      lineHeight = '1em',\n      autoWrapText = false,\n      lineClamp = 0,\n      textOverflow = 'clip',\n      icons,\n    }: {\n      padding?: number | string | (number | string)[]\n      offset?: number\n      color?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      font?: FontPropertyDefine\n      lineHeight?: string | number\n      autoWrapText?: boolean\n      lineClamp?: LineClamp\n      textOverflow?: TextOverflow\n      icons?: SimpleColumnIconOption[]\n    } = {}\n  ): void {\n    let rect = context.getRect()\n\n    const { col, row } = context\n\n    color = getGridThemeColor(this._grid, this.theme, col, row, color)\n    font = getGridThemeFont(this._grid, this.theme, col, row, font)\n\n    this.drawWithClip(context, (ctx) => {\n      font = getFont(font, context.col, context.row, this._grid, ctx)\n      if (padding) {\n        const paddingNums = this.toBoxPixelArray(padding, context, font)\n        const left = rect.left + paddingNums[3]\n        const top = rect.top + paddingNums[0]\n        const width = rect.width - paddingNums[1] - paddingNums[3]\n        const height = rect.height - paddingNums[0] - paddingNums[2]\n        rect = new Rect(left, top, width, height)\n      }\n      const calculator = this.createCalculator(context, font)\n      lineHeight = calculator.calcHeight(lineHeight)\n      _multiInlineRect(this._grid, ctx, multilines, rect, col, row, {\n        autoWrapText,\n        color,\n        font,\n        icons,\n        lineClamp,\n        lineHeight,\n        offset,\n        textAlign,\n        textBaseline,\n        textOverflow,\n      })\n    })\n  }\n  public fillText(\n    text: string,\n    x: number,\n    y: number,\n    context: CellContext,\n    {\n      color,\n      textAlign = 'left',\n      textBaseline = 'top',\n      font,\n    }: {\n      color?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      font?: FontPropertyDefine\n    } = {}\n  ): void {\n    const { col, row } = context\n\n    color = getGridThemeColor(this._grid, this.theme, col, row, color)\n    font = getGridThemeFont(this._grid, this.theme, col, row, font)\n\n    const ctx = context.getContext()\n    ctx.save()\n    try {\n      font = getFont(font, context.col, context.row, this._grid, ctx)\n      ctx.fillStyle = getColor(color, col, row, this._grid, ctx)\n      ctx.textAlign = textAlign\n      ctx.textBaseline = textBaseline\n      ctx.font = font || ctx.font\n      ctx.fillText(text, x, y)\n    } finally {\n      ctx.restore()\n    }\n  }\n  public clearCell(context: CellContext): void {\n    const rect = context.getRect()\n    this.drawWithClip(context, (ctx) => {\n      ctx.clearRect(rect.left, rect.top, rect.width, rect.height)\n    })\n  }\n  public fillCell(\n    context: CellContext,\n    {\n      fillColor = this.theme.defaultBgColor,\n      selectionColor,\n    }: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n    } = {}\n  ): void {\n    const rect = context.getRect()\n\n    this.drawWithClip(context, (ctx) => {\n      const col = context.col\n      const row = context.row\n      ctx.fillStyle = getColor(fillColor, col, row, this._grid, ctx)\n\n      ctx.beginPath()\n      ctx.clearRect(rect.left, rect.top, rect.width, rect.height)\n      ctx.rect(rect.left, rect.top, rect.width, rect.height)\n      ctx.fill()\n      if (selectionColor) {\n        ctx.fillStyle = getColor(selectionColor, col, row, this._grid, ctx)\n        ctx.fill()\n      }\n    })\n  }\n  public fillCellWithState(\n    context: CellContext,\n    option: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n      isEditing?: boolean\n    } = {}\n  ): void {\n    option.fillColor = this.getFillColorState(context, option)\n    if (option.isEditing) {\n      delete option.selectionColor\n      delete option.isEditing\n    } else {\n      option.selectionColor = this.getSelectionColorState(context, option)\n    }\n    this.fillCell(context, option)\n  }\n  public fillRect(\n    rect: RectProps,\n    context: CellContext,\n    {\n      fillColor = this.theme.defaultBgColor,\n      selectionColor,\n    }: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n    } = {}\n  ) {\n    const ctx = context.getContext()\n    ctx.save()\n    try {\n      const col = context.col\n      const row = context.row\n      ctx.fillStyle = getColor(fillColor, col, row, this._grid, ctx)\n\n      ctx.beginPath()\n      ctx.rect(rect.left, rect.top, rect.width, rect.height)\n      ctx.fill()\n      if (selectionColor) {\n        ctx.fillStyle = getColor(selectionColor, col, row, this._grid, ctx)\n        ctx.fill()\n      }\n    } finally {\n      ctx.restore()\n    }\n  }\n  public fillRectWithState(\n    rect: RectProps,\n    context: CellContext,\n    option: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n    } = {}\n  ) {\n    option.fillColor = this.getFillColorState(context, option)\n    option.selectionColor = this.getSelectionColorState(context, option)\n    this.fillRect(rect, context, option)\n  }\n  public getSelectionColorState(\n    context: CellContext,\n    option: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n    } = {}\n  ): ColorPropertyDefine | undefined {\n    const sel = context.getSelection()\n    const { col, row } = context\n    if (option.selectionColor) {\n      return option.selectionColor\n    } else if (sel.dragged) {\n      return this.theme.selectionDragBgColor\n    } else if (\n      !cellInRange(context.range, sel.select.col, sel.select.row) &&\n      cellInRange(sel.range, col, row)\n    ) {\n      return this.theme.selectionBgColor\n    } else if (\n      cellInRange(context.range, sel.select.col, sel.select.row) &&\n      cellInRange(sel.range, col, row)\n    ) {\n      return this.theme.focusBgColor\n    } else {\n      return undefined\n    }\n  }\n  public getFillColorState(\n    context: CellContext,\n    option: {\n      fillColor?: ColorPropertyDefine\n      selectionColor?: ColorPropertyDefine\n    } = {}\n  ): ColorPropertyDefine {\n    const sel = context.getSelection()\n    const { col, row } = context\n    if (\n      !cellInRange(context.range, sel.select.col, sel.select.row) &&\n      cellInRange(sel.range, col, row)\n    ) {\n      return this.theme.selectionBgColor\n    }\n    if (option.fillColor) {\n      return option.fillColor\n    }\n    if (cellInRange(context.range, sel.select.col, sel.select.row)) {\n      return this.theme.highlightBgColor\n    }\n    const isFrozenCell = this._grid.isFrozenCell(col, row)\n    if (isFrozenCell && isFrozenCell.row) {\n      return this.theme.frozenRowsBgColor\n    }\n    return this.theme.defaultBgColor\n  }\n  public border(\n    context: CellContext,\n    {\n      borderColor = this.theme.borderColor,\n      lineWidth = 1,\n    }: { borderColor?: ColorsPropertyDefine; lineWidth?: number } = {}\n  ): void {\n    const rect = context.getRect()\n\n    this.drawBorderWithClip(context, (ctx) => {\n      const col = context.col\n      const row = context.row\n      let left = rect.left\n      let top = rect.top\n      let width = rect.width\n      let height = rect.height\n      if (col === 0) {\n        left += lineWidth\n        width -= lineWidth\n      }\n      if (row === 0) {\n        top += lineWidth\n        height -= lineWidth\n      }\n      const borderColors = getColor(borderColor, col, row, this._grid, ctx)\n\n      if (lineWidth === 1) {\n        ctx.lineWidth = 1\n        strokeRect(ctx, borderColors, left - 0.5, top - 0.5, width, height)\n      } else if (lineWidth === 2) {\n        ctx.lineWidth = 2\n        strokeRect(ctx, borderColors, left, top, width - 1, height - 1)\n      } else {\n        ctx.lineWidth = lineWidth\n        const startOffset = lineWidth / 2 - 1\n        strokeRect(\n          ctx,\n          borderColors,\n          left + startOffset,\n          top + startOffset,\n          width - lineWidth + 1,\n          height - lineWidth + 1\n        )\n      }\n    })\n  }\n  public borderSelection(\n    context: CellContext,\n    option: {\n      borderColor?: ColorsPropertyDefine\n      lineWidth?: number\n      highlightBorderWidth?: number\n      isEditing?: boolean\n    } = {}\n  ) {\n    const col = context.col\n    const row = context.row\n    const border = context.getSelection().border\n    const rect = context.getRect()\n    const drawRect = context.getDrawRect() || rect\n\n    // header color\n    const isFrozenCell = this._grid.isFrozenCell(col, row)\n    if (isFrozenCell && isFrozenCell.row) {\n      option.borderColor = this.theme.frozenRowsBorderColor\n    }\n\n    option.lineWidth = 1\n    this.border(context, option)\n\n    // 编辑中不绘制选择边框\n    if (option.isEditing) {\n      return\n    }\n\n    let highlightBorderWidth = 1\n    if (option.highlightBorderWidth !== undefined) {\n      highlightBorderWidth = option.highlightBorderWidth\n    }\n\n    // 画边框\n    if (border.top || border.right || border.bottom || border.left) {\n      this.drawBorderWithClip(context, (ctx) => {\n        const borderColor = getColor(\n          this.theme.highlightBorderColor,\n          col,\n          row,\n          this._grid,\n          ctx\n        )\n        const borderColors = style.toBoxArray(borderColor)\n        ctx.lineWidth = highlightBorderWidth\n        if (ctx.lineWidth > 0) {\n          const offset = ctx.lineWidth / 2\n          if (row === 0) {\n            rect.top += offset\n          }\n          if (col === 0) {\n            rect.left += offset\n          }\n          if (border.top) {\n            ctx.strokeStyle = borderColors[0] || ctx.strokeStyle\n            ctx.beginPath()\n            ctx.moveTo(rect.left, rect.top)\n            ctx.lineTo(rect.right - offset, rect.top)\n            ctx.stroke()\n          }\n          if (border.right) {\n            ctx.strokeStyle = borderColors[1] || ctx.strokeStyle\n            ctx.beginPath()\n            ctx.moveTo(rect.right - offset, rect.top)\n            ctx.lineTo(rect.right - offset, rect.bottom - offset)\n            ctx.stroke()\n          }\n          if (border.bottom) {\n            ctx.strokeStyle = borderColors[2] || ctx.strokeStyle\n            ctx.beginPath()\n            ctx.moveTo(rect.right - offset, rect.bottom - offset)\n            ctx.lineTo(rect.left, rect.bottom - offset)\n            ctx.stroke()\n          }\n          if (border.left) {\n            ctx.strokeStyle = borderColors[3] || ctx.strokeStyle\n            ctx.beginPath()\n            ctx.moveTo(rect.left, rect.bottom - offset)\n            ctx.lineTo(rect.left, rect.top)\n            ctx.stroke()\n          }\n        }\n\n        if (border.right && border.bottom && this._grid.canDragSelection) {\n          // 右下角拖动点\n          const x = drawRect.right\n          const y = drawRect.bottom\n          ctx.lineWidth = 1\n          ctx.strokeStyle =\n            borderColors[1] || borderColors[2] || ctx.strokeStyle\n          ctx.beginPath()\n          ctx.moveTo(x - 8, y - 3)\n          ctx.lineTo(x - 3, y - 8)\n          ctx.moveTo(x - 5, y - 3)\n          ctx.lineTo(x - 3, y - 5)\n          ctx.stroke()\n        }\n      })\n    }\n\n    // 额外处理\n    const range = this._grid.selection.range\n    if (\n      range.start.row <= row &&\n      range.end.row >= row &&\n      range.end.col === col - 1\n    ) {\n      // 左边被选中\n      this.drawBorderWithClip(context, (ctx) => {\n        const borderColor = getColor(\n          this.theme.highlightBorderColor,\n          col - 1,\n          row,\n          this._grid,\n          ctx\n        )\n        const borderColors = style.toBoxArray(borderColor)\n        ctx.lineWidth = 1\n        ctx.strokeStyle = borderColors[1] || ctx.strokeStyle\n        ctx.beginPath()\n        ctx.moveTo(rect.left - 0.5, rect.top)\n        ctx.lineTo(rect.left - 0.5, rect.bottom)\n        ctx.stroke()\n      })\n    } else if (\n      range.start.col <= col &&\n      range.end.col >= col &&\n      range.end.row === row - 1\n    ) {\n      // 顶部被选中\n      this.drawBorderWithClip(context, (ctx) => {\n        const borderColor = getColor(\n          this.theme.highlightBorderColor,\n          col,\n          row - 1,\n          this._grid,\n          ctx\n        )\n        const borderColors = style.toBoxArray(borderColor)\n        ctx.lineWidth = 1\n        ctx.strokeStyle = borderColors[0] || ctx.strokeStyle\n        ctx.beginPath()\n        ctx.moveTo(rect.left, rect.top - 0.5)\n        ctx.lineTo(rect.right, rect.top - 0.5)\n        ctx.stroke()\n      })\n    }\n  }\n  // public borderWithState(\n  //   context: CellContext,\n  //   option: { borderColor?: ColorsPropertyDefine; lineWidth?: number } = {}\n  // ): void {\n  //   const rect = context.getRect()\n  //   const state = context.getSelectState()\n  //   const { col, row } = context\n\n  //   // 划线\n  //   if (state.selected) {\n  //     option.borderColor = this.theme.highlightBorderColor\n  //     option.lineWidth = 2\n  //     this.border(context, option)\n  //   } else {\n  //     // header color\n  //     const isFrozenCell = this._grid.isFrozenCell(col, row)\n  //     if (isFrozenCell && isFrozenCell.row) {\n  //       option.borderColor = this.theme.frozenRowsBorderColor\n  //     }\n\n  //     option.lineWidth = 1\n  //     this.border(context, option)\n\n  //     // 额外处理\n  //     const sel = this._grid.selection.select\n  //     if (sel.col + 1 === col && sel.row === row) {\n  //       // 左边被选中\n  //       this.drawBorderWithClip(context, ctx => {\n  //         const borderColors = style.toBoxArray(\n  //           getColor(\n  //             this.theme.highlightBorderColor,\n  //             sel.col,\n  //             sel.row,\n  //             this._grid,\n  //             ctx\n  //           )\n  //         )\n  //         ctx.lineWidth = 1\n  //         ctx.strokeStyle = borderColors[1] || ctx.strokeStyle\n  //         ctx.beginPath()\n  //         ctx.moveTo(rect.left - 0.5, rect.top)\n  //         ctx.lineTo(rect.left - 0.5, rect.bottom)\n  //         ctx.stroke()\n  //       })\n  //     } else if (sel.col === col && sel.row + 1 === row) {\n  //       // 顶部被选中\n  //       this.drawBorderWithClip(context, ctx => {\n  //         const borderColors = style.toBoxArray(\n  //           getColor(\n  //             this.theme.highlightBorderColor,\n  //             sel.col,\n  //             sel.row,\n  //             this._grid,\n  //             ctx\n  //           )\n  //         )\n  //         ctx.lineWidth = 1\n  //         ctx.strokeStyle = borderColors[0] || ctx.strokeStyle\n  //         ctx.beginPath()\n  //         ctx.moveTo(rect.left, rect.top - 0.5)\n  //         ctx.lineTo(rect.right, rect.top - 0.5)\n  //         ctx.stroke()\n  //       })\n  //     }\n  //   }\n  // }\n  public buildCheckBoxInline(\n    check: boolean,\n    context: CellContext,\n    option: {\n      animElapsedTime?: number\n      uncheckBgColor?: ColorPropertyDefine\n      checkBgColor?: ColorPropertyDefine\n      borderColor?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n    } = {}\n  ): InlineDrawer {\n    const self = this\n    const boxWidth = canvasHelper.measureCheckbox(context.getContext()).width\n\n    function draw(info: InlineDrawOption): void {\n      const col = context.col\n      const row = context.row\n      gridDrawCheckbox(info.ctx, info.rect, col, row, check, self, option, {\n        offset: info.offset + 1,\n        padding: {\n          bottom: info.offsetBottom,\n          left: info.offsetLeft + 1,\n          right: info.offsetRight,\n          top: info.offsetTop,\n        },\n      })\n    }\n    return new InlineDrawer({\n      color: undefined,\n      draw,\n      height: boxWidth + 1,\n      width: boxWidth + 3,\n    })\n  }\n  public buildSwitchBtnInline(\n    check: boolean,\n    context: CellContext,\n    option: {\n      animElapsedTime?: number\n      uncheckBgColor?: ColorPropertyDefine\n      checkBgColor?: ColorPropertyDefine\n      borderColor?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n    } = {}\n  ): InlineDrawer {\n    const self = this\n    const btnSize = getSwitchBtnSize(context.getRect())\n\n    function draw(info: InlineDrawOption) {\n      const col = context.col\n      const row = context.row\n      gridDrawSwitchBtn(info.ctx, info.rect, col, row, check, self, option, {\n        offset: info.offset + 1,\n        padding: {\n          bottom: info.offsetBottom,\n          left: info.offsetLeft + 1,\n          right: info.offsetRight,\n          top: info.offsetTop,\n        },\n      })\n    }\n    return new InlineDrawer({\n      color: undefined,\n      draw,\n      height: btnSize.height + 1,\n      width: btnSize.width + 3,\n    })\n  }\n  public checkbox(\n    check: boolean,\n    context: CellContext,\n    option: {\n      animElapsedTime?: number\n      uncheckBgColor?: ColorPropertyDefine\n      checkBgColor?: ColorPropertyDefine\n      borderColor?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n    } = {}\n  ): void {\n    this.drawWithClip(context, (ctx) => {\n      const { col, row } = context\n      gridDrawCheckbox(ctx, context.getRect(), col, row, check, this, option)\n    })\n  }\n  public radioButton(\n    check: boolean,\n    context: CellContext,\n    option: {\n      animElapsedTime?: number\n      checkColor?: ColorPropertyDefine\n      uncheckBorderColor?: ColorPropertyDefine\n      checkBorderColor?: ColorPropertyDefine\n      bgColor?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n    } = {}\n  ): void {\n    this.drawWithClip(context, (ctx) => {\n      const { col, row } = context\n      gridDrawRadioButton(ctx, context.getRect(), col, row, check, this, option)\n    })\n  }\n  public switch(\n    check: boolean,\n    context: CellContext,\n    option: {\n      animElapsedTime?: number\n      uncheckBgColor?: ColorPropertyDefine\n      checkBgColor?: ColorPropertyDefine\n      borderColor?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n    } = {}\n  ): void {\n    this.drawWithClip(context, (ctx) => {\n      const col = context.col\n      const row = context.row\n      gridDrawSwitchBtn(ctx, context.getRect(), col, row, check, this, option)\n    })\n  }\n  public button(\n    caption: string,\n    context: CellContext,\n    {\n      bgColor = this.theme.button.bgColor,\n      padding,\n      offset = 2,\n      color = this.theme.button.color,\n      textAlign = 'center',\n      textBaseline = 'middle',\n      shadow,\n      font,\n      textOverflow = 'clip',\n      icons,\n    }: {\n      bgColor?: ColorPropertyDefine\n      padding?: number | string | (number | string)[]\n      offset?: number\n      color?: ColorPropertyDefine\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      shadow?: DrawButtonOption['shadow']\n      font?: FontPropertyDefine\n      textOverflow?: TextOverflow\n      icons?: SimpleColumnIconOption[]\n    } = {}\n  ): void {\n    const rect = context.getRect()\n\n    this.drawWithClip(context, (ctx) => {\n      font = getFont(font, context.col, context.row, this._grid, ctx)\n      const col = context.col\n      const row = context.row\n      const paddingNums = this.toBoxPixelArray(\n        padding || rect.height / 8,\n        context,\n        font\n      )\n      const left = rect.left + paddingNums[3]\n      const top = rect.top + paddingNums[0]\n      const width = rect.width - paddingNums[1] - paddingNums[3]\n      const height = rect.height - paddingNums[0] - paddingNums[2]\n\n      bgColor = getColor(bgColor, context.col, context.row, this._grid, ctx)\n\n      canvasHelper.drawButton(ctx, left, top, width, height, {\n        bgColor,\n        // offset,\n        radius: rect.height / 8,\n        shadow,\n      })\n      _inlineRect(\n        this._grid,\n        ctx,\n        caption,\n        new Rect(left, top, width, height),\n        col,\n        row,\n        {\n          color,\n          font,\n          icons,\n          offset,\n          textAlign,\n          textBaseline,\n          textOverflow,\n        }\n      )\n    })\n  }\n  public testFontLoad(\n    font: string | undefined,\n    value: string,\n    context: CellContext\n  ): boolean {\n    return testFontLoad(font, value, context, this._grid)\n  }\n  public tree(\n    text: string,\n    context: CellContext,\n    {\n      font,\n      offset = 2,\n      color,\n      lineColor = this.theme.tree.lineColor,\n      buttonColor = this.theme.tree.buttonColor,\n      buttonBgColor = this.theme.tree.buttonBgColor,\n      buttonBorderColor = this.theme.tree.buttonBorderColor,\n      icons,\n      padding,\n      textAlign = 'left',\n      textBaseline = 'middle',\n      textOverflow = 'clip',\n      treeInfo,\n      treeNodeSpace = 0,\n      isMultilineText = false,\n      autoWrapText = false,\n      lineHeight = '1em',\n      lineClamp = 0,\n    }: {\n      font?: FontPropertyDefine\n      offset?: number\n      color?: ColorPropertyDefine\n      lineColor?: ColorPropertyDefine\n      buttonColor?: ColorPropertyDefine\n      buttonBgColor?: ColorPropertyDefine\n      buttonBorderColor?: ColorPropertyDefine\n      icons?: SimpleColumnIconOption[]\n      padding?: number | string | (number | string)[]\n      textAlign?: CanvasTextAlign\n      textBaseline?: CanvasTextBaseline\n      textOverflow?: TextOverflow\n      treeInfo?: TreeInfo\n      treeNodeSpace?: number\n      isMultilineText?: boolean\n      autoWrapText?: boolean\n      lineHeight?: string | number\n      lineClamp?: LineClamp\n    } = {}\n  ): void {\n    let rect = context.getRect()\n\n    const col = context.col\n    const row = context.row\n\n    color = getGridThemeColor(this._grid, this.theme, col, row, color)\n    font = getGridThemeFont(this._grid, this.theme, col, row, font)\n\n    this.drawWithClip(context, (ctx) => {\n      let xOffset = rect.left\n      let lineNodeSpace = 0\n      if (treeInfo) {\n        const info = treeInfo as TreeInfo\n        const nodeRadius = 5\n        const rectTop = rect.top\n        const rectMiddle = rectTop + rect.height / 2\n        const rectBottom = rectTop + rect.height\n        lineNodeSpace = treeNodeSpace\n        ctx.strokeStyle = this.getColor(lineColor, col, row, ctx)\n        ctx.beginPath()\n        for (let i = 0; i < info.level; i++) {\n          xOffset += lineNodeSpace\n          const isLastLevel = i === info.level - 1\n          const isLastRecord = info.levelLast[i]\n          if (isLastLevel || !isLastRecord) {\n            ctx.moveTo(xOffset, rectTop)\n            if (isLastRecord) {\n              ctx.lineTo(xOffset, rectMiddle)\n            } else {\n              ctx.lineTo(xOffset, rectBottom)\n            }\n            if (isLastLevel) {\n              ctx.moveTo(xOffset, rectMiddle)\n              ctx.lineTo(xOffset + lineNodeSpace - nodeRadius, rectMiddle)\n            }\n          }\n        }\n        ctx.stroke()\n        if (!info.isLeaf) {\n          ctx.beginPath()\n          ctx.strokeStyle = this.getColor(buttonBorderColor, col, row, ctx)\n          ctx.moveTo(xOffset + lineNodeSpace + nodeRadius, rectMiddle)\n          ctx.arc(\n            xOffset + lineNodeSpace,\n            rectMiddle,\n            nodeRadius,\n            0,\n            2 * Math.PI\n          )\n          ctx.fillStyle = this.getColor(buttonBgColor, col, row, ctx)\n          ctx.fill()\n          ctx.stroke()\n\n          if (info.expanded) {\n            ctx.beginPath()\n            ctx.strokeStyle = this.getColor(lineColor, col, row, ctx)\n            ctx.moveTo(xOffset + lineNodeSpace, rectMiddle + nodeRadius)\n            ctx.lineTo(xOffset + lineNodeSpace, rectBottom)\n            ctx.stroke()\n          }\n\n          // 减号\n          const symbolRadius = nodeRadius - 2\n          ctx.beginPath()\n          ctx.lineWidth = 2\n          ctx.strokeStyle = this.getColor(buttonColor, col, row, ctx)\n          ctx.moveTo(xOffset + lineNodeSpace - symbolRadius, rectMiddle)\n          ctx.lineTo(xOffset + lineNodeSpace + symbolRadius, rectMiddle)\n          if (!info.expanded) {\n            // 加号\n            ctx.moveTo(xOffset + lineNodeSpace, rectMiddle - symbolRadius)\n            ctx.lineTo(xOffset + lineNodeSpace, rectMiddle + symbolRadius)\n          }\n          ctx.stroke()\n        }\n      }\n      rect.left = xOffset + lineNodeSpace * 2\n      font = getFont(font, context.col, context.row, this._grid, ctx)\n      if (padding) {\n        const paddingNums = this.toBoxPixelArray(padding, context, font)\n        const left = rect.left + paddingNums[3]\n        const top = rect.top + paddingNums[0]\n        const width = rect.width - paddingNums[1] - paddingNums[3]\n        const height = rect.height - paddingNums[0] - paddingNums[2]\n        rect = new Rect(left, top, width, height)\n      }\n      if (!isMultilineText) {\n        _inlineRect(this._grid, ctx, text, rect, col, row, {\n          color,\n          font,\n          icons,\n          offset,\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      } else {\n        text = isDef(text) ? text + '' : ''\n        const multiInlines = text\n          .replace(/\\r?\\n/g, '\\n')\n          .replace(/\\r/g, '\\n')\n          .split('\\n')\n        const calculator = this.createCalculator(context, font)\n        lineHeight = calculator.calcHeight(lineHeight)\n        _multiInlineRect(this._grid, ctx, multiInlines, rect, col, row, {\n          autoWrapText,\n          color,\n          font,\n          icons,\n          lineClamp,\n          lineHeight,\n          offset,\n          textAlign,\n          textBaseline,\n          textOverflow,\n        })\n      }\n    })\n  }\n  public attachArea(rect: RectProps, context: CellContext): void {\n    this.drawWithClip(context, (ctx) => {\n      const sel = context.getSelection()\n      const { col, row } = context\n      if (!cellInRange(sel.range, col, row)) {\n        ctx.setLineDash([4, 4])\n      }\n      ctx.strokeStyle = '#D9D9D9'\n      ctx.lineWidth = 1\n      const r = 2\n      const x = rect.left\n      const y = rect.top\n      const width = rect.width\n      const height = rect.height\n      ctx.beginPath()\n      ctx.moveTo(x + r, y)\n      ctx.arcTo(x + width, y, x + width, y + r, r)\n      ctx.arcTo(x + width, y + height, x + width - r, y + height, r)\n      ctx.arcTo(x, y + height, x, y + height - r, r)\n      ctx.arcTo(x, y, x + r, y, r)\n      ctx.stroke()\n    })\n  }\n}\n","import fonts from '../internal/fonts'\nimport { InlineDrawOption, Inline } from './Inline'\nimport { ColorDef, AnyFunction } from '../ts-types'\n\nexport type InlineIconConstructorOption = {\n  width?: number\n  font?: string\n  content?: string\n  color?: ColorDef\n}\n\nexport class InlineIcon extends Inline {\n  private _icon: InlineIconConstructorOption\n  public constructor(icon: InlineIconConstructorOption) {\n    super()\n    this._icon = icon || {}\n  }\n  public width({ ctx }: { ctx: CanvasRenderingContext2D }): number {\n    const icon = this._icon\n    if (icon.width) {\n      return icon.width\n    }\n    if (icon.font && fonts.check(icon.font, icon.content || '')) {\n      ctx.save()\n      ctx.canvas.style.letterSpacing = 'normal'\n      try {\n        ctx.font = icon.font || ctx.font\n        return ctx.measureText(icon.content || '').width\n      } finally {\n        ctx.canvas.style.letterSpacing = ''\n        ctx.restore()\n      }\n    }\n    return 0 // unknown\n  }\n  public font(): string | null {\n    return this._icon.font ?? null\n  }\n  public color(): ColorDef | null {\n    return this._icon.color ?? null\n  }\n  public canDraw(): boolean {\n    const icon = this._icon\n    return icon.font ? fonts.check(icon.font, icon.content || '') : true\n  }\n  public onReady(callback: AnyFunction): void {\n    const icon = this._icon\n    if (icon.font && !fonts.check(icon.font, icon.content || '')) {\n      fonts.load(icon.font, icon.content || '', callback)\n    }\n  }\n  public draw({\n    ctx,\n    canvasHelper,\n    rect,\n    offset,\n    offsetLeft,\n    offsetRight,\n    offsetTop,\n    offsetBottom,\n  }: InlineDrawOption): void {\n    const icon = this._icon\n    if (icon.content) {\n      ctx.canvas.style.letterSpacing = 'normal'\n      try {\n        ctx.font = ctx.font // To apply letterSpacing, we need to reset it.\n        canvasHelper.fillTextRect(\n          ctx,\n          icon.content,\n          rect.left,\n          rect.top,\n          rect.width,\n          rect.height,\n          {\n            offset: offset + 1,\n            padding: {\n              bottom: offsetBottom,\n              left: offsetLeft,\n              right: offsetRight,\n              top: offsetTop,\n            },\n          }\n        )\n      } finally {\n        ctx.canvas.style.letterSpacing = ''\n      }\n    }\n  }\n  public canBreak(): boolean {\n    return false\n  }\n  public toString(): string {\n    return ''\n  }\n}\n","import { MaybePromise, AnyFunction } from '../ts-types'\nimport { getCacheOrLoad } from '../internal/imgs'\nimport { isPromise } from '../internal/utils'\nimport { InlineDrawOption, Inline } from './Inline'\n\nexport type InlineImageConstructorOption = {\n  src: MaybePromise<string>\n  width?: number\n  height?: number\n  imageLeft?: number\n  imageTop?: number\n  imageWidth?: number\n  imageHeight?: number\n}\n\nexport class InlineImage extends Inline {\n  private _src: MaybePromise<string>\n  private _width?: number\n  private _height?: number\n  private _imageLeft?: number\n  private _imageTop?: number\n  private _imageWidth?: number\n  private _imageHeight?: number\n  private _onloaded: AnyFunction[]\n  private _inlineImgPromise: MaybePromise<HTMLImageElement> | null = null\n  private _inlineImg: HTMLImageElement | null = null\n  public constructor({\n    src,\n    width,\n    height,\n    imageLeft,\n    imageTop,\n    imageWidth,\n    imageHeight,\n  }: InlineImageConstructorOption) {\n    super()\n    this._src = src\n    this._width = width\n    this._height = height\n    this._imageLeft = imageLeft\n    this._imageTop = imageTop\n    this._imageWidth = imageWidth\n    this._imageHeight = imageHeight\n\n    this._onloaded = []\n\n    if (isPromise(src)) {\n      src.then((s) => {\n        this._src = s\n        this._loadImage(s)\n      })\n    } else {\n      this._loadImage(src)\n    }\n  }\n  public width(_arg: { ctx: CanvasRenderingContext2D }): number {\n    return this._width || (this._inlineImg?.width ?? 0)\n  }\n  public font(): string | null {\n    return null\n  }\n  public color(): string | null {\n    return null\n  }\n  public canDraw(): boolean {\n    return !!this._inlineImg\n  }\n  public onReady(callback: AnyFunction): void {\n    if (isPromise(this._src) || isPromise(this._inlineImgPromise)) {\n      this._onloaded.push(() => callback())\n    }\n  }\n  public draw({\n    ctx,\n    canvasHelper,\n    rect,\n    offset,\n    offsetLeft,\n    offsetRight,\n    offsetTop,\n    offsetBottom,\n  }: InlineDrawOption): void {\n    const img = this._inlineImg as HTMLImageElement\n    canvasHelper.drawInlineImageRect(\n      ctx,\n      img,\n      this._imageLeft || 0,\n      this._imageTop || 0,\n      this._imageWidth || img.width,\n      this._imageHeight || img.height,\n      this._width || img.width,\n      this._height || img.height,\n      rect.left,\n      rect.top,\n      rect.width,\n      rect.height,\n      {\n        offset: offset + 1,\n        padding: {\n          bottom: offsetBottom,\n          left: offsetLeft,\n          right: offsetRight,\n          top: offsetTop,\n        },\n      }\n    )\n  }\n  public canBreak(): boolean {\n    return false\n  }\n  public toString(): string {\n    return ''\n  }\n  private _loadImage(src: string) {\n    const img = (this._inlineImgPromise = getCacheOrLoad(\n      'InlineImage',\n      50,\n      src\n    ))\n    if (isPromise(img)) {\n      img.then((i) => {\n        this._inlineImg = i\n\n        this._onloaded.forEach((fn) => fn())\n      })\n    } else {\n      this._inlineImg = img\n    }\n  }\n}\n","import { AnyFunction, ColorDef } from '../ts-types'\nimport { calcStartPosition } from '../internal/canvases'\nimport { path2DManager } from '../internal/path2DManager'\nimport { InlineDrawOption, Inline } from './Inline'\n\nexport type InlinePath2DConstructorOption = {\n  path: Path2D | string\n  width: number\n  height: number\n  color?: ColorDef\n}\n\nexport class InlinePath2D extends Inline {\n  private _path: Path2D\n  private _width: number\n  private _height: number\n  private _color?: ColorDef\n  public constructor({\n    path,\n    width,\n    height,\n    color,\n  }: InlinePath2DConstructorOption) {\n    super()\n    // Path2D的Polyfill不会反映在IE中，除非是这个时间\n    const Path2D = path2DManager.getPath2D()\n    this._path = new Path2D(path)\n    this._width = width\n    this._height = height\n    this._color = color\n  }\n  public width(_arg: { ctx: CanvasRenderingContext2D }): number {\n    return this._width\n  }\n  public font(): string | null {\n    return null\n  }\n  public color(): ColorDef | null {\n    return this._color ?? null\n  }\n  public canDraw(): boolean {\n    return true\n  }\n  public onReady(_callback: AnyFunction): void {}\n  public draw({\n    ctx,\n    canvasHelper,\n    rect,\n    offset,\n    offsetLeft,\n    offsetRight,\n    offsetTop,\n    offsetBottom,\n  }: InlineDrawOption): void {\n    offset++\n    const padding = {\n      bottom: offsetBottom,\n      left: offsetLeft,\n      right: offsetRight,\n      top: offsetTop,\n    }\n    ctx.save()\n    try {\n      ctx.beginPath()\n      ctx.rect(rect.left, rect.top, rect.width, rect.height)\n      // clip\n      ctx.clip()\n\n      const pos = calcStartPosition(ctx, rect, this._width, this._height, {\n        offset,\n        padding,\n      })\n      ctx.translate(pos.x, pos.y)\n      ctx.fill(this._path)\n    } finally {\n      ctx.restore()\n    }\n  }\n  public canBreak(): boolean {\n    return false\n  }\n  public toString(): string {\n    return ''\n  }\n}\n","import { then, isPromise } from '../internal/utils'\nimport { InlineImage } from './InlineImage'\nimport { MaybePromise } from '../ts-types'\nimport { toPx } from '../internal/calc'\n\nfunction buildSvgDataUrl(svg: string | Node): string {\n  const data =\n    typeof svg === 'string' ? svg : new XMLSerializer().serializeToString(svg)\n  const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(data)}` // svg -> base64\n  return url\n}\nfunction getSvgElement(svg: string | SVGElement): SVGElement {\n  let el\n  if (typeof svg === 'string') {\n    const parser = new DOMParser()\n    const doc = parser.parseFromString(svg, 'image/svg+xml')\n    const nodes = doc.children || doc.childNodes\n    el = nodes[0] as SVGElement\n    for (let i = 0; i < nodes.length; i++) {\n      if (nodes[i] instanceof SVGElement) {\n        el = nodes[i] as SVGElement\n        break\n      }\n    }\n  } else {\n    el = svg\n  }\n  return el\n}\n\nexport type InlineSvgConstructorOption = {\n  svg: MaybePromise<string | SVGElement>\n  width?: number\n  height?: number\n}\n\nexport class InlineSvg extends InlineImage {\n  public constructor({ svg, width, height }: InlineSvgConstructorOption) {\n    const svgElem = then(svg, getSvgElement)\n    const elmWidth = !isPromise(svgElem)\n      ? svgElem.getAttribute('width') ?? undefined\n      : undefined\n    const elmHeight = !isPromise(svgElem)\n      ? svgElem.getAttribute('height') ?? undefined\n      : undefined\n    const context = {\n      full: 0,\n      em: 0\n    }\n    const numElmWidth = elmWidth != null ? toPx(elmWidth, context) : undefined\n    const numElmHeight = elmHeight != null ? toPx(elmHeight, context) : undefined\n    super({\n      src: then(svg, buildSvgDataUrl),\n      width: width || numElmWidth,\n      height: height || numElmHeight,\n      imageWidth: numElmWidth,\n      imageHeight: numElmHeight,\n    })\n  }\n  public canBreak(): boolean {\n    return false\n  }\n  public toString(): string {\n    return ''\n  }\n}\n","import { IconDefine } from '../ts-types'\nimport { SimpleColumnIconOption } from '../ts-types-internal'\nimport { svgIcons } from '../icons'\nimport { PaddingOption, calcStartPosition } from '../internal/canvases'\nimport { path2DManager } from '../internal/path2DManager'\nimport { isDef } from '../internal/utils'\nimport { InlineDrawOption, Inline } from './Inline'\nimport { InlineDrawer } from './InlineDrawer'\nimport { InlineIcon } from './InlineIcon'\nimport { InlineImage } from './InlineImage'\nimport { InlinePath2D } from './InlinePath2D'\nimport { InlineSvg } from './InlineSvg'\n\nfunction drawRegisteredIcon(\n  ctx: CanvasRenderingContext2D,\n  icon: IconDefine,\n  drawWidth: number,\n  drawHeight: number,\n  left: number,\n  top: number,\n  width: number,\n  height: number,\n  { offset = 2, padding }: { offset?: number; padding?: PaddingOption } = {}\n) {\n  const rect = {\n    bottom: top + height,\n    height,\n    left,\n    right: left + width,\n    top,\n    width,\n  }\n  ctx.save()\n  try {\n    ctx.beginPath()\n    ctx.rect(rect.left, rect.top, rect.width, rect.height)\n    // clip\n    ctx.clip()\n\n    const pos = calcStartPosition(ctx, rect, drawWidth, drawHeight, {\n      offset,\n      padding,\n    })\n    path2DManager.fill(icon, ctx, pos.x, pos.y, drawWidth, drawHeight)\n  } finally {\n    ctx.restore()\n  }\n}\n\nfunction isIconConstructorOption(\n  icon: SimpleColumnIconOption\n): icon is SimpleColumnIconOption & { font: string; content: string } {\n  if (icon.font && icon.content) {\n    return true\n  }\n  return false\n}\n\nfunction isInlineImageConstructorOption(\n  icon: SimpleColumnIconOption\n): icon is SimpleColumnIconOption & { src: string } {\n  if (icon.src) {\n    return true\n  }\n  return false\n}\n\nfunction isInlineSvgConstructorOption(\n  icon: SimpleColumnIconOption\n): icon is SimpleColumnIconOption & {\n  path: string\n  width: number\n  height: number\n} {\n  if (icon.path) {\n    return true\n  }\n  return false\n}\n\nexport function iconOf(icon: SimpleColumnIconOption | null): Inline | null {\n  if (icon instanceof Inline) {\n    return icon\n  }\n  if (!icon) {\n    return null\n  }\n  if (isIconConstructorOption(icon)) {\n    return new InlineIcon(icon)\n  }\n  if (isInlineImageConstructorOption(icon)) {\n    return new InlineImage({\n      height: icon.width,\n      src: icon.src,\n      width: icon.width,\n    })\n  }\n  if (icon.svg) {\n    return new InlineSvg({\n      height: icon.width,\n      svg: icon.svg,\n      width: icon.width,\n    })\n  }\n  if (isInlineSvgConstructorOption(icon)) {\n    return new InlinePath2D({\n      color: icon.color,\n      height: icon.width,\n      path: icon.path,\n      width: icon.width,\n    })\n  }\n  const regedIcons = svgIcons.get()\n  if (icon.name && regedIcons[icon.name]) {\n    const regedIcon = regedIcons[icon.name]\n    const width = icon.width || Math.max(regedIcon.width, regedIcon.height)\n    return new InlineDrawer({\n      draw({\n        ctx,\n        rect,\n        offset,\n        offsetLeft,\n        offsetRight,\n        offsetTop,\n        offsetBottom,\n      }: InlineDrawOption): void {\n        drawRegisteredIcon(\n          ctx,\n          regedIcon,\n          width,\n          width,\n          rect.left,\n          rect.top,\n          rect.width,\n          rect.height,\n          {\n            offset: offset + 1,\n            padding: {\n              bottom: offsetBottom,\n              left: offsetLeft,\n              right: offsetRight,\n              top: offsetTop,\n            },\n          }\n        )\n      },\n      color: icon.color,\n      height: width,\n      width,\n    })\n  }\n  return new InlineIcon(icon)\n}\n\nexport function of(content: string | Inline): Inline\nexport function of(content?: string | Inline | null): null\nexport function of(content?: string | Inline | null): Inline | null {\n  if (!isDef(content)) {\n    return null\n  }\n  if (content instanceof Inline) {\n    return content\n  }\n  return new Inline(content)\n}\nexport function buildInlines(\n  icons: SimpleColumnIconOption[] | null | undefined,\n  inline: Inline | string | (string | Inline)[]\n): Inline[] {\n  const result = []\n  if (icons) {\n    result.push(...icons.map((icon) => iconOf(icon)).filter(isDef))\n  }\n  if (\n    Array.isArray(inline)\n    // && inline.filter(il => il instanceof Inline).length <- ?\n  ) {\n    result.push(...inline.map((il) => of(il)).filter(isDef))\n  } else {\n    const il = of(inline)\n    if (il) {\n      result.push(il)\n    }\n  }\n  return result\n}\nexport function string(inline: any) {\n  return buildInlines(undefined, inline).join('')\n}\n","import { themes } from './themes'\nimport {\n  RequiredThemeDefine,\n  ListGridAPI,\n  ColorPropertyDefine,\n  ColorsPropertyDefine,\n  ColorDef,\n  StylePropertyFunctionArg,\n  FontPropertyDefine,\n} from './ts-types'\nimport { getChainSafe, isDef, getOrApply } from './internal/utils'\n\nfunction getThemeColor<\n  R,\n  T extends\n    | ColorPropertyDefine\n    | ColorsPropertyDefine\n    | FontPropertyDefine\n    | number\n>(grid: ListGridAPI<R>, ...names: string[]): T {\n  const gridThemeColor = getChainSafe(grid.theme, ...names)\n  if (!isDef(gridThemeColor)) {\n    // use default theme\n    return getChainSafe(themes.getDefault(), ...names)\n  }\n  if (typeof gridThemeColor !== 'function') {\n    return gridThemeColor\n  }\n  let defaultThemeColor: ColorDef\n  return ((args: StylePropertyFunctionArg): any => {\n    const color = gridThemeColor(args)\n    if (isDef(color)) {\n      // use grid theme\n      return color\n    }\n    // use default theme\n    defaultThemeColor =\n      defaultThemeColor || getChainSafe(themes.getDefault(), ...names)\n    return getOrApply(defaultThemeColor, args)\n  }) as any\n}\n\nexport class ThemeResolver<T> implements RequiredThemeDefine {\n  private _grid: ListGridAPI<T>\n  private _checkbox: RequiredThemeDefine['checkbox'] | null = null\n  private _radioButton: RequiredThemeDefine['radioButton'] | null = null\n  private _button: RequiredThemeDefine['button'] | null = null\n  private _header: RequiredThemeDefine['header'] | null = null\n  private _switch: RequiredThemeDefine['switch'] | null = null\n  private _tree: RequiredThemeDefine['tree'] | null = null\n  public constructor(grid: ListGridAPI<T>) {\n    this._grid = grid\n  }\n  public getThemeColor<\n    T extends\n      | ColorPropertyDefine\n      | ColorsPropertyDefine\n      | FontPropertyDefine\n      | number\n  >(...name: string[]): T {\n    return getThemeColor(this._grid, ...name)\n  }\n  public get underlayBackgroundColor(): string {\n    return getThemeColor(this._grid, 'underlayBackgroundColor')\n  }\n  // font\n  public get font(): string {\n    return getThemeColor(this._grid, 'font')\n  }\n  public get frozenRowsFont(): string {\n    return getThemeColor(this._grid, 'frozenRowsFont')\n  }\n  // color\n  public get color(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'color')\n  }\n  public get frozenRowsColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'frozenRowsColor')\n  }\n  // background\n  public get defaultBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'defaultBgColor')\n  }\n  public get frozenRowsBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'frozenRowsBgColor')\n  }\n  public get focusBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'focusBgColor')\n  }\n  public get selectionBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'selectionBgColor')\n  }\n  public get highlightBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'highlightBgColor')\n  }\n  public get selectionDragBgColor(): ColorPropertyDefine {\n    return getThemeColor(this._grid, 'selectionDragBgColor')\n  }\n  // border\n  public get borderColor(): ColorsPropertyDefine {\n    return getThemeColor(this._grid, 'borderColor')\n  }\n  public get frozenRowsBorderColor(): ColorsPropertyDefine {\n    return getThemeColor(this._grid, 'frozenRowsBorderColor')\n  }\n  public get highlightBorderColor(): ColorsPropertyDefine {\n    return getThemeColor(this._grid, 'highlightBorderColor')\n  }\n  // grid border\n  public get gridBorderColor(): string {\n    return getThemeColor(this._grid, 'gridBorderColor')\n  }\n  public get gridBorderWidth(): number {\n    return getThemeColor(this._grid, 'gridBorderWidth')\n  }\n  // size\n  public get defaultRowHeight(): number {\n    return getThemeColor(this._grid, 'defaultRowHeight')\n  }\n  public get defaultColWidth(): number {\n    return getThemeColor(this._grid, 'defaultColWidth')\n  }\n  public get highlightBorderWidth(): number {\n    return getThemeColor(this._grid, 'highlightBorderWidth')\n  }\n  // other\n  public get checkbox(): RequiredThemeDefine['checkbox'] {\n    const grid = this._grid\n    return (\n      this._checkbox ||\n      (this._checkbox = {\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'checkbox', 'uncheckBgColor')\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'checkbox', 'checkBgColor')\n        },\n        get borderColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'checkbox', 'borderColor')\n        },\n      })\n    )\n  }\n  public get radioButton(): RequiredThemeDefine['radioButton'] {\n    const grid = this._grid\n    return (\n      this._radioButton ||\n      (this._radioButton = {\n        get checkColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'radioButton', 'checkColor')\n        },\n        get uncheckBorderColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'radioButton', 'uncheckBorderColor')\n        },\n        get checkBorderColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'radioButton', 'checkBorderColor')\n        },\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'radioButton', 'uncheckBgColor')\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'radioButton', 'checkBgColor')\n        },\n      })\n    )\n  }\n  public get button(): RequiredThemeDefine['button'] {\n    const grid = this._grid\n    return (\n      this._button ||\n      (this._button = {\n        get color(): ColorPropertyDefine {\n          return getThemeColor(grid, 'button', 'color')\n        },\n        get bgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'button', 'bgColor')\n        },\n      })\n    )\n  }\n  public get header(): RequiredThemeDefine['header'] {\n    const grid = this._grid\n    return (\n      this._header ||\n      (this._header = {\n        get sortArrowColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'header', 'sortArrowColor')\n        },\n      })\n    )\n  }\n  public get switch(): RequiredThemeDefine['switch'] {\n    const grid = this._grid\n    return (\n      this._switch ||\n      (this._switch = {\n        get uncheckBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'switch', 'uncheckBgColor')\n        },\n        get checkBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'switch', 'checkBgColor')\n        },\n        get borderColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'switch', 'borderColor')\n        },\n      })\n    )\n  }\n  public get tree(): RequiredThemeDefine['tree'] {\n    const grid = this._grid\n    return (\n      this._tree ||\n      (this._tree = {\n        get lineColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'tree', 'lineColor')\n        },\n        get buttonColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'tree', 'buttonColor')\n        },\n        get buttonBgColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'tree', 'buttonBgColor')\n        },\n        get buttonBorderColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'tree', 'buttonBorderColor')\n        },\n        get linkColor(): ColorPropertyDefine {\n          return getThemeColor(grid, 'tree', 'linkColor')\n        },\n      })\n    )\n  }\n}\n","import { ListGridAPI } from '../ts-types'\nimport { TooltipElement } from './internal/TooltipElement'\n\nexport abstract class BaseTooltip<T> {\n  private _grid: ListGridAPI<T>\n  private _tooltipElement?: TooltipElement<T>\n  public constructor(grid: ListGridAPI<T>) {\n    this._grid = grid\n  }\n  public dispose() {\n    this.detachTooltipElement()\n    if (this._tooltipElement) {\n      this._tooltipElement.dispose()\n    }\n    delete this._tooltipElement\n  }\n  public attachTooltipElement(col: number, row: number, content: string) {\n    const tooltipElement = this._getTooltipElement()\n    tooltipElement.attach(this._grid, col, row, content)\n  }\n  public moveTooltipElement(col: number, row: number) {\n    const tooltipElement = this._getTooltipElement()\n    tooltipElement.move(this._grid, col, row)\n  }\n  public detachTooltipElement() {\n    const tooltipElement = this._getTooltipElement()\n    tooltipElement.detach()\n  }\n  public abstract createTooltipElementInternal(): TooltipElement<T>\n  private _getTooltipElement(): TooltipElement<T> {\n    return (\n      this._tooltipElement ||\n      (this._tooltipElement = this.createTooltipElementInternal())\n    )\n  }\n}\n","import { ListGridAPI } from '../../ts-types'\nimport { createElement } from '../../internal/dom'\nimport { EventHandler } from '../../internal/EventHandler'\nimport style from '../../internal/style'\n\nimport tooltipElementCss from './TooltipElement.css'\n\nconst CLASS_NAME = 'kaka-grid__tooltip-element'\nconst CONTENT_CLASS_NAME = `${CLASS_NAME}__content`\nconst HIDDEN_CLASS_NAME = `${CLASS_NAME}--hidden`\nconst SHOWN_CLASS_NAME = `${CLASS_NAME}--shown`\n\nexport class TooltipElement<T> {\n  private _handler: EventHandler\n  private _rootElement: HTMLDivElement\n  private _messageElement: HTMLElement | null\n  public constructor() {\n    this._handler = new EventHandler()\n    this._rootElement = this.createTooltipDomElement()\n    this._messageElement = this.createTooltipMessageElement(\n      this._rootElement,\n      CONTENT_CLASS_NAME\n    )\n  }\n  public dispose() {\n    this.detach()\n\n    const rootElement = this._rootElement\n    if (rootElement.parentElement) {\n      rootElement.parentElement.removeChild(rootElement)\n    }\n\n    this._handler.dispose()\n    this._messageElement = null\n  }\n  public attach(\n    grid: ListGridAPI<T>,\n    col: number,\n    row: number,\n    content: string\n  ) {\n    const rootElement = this._rootElement\n    const messageElement = this._messageElement\n\n    rootElement.classList.remove(SHOWN_CLASS_NAME)\n    rootElement.classList.add(HIDDEN_CLASS_NAME)\n\n    if (messageElement) {\n      this.doSetContent(messageElement, content)\n    }\n\n    if (this._attachCell(grid, col, row)) {\n      rootElement.classList.add(SHOWN_CLASS_NAME)\n      rootElement.classList.remove(HIDDEN_CLASS_NAME)\n    } else {\n      this._detach()\n    }\n  }\n  public move(grid: ListGridAPI<T>, col: number, row: number) {\n    const rootElement = this._rootElement\n    if (this._attachCell(grid, col, row)) {\n      rootElement.classList.add(SHOWN_CLASS_NAME)\n      rootElement.classList.remove(HIDDEN_CLASS_NAME)\n    } else {\n      this._detach()\n    }\n  }\n  public detach() {\n    this._detach()\n  }\n  protected createTooltipDomElement() {\n    style.inject('tooltipElement', tooltipElementCss)\n    const rootElement = createElement('div', {\n      classList: [CLASS_NAME, HIDDEN_CLASS_NAME],\n    })\n    return rootElement\n  }\n  protected createTooltipMessageElement(\n    rootElement: HTMLDivElement,\n    cls: string\n  ): HTMLElement {\n    const messageElement = createElement('pre', { classList: [cls] })\n    rootElement.appendChild(messageElement)\n    return messageElement\n  }\n  protected doSetContent(element: Element, content: string) {\n    element.textContent = content\n  }\n  private _detach() {\n    const rootElement = this._rootElement\n    if (rootElement.parentElement) {\n      // rootElement.parentElement.removeChild(rootElement);\n      rootElement.classList.remove(SHOWN_CLASS_NAME)\n      rootElement.classList.add(HIDDEN_CLASS_NAME)\n    }\n  }\n  private _attachCell(grid: ListGridAPI<T>, col: number, row: number) {\n    const rootElement = this._rootElement\n    const { element, rect } = grid.getAttachCellsArea(\n      grid.getCellRange(col, row)\n    )\n\n    const top = rect.top\n    const right = rect.right\n    const bottom = rect.bottom\n    const left = rect.left\n    const width = rect.width\n\n    const frozenRowCount = grid.frozenRowCount\n    const frozenColCount = grid.frozenColCount\n    if (row >= frozenRowCount && frozenRowCount > 0) {\n      const { rect: frozenRect } = grid.getAttachCellsArea(\n        grid.getCellRange(col, frozenRowCount - 1)\n      )\n      if (bottom < frozenRect.bottom) {\n        return false // 超出范围\n      }\n    } else {\n      if (bottom < 0) {\n        return false // 超出范围\n      }\n    }\n    if (col >= frozenColCount && frozenColCount > 0) {\n      const { rect: frozenRect } = grid.getAttachCellsArea(\n        grid.getCellRange(frozenColCount - 1, row)\n      )\n      if (right < frozenRect.right) {\n        return false // 超出范围\n      }\n    } else {\n      if (right < 0) {\n        return false // 超出范围\n      }\n    }\n    const offsetHeight = element.offsetHeight\n    const offsetWidth = element.offsetWidth\n    if (offsetHeight < top) {\n      return false // 超出范围\n    }\n    if (offsetWidth < left) {\n      return false // 超出范围\n    }\n\n    const rootTop = bottom\n    const rootLeft = left + width / 2\n    rootElement.style.top = `${rootTop.toFixed()}px`\n    rootElement.style.left = `${rootLeft.toFixed()}px`\n    rootElement.style.minWidth = `${width.toFixed()}px`\n    if (rootElement.parentElement !== element) {\n      element.appendChild(rootElement)\n    }\n\n    const rootHeight = rootElement.offsetHeight\n    const rootWidth = rootElement.offsetWidth\n    // 底部越界\n    if (rootTop + rootHeight > offsetHeight) {\n      const bTop = top - rootHeight\n      rootElement.style.top = `${bTop.toFixed()}px`\n    }\n    // 左右越界\n    if (rootLeft - rootWidth / 2 < 0) {\n      // 左\n      const lLeft = rootWidth / 2\n      rootElement.style.left = `${lLeft.toFixed()}px`\n    } else if (rootLeft + rootWidth / 2 > offsetWidth) {\n      // 右\n      const rLeft = offsetWidth - rootWidth / 2\n      rootElement.style.left = `${rLeft.toFixed()}px`\n    }\n\n    return true\n  }\n}\n","import { BaseTooltip } from './BaseTooltip'\nimport { TooltipElement } from './internal/TooltipElement'\n\nexport class Tooltip<T> extends BaseTooltip<T> {\n  public createTooltipElementInternal(): TooltipElement<T> {\n    return new TooltipElement()\n  }\n}\n","import { createElement } from '../../internal/dom'\nimport { TooltipElement } from './TooltipElement'\n\nexport class HtmlTooltipElement<T> extends TooltipElement<T> {\n  protected createTooltipMessageElement(\n    rootElement: HTMLDivElement,\n    cls: string\n  ): HTMLElement {\n    const messageElement = createElement('div', { classList: [cls] })\n    rootElement.appendChild(messageElement)\n    return messageElement\n  }\n  protected doSetContent(element: Element, content: string) {\n    element.innerHTML = content\n  }\n}\n","import { BaseTooltip } from './BaseTooltip'\nimport { HtmlTooltipElement } from './internal/HtmlTooltipElement'\n\nexport class HtmlTooltip<T> extends BaseTooltip<T> {\n  public createTooltipElementInternal(): HtmlTooltipElement<T> {\n    return new HtmlTooltipElement()\n  }\n}\n","import { ListGridAPI, CellRange } from '../ts-types'\nimport { LG_EVENT_TYPE } from '../list-grid/LG_EVENT_TYPE'\nimport { BaseTooltip } from './BaseTooltip'\nimport { Tooltip } from './Tooltip'\nimport { HtmlTooltip } from './HtmlTooltip'\nimport { cellInRange } from '../internal/utils'\n\nconst TOOLTIP_INSTANCE_FACTORY: {\n  [key: string]: <T>(grid: ListGridAPI<T>) => BaseTooltip<T>\n} = {\n  'overflow-html': <T>(grid: ListGridAPI<T>) => {\n    return new HtmlTooltip(grid)\n  },\n  'overflow-text': <T>(grid: ListGridAPI<T>) => {\n    return new Tooltip(grid)\n  },\n}\n\nfunction getTooltipInstanceInfo<T>(\n  grid: ListGridAPI<T>,\n  col: number,\n  row: number\n) {\n  // overflow text tooltip\n  const overflowText = grid.getCellOverflowText(col, row)\n  if (overflowText) {\n    const overflowType = grid.getCellOverflowType(col, row)\n    return {\n      content: overflowText,\n      type: overflowType || 'overflow-text',\n    }\n  }\n  return null\n}\n\ntype AttachInfo<T> = {\n  instance: BaseTooltip<T>\n  range: CellRange\n}\n\nclass TooltipHandler<T> {\n  private _grid: ListGridAPI<T>\n  private _tooltipInstances: { [type: string]: BaseTooltip<T> }\n  private _attachInfo?: AttachInfo<T> | null\n  public constructor(grid: ListGridAPI<T>) {\n    this._grid = grid\n    this._tooltipInstances = {}\n    this._bindGridEvent(grid)\n  }\n  public dispose(): void {\n    const tooltipInstances = this._tooltipInstances\n    for (const k in tooltipInstances) {\n      tooltipInstances[k].dispose()\n    }\n    this._attachInfo = null\n  }\n  private _attach(col: number, row: number): void {\n    const info = this._attachInfo\n    const instanceInfo = this._getTooltipInstanceInfo(col, row)\n    if (info && (!instanceInfo || info.instance !== instanceInfo.instance)) {\n      info.instance.detachTooltipElement()\n      this._attachInfo = null\n    }\n    if (!instanceInfo) {\n      return\n    }\n    const { instance } = instanceInfo\n    instance.attachTooltipElement(col, row, instanceInfo.content)\n    const range = this._grid.getCellRange(col, row)\n    this._attachInfo = { range, instance }\n  }\n  private _move(col: number, row: number) {\n    const info = this._attachInfo\n    if (!info || !cellInRange(info.range, col, row)) {\n      return\n    }\n    const { instance } = info\n    instance.moveTooltipElement(col, row)\n  }\n  private _detach() {\n    const info = this._attachInfo\n    if (!info) {\n      return\n    }\n    const { instance } = info\n    instance.detachTooltipElement()\n    this._attachInfo = null\n  }\n  private _isAttachCell(col: number, row: number) {\n    const info = this._attachInfo\n    if (!info) {\n      return false\n    }\n    return cellInRange(info.range, col, row)\n  }\n  private _bindGridEvent(grid: ListGridAPI<T>) {\n    grid.listen(LG_EVENT_TYPE.MOUSEOVER_CELL, (e) => {\n      if (e.related) {\n        if (this._isAttachCell(e.col, e.row)) {\n          return\n        }\n      }\n      this._attach(e.col, e.row)\n    })\n    grid.listen(LG_EVENT_TYPE.MOUSEOUT_CELL, (e) => {\n      if (e.related) {\n        if (this._isAttachCell(e.related.col, e.related.row)) {\n          return\n        }\n      }\n      this._detach()\n    })\n    grid.listen(LG_EVENT_TYPE.SELECTED_CELL, (e) => {\n      if (this._isAttachCell(e.col, e.row)) {\n        this._detach()\n      }\n    })\n    grid.listen(LG_EVENT_TYPE.SCROLL, () => {\n      const info = this._attachInfo\n      if (!info) {\n        return\n      }\n      this._move(info.range.start.col, info.range.start.row)\n    })\n    grid.listen(LG_EVENT_TYPE.CHANGED_VALUE, (e) => {\n      if (this._isAttachCell(e.col, e.row)) {\n        this._detach()\n        this._attach(e.col, e.row)\n      }\n    })\n  }\n  private _getTooltipInstanceInfo(\n    col: number,\n    row: number\n  ): {\n    instance: Tooltip<T>\n    type: string\n    content: string\n  } | null {\n    const grid = this._grid\n    const tooltipInstances = this._tooltipInstances\n    const info = getTooltipInstanceInfo(grid, col, row)\n    if (!info) {\n      return null\n    }\n    const type = info.type\n    const instance =\n      tooltipInstances[type] ||\n      (tooltipInstances[type] = TOOLTIP_INSTANCE_FACTORY[type](grid))\n    return {\n      instance,\n      type,\n      content: info.content,\n    }\n  }\n}\n\nexport default TooltipHandler\n","import {\n  CellAddress,\n  CellContext,\n  CellRange,\n  ColorPropertyDefine,\n  ColumnIconOption,\n  ColumnStyleOption,\n  EventListenerId,\n  FieldData,\n  FieldDef,\n  HeaderValues,\n  LayoutObjectId,\n  ListGridAPI,\n  ListGridEventHandlersEventMap,\n  ListGridEventHandlersReturnMap,\n  MaybePromise,\n  MaybePromiseOrUndef,\n  Message,\n  SortState,\n  ThemeDefine,\n  PasteCellEvent,\n  SelectedCellEvent,\n  SetPasteValueTestData,\n  ColumnTypeAPI,\n  ListGridSpanBodyOptions,\n} from './ts-types'\nimport { DrawCellInfo } from './ts-types-internal'\nimport {\n  ColumnData,\n  ColumnDefine,\n  HeaderDefine,\n  HeadersDefine,\n  LayoutDefine,\n  LayoutMapAPI,\n  MultiLayoutMap,\n  SimpleHeaderLayoutMap,\n} from './list-grid/layout-map'\nimport { LayoutMap } from './list-grid/LayoutMap'\nimport {\n  DrawGrid,\n  DrawGridConstructorOptions,\n  DrawGridProtected,\n} from './core/DrawGrid'\nimport {\n  isDef,\n  obj,\n  then,\n  isPromise,\n  getOrApply,\n  event,\n  cellEquals,\n  cellMerge,\n  omit,\n} from './internal/utils'\nimport { BaseColumn } from './columns/type/BaseColumn'\nimport { icons } from './internal/icons'\nimport { columns } from './columns'\nimport { themes } from './themes'\nimport { MessageHandler } from './columns/message/MessageHandler'\nimport { createCellRange } from './core/draw-grid/DrawCellContext'\nimport { CachedDataSource } from './data/CachedDataSource'\nimport { DataSource } from './data/DataSource'\nimport { GridCanvasHelper } from './GridCanvasHelper'\nimport { BaseAction } from './header/action/BaseAction'\nimport { BaseStyle as HeaderBaseStyle } from './header/style'\nimport { EventHandler } from './internal/EventHandler'\nimport Rect from './internal/Rect'\nimport { Theme } from './themes/theme'\nimport TooltipHandler from './tooltip/TooltipHandler'\nimport { LG_EVENT_TYPE } from './list-grid/LG_EVENT_TYPE'\nimport { parsePasteRangeBoxValues } from './internal/paste-utils'\nimport { toPx } from './internal/calc'\nimport { getInlineEditingState } from './columns/utils'\n// protected symbol\nimport { getListGridSymbol } from './internal/symbolManager'\n\nconst _ = getListGridSymbol()\n\n// private methods\nfunction _arrayEqual(a: any[], b: any[]): boolean {\n  if (a.length !== b.length) {\n    return false\n  } else {\n    for (let i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) {\n        return false\n      }\n    }\n    return true\n  }\n}\nfunction _getCellValues<T>(\n  grid: ListGrid<T>,\n  startCol: number,\n  endCol: number,\n  row: number\n): any[] {\n  const values = []\n  if (startCol <= endCol) {\n    for (let col = startCol; col <= endCol; col++) {\n      values.push(_getCellValue(grid, col, row))\n    }\n  } else {\n    for (let col = startCol; col >= endCol; col--) {\n      values.push(_getCellValue(grid, col, row))\n    }\n  }\n  return values\n}\nfunction _getBodyCellRange<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): CellRange | null {\n  let cellRange = null\n  const { spanBodyOptions, layoutMap } = grid[_]\n  if (spanBodyOptions && row >= layoutMap.headerRowCount) {\n    let startRow = row\n    let endRow = row\n    const { startCol, endCol } = spanBodyOptions\n    if (\n      (startCol <= col && col <= endCol) ||\n      (endCol <= col && col <= startCol)\n    ) {\n      const values = _getCellValues(grid, startCol, col, row)\n      while (startRow > layoutMap.headerRowCount) {\n        const pValues = _getCellValues(grid, startCol, col, startRow - 1)\n        if (_arrayEqual(values, pValues)) {\n          startRow--\n        } else {\n          break\n        }\n      }\n      while (endRow < grid.rowCount) {\n        const nValues = _getCellValues(grid, startCol, col, endRow + 1)\n        if (_arrayEqual(values, nValues)) {\n          endRow++\n        } else {\n          break\n        }\n      }\n    }\n    cellRange = {\n      start: {\n        col,\n        row: Math.min(startRow, endRow),\n      },\n      end: {\n        col,\n        row: Math.max(startRow, endRow),\n      },\n    }\n  }\n  return cellRange\n}\nfunction _getCellRange<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): CellRange {\n  const { layoutMap } = grid[_]\n  let cellRange = layoutMap.getCellRange(col, row)\n  const bodyCellRange = _getBodyCellRange(grid, col, row)\n  if (bodyCellRange) {\n    cellRange = cellMerge(cellRange, bodyCellRange)\n  }\n  const p = {\n    get col() {\n      return col\n    },\n    get row() {\n      return row\n    },\n    cellRange,\n  }\n  grid.fireListeners(LG_EVENT_TYPE.CELL_RANGE, p)\n  return p.cellRange\n}\nfunction _updateRect<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number,\n  context: CellContext\n): void {\n  context.setRectFilter((rect) => {\n    let { left, right, top, bottom } = rect\n    const {\n      start: { col: startCol, row: startRow },\n      end: { col: endCol, row: endRow },\n    } = _getCellRange(grid, col, row)\n    for (let c = col - 1; c >= startCol; c--) {\n      left -= grid.getColWidth(c)\n    }\n    for (let c = col + 1; c <= endCol; c++) {\n      right += grid.getColWidth(c)\n    }\n    for (let r = row - 1; r >= startRow; r--) {\n      top -= grid.getRowHeight(r)\n    }\n    for (let r = row + 1; r <= endRow; r++) {\n      bottom += grid.getRowHeight(r)\n    }\n    return Rect.bounds(left, top, right, bottom)\n  })\n  context.range = _getCellRange(grid, col, row) // !!! TODO\n}\nfunction _getCellValue<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): FieldData {\n  let cellValue\n  if (row < grid[_].layoutMap.headerRowCount) {\n    const { caption } = grid[_].layoutMap.getHeader(col, row)\n    cellValue = typeof caption === 'function' ? caption() : caption\n  } else {\n    const { field } = grid[_].layoutMap.getBody(col, row)\n    cellValue = _getField(grid, field, row)\n  }\n  const p = {\n    get col() {\n      return col\n    },\n    get row() {\n      return row\n    },\n    cellValue,\n  }\n  grid.fireListeners(LG_EVENT_TYPE.CELL_VALUE, p)\n  return p.cellValue\n}\nfunction _setCellValue<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number,\n  value: any\n): MaybePromise<boolean> {\n  if (row < grid[_].layoutMap.headerRowCount) {\n    // nop\n    return false\n  } else {\n    const { field } = grid[_].layoutMap.getBody(col, row)\n    if (field == null) {\n      return false\n    }\n    const index = _getRecordIndexByRow(grid, row)\n    return grid[_].dataSource.setField(index, field, value)\n  }\n}\nfunction _getContentHidden<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): boolean {\n  let contentHidden = false\n  if (row >= grid[_].layoutMap.headerRowCount) {\n    const column = grid[_].layoutMap.getBody(col, row)\n    if (column && column.contentHidden) {\n      contentHidden = getOrApply(\n        column.contentHidden,\n        grid.getRowRecord(row) as any\n      )\n    }\n  }\n  return contentHidden\n}\nfunction _getCellMessage<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): FieldData {\n  if (row < grid[_].layoutMap.headerRowCount) {\n    return null\n  } else {\n    const column = grid[_].layoutMap.getBody(col, row)\n    if (!column || !column.message) {\n      return null\n    }\n    return _getField(grid, column.message as FieldDef<T>, row)\n  }\n}\nfunction _getHeaderField<T>(grid: ListGrid<T>, field: any) {\n  if (typeof field === 'function') {\n    return field(grid.headerValues)\n  } else {\n    return grid.headerValues.get(field)\n  }\n}\nfunction _hasHeaderField<T>(grid: ListGrid<T>, field: any): boolean {\n  let has = false\n  grid[_].layoutMap.headerObjects.forEach((cell) => {\n    if (cell.field === field) {\n      has = true\n    }\n  })\n  return has\n}\nfunction _getCellIcon1<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T>\n): ColumnIconOption<T>\nfunction _getCellIcon1<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T>[]\n): ColumnIconOption<T>[]\nfunction _getCellIcon1<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T> | ColumnIconOption<T>[]\n): ColumnIconOption<T> | ColumnIconOption<T>[]\nfunction _getCellIcon1<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T> | ColumnIconOption<T>[]\n): ColumnIconOption<T> | ColumnIconOption<T>[] {\n  if (Array.isArray(icon)) {\n    return icon.map((i) => _getCellIcon1(grid, i))\n  }\n  if (!obj.isObject(icon) || typeof icon === 'function') {\n    return _getHeaderField(grid, icon)\n  }\n  const retIcon: any = {}\n  const iconOpt: any = icon\n  icons.iconPropKeys.forEach((k) => {\n    if (iconOpt[k]) {\n      const f = _getHeaderField(grid, iconOpt[k])\n      if (isDef(f)) {\n        retIcon[k] = f\n      } else {\n        if (!_hasHeaderField(grid, iconOpt[k])) {\n          retIcon[k] = iconOpt[k]\n        }\n      }\n    }\n  })\n  return retIcon\n}\nfunction _getHeaderIcon<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): ColumnIconOption<T> | ColumnIconOption<T>[] | null {\n  const icon = grid[_].layoutMap.getHeader(col, row).icon\n  if (icon == null) {\n    return null\n  }\n  return _getCellIcon1(grid, icon)\n}\nfunction _getCellIcon0<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T>,\n  row: number\n): ColumnIconOption<T>\nfunction _getCellIcon0<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T>[],\n  row: number\n): ColumnIconOption<T>[]\nfunction _getCellIcon0<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T> | ColumnIconOption<T>[],\n  row: number\n): ColumnIconOption<T> | ColumnIconOption<T>[]\nfunction _getCellIcon0<T>(\n  grid: ListGrid<T>,\n  icon: ColumnIconOption<T> | ColumnIconOption<T>[],\n  row: number\n): ColumnIconOption<T> | ColumnIconOption<T>[] {\n  if (Array.isArray(icon)) {\n    return icon.map((i) => _getCellIcon0(grid, i, row))\n  }\n  if (!obj.isObject(icon) || typeof icon === 'function') {\n    return _getField(grid, icon, row)\n  }\n  const retIcon: any = {}\n  const iconOpt: any = icon\n  icons.iconPropKeys.forEach((k) => {\n    if (iconOpt[k]) {\n      const f = _getField(grid, iconOpt[k], row)\n      if (isDef(f)) {\n        retIcon[k] = f\n      } else {\n        if (!_hasField(grid, iconOpt[k], row)) {\n          retIcon[k] = iconOpt[k]\n        }\n      }\n    }\n  })\n  return retIcon\n}\nfunction _getCellIcon<T>(\n  grid: ListGrid<T>,\n  col: number,\n  row: number\n): ColumnIconOption<T> | ColumnIconOption<T>[] | null {\n  const icon = grid[_].layoutMap.getBody(col, row).icon\n  if (icon == null) {\n    return null\n  }\n  return _getCellIcon0(grid, icon, row)\n}\nfunction _getField<T>(\n  grid: ListGrid<T>,\n  field: FieldDef<T> | undefined,\n  row: number\n): FieldData {\n  if (!isDef(field)) {\n    return null\n  }\n\n  if (row < grid[_].layoutMap.headerRowCount) {\n    return null\n  } else {\n    const index = _getRecordIndexByRow(grid, row)\n    return grid[_].dataSource.getField(index, field)\n  }\n}\nfunction _hasField<T>(\n  grid: ListGrid<T>,\n  field: FieldDef<T>,\n  row: number\n): boolean {\n  if (!isDef(field)) {\n    return false\n  }\n  if (row < grid[_].layoutMap.headerRowCount) {\n    return false\n  } else {\n    const index = _getRecordIndexByRow(grid, row)\n    return grid[_].dataSource.hasField(index, field)\n  }\n}\nfunction _onDrawValue<T>(\n  grid: ListGrid<T>,\n  cellValue: MaybePromise<unknown>,\n  context: CellContext,\n  { col, row }: CellAddress,\n  style: ColumnStyleOption | null | undefined,\n  draw: BaseColumn<T, any>['onDrawCell']\n): MaybePromise<void> {\n  const helper = grid[_].gridCanvasHelper\n  const isEditing = !!getInlineEditingState(grid).cellRange\n\n  const drawCellBg = ({\n    bgColor,\n  }: { bgColor?: ColorPropertyDefine } = {}): void => {\n    const fillOpt = {\n      fillColor: bgColor,\n      isEditing,\n    }\n    // 绘制整个cell\n    helper.fillCellWithState(context, fillOpt)\n  }\n  const drawCellBorder = () => {\n    if (context.col === grid.frozenColCount - 1) {\n      // 固定列规则\n      const rect = context.getRect()\n      helper.drawWithClip(context, (ctx: CanvasRenderingContext2D) => {\n        const borderColor =\n          context.row >= grid.frozenRowCount\n            ? helper.theme.borderColor\n            : helper.theme.frozenRowsBorderColor\n\n        const borderColors = helper.toBoxArray(\n          helper.getColor(borderColor, context.col, context.row, ctx)\n        )\n        if (borderColors[1]) {\n          ctx.lineWidth = 1\n          ctx.strokeStyle = borderColors[1]\n          ctx.beginPath()\n          ctx.moveTo(rect.right - 2.5, rect.top)\n          ctx.lineTo(rect.right - 2.5, rect.bottom)\n          ctx.stroke()\n        }\n      })\n    }\n\n    helper.borderSelection(context, {\n      isEditing,\n      highlightBorderWidth: toPx(\n        grid.highlightBorderWidth,\n        grid[_].calcWidthContext\n      ),\n    }) // !!! TODO\n    // _borderWithState(grid, helper, context)\n  }\n  const clearCellBase = () => {\n    helper.clearCell(context)\n  }\n  const drawCellBase = ({\n    bgColor,\n  }: { bgColor?: ColorPropertyDefine } = {}): void => {\n    drawCellBg({ bgColor })\n    drawCellBorder()\n  }\n  const info: DrawCellInfo<T> = {\n    getRecord: () => grid.getRowRecord(row),\n    getIcon: () => _getCellIcon(grid, col, row),\n    getMessage: () => _getCellMessage(grid, col, row),\n    messageHandler: grid[_].messageHandler,\n    style,\n    clearCellBase,\n    drawCellBase,\n    drawCellBg,\n    drawCellBorder,\n    getCell: () => ({ col, row }),\n    getHeaderIcon: () => _getHeaderIcon(grid, col, row),\n    getContentHidden: () => _getContentHidden(grid, col, row),\n  }\n\n  return draw(cellValue, info, context, grid)\n}\n// function _borderWithState<T>(\n//   grid: ListGrid<T>,\n//   helper: GridCanvasHelper<T>,\n//   context: CellContext\n// ): void {\n//   const { col, row } = context;\n//   const sel = grid.selection.select;\n//   const { layoutMap } = grid[_];\n\n//   const rect = context.getRect();\n//   const option: { borderColor?: ColorsPropertyDefine; lineWidth?: number } = {};\n\n//   const selRecordIndex = layoutMap.getRecordIndexByRow(sel.row);\n//   const selId = layoutMap.getCellId(sel.col, sel.row);\n//   function isSelectCell(col: number, row: number): boolean {\n//     if (col === sel.col && row === sel.row) {\n//       return true;\n//     }\n//     return (\n//       selId != null &&\n//       layoutMap.getCellId(col, row) === selId &&\n//       layoutMap.getRecordIndexByRow(row) === selRecordIndex\n//     );\n//   }\n\n//   // 边线\n//   if (isSelectCell(col, row)) {\n//     option.borderColor = helper.theme.highlightBorderColor;\n//     option.lineWidth = 2;\n//     helper.border(context, option);\n//   } else {\n//     option.lineWidth = 1;\n//     // header color\n//     const isFrozenCell = grid.isFrozenCell(col, row);\n//     if (isFrozenCell?.row) {\n//       option.borderColor = helper.theme.frozenRowsBorderColor;\n//     }\n//     helper.border(context, option);\n\n//     // 额外处理\n//     if (col > 0 && isSelectCell(col - 1, row)) {\n//       // 右边被选中\n//       helper.drawBorderWithClip(context, ctx => {\n//         const borderColors = helper.toBoxArray(\n//           helper.getColor(\n//             helper.theme.highlightBorderColor,\n//             sel.col,\n//             sel.row,\n//             ctx\n//           )\n//         );\n//         if (borderColors[1]) {\n//           ctx.lineWidth = 1;\n//           ctx.strokeStyle = borderColors[1];\n//           ctx.beginPath();\n//           ctx.moveTo(rect.left - 0.5, rect.top);\n//           ctx.lineTo(rect.left - 0.5, rect.bottom);\n//           ctx.stroke();\n//         }\n//       });\n//     } else if (row > 0 && isSelectCell(col, row - 1)) {\n//       // 顶部被选中\n//       helper.drawBorderWithClip(context, ctx => {\n//         const borderColors = helper.toBoxArray(\n//           helper.getColor(\n//             helper.theme.highlightBorderColor,\n//             sel.col,\n//             sel.row,\n//             ctx\n//           )\n//         );\n//         if (borderColors[0]) {\n//           ctx.lineWidth = 1;\n//           ctx.strokeStyle = borderColors[0];\n//           ctx.beginPath();\n//           ctx.moveTo(rect.left, rect.top - 0.5);\n//           ctx.lineTo(rect.right, rect.top - 0.5);\n//           ctx.stroke();\n//         }\n//       });\n//     }\n//   }\n// }\n\nfunction _refreshHeader<T>(grid: ListGrid<T>): void {\n  const protectedSpace = grid[_]\n  if (protectedSpace.headerEvents) {\n    protectedSpace.headerEvents.forEach((id: number) => grid.unlisten(id))\n  }\n\n  const headerEvents: EventListenerId[] = (protectedSpace.headerEvents = [])\n\n  headerEvents.forEach((id) => grid.unlisten(id))\n\n  let layoutMap: LayoutMap<T>\n  if (\n    protectedSpace.layout &&\n    (!Array.isArray(protectedSpace.layout) || protectedSpace.layout.length > 0)\n  ) {\n    layoutMap = protectedSpace.layoutMap = new LayoutMap(\n      new MultiLayoutMap(protectedSpace.layout)\n    )\n  } else {\n    layoutMap = protectedSpace.layoutMap = new LayoutMap(\n      new SimpleHeaderLayoutMap(protectedSpace.header ?? [])\n    )\n  }\n  layoutMap.hiddenHeader = protectedSpace.hiddenHeader\n\n  if (!grid.hiddenHeader) {\n    layoutMap.headerObjects.forEach((cell) => {\n      const ids = cell.headerType.bindGridEvent(grid, cell.id)\n      headerEvents.push(...ids)\n      if (cell.style) {\n        if (cell.style instanceof HeaderBaseStyle) {\n          const id = cell.style.listen(\n            HeaderBaseStyle.EVENT_TYPE.CHANGE_STYLE,\n            () => {\n              grid.invalidate()\n            }\n          )\n          headerEvents.push(id)\n        }\n      }\n      if (cell.action) {\n        if (cell.action instanceof BaseAction) {\n          const ids = cell.action.bindGridEvent(grid, cell.id)\n          headerEvents.push(...ids)\n        }\n      }\n    })\n  }\n  layoutMap.columnObjects.forEach((col) => {\n    if (col.action) {\n      const ids = col.action.bindGridEvent(grid, col.id)\n      headerEvents.push(...ids)\n    }\n    if (col.columnType) {\n      const ids = col.columnType.bindGridEvent(grid, col.id)\n      headerEvents.push(...ids)\n    }\n    if (col.style) {\n      if (col.style instanceof columns.style.BaseStyle) {\n        const id = col.style.listen(\n          columns.style.EVENT_TYPE.CHANGE_STYLE,\n          () => {\n            grid.invalidate()\n          }\n        )\n        headerEvents.push(id)\n      }\n    }\n  })\n  for (let col = 0; col < layoutMap.columnWidths.length; col++) {\n    const column = layoutMap.columnWidths[col]\n    const { width, minWidth, maxWidth, disableResize } = column\n    if (width && (width > 0 || typeof width === 'string')) {\n      grid.setColWidth(col, width)\n    }\n    if (minWidth && (minWidth > 0 || typeof minWidth === 'string')) {\n      grid.setMinColWidth(col, minWidth)\n    }\n    if (maxWidth && (maxWidth > 0 || typeof maxWidth === 'string')) {\n      grid.setMaxColWidth(col, maxWidth)\n    }\n    if (typeof disableResize === 'boolean') {\n      grid.setColDisableResize(col, disableResize)\n    }\n  }\n  if (!grid.hiddenHeader) {\n    const headerRowHeight = grid[_].headerRowHeight\n    for (let row = 0; row < layoutMap.headerRowCount; row++) {\n      const height = Array.isArray(headerRowHeight)\n        ? headerRowHeight[row]\n        : headerRowHeight\n      if (height && height > 0) {\n        grid.setRowHeight(row, height)\n      }\n    }\n  }\n  grid.colCount = layoutMap.colCount\n  _refreshRowCount(grid)\n  grid.frozenRowCount = layoutMap.headerRowCount\n}\nfunction _refreshRowCount<T>(grid: ListGrid<T>): void {\n  const { layoutMap } = grid[_]\n  grid.rowCount =\n    grid[_].dataSource.length * layoutMap.bodyRowCount +\n    layoutMap.headerRowCount\n}\nfunction _tryWithUpdateDataSource<T>(\n  grid: ListGrid<T>,\n  fn: (grid: ListGrid<T>) => void\n): void {\n  if (grid[_].dataSourceEventIds) {\n    grid[_].dataSourceEventIds.forEach((id: number) => grid[_].handler.off(id))\n  }\n\n  fn(grid)\n\n  grid[_].dataSourceEventIds = [\n    grid[_].handler.on(\n      grid[_].dataSource as any,\n      DataSource.EVENT_TYPE.UPDATED_LENGTH,\n      () => {\n        _refreshRowCount(grid)\n        grid.selection.fireSelectedEvent()\n        grid.invalidate()\n      }\n    ),\n    grid[_].handler.on(\n      grid[_].dataSource as any,\n      DataSource.EVENT_TYPE.UPDATED_ORDER,\n      () => {\n        grid.selection.fireSelectedEvent()\n        grid.invalidate()\n      }\n    ),\n    grid[_].handler.on(\n      grid[_].dataSource as any,\n      DataSource.EVENT_TYPE.REFRESH_DATA,\n      () => {\n        grid.selection.fireSelectedEvent()\n        grid.invalidate()\n      }\n    ),\n  ]\n}\nfunction _setRecords<T>(grid: ListGrid<T>, records: T[] = []): void {\n  _tryWithUpdateDataSource(grid, () => {\n    grid[_].records = records\n    const newDataSource = (grid[_].dataSource = CachedDataSource.ofArray(\n      records\n    ))\n    grid.addDisposable(newDataSource)\n  })\n}\nfunction _setDataSource<T>(grid: ListGrid<T>, dataSource: DataSource<T>): void {\n  _tryWithUpdateDataSource(grid, () => {\n    if (dataSource) {\n      if (dataSource instanceof DataSource) {\n        grid[_].dataSource = dataSource\n      } else {\n        const newDataSource = (grid[_].dataSource = new CachedDataSource(\n          dataSource\n        ))\n        grid.addDisposable(newDataSource)\n      }\n    } else {\n      grid[_].dataSource = DataSource.EMPTY\n    }\n    grid[_].records = null\n  })\n}\nfunction _getRecordIndexByRow<T>(grid: ListGrid<T>, row: number): number {\n  const { layoutMap } = grid[_]\n  return layoutMap.getRecordIndexByRow(row)\n}\nfunction _onRangePaste<T>(\n  this: ListGrid<T>,\n  text: string,\n  test: (data: SetPasteValueTestData<T>) => boolean = (): boolean => true\n): void {\n  const { layoutMap } = this[_]\n  const selectionRange = this.selection.range\n  const { start } = this.getCellRange(\n    selectionRange.start.col,\n    selectionRange.start.row\n  )\n  const { end } = this.getCellRange(\n    selectionRange.end.col,\n    selectionRange.end.row\n  )\n  const values = parsePasteRangeBoxValues(text)\n\n  const pasteRowCount = Math.min(\n    Math.max(end.row - start.row + 1, values.rowCount),\n    this.rowCount - start.row\n  )\n  const pasteColCount = Math.min(\n    Math.max(end.col - start.col + 1, values.colCount),\n    this.colCount - start.col\n  )\n\n  let hasEditable = false\n  const actionColumnsBox: ColumnData<T>[][] = []\n  for (let bodyRow = 0; bodyRow < layoutMap.bodyRowCount; bodyRow++) {\n    const actionColumnsRow: ColumnData<T>[] = []\n    actionColumnsBox.push(actionColumnsRow)\n    for (let offsetCol = 0; offsetCol < pasteColCount; offsetCol++) {\n      const body = layoutMap.getBody(\n        start.col + offsetCol,\n        bodyRow + layoutMap.headerRowCount\n      )\n      actionColumnsRow[offsetCol] = body\n      if (!hasEditable && body.action?.editable) {\n        hasEditable = true\n      }\n    }\n  }\n  if (!hasEditable) {\n    return\n  }\n\n  const startRow = layoutMap.getRecordStartRowByRecordIndex(\n    layoutMap.getRecordIndexByRow(start.row)\n  )\n  const startRowOffset = start.row - startRow\n\n  let duplicate: { [key: number]: boolean } = {}\n  let actionRow = startRowOffset\n  let valuesRow = 0\n  for (let offsetRow = 0; offsetRow < pasteRowCount; offsetRow++) {\n    let valuesCol = 0\n    for (let offsetCol = 0; offsetCol < pasteColCount; offsetCol++) {\n      const { action, id } = actionColumnsBox[actionRow][offsetCol]\n      if (!duplicate[id as number] && action?.editable) {\n        duplicate[id as number] = true\n        const col = start.col + offsetCol\n        const row = start.row + offsetRow\n        const cellValue = values.getCellValue(valuesCol, valuesRow)\n\n        then(this.getRowRecord(row), (record) => {\n          then(_getCellValue(this, col, row), (oldValue) => {\n            if (\n              test({\n                grid: this,\n                record: record as T,\n                col,\n                row,\n                value: cellValue,\n                oldValue,\n              })\n            ) {\n              action.onPasteCellRangeBox(this, { col, row }, cellValue)\n            }\n          })\n        })\n      }\n      valuesCol++\n      if (valuesCol >= values.colCount) {\n        valuesCol = 0\n      }\n    }\n    actionRow++\n    if (actionRow >= layoutMap.bodyRowCount) {\n      actionRow = 0\n      duplicate = {}\n    }\n    valuesRow++\n    if (valuesRow >= values.rowCount) {\n      valuesRow = 0\n    }\n  }\n\n  const newEnd = {\n    col: start.col + pasteColCount - 1,\n    row: start.row + pasteRowCount - 1,\n  }\n  this.selection.range = {\n    start,\n    end: newEnd,\n  }\n  this.invalidateCellRange(this.selection.range)\n}\n\nfunction _onRangeDelete<T>(this: ListGrid<T>): void {\n  const { layoutMap } = this[_]\n  const selectionRange = this.selection.range\n  const { start } = this.getCellRange(\n    selectionRange.start.col,\n    selectionRange.start.row\n  )\n  const { end } = this.getCellRange(\n    selectionRange.end.col,\n    selectionRange.end.row\n  )\n\n  const deleteRowCount = Math.min(\n    end.row - start.row + 1,\n    this.rowCount - start.row\n  )\n  const deleteColCount = Math.min(\n    end.col - start.col + 1,\n    this.colCount - start.col\n  )\n\n  let hasEditable = false\n  const actionColumnsBox: ColumnData<T>[][] = []\n  for (let bodyRow = 0; bodyRow < layoutMap.bodyRowCount; bodyRow++) {\n    const actionColumnsRow: ColumnData<T>[] = []\n    actionColumnsBox.push(actionColumnsRow)\n    for (let offsetCol = 0; offsetCol < deleteColCount; offsetCol++) {\n      const body = layoutMap.getBody(\n        start.col + offsetCol,\n        bodyRow + layoutMap.headerRowCount\n      )\n      actionColumnsRow[offsetCol] = body\n      if (!hasEditable && body.action?.editable) {\n        hasEditable = true\n      }\n    }\n  }\n  if (!hasEditable) {\n    return\n  }\n\n  const startRow = layoutMap.getRecordStartRowByRecordIndex(\n    layoutMap.getRecordIndexByRow(start.row)\n  )\n  const startRowOffset = start.row - startRow\n\n  let duplicate: { [key: number]: boolean } = {}\n  let actionRow = startRowOffset\n  for (let offsetRow = 0; offsetRow < deleteRowCount; offsetRow++) {\n    for (let offsetCol = 0; offsetCol < deleteColCount; offsetCol++) {\n      const { action, id } = actionColumnsBox[actionRow][offsetCol]\n      if (!duplicate[id as number] && action?.editable) {\n        duplicate[id as number] = true\n        const col = start.col + offsetCol\n        const row = start.row + offsetRow\n\n        then(this.getRowRecord(row), (_record) => {\n          then(_getCellValue(this, col, row), (_oldValue) => {\n            action.onDeleteCellRangeBox(this, { col, row })\n          })\n        })\n      }\n    }\n    actionRow++\n    if (actionRow >= layoutMap.bodyRowCount) {\n      actionRow = 0\n      duplicate = {}\n    }\n  }\n\n  this.invalidateCellRange(selectionRange)\n}\n\n// end private methods\n\ninterface ListGridProtected<T> extends DrawGridProtected {\n  dataSourceEventIds: number[]\n  headerEvents: number[]\n  layoutMap: LayoutMapAPI<T>\n  headerValues: HeaderValues\n  tooltipHandler: TooltipHandler<T>\n  messageHandler: MessageHandler<T>\n  theme: Theme | null\n  headerRowHeight: number | number[]\n  header: HeadersDefine<T>\n  layout: LayoutDefine<T>\n  gridCanvasHelper: GridCanvasHelper<T>\n  sortState: SortState\n  hiddenHeader: boolean\n  dataSource: DataSource<T>\n  records?: T[] | null\n  allowRangePaste: boolean\n  handler: EventHandler\n  disabled: boolean | ((record: T) => boolean)\n  readOnly: boolean | ((record: T) => boolean)\n  spanBodyOptions?: ListGridSpanBodyOptions\n}\n\ninterface ListGridConstructorOptions<T> extends DrawGridConstructorOptions {\n  /**\n   * Simple header property\n   */\n  header?: HeadersDefine<T>\n  /**\n   * Layout property\n   */\n  layout?: LayoutDefine<T>\n  /**\n   * Header row height(s)\n   */\n  headerRowHeight?: number[] | number\n  /**\n   * Hidden header\n   */\n  hiddenHeader?: boolean\n  /**\n   * Records data source\n   */\n  dataSource?: DataSource<T>\n  /**\n   * Simple records data\n   */\n  records?: T[]\n  /**\n   * Theme\n   */\n  theme?: ThemeDefine | string\n  /**\n   * If set to true to allow pasting of ranges. default false\n   */\n  allowRangePaste?: boolean\n  /**\n   * @deprecated Cannot be used with ListGrid.\n   * @override\n   */\n  rowCount?: undefined\n  /**\n   * @deprecated Cannot be used with ListGrid.\n   * @override\n   */\n  colCount?: undefined\n  /**\n   * @deprecated Cannot be used with ListGrid.\n   * @override\n   */\n  frozenRowCount?: undefined\n  disabled?: boolean | ((record: T) => boolean)\n  readonly?: boolean | ((record: T) => boolean)\n  spanBodyOptions?: ListGridSpanBodyOptions\n  monitorResize?: boolean\n}\n\n/**\n * ListGrid\n */\nexport class ListGrid<T> extends DrawGrid implements ListGridAPI<T> {\n  public static get EVENT_TYPE(): typeof LG_EVENT_TYPE {\n    return LG_EVENT_TYPE\n  }\n  private [_]: ListGridProtected<T>\n  /**\n   * constructor\n   * @param options - Constructor options\n   */\n  public constructor(options: ListGridConstructorOptions<T> = {}) {\n    super(omit(options, ['colCount', 'rowCount', 'frozenRowCount']))\n    this[_] = {} as any\n    const protectedSpace = this[_]\n    protectedSpace.disabled = options.disabled || false\n    protectedSpace.readOnly = options.readonly || false\n    protectedSpace.header = options.header || []\n    protectedSpace.layout = options.layout || []\n    protectedSpace.headerRowHeight = options.headerRowHeight || []\n    protectedSpace.hiddenHeader = !!options.hiddenHeader\n    protectedSpace.spanBodyOptions = options.spanBodyOptions || undefined\n    protectedSpace.handler = new EventHandler()\n    protectedSpace.sortState = {\n      col: -1,\n      order: undefined,\n      row: -1,\n    }\n    protectedSpace.gridCanvasHelper = new GridCanvasHelper(this)\n    protectedSpace.theme = themes.of(options.theme)\n    protectedSpace.messageHandler = new MessageHandler(\n      this,\n      (col: number, row: number): Message => _getCellMessage(this, col, row)\n    )\n    protectedSpace.tooltipHandler = new TooltipHandler(this)\n    if (options.dataSource) {\n      _setDataSource(this, options.dataSource)\n    } else {\n      _setRecords(this, options.records)\n    }\n    protectedSpace.allowRangePaste = options.allowRangePaste ?? false\n    _refreshHeader(this)\n    this.selection.fireSelectedEvent()\n    this.invalidate()\n    if (!isDef(options.monitorResize) || options.monitorResize === true) {\n      protectedSpace.handler.on(window, 'resize', () => this.resize())\n    }\n  }\n  /**\n   * Dispose the grid instance.\n   * @returns\n   */\n  public dispose(): void {\n    const protectedSpace = this[_]\n    protectedSpace.handler.dispose()\n    protectedSpace.messageHandler.dispose()\n    protectedSpace.tooltipHandler.dispose()\n    super.dispose()\n  }\n\n  /**\n   * Define of the header with the given data.\n   * <pre>\n   * column options\n   * -----\n   * caption: header caption\n   * field: field name\n   * width: column width\n   * minWidth: column min width\n   * maxWidth: column max width\n   * disableResize: column disable resize\n   * icon: icon name\n   * message: message key name\n   * columnType: column type\n   * action: column action\n   * style: column style\n   * headerType: header type\n   * headerStyle: header style\n   * headerAction: header action\n   * headerField: header field name\n   * sort: define sort setting\n   * -----\n   *\n   * multiline header\n   * -----\n   * caption: header caption\n   * columns: columns define\n   * -----\n   * </pre>\n   */\n  public get header() {\n    return this[_].header\n  }\n  public set header(header) {\n    this[_].header = header\n    _refreshHeader(this)\n    const oldRange = this.selection.range\n    const newRange = this.updateSelectionRange(this.selection.range)\n    if (\n      oldRange.start.col !== newRange.start.col ||\n      oldRange.end.col !== newRange.end.col ||\n      oldRange.start.row !== newRange.start.row ||\n      oldRange.end.row !== newRange.end.row\n    ) {\n      this.selection._forceUpdateRange()\n      this.selection.fireSelectedEvent()\n    }\n  }\n  /**\n   * The define of the layout.\n   */\n  get layout(): LayoutDefine<T> {\n    return this[_].layout\n  }\n  set layout(layout) {\n    this[_].layout = layout\n    _refreshHeader(this)\n  }\n  /**\n   * Get the row count per record\n   */\n  get recordRowCount(): number {\n    return this[_].layoutMap.bodyRowCount\n  }\n  /**\n   * Records.\n   */\n  public get records(): T[] | null {\n    return this[_].records || null\n  }\n  public set records(records) {\n    if (records == null) {\n      return\n    }\n    _setRecords(this, records)\n    _refreshRowCount(this)\n    this.invalidate()\n  }\n  /**\n   * Data source.\n   */\n  public get dataSource(): DataSource<T> {\n    return this[_].dataSource\n  }\n  public set dataSource(dataSource) {\n    _setDataSource(this, dataSource)\n    _refreshRowCount(this)\n    this.invalidate()\n  }\n  /**\n   * Theme.\n   */\n  public get theme(): Theme | null {\n    return this[_].theme\n  }\n  public set theme(theme) {\n    this[_].theme = themes.of(theme)\n    this.invalidate()\n  }\n  /**\n   * If set to true to allow pasting of ranges.\n   */\n  get allowRangePaste(): boolean {\n    return this[_].allowRangePaste\n  }\n  set allowRangePaste(allowRangePaste) {\n    this[_].allowRangePaste = allowRangePaste\n  }\n  /**\n   * Sort state.\n   */\n  public get sortState() {\n    return this[_].sortState\n  }\n  public set sortState(sortState) {\n    const oldState = this.sortState\n    let oldField\n    if (oldState.col >= 0 && oldState.row >= 0) {\n      oldField = this.getHeaderField(oldState.col, oldState.row)\n    }\n\n    const newState = (this[_].sortState = isDef(sortState)\n      ? sortState\n      : {\n          col: -1,\n          row: -1,\n          order: undefined,\n        })\n\n    let newField\n    if (newState.col >= 0 && newState.row >= 0) {\n      newField = this.getHeaderField(newState.col, newState.row)\n    }\n\n    // bind header value\n    if (isDef(oldField) && oldField !== newField) {\n      this.setHeaderValue(oldState.col, oldState.row, undefined)\n    }\n    if (isDef(newField)) {\n      this.setHeaderValue(newState.col, newState.row, newState.order)\n    }\n  }\n  /**\n   * Header values.\n   */\n  public get headerValues(): HeaderValues {\n    return this[_].headerValues || (this[_].headerValues = new Map())\n  }\n  public set headerValues(headerValues) {\n    this[_].headerValues = headerValues || new Map()\n  }\n  /**\n   * Whether to hide the column header.\n   */\n  public get hiddenHeader() {\n    return this[_].hiddenHeader\n  }\n  public set hiddenHeader(hidden) {\n    this[_].hiddenHeader = hidden\n    _refreshHeader(this)\n    this.invalidate()\n  }\n  /**\n   * Disabled.\n   */\n  public get disabled() {\n    return this[_].disabled\n  }\n  public set disabled(disabled) {\n    this[_].disabled = disabled\n  }\n  /**\n   * Read Only.\n   */\n  public get readOnly() {\n    return this[_].readOnly\n  }\n  public set readOnly(readOnly) {\n    this[_].readOnly = readOnly\n  }\n  public get readonly() {\n    window.console.warn(\n      \"'readonly' is deprecated, please use 'readOnly' instead\"\n    )\n    return this.readOnly\n  }\n  public set readonly(readOnly) {\n    window.console.warn(\n      \"'readonly' is deprecated, please use 'readOnly' instead\"\n    )\n    this.readOnly = readOnly\n  }\n  /**\n   * Span Body\n   */\n  public get spanBodyOptions(): ListGridSpanBodyOptions | null {\n    return this[_].spanBodyOptions ?? null\n  }\n  public set spanBodyOptions(spanBodyOptions) {\n    this[_].spanBodyOptions = spanBodyOptions ?? undefined\n  }\n  /**\n   * Get the field of the given column index.\n   * @param col - The column index.\n   * @param row - The row index.\n   * @returns The field object.\n   */\n  public getField(col: number, row: number): FieldDef<T> | undefined {\n    return this[_].layoutMap.getBody(\n      col,\n      row ?? this[_].layoutMap.headerRowCount\n    ).field\n  }\n  /**\n   * Get the column define of the given column index.\n   * @param col - The column index.\n   * @param row - The row index.\n   * @returns The column define object.\n   */\n  public getColumnDefine(col: number, row: number): ColumnDefine<T> {\n    return this[_].layoutMap.getBody(\n      col,\n      row ?? this[_].layoutMap.headerRowCount\n    ).define\n  }\n  public getColumnType(col: number, row: number): ColumnTypeAPI {\n    return this[_].layoutMap.getBody(col, row).columnType\n  }\n  /**\n   * Get the header field of the given header cell.\n   * @param col - The column index.\n   * @param row - The header row index.\n   * @returns The field object.\n   */\n  public getHeaderField(col: number, row: number) {\n    const hd = this[_].layoutMap.getHeader(col, row)\n    return hd.field\n  }\n  /**\n   * Get the header define of the given header cell.\n   * @param col - The column index.\n   * @param row - The header row index.\n   * @returns The header define object.\n   */\n  public getHeaderDefine(col: number, row: number): HeaderDefine<T> {\n    const hd = this[_].layoutMap.getHeader(col, row)\n    return hd.define\n  }\n  /**\n   * Get the column of the given column index.\n   * @param col - The column index.\n   * @returns The field object.\n   */\n  public getColumn(col: number, row?: number): ColumnData<T> {\n    return this[_].layoutMap.getBody(col, row || 0)\n  }\n  /**\n   * Get the record of the given row index.\n   * @param row - The row index.\n   * @returns The record.\n   */\n  public getRowRecord(row: number): MaybePromiseOrUndef<T> {\n    if (row < this[_].layoutMap.headerRowCount) {\n      return undefined\n    } else {\n      return this[_].dataSource.get(_getRecordIndexByRow(this, row))\n    }\n  }\n  /**\n   * Get the record index of the given row index.\n   * @param row -  The row index.\n   * @returns The record index.\n   */\n  public getRecordIndexByRow(row: number): number {\n    return _getRecordIndexByRow(this, row)\n  }\n  /**\n   * Get the record index of the given row index.\n   * @param row - The row index.\n   * @returns The record index.\n   */\n  public getRowRecordIndex(row: number): number {\n    window.console.warn(\n      \"'getRowRecordIndex' is deprecated, please use 'getRecordIndexByRow' instead\"\n    )\n    return this.getRecordIndexByRow(row)\n  }\n  /**\n   * Gets the row index starting at the given record index.\n   * @param index - The record index.\n   */\n  public getRecordStartRowByRecordIndex(index: number): number {\n    return this[_].layoutMap.getRecordStartRowByRecordIndex(index)\n  }\n  /**\n   * Get the column index of the given field.\n   * @param field - The field.\n   * @returns The column index.\n   */\n  public getColumnIndexByField(field: FieldDef<T>): number | null {\n    const range = this.getCellRangeByField(field, 0)\n    return range?.start.col ?? null\n  }\n  /**\n   * Get the column index of the given field.\n   * @param field - The field.\n   * @param index - The record index\n   * @returns The column index.\n   */\n  public getCellRangeByField(\n    field: FieldDef<T>,\n    index: number\n  ): CellRange | null {\n    const { layoutMap } = this[_]\n    const colObj = layoutMap.columnObjects.find((col) => col.field === field)\n    if (colObj) {\n      const layoutRange = layoutMap.getBodyLayoutRangeById(colObj.id)\n      const startRow = layoutMap.getRecordStartRowByRecordIndex(index)\n      return {\n        start: {\n          col: layoutRange.start.col,\n          row: startRow + layoutRange.start.row,\n        },\n        end: {\n          col: layoutRange.end.col,\n          row: startRow + layoutRange.end.row,\n        },\n      }\n    }\n    return null\n  }\n  /**\n   * Focus the cell.\n   * @param field - The field.\n   * @param index - The record index\n   * @returns\n   */\n  public focusGridCell(field: any, index: number) {\n    const {\n      start: { col: startCol, row: startRow },\n      end: { col: endCol, row: endRow },\n    } = this.selection.range\n\n    const newFocus = this.getCellRangeByField(field, index)?.start\n    if (newFocus == null) {\n      return\n    }\n    this.focusCell(newFocus.col, newFocus.row)\n    this.selection.select = newFocus\n    this.invalidateGridRect(startCol, startRow, endCol, endRow)\n    this.invalidateCell(newFocus.col, newFocus.row)\n  }\n  /**\n   * Scroll to where cell is visible.\n   * @param field - The field.\n   * @param index - The record index\n   * @returns\n   */\n  public makeVisibleGridCell(field: any, index: number) {\n    const cell = this.getCellRangeByField(field, index)?.start\n    this.makeVisibleCell(\n      cell?.col ?? 0,\n      cell?.row ?? this[_].layoutMap.headerRowCount\n    )\n  }\n  /**\n   * Select cell range\n   */\n  public selectCellRange(\n    startCol: number,\n    startRow: number,\n    endCol: number,\n    endRow: number\n  ): void {\n    this.focusCell(startCol, startRow)\n    this.selection.range = createCellRange(startCol, startRow, endCol, endRow)\n    const {\n      start: { col: newStartCol, row: newStartRow },\n      end: { col: newEndCol, row: newEndRow },\n    } = this.selection.range\n    this.invalidateGridRect(newStartCol, newStartRow, newEndCol, newEndRow)\n  }\n  public getGridCanvasHelper(): GridCanvasHelper<T> {\n    return this[_].gridCanvasHelper\n  }\n  /**\n   * Get cell range information for a given cell.\n   * @param col - column index of the cell\n   * @param row - row index of the cell\n   * @returns cell range info\n   */\n  public getCellRange(col: number, row: number): CellRange {\n    return _getCellRange(this, col, row)\n  }\n  /**\n   * Get header range information for a given cell.\n   * @param col - column index of the cell\n   * @param row - row index of the cell\n   * @returns cell range info\n   */\n  public getHeaderCellRange(col: number, row: number) {\n    window.console.warn(\n      \"'getHeaderCellRange' is deprecated, please use 'getCellRange' instead\"\n    )\n    return this.getCellRange(col, row)\n  }\n  protected getCopyCellValue(\n    col: number,\n    row: number,\n    range?: CellRange\n  ): string {\n    const cellRange = _getCellRange(this, col, row)\n    const startCol = range\n      ? Math.max(range.start.col, cellRange.start.col)\n      : cellRange.start.col\n    const startRow = range\n      ? Math.max(range.start.row, cellRange.start.row)\n      : cellRange.start.row\n    if (startCol !== col || startRow !== row) {\n      return ''\n    }\n    const { layoutMap } = this[_]\n    let value = _getCellValue(this, col, row)\n    if (row >= layoutMap.headerRowCount) {\n      const columnType = layoutMap.getBody(col, row).columnType\n      value = columnType.getCopyCellValue(value, this, { col, row }) ?? value\n      value = columnType.convertCopyValue(value, { col, row }, this)\n    }\n    return value\n  }\n  protected onDrawCell(col: number, row: number, context: CellContext) {\n    const { layoutMap } = this[_]\n\n    let draw\n    let style\n    if (row < layoutMap.headerRowCount) {\n      const hd = layoutMap.getHeader(col, row)\n      draw = hd.headerType.onDrawCell\n      ;({ style } = hd)\n    } else {\n      const column = layoutMap.getBody(col, row)\n      draw = column.columnType.onDrawCell\n      ;({ style } = column)\n    }\n    _updateRect(this, col, row, context)\n    const cellValue = _getCellValue(this, col, row)\n    return _onDrawValue(\n      this,\n      cellValue,\n      context,\n      {\n        col,\n        row,\n      },\n      style,\n      draw\n    )\n  }\n  public doGetCellValue(\n    col: number,\n    row: number,\n    valueCallback: (value: any) => void\n  ) {\n    if (row < this[_].layoutMap.headerRowCount) {\n      // nop\n      return false\n    } else {\n      const value = _getCellValue(this, col, row)\n      if (isPromise(value)) {\n        // 在延迟期间被忽略\n        return false\n      }\n      valueCallback(value)\n    }\n    return true\n  }\n  public doChangeValue(\n    col: number,\n    row: number,\n    changeValueCallback: (before: any) => any\n  ) {\n    if (row < this[_].layoutMap.headerRowCount) {\n      // nop\n      return false\n    } else {\n      const record = this.getRowRecord(row)\n      if (isPromise(record)) {\n        // 在延迟期间被忽略\n        return false\n      }\n      const before = _getCellValue(this, col, row)\n      if (isPromise(before)) {\n        // 在延迟期间被忽略\n        return false\n      }\n      const after = changeValueCallback(before)\n      if (after === undefined) {\n        return false\n      }\n      return then(_setCellValue(this, col, row, after), (ret: any) => {\n        if (ret) {\n          const { field } = this[_].layoutMap.getBody(col, row)\n          this.fireListeners(LG_EVENT_TYPE.CHANGED_VALUE, {\n            col,\n            row,\n            field: field as FieldDef<T>,\n            record: record as T,\n            value: after,\n            oldValue: before,\n          })\n        }\n        return ret\n      })\n    }\n  }\n  public doSetPasteValue(\n    text: string,\n    test?: (data: SetPasteValueTestData<T>) => boolean\n  ): void {\n    _onRangePaste.call(\n      this,\n      text,\n      test as (data: SetPasteValueTestData<T>) => boolean\n    )\n  }\n  public getHeaderValue(col: number, row: number): any | undefined {\n    const field = this.getHeaderField(col, row)\n    return this.headerValues.get(field)\n  }\n  public setHeaderValue(col: number, row: number, newValue: any): void {\n    const field = this.getHeaderField(col, row)\n\n    const oldValue = this.headerValues.get(field)\n    this.headerValues.set(field, newValue)\n\n    this.fireListeners(LG_EVENT_TYPE.CHANGED_HEADER_VALUE, {\n      col,\n      field,\n      oldValue,\n      row,\n      value: newValue,\n    })\n  }\n  public getLayoutCellId(col: number, row: number): LayoutObjectId {\n    return this[_].layoutMap.getCellId(col, row)\n  }\n  public completeEdit() {\n    this.focus()\n  }\n  protected bindEventsInternal() {\n    this.listen(LG_EVENT_TYPE.SELECTED_CELL, (e: SelectedCellEvent) => {\n      if (e.selected) {\n        const beforeRange = _getCellRange(this, e.before.col, e.before.row)\n        const {\n          start: { col: beforeStartCol, row: beforeStartRow },\n          end: { col: beforeEndCol, row: beforeEndRow },\n        } = beforeRange\n        if (\n          beforeStartCol !== beforeEndCol ||\n          beforeStartRow !== beforeEndRow\n        ) {\n          this.invalidateGridRect(\n            beforeStartCol,\n            beforeStartRow,\n            beforeEndCol,\n            beforeEndRow\n          )\n        }\n\n        const range = _getCellRange(this, e.col, e.row)\n        const {\n          start: { col: startCol, row: startRow },\n          end: { col: endCol, row: endRow },\n        } = range\n        if (startCol !== endCol || startRow !== endRow) {\n          this.invalidateGridRect(startCol, startRow, endCol, endRow)\n        }\n      }\n    })\n    this.listen(LG_EVENT_TYPE.PASTE_CELL, (e: PasteCellEvent) => {\n      if (!this[_].allowRangePaste) {\n        return\n      }\n      const { start, end } = this.selection.range\n      if (!e.multi && cellEquals(start, end)) {\n        return\n      }\n      const { layoutMap } = this[_]\n\n      if (start.row < layoutMap.headerRowCount) {\n        return\n      }\n      event.cancel(e.event)\n      _onRangePaste.call(this, e.normalizeValue)\n    })\n    this.listen(LG_EVENT_TYPE.DELETE_CELL, (e) => {\n      const { start } = this.selection.range\n      const { layoutMap } = this[_]\n\n      if (start.row < layoutMap.headerRowCount) {\n        return\n      }\n      event.cancel(e.event)\n      _onRangeDelete.call(this)\n    })\n  }\n  protected getMoveLeftColByKeyDownInternal({ col, row }: CellAddress): number {\n    const {\n      start: { col: startCol },\n    } = _getCellRange(this, col, row)\n    col = startCol\n    return super.getMoveLeftColByKeyDownInternal({ col, row })\n  }\n  protected getMoveRightColByKeyDownInternal({\n    col,\n    row,\n  }: CellAddress): number {\n    const {\n      end: { col: endCol },\n    } = _getCellRange(this, col, row)\n    col = endCol\n    return super.getMoveRightColByKeyDownInternal({ col, row })\n  }\n  protected getMoveUpRowByKeyDownInternal({ col, row }: CellAddress): number {\n    const {\n      start: { row: startRow },\n    } = _getCellRange(this, col, row)\n    row = startRow\n    return super.getMoveUpRowByKeyDownInternal({ col, row })\n  }\n  protected getMoveDownRowByKeyDownInternal({ col, row }: CellAddress): number {\n    const {\n      end: { row: endRow },\n    } = _getCellRange(this, col, row)\n    row = endRow\n    return super.getMoveDownRowByKeyDownInternal({ col, row })\n  }\n  protected getOffsetInvalidateCells(): number {\n    return 1\n  }\n  protected getCopyRangeInternal(range: CellRange): CellRange {\n    const { start } = this.getCellRange(range.start.col, range.start.row)\n    const { end } = this.getCellRange(range.end.col, range.end.row)\n    return { start, end }\n  }\n  protected getAttachCellsAreaInternal(range: CellRange) {\n    const rect = super.getAttachCellsAreaInternal(range)\n    const {\n      start: { col, row },\n    } = this.getCellRange(range.start.col, range.start.row)\n    if (row >= this[_].layoutMap.headerRowCount) {\n      const column = this[_].layoutMap.getBody(col, row)\n      column.columnType.reviseAttachCellsArea(rect, row, this)\n    }\n    return rect\n  }\n  protected getAttachCellsPaddingInternal(\n    range: CellRange\n  ): [number, number, number, number] {\n    const padding = super.getAttachCellsPaddingInternal(range)\n    const {\n      start: { col, row },\n    } = this.getCellRange(range.start.col, range.start.row)\n    if (row >= this[_].layoutMap.headerRowCount) {\n      const column = this[_].layoutMap.getBody(col, row)\n      column.columnType.reviseAttachCellsPadding(padding, row, this)\n    }\n    return padding\n  }\n  protected getFocusRectInternal(col: number, row: number) {\n    const rect: Rect = super.getFocusRectInternal(col, row)\n    if (this[_] && row >= this[_].layoutMap.headerRowCount) {\n      const column = this[_].layoutMap.getBody(col, row)\n      column.columnType.reviseFocusRect(rect, row, this)\n    }\n    return rect\n  }\n  protected getCellOverflowTextInternal(cell: CellAddress) {\n    const col = cell.col\n    const row = cell.row\n    let text = ''\n    if (row >= this[_].layoutMap.headerRowCount) {\n      const column = this[_].layoutMap.getBody(col, row)\n      const tooltip = column.tooltip\n      const record: any = this.getRowRecord(row)\n      if (record) {\n        if (typeof tooltip === 'function') {\n          text = tooltip.call(this, record)\n        } else if (typeof tooltip === 'string') {\n          text = record[tooltip]\n        }\n      }\n    } else {\n      const hd = this[_].layoutMap.getHeader(col, row)\n      if (hd) {\n        const tooltip = hd.tooltip\n        if (typeof tooltip === 'function') {\n          text = tooltip.call(this, {\n            cell: { col, row },\n            field: this.getHeaderField(col, row),\n          })\n        } else if (typeof tooltip === 'string') {\n          text = tooltip\n        }\n      }\n    }\n    return text || ''\n  }\n  protected getCellOverflowTypeInternal(cell: CellAddress) {\n    const col = cell.col\n    const row = cell.row\n    let type = ''\n    if (row >= this[_].layoutMap.headerRowCount) {\n      const column = this[_].layoutMap.getBody(col, row)\n      const tooltipType = column.tooltipType\n      const record = this.getRowRecord(row)\n      if (record) {\n        if (typeof tooltipType === 'function') {\n          type = tooltipType.call(this, record)\n        } else if (typeof tooltipType === 'string') {\n          type = tooltipType\n        }\n      }\n    } else {\n      const hd = this[_].layoutMap.getHeader(col, row)\n      if (hd) {\n        const tooltipType = hd.tooltipType\n        if (typeof tooltipType === 'function') {\n          type = tooltipType.call(this, {\n            cell: { col, row },\n            field: this.getHeaderField(col, row),\n          })\n        } else if (typeof tooltipType === 'string') {\n          type = tooltipType\n        }\n      }\n    }\n    return type || ''\n  }\n  protected getDefaultRowHeight() {\n    return (\n      (this[_] && this[_].gridCanvasHelper.theme.defaultRowHeight) ||\n      super.getDefaultRowHeight()\n    )\n  }\n  protected getDefaultColWidth() {\n    return (\n      (this[_] && this[_].gridCanvasHelper.theme.defaultColWidth) ||\n      super.getDefaultColWidth()\n    )\n  }\n  protected getHighlightBorderWidth() {\n    return (\n      (this[_] && this[_].gridCanvasHelper.theme.highlightBorderWidth) ||\n      super.getHighlightBorderWidth()\n    )\n  }\n  protected updateSelectionRange(range: CellRange) {\n    const oldStartCol = range.start.col\n    const oldStartRow = range.start.row\n    const oldEndCol = range.end.col\n    const oldEndRow = range.end.row\n    const startCol = Math.min(range.start.col, range.end.col)\n    const startRow = Math.min(range.start.row, range.end.row)\n    const endCol = Math.max(range.start.col, range.end.col)\n    const endRow = Math.max(range.start.row, range.end.row)\n    let newStartCol = startCol\n    let newStartRow = startRow\n    let newEndCol = endCol\n    let newEndRow = endRow\n    for (let row = startRow; row <= endRow; row++) {\n      for (let col = startCol; col <= endCol; col++) {\n        const r = this.getCellRange(col, row)\n        newStartCol = Math.min(r.start.col, newStartCol)\n        newStartRow = Math.min(r.start.row, newStartRow)\n        newEndCol = Math.max(r.end.col, newEndCol)\n        newEndRow = Math.max(r.end.row, newEndRow)\n      }\n    }\n    if (newStartCol < startCol) {\n      if (range.start.col > range.end.col) {\n        range.end.col = newStartCol\n      } else {\n        range.start.col = newStartCol\n      }\n    }\n    if (newStartRow < startRow) {\n      if (range.start.row > range.end.row) {\n        range.end.row = newStartRow\n      } else {\n        range.start.row = newStartRow\n      }\n    }\n    if (newEndCol > endCol) {\n      if (range.start.col > range.end.col) {\n        range.start.col = newEndCol\n      } else {\n        range.end.col = newEndCol\n      }\n    }\n    if (newEndRow > endRow) {\n      if (range.start.row > range.end.row) {\n        range.start.row = newEndRow\n      } else {\n        range.end.row = newEndRow\n      }\n    }\n    if (\n      oldStartCol !== range.start.col ||\n      oldStartRow !== range.start.row ||\n      oldEndCol !== range.end.col ||\n      oldEndRow !== range.end.row\n    ) {\n      range = this.updateSelectionRange(range)\n    }\n    return range\n  }\n  protected getDefaultFont(): string {\n    return this[_].gridCanvasHelper.theme.font\n  }\n  protected getDefaultUnderlayBackgroundColor(): string {\n    return this[_].gridCanvasHelper.theme.underlayBackgroundColor\n  }\n  protected getDefaultBorderColor(): string {\n    return this[_].gridCanvasHelper.theme.gridBorderColor\n  }\n  protected getDefaultBorderWidth(): number {\n    return this[_].gridCanvasHelper.theme.gridBorderWidth\n  }\n  fireListeners<TYPE extends keyof ListGridEventHandlersEventMap<T>>(\n    type: TYPE,\n    ...event: ListGridEventHandlersEventMap<T>[TYPE]\n  ): ListGridEventHandlersReturnMap[TYPE][] {\n    return super.fireListeners(type as any, ...event)\n  }\n}\n","import { IconDefine } from './ts-types'\nimport { Theme } from './themes/theme'\nimport { icons as iconPlugins } from './plugins/icons'\nimport { themes as themePlugins } from './plugins/themes'\n\nfunction registerPlugin<T>(\n  obj: { [key: string]: T },\n  name: string,\n  value: T\n): T {\n  const old = obj[name]\n  obj[name] = value\n  return old\n}\n\nfunction registerPlugins<T>(\n  obj: { [key: string]: T },\n  values: { [key: string]: T }\n): void {\n  for (const k in values) {\n    obj[k] = values[k]\n  }\n}\n\nfunction theme(name: string, theme?: Theme): Theme {\n  if (theme != null) {\n    return registerPlugin(themePlugins, name, theme)\n  } else {\n    return themePlugins[name]\n  }\n}\n\nfunction icon(name: string, icon?: IconDefine): IconDefine {\n  if (icon != null) {\n    return registerPlugin(iconPlugins, name, icon)\n  } else {\n    return iconPlugins[name]\n  }\n}\n\nfunction icons(icons: { [key: string]: IconDefine }): void {\n  return registerPlugins(iconPlugins, icons)\n}\n\nexport const register = {\n  theme,\n  icon,\n  icons,\n}\n","import { IconDefine } from './ts-types'\nimport { columns as _columns } from './columns'\nimport { core as _core } from './core'\nimport { data as _data } from './data'\nimport { headers as _headers } from './headers'\nimport { themes as _themes } from './themes'\nimport { tools as _tools } from './tools'\nimport { ListGrid as _ListGrid } from './ListGrid'\nimport { GridCanvasHelper as _GridCanvasHelper } from './GridCanvasHelper'\nimport { register as _register } from './register'\nimport { svgIcons } from './icons'\nimport { str } from './internal/utils'\n\n/**\n * Kaka Grid\n */\nconst _kakaGrid: {\n  version: string\n  core: typeof _core\n  tools: typeof _tools\n  ListGrid: typeof _ListGrid\n  columns: typeof _columns\n  data: typeof _data\n  headers: typeof _headers\n  themes: typeof _themes\n  GridCanvasHelper: typeof _GridCanvasHelper\n  readonly icons: {\n    [key: string]: IconDefine\n  }\n  template: typeof str.template\n  register: typeof _register\n} = {\n  version: 'VERSION',\n\n  core: _core,\n  tools: _tools,\n\n  // impl Grids\n  ListGrid: _ListGrid,\n\n  // objects\n  columns: _columns,\n  data: _data,\n  headers: _headers,\n  themes: _themes,\n\n  // helper\n  GridCanvasHelper: _GridCanvasHelper,\n  get icons() {\n    return svgIcons.get()\n  },\n  template: str.template,\n\n  // plugin registers\n  register: _register,\n}\n\nnamespace kakaGrid {\n  export const version: string = _kakaGrid.version\n  export class ListGrid<T> extends _kakaGrid.ListGrid<T> {}\n  export const core: typeof _kakaGrid.core = _kakaGrid.core\n  export const tools: typeof _kakaGrid.tools = _kakaGrid.tools\n  export const columns: typeof _kakaGrid.columns = _kakaGrid.columns\n  export const data: typeof _kakaGrid.data = _kakaGrid.data\n  export const headers: typeof _kakaGrid.headers = _kakaGrid.headers\n  export const themes: typeof _kakaGrid.themes = _kakaGrid.themes\n  export const GridCanvasHelper: typeof _kakaGrid.GridCanvasHelper =\n    _kakaGrid.GridCanvasHelper\n  export const icons: {\n    [key: string]: IconDefine\n  } = _kakaGrid.icons\n  export const template: typeof str.template = _kakaGrid.template\n  export const register: typeof _kakaGrid.register = _kakaGrid.register\n}\n\nexport default kakaGrid\n"],"names":["isNode","window","arrayFind","arrayFindIndex","array","find","Array","prototype","arr","predicate","call","index","findIndex","undefined","length","i","isDef","data","isDefString","IE","Chrome","Firefox","Edge","Safari","ua","navigator","userAgent","toLowerCase","exec","indexOf","analyzeUserAgent","each","obj","fn","key","defaults","source","defs","keys","result","push","Object","defineProperty","[object Object]","val","configurable","enumerable","extend","args","forEach","get","isDescendantElement","root","target","parentElement","p","applyChainSafe","names","value","getChainSafe","name","getOrApply","isPromise","Boolean","then","callback","r","cellEquals","a","b","col","row","cellInRange","range","start","end","browser","setReadonly","isObject","str","endsWith","searchString","position","subjectString","toString","isFinite","Math","floor","lastIndex","lastIndexOf","genChars","s","re","res","genWords","escape","html","String","replace","template","strings","values","dict","Number","isInteger","Infinity","join","event","getMouseButtons","e","buttons","which","button","getKeyCode","keyCode","isTouchEvent","changedTouches","cancel","preventDefault","stopPropagation","stopImmediatePropagation","style","toBoxArray","isArray","emptyFn","toggleValue","getBooleanOptionOfRecord","option","grid","record","getRowRecord","isDisabledRecord","disabled","isReadOnlyRecord","readOnly","DG_EVENT_TYPE","CLICK_CELL","DBLCLICK_CELL","DBLTAP_CELL","MOUSEDOWN_CELL","MOUSEUP_CELL","SELECTED_CELL","MOUSE_SELECTED_START","MOUSE_SELECTED_END","KEYDOWN","MOUSEMOVE_CELL","MOUSEENTER_CELL","MOUSELEAVE_CELL","MOUSEOVER_CELL","MOUSEOUT_CELL","CONTEXTMENU_CELL","INPUT_CELL","PASTE_CELL","DELETE_CELL","EDITABLEINPUT_CELL","MODIFY_STATUS_EDITABLEINPUT_CELL","RESIZE_COLUMN","SCROLL","FOCUS_GRID","BLUR_GRID","CAN_DRAG_SELECTION","DRAG_SELECTION","CLICK_UNDERLAY","DBLCLICK_UNDERLAY","DBLTAP_UNDERLAY","COPY","CUT","PASTE","KEY_ENTER","KEY_UP","KEY_DOWN","getCheckColumnStateId","getRadioColumnStateId","getSwitchColumnStateId","getButtonColumnStateId","getColumnActionStateId","getInlineInputEditorStateId","getInlineTextareaEditorStateId","getInlineLookupEditorStateId","getCheckHeaderStateId","getSwitchHeaderStateId","COLUMN_ACTION_STATE_ID","bindCellClickAction","cellId","action","mouseOver","mouseMove","mouseOut","isTarget","getLayoutCellId","actionState","listen","getElement","cursor","mouseActive","bindCellKeyAction","acceptKeys","keyboardOptions","moveCellOnEnter","sel","selection","select","BaseAction","options","this","_disabled","onChangeDisabledInternal","Action","super","_action","editable","_grid","state","getState","cell","apply","mouseRelativePos","_getMouseRelativePoint","mouseActiveCell","getCellRange","invalidateCellRange","Editor","_readOnly","readonly","onChangeReadOnlyInternal","console","warn","_inAttachCellArea","bool","relativePos","rect","getAttachCellsArea","inPoint","x","y","BaseInputEditor","allowOpen","onOpenCellInternal","_keyCode","_e","_cellId","open","input","onInputCellInternal","multi","selectionRange","normalizeValue","shiftKey","onBeforeKeydownInternal","ctrlKey","metaKey","stopCellMoving","onChangeSelectCellInternal","selected","onGridScrollInternal","baseRect","getCellRect","rangeRect","getCellRangeRect","top","parseFloat","toFixed","left","width","height","onSetInputAttrsInternal","doChangeValue","BaseActionInput","_disableInput","disableInput","_disableAction","disableAction","isDisabledAction","isDisabledInput","ids","bindGridEvent","concat","inputValue","onActionInputCellInternal","onActionOpenCellInternal","Error","isDisabled","cubicBezier","x2","y2","x3","y3","step","t","c","d","abs","EASINGS","linear","easeIn","easeOut","easeInOut","raf","requestAnimationFrame","setTimeout","now","Date","animate","duration","easing","startedAt","easingFn","canceledFlg","createAnim","resolve","reject","anim","point","Promise","BaseCheckEditor","cellKey","block","ret","onChange","elapsed","selRange","pasteValue","trim","doGetCellValue","BUTTON_COLUMN_STATE_ID","CHECK_COLUMN_STATE_ID","CheckEditor","SWITCH_COLUMN_STATE_ID","SwitchEditor","createElement","tagName","classList","text","element","document","add","textContent","innerHTML","empty","dom","firstChild","removeChild","toNodeList","arg","node","nodeType","nodeName","slice","childNodes","toNode","appendHtml","inner","appendChild","disableFocus","el","dataset","disableBeforeTabIndex","tabIndex","children","isFocusable","findPrevSiblingFocusable","n","previousSibling","findNextSiblingFocusable","nextSibling","eventHandlerNextId","EventHandler","type","listener","addEventListener","id","_listeners","on","off","list","removeEventListener","clear","styleInject","css","styleElement","getElementById","HTMLStyleElement","head","getElementsByTagName","styleSheet","cssText","createTextNode","SCROLLBAR_SIZE","isPerfectScrollbar","PerfectScrollbar","initDocument","outer","visibility","overflow","body","w1","offsetWidth","w2","clientWidth","getScrollBarWidth","getScrollBarSize","inject","setInputValue","handler","dispose","once","INLINE_EDITING_STATE_ID","getInlineEditingState","toBoolean","setInputAttrs","editor","fixedType","InlineInputElement","_handler","_input","_bindInputEvents","detach","_beforePropEditor","_enabledMouseWheel","enabledMouseWheel","remove","font","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","toJSON","valueAsDate","setInlineInputValue","_activeData","safeInputFocus","tryWithOffEvents","focus","selectionStart","selectionEnd","createTextRange","collapse","moveEnd","moveStart","cellRange","_attaching","gridFocus","_isActive","activeData","test","isNaN","getInlineInputValue","stopPropagationOnly","contains","_onKeydownEnter","_onKeydownTab","onKeyDownMove","moveCellOnTab","INLINE_INPUT_EDITOR_STATE_ID","globalInlineInputElement","globalInlineInputBindGridCount","attachInput","addDisposable","attach","detachInput","InlineInputEditor","_classList","_type","enabled","_cell","_selected","CLASSNAME_ILE","INPUT_CLASSNAME_ILE","DROPDOWN_CLASSNAME_ILE","DROPDOWN_HIDDEN_CLASSNAME_ILE","DROPDOWN_SHOWN_CLASSNAME_ILE","DROPDOWN_RIGHT_CLASSNAME_ILE","DROPDOWN_BOTTOM_CLASSNAME_ILE","DROPDOWN_ITEM_CLASSNAME_ILE","DROPDOWN_ITEM_EMPTY_CLASSNAME_ILE","DROPDOWN_ITEM_OTHER_CLASSNAME_ILE","DROPDOWN_ITEM_FIRST_CLASSNAME_ILE","highlight","search","RegExp","InlineLookupElement","_lookup","ul","createLookupElement","querySelector","_dropdown","_editor","lookup","lookupRecords","_unbindLookupProps","valueField","captionField","filterFields","field","gridRecord","records","emptyRecord","beforeRecord","filter","captionValue","allowOtherInput","dropdownInfo","disableFilterRecords","disableFilterSort","dropdownEmptyTemplate","dropdownTemplate","valueType","JSON","stringify","setLookupInputValue","_onInputValue","_bindLookupProps","_beforeValue","changeOnlyWhenAllowOtherInput","parse","getLookupInputValue","dropdown","item","findDropdownItemParents","_selectNode","onKeyupAndPress","next","items","querySelectorAll","before","_onInputValueChange","after","isFirstChange","filterInfo","_filterRecords","isAll","filterRecords","itemNodes","beforeNode","firstMatchedNode","isEmptyValue","saveValue","displayValue","otherLi","__isEmpty","li","__isBefore","__isMatched","__value","offset","scrollHeight","selectedNode","maxHeight","offsetTop","offsetHeight","clientHeight","offsetLeft","isSelected","scrollTop","allRecords","otherRecords","filterRecord","matched","matchValue","INLINE_LOOKUP_EDITOR_STATE_ID","globalInlineLookupElement","globalInlineLookupBindGridCount","attachLookupInput","rs","detachLookupInput","doChangeLookupValue","InlineLookupEditor","me","_record","_records","_valueField","_valueType","_captionField","_filterFields","_allowOtherInput","_disableFilterRecords","_disableFilterSort","disableDropdown","_filter","_dropdownTemplate","_dropdownEmptyTemplate","normalize","map","o","k","label","caption","hasOwnProperty","normalizeToFn","CLASSNAME_IME","ITEM_CLASSNAME_IME","HIDDEN_CLASSNAME_IME","SHOWN_CLASSNAME_IME","EMPTY_ITEM_CLASSNAME_IME","findItemParents","attachElement","menu","autoWidth","lineHeight","openMenu","emptyItemEl","valueItemEl","setAttribute","span","optionToLi","focusEl","focusIndex","allHeight","transformOrigin","ceil","menuClientRect","getBoundingClientRect","scaleDiff","orgMenuTop","menuTop","menuBottom","winBottom","innerHeight","InlineMenuElement","_menu","_bindMenuEvents","owner","_focus","_col","_row","closeMenu","valueIndex","parseInt","getAttribute","_doChangeValue","ICON_PROP_KEYS","doms","props","toSimpleArray","iconProps","workData","count","prop","max","toPropArray","normarize","isIconKey","className","tagProps","beforeStyle","defaultView","getComputedStyle","content","getPropertyValue","substr","quoted","split","part","quote","color","isLiga","getIconProps","icons","toNormarizeArray","icon","iconPropKeys","Rect","_left","_top","_width","_height","_right","right","bottom","rect1","rect2","bounds","min","_bottom","x0","x1","y0","y1","another","loadIcons","context","helper","argIcon","toCurrentContext","iconList","testFontLoad","getActionTextPadding","appearance","textPadding","toBoxPixelArray","drawActionButton","stateId","textBaseline","active","getRect","btnWidth","iconPadding","path","cellOverflowText","getCellOverflowText","textAlign","setCellOverflowText","customDraw","draw","opt","getSelection","drawWithClip","ctx","isAttachArea","cellStyle","innerBox","reviseAttachCellsArea","reviseAttachCellsPadding","drawAttachArea","attachArea","_","eventTargetNextId","EventTarget","listeners","listenerData","splice","unlisten","BASE_STYLE_EVENT_TYPE","CHANGE_STYLE","defaultBaseStyle","defaultBaseStdStyle","defaultBaseCheckStyle","defaultStyle","defaultButtonStyle","defaultCheckStyle","defaultSwitchStyle","defaultDateStyle","defaultDrawStyle","defaultIconStyle","defaultImageStyle","defaultLookupStyle","defaultMenuStyle","defaultMultilineTextStyle","defaultNumberStyle","defaultPercentCompleteBarStyle","BaseStyle","bgColor","_bgColor","EVENT_TYPE","DEFAULT","doChangeStyle","fireListeners","BaseStdStyle","_textAlign","_textBaseline","BaseCheckStyle","uncheckBgColor","checkBgColor","borderColor","_uncheckBgColor","_checkBgColor","_borderColor","Style","_color","_font","_padding","_inputPadding","inputPadding","_textOverflow","textOverflow","_appearance","ButtonStyle","_buttonBgColor","buttonBgColor","CheckStyle","SwitchStyle","DateStyle","adjustDateTimeStyleOption","DrawStyle","IconStyle","ImageStyle","_imageSizing","imageSizing","_margin","margin","LookupStyle","MenuStyle","MultilineTextStyle","_lineHeight","_autoWrapText","autoWrapText","_lineClamp","lineClamp","NumberStyle","DEFAULT_BAR_COLOR","num","PercentCompleteBarStyle","_barColor","barColor","_barBgColor","barBgColor","_barHeight","barHeight","defaultRadioStyle","defaultTreeStyle","RadioStyle","checkColor","uncheckBorderColor","checkBorderColor","_checkColor","_uncheckBorderColor","_checkBorderColor","TreeStyle","adjustTreeStyleOption","_lineColor","lineColor","_buttonColor","buttonColor","_buttonBorderColor","buttonBorderColor","_linkColor","linkColor","of","columnStyle","StyleClassDef","COLUMN_FADEIN_STATE_ID","getFadinState","cells","_generateFadinPointAction","drawInternal","drawCellBase","stateKey","opacity","cellState","getContext","globalAlpha","fadinMgr","activeFadeins","f","BaseColumn","onDrawCell","bind","_convert","convert","_convertCopy","convertCopy","_hidden","hidden","_fadeinWhenCallbackInPromise","fadeinWhenCallbackInPromise","StyleClass","_rect","cellValue","info","getRecord","clearCellBase","getCell","getContentHidden","getGridCanvasHelper","actStyle","styleContents.of","drawEditingInternal","dragged","promise","getDrawRect","time","_currentContext","isContentHidden","doConvertInternal","drawMessageInternal","getMessage","isFadeinWhenCallbackInPromise","configure","margeAnimate","message","messageHandler","drawCellMessage","convertCopyInternal","convertInternal","_context","_style","_helper","_info","contentHidden","MenuColumn","_options","menuItems","clone","getIcon","_convertInternal","columnUtils.loadIcons","basePadding","INLINE_MENU_EDITOR_STATE_ID","globalInlineMenuElement","globalInlineMenuBindGridCount","attachMenu","detachMenu","InlineMenuEditor","_autoWidth","pasteOpt","_pasteDataToOptionValue","_textToOptionValue","columnType","getColumnType","hasOptions","normalizePasteValueStr","captionOpt","inputAutoHeight","h","minHeight","InlineTextAreaElement","minWidth","setTextInputValue","getTextInputValue","altKey","setRangeText","INLINE_TEXTAREA_EDITOR_STATE_ID","globalInlineTextAreaElement","InlineTextAreaEditor","RADIO_COLUMN_STATE_ID","defaultGroupResolver","offsetRow","getRecordStartRowByRecordIndex","getRecordIndexByRow","rowCount","recordRowCount","targetRow","frozenRowCount","RadioEditor","_group","group","_state","flag","actionCell","CLASSNAME_SDE","INPUT_CLASSNAME_SDE","HIDDEN_CLASSNAME_SDE","SHOWN_CLASSNAME_SDE","SmallDialogInputElement","_dialog","createDialogElement","_bindDialogEvents","dialog","helperText","unbindProps","errorMessage","bindProps","_validate","inputOnly","inputValidator","msg","validator","mess","SMALL_DIALOG_INPUT_EDITOR_STATE_ID","globalSmallDialogInputElement","globalSmallDialogInputBindGridCount","attachDialogInput","detachDialogInput","SmallDialogInputEditor","_helperText","_inputValidator","_validator","ACTIONS","CHECK","RADIO","INPUT","SWITCH","BaseCheckColumn","_draw","utils.customDraw","animElapsedTime","doDrawInternal","defaultBranchGraphStyle","DEFAULT_BRANCH_COLORS","_name","BranchGraphStyle","_branchColors","branchColors","_circleSize","circleSize","_branchLineWidth","branchLineWidth","_mergeStyle","mergeStyle","BranchLine","fromIndex","toIndex","colorIndex","BranchPoint","commit","lines","tag","l","fromLines","toLines","mergeLines","BRANCH_GRAPH_COLUMN_STATE_ID","joinLine","timeline","branchIndex","reverse","j","calcCommand","command","timelineData","cmd","from","branch","to","branches","fromTargetIndex","fromTL","findBranchRootIndex","branchTargetFromIndex","branchPoint","targetLine","merge","froms","fromTargetLine","pop","commitMerge","commitTag","calcBranchesInfo","dataSource","allData","getField","dataIndex","getAllColumnData","BranchGraphColumn","_start","_cache","cache","Map","has","set","_value","upLineIndexKey","downLineIndexKey","radius","branchXPoints","w","tl","textWidth","measureText","calcBranchXPoints","line","downLineIndex","pointIndex","upLineIndex","reduce","sort","strokeStyle","lineWidth","lineCap","beginPath","upX","upRect","getCellRelativeRect","upY","moveTo","bezierCurveTo","lineTo","downX","downRect","downY","stroke","renderMerge","fillStyle","arc","PI","fill","closePath","fillText","Column","_cellStyle","columnUtils.reviseAttachCellsArea","columnUtils.reviseAttachCellsPadding","columnUtils.customDraw","columnUtils.getActionTextPadding","columnUtils.drawActionButton","columnUtils.drawAttachArea","ButtonColumn","_caption","_linkButton","linkButton","utils.loadIcons","getTextRect","theme","shadow","blur","offsetY","CheckColumn","checkbox","SwitchColumn","switch","defaultDateTimeFormat","DateColumn","_format","format","defaultFormat","Intl","DateTimeFormat","fmt","DrawColumn","utils.drawActionButton","IconColumn","_tagName","_className","_content","_iconWidth","iconWidth","repeatArray","fontSizeCache","getFontSize","fontName","bk","em","calcStartPosition","LRUCache","cacheSize","_list","_map","_cacheSize","idx","shift","allCache","getCacheOrLoad0","src","error","img","Image","onload","onerror","url","loadImage","put","getCacheOrLoad","cacheName","ImageColumn","copy","utils.getActionTextPadding","size","maxWidth","newWidth","newHeight","calcKeepAspectRatioSize","pos","drawImage","lookupColumnPromiseDrawingCol","LookupColumn","_mergeRecords","_convertInternalValue","v","_lookupMap","recs","MultilineTextColumn","multiline","multilineText","NumberColumn","NumberFormat","PercentCompleteBarColumn","_min","_max","_formatter","formatter","sValue","rate","barMaxWidth","MARGIN","barTop","barLeft","barSize","createArrayPromise","plist","all","setArrayField","compare","old","createArray","r1","r2","isFieldAssessor","DATA_SOURCE_EVENT_TYPE","REFRESH_DATA","UPDATED_LENGTH","UPDATED_ORDER","UPDATE_LENGTH","getValue","setPromiseBack","maybePromiseValue","promiseValue","fieldGet","ss","setField","fieldSet","_getIndex","sortedIndexMap","mapIndex","DataSource","_get","_length","_source","getOriginal","_sortedIndexMap","getOriginalField","hasOriginalField","setOriginalField","order","orderFn","v1","v2","dummyPromise","catch","sort\n            .sortPromise","rel","setLength","refreshInternal","recordPromiseCallBackInternal","fieldPromiseCallBackInternal","_index","_field","results","_initLevel","ds","level","keyField","_levelMap","_pIdMap","child","_initLast","_lastMap","_expandAll","_expandMap","_getExpandRecords","_getCollapseRecordCount","_expand","silent","_collapseAll","_parentKey","_idMap","parentKeyField","_rebuildTree","_rootRecords","parentKey","_lazyLoadRecords","expandedKeys","hasNewRecords","pKey","_lazyLoadChildren","hasChildren","getChildren","TreeDataSource","_dataSource","expanded","isLeaf","isLast","levelLast","unshift","_updateLengthSilentCounter","ds1","record1","all1","silent1","ds2","record2","all2","silent2","parentKeys","expand","getIndexByKey","targets","expandToKey","_getTreeInfo","treeInfo","recordIndex","getTreeInfo","_getTreeNodeSpaceWidth","TREE_NODE_SPACE","_isTreeNodeSpace","treeNodeSpaceWidth","TreeColumn","_canToggle","canToggle","_toggled","toggled","_multilineText","isMultilineText","tree","treeNodeSpace","toggle","doMouseMove","doMouseLeave","params","selectCellRange","RadioColumn","radioButton","TYPES","NUMBER","BUTTON","IMAGE","MULTILINETEXT","DATE","LOOKUP","TREE","DRAW","columns","ColumnAction","ButtonAction","columnAction","toUpperCase","ColumnStyle","styleOf","TYPE_PUNCTURE","createError","calc","PRECEDENCE","*","/","+","-","lex","tokens","buildBinaryExpNode","stack","op","token","deep","closeIndex","beforeOp","unit","calcStr","exp","reUnit","reNum","reOp","tokenize","calcNode","full","toPxInternal","toPx","ratio","setRatio","devicePixelRatio","canvas","wh","scale","save","restore","NumberMap","_keys","_vals","_sorted","keyFrom","keyTo","ary","elm","low","high","indexFirst","MAX_SCROLL","Scrollbar","_scrollable","_perfectScrollbar","minScrollbarLength","_p","_endPointElement","_update","relativeTop","scrollWidth","scrollLeft","domHeight","sbSize","vScrollRange","rScrollRange","domWidth","update","Scrollable","_canvas","maxScrollTop","maxScrollLeft","BaseMouseDownMover","_events","_started","_moved","_mouseEndPoint","moving","last","pt","_getMouseAbstractPoint","events","touchmove","_mouseMove","passive","touchend","_mouseUp","touchcancel","mousemove","mouseup","_moveInternal","_upInternal","vibrate","CellSelector","_getTargetCell","_forceFocusCell","_moveFocusCell","_bindMoveAndUp","_vibrate","oldCol","oldRow","newCol","newRow","makeVisibleCol","colCount","makeVisibleRow","makeVisibleCell","abstractPos","getCellAt","ColumnResizer","_targetCol","_x","_preX","_invalidateAbsoluteLeft","pageX","_resetColWidthOffset","moveX","pre","getColWidth","afterSize","_adjustColWidth","_storeAutoColWidthExprs","setColWidth","_getVisibleRect","_invalidateRect","updateScroll","invalidate","createCellRange","startCol","startRow","endCol","endRow","DrawCellContext","drawRect","drawing","drawLayers","_mode","_range","_ctx","_drawRect","_drawing","_selection","_drawLayers","_childContexts","_cancel","border","drag","inDrag","_getInitContext","rectFilter","_rectFilter","_getRectInternal","_isOutOfRange","absoluteRect","_toRelativeDrawRect","_toRelativeRect","addDraw","onTerminate","_onTerminate","visibleRect","intersection","isFrozenCell","frozenColCount","fRect","DrawLayer","_level","DrawLayers","_layers","_setSafeInputValue","FocusControl","scrollable","lastInputValue","_isComposition","_compositionEnd","clearTimeout","inputClear","handleCompositionEnd","stopCellMove","evt","fireKeyDownMove","deleteCellValueOnDel","dummyInput","pasteText","clipboardData","getData","types","cData","setData","_keyDownMoveCallback","selectAllOnCtrlA","calcTop","editMode","composition","attrs","attributes","removeNames","att","_inputStatus","removeName","removeAttribute","inputStatus","atts","Selection","updateRange","_sel","_end","_updateRange","_wrapFireSelectedEvent","_setSelectCell","_setFocusCell","_updatedSelection","dragging","_drag","inOldRange","inRange","inNewRange","oldStartCol","oldStartRow","oldEndCol","oldEndRow","newStartCol","newStartRow","newEndCol","newEndRow","invalidateGridRect","points","needChange","keepSelect","singleSelection","_isWraped","backup","_forceUpdateRange","SelectionResizer","cellAndRange","_getTargetCellAndRange","_oldRange","startDrag","_newRange","newRange","newCell","dragDone","oldRange","stopDrag","startRect","endRect","ab","ad","parsePasteRangeBoxValues","offsetCol","_getTargetRowAt","absoluteY","internal","getTargetRowAtInternal","findBefore","startBottom","_getRowHeight","findAfter","candRow","defaultRowHeight","candBottom","_getRowsHeight","_getTargetColAt","absoluteX","_getColWidth","_getTargetFrozenRowAt","scroll","_getTargetFrozenColAt","_getFrozenRowsRect","_getFrozenColsRect","_getCellDrawing","drawCells","_putCellDrawing","_removeCellDrawing","_drawCell","absoluteLeft","absoluteTop","skipAbsoluteTop","skipAbsoluteLeft","cellDrawing","dcContext","pCol","_delayMode","terminate","_drawRow","initFrozenCol","initCol","drawRight","drawOuter","outerLeft","underlayBackgroundColor","clearRect","colAbsoluteLeft","_isPreciseColWidth","_toPxWidth","calcWidthContext","_getColPreciseWidth","orgWidth","_applyColWidthLimits","limits","_getColWidthDefine","colWidthsMap","defaultColWidth","_getColWidthLimits","limit","colWidthsLimit","minDef","maxDef","isAutoDefine","_calcAutoColWidthExpr","others","autoCount","hasLimitsOnAuto","def","expr","autoPx","_colWidthDefineToPxWidth","_setColWidth","getRowHeightInternal","rowHeightsMap","getRowsHeightInternal","_setRowHeight","_getUnderlayWidth","bodyWidth","underlayColCount","underlayColWidth","_getScrollWidth","_getColsWidth","_getUnderlayHeight","bodyHeight","getRowHeight","underlayRowCount","underlayRowHeight","_getScrollHeight","getScrollHeightInternal","underlayHeight","_onScroll","lastLeft","lastTop","moveY","redrawRect","frozenRect","_onTabKeyDown","focusCell","getMoveLeftColByKeyDownInternal","getMoveRightColByKeyDownInternal","_onEnterKeyDown","getMoveUpRowByKeyDownInternal","getMoveDownRowByKeyDownInternal","_onKeyDownMove","move","hmove","vmove","selectAllOptions","shiftCtrlA","excludeFrozenCol","excludeFrozenRow","ctrlA","vDir","hDir","shiftKeyFlg","_bindEvents","getCellEventArgsSet","eventArgs","canResizeColumn","canResize","disableColumnResize","disableResize","eventArgsSet","_getResizeSelectionAt","selectionResizer","resizeCol","_getResizeColAt","columnResizer","cellSelector","hasListeners","doubleTapBefore","longTouchId","defaultPrevented","isMouseover","mouseEnterCell","mouseOverCell","onMouseenterCell","related","onMouseleaveCell","beforeMouseCell","onMouseoverCell","onMouseoutCell","scrollElement","enterCell","outCell","leaveCell","elementStyle","lastMoving","eventPhase","Event","AT_TARGET","focusControl","onKeyDown","onScroll","getCopyValue","copyValue","copyRange","getCopyRangeInternal","copyCellValue","getCopyCellValue","strCellValue","onCopy","onCut","onPaste","rangeBoxValues","pasteCellEvent","onInput","onDelete","onFocus","focusedGrid","invalidateCell","onBlur","abstractX","abstractY","cellRect","canDragSelection","_getScrollableVisibleRect","frozenColsWidth","frozenRowsHeight","DrawGrid","highlightBorderWidth","borderMode","borderWidth","protectedSpace","createRootElement","hiDPI","transform","alpha","updateSelectionRange","disableColResize","colWidthsOffset","cellTextOverflows","cellTypeOverflows","updateSize","bindEventsInternal","_updateGridRange","setFocusCursor","getDefaultRowHeight","getDefaultColWidth","getHighlightBorderWidth","getDefaultFont","getDefaultUnderlayBackgroundColor","getDefaultBorderColor","getDefaultBorderWidth","getDefaultBorderMode","canStart","cfg","config","parent","setFocusRect","getFocusRectInternal","total","round","_initColWidthsOffset","setScrollSize","isFrozenStartCell","isFrozenEndCell","getCellsRect","isFrozenRow","isFrozenCol","frozen","getColAt","getRowAt","oldEditMode","resetInputStatus","selCol","selRow","storeInputStatus","setDefaultInputStatus","getOffsetInvalidateCells","cellsRect","invalidateTarget","visibleRowCount","visibleTop","initRow","visibleColCount","visibleLeft","topRow","leftCol","overflowText","getCellOverflowTextInternal","overflowType","getCellOverflowTypeInternal","disposable","disposables","getAttachCellsAreaInternal","getAttachCellsPaddingInternal","clientX","scrollX","clientY","pageY","scrollY","defaultColPxWidth","adj","silence","extendRange","beforeRange","beforeRect","afterRange","afterRect","invalidateRect","drawBottom","initFrozenRow","drawGridBorder","isContent","outerTop","rowAbsoluteTop","offsetParent","_absoluteY","_startRow","_endRow","core","CachedDataSource","_rCache","_fCache","rowCache","fCache","_setFieldCache","DataSourceIterator","_curIndex","_data","_getIndexData","nest","FilterData","dc","original","_owner","_dataSourceItr","_filteredList","_queues","filteredList","queues","indexQueue","_findIndex","timeout","_findIndexWithTimeout","testTimeout","dataSourceItr","hasNext","movePrev","queue","FilterDataSource","_filterData","aggregateType","_getPivotRecordKey","pivots","distinctKeys","PivotDataSource","refresh","_keysMap","rowPivots","colPivots","begin","rowKey","colKey","_distinctMap","log","inMouse","isHeaderDisabledCell","BaseCheckAction","checked","getHeaderValue","setHeaderValue","CHECK_HEADER_STATE_ID","CheckHeaderAction","SWITCH_HEADER_STATE_ID","SwitchHeaderAction","SortHeaderAction","_sort","newState","fieldRow","sortState","_executeSort","ImmutableSortHeaderAction","SORT","headerAction","HEADER_BASE_STYLE_EVENT_TYPE","defaultHeaderBaseStyle","defaultHeaderBaseStdStyle","defaultHeaderStyle","defaultHeaderBaseCheckStyle","defaultCheckHeaderStyle","defaultSortHeaderStyle","defaultSwitchHeaderStyle","CheckHeaderStyle","SortHeaderStyle","_sortArrowColor","sortArrowColor","SwitchHeaderStyle","MultilineTextHeaderStyle","headerStyle","headerValues","BaseHeader","BaseCheckHeader","inlineCheck","getInlineCheck","CheckHeader","buildCheckBoxInline","Header","getHeaderIcon","multiLines","headerUtils","SortHeader","arrowSize","multilines","getColor","header","SwitchHeader","buildSwitchBtnInline","MultilineTextHeader","headerType","headers","headerActionOf","ofCell","headerCell","sortMethod","headerStyleOf","headerTypeOf","themes","cacheLinearGradient","defaultBgColor","frozenRowsBgColor","colorStops","stopsKey","stop","grad","createLinearGradient","addColorStop","getLinearGradient","0","1","highlightBorderColor","selectionBgColor","selectionDragBgColor","frozenRowsBorderColor","frozenRowsColor","getProp","superObj","defNames","Theme","superTheme","frozenRowsFont","focusBgColor","highlightBgColor","hasProperty","gridBorderColor","gridBorderWidth","_checkbox","_radioButton","_button","_header","_switch","_tree","hasThemeProperty","BASIC","basicTheme","MATERIAL_DESIGN","materialDesignTheme","builtin","defTheme","u","getIgnoreCase","getChoices","plugins","getDefault","setDefault","defaultTheme","rgbMap","hexToNum","hex","createRGB","g","testRGB","rateToByte","colorToRGB0","2","3","tripleHexToRGB","g1","4","g2","5","b1","6","b2","sextupleHexToRGB","rgb","colorToRGB","dummy","styleColor","styleColorToRGB","calcElapsedColor","startColor","endColor","elapsedTime","startColorRGB","endColorRGB","getRGB","colorName","diff","roundRect","fillRoundRect","strokeRoundRect","fillCircle","strokeCircle","measureCheckbox","measureRadioButton","canvasHelper","drawButton","backgroundColor","offsetX","ox","oy","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","drawCheckbox","check","boxSize","checkPoint","leftX","topY","leftWidth","rightWidth","leftLeftPos","leftTopPos","drawInlineImageRect","image","srcLeft","srcTop","srcWidth","srcHeight","destWidth","destHeight","clip","drawRadioButton","checkSize","drawSwitchButton","btnSize","fontSize","textMargin","backgroundFillStyle","trueFillStyle","falseFillStyle","bX","bY","bW","bH","sW","sH","sX","sY","drawSwitchBtn","cW","cH","offsetScale","fillTextRect","calcBasePosition","strokeColorsRect","borderColors","strokeRect","positions","preColor","pos1","pos2","pColor","strokeRectLines","tools","seqId","EmptyDataCache","rows","define","SimpleHeaderLayoutMap","_columns","_headerCellIds","_headerObjects","_addHeaders","_headerObjectMap","_setupHeaderSpan","columnWidths","headerRowCount","headerObjects","columnObjects","getCellId","_emptyDataCache","getHeader","getBody","roots","rowCells","_newRow","hd","headerField","headerIcon","tooltip","headerTooltip","tooltipType","headerTooltipType","colDef","prev","processed","cols","headerRowSpan","headerColSpan","rowSpan","colSpan","LayoutObjectGrid","layout","rowLayout","objects","objectMap","_findStartCell","rowIndex","objectGridRow","_getObjectGridRow","colIndex","_setWidthDataIfAbsent","_useColumnIndex","objectGrid","columnCount","MultiLayoutMap","hbLayout","normalizeLayout","_body","_columnCount","widthDef","_columnWidths","bodyRowCount","bodyLayoutRow","_getCellRange","bodyRow","layoutRow","LayoutMap","layoutMap","_layoutMap","hiddenHeader","getBodyLayoutRangeById","LG_EVENT_TYPE","CHANGED_HEADER_VALUE","CHANGED_VALUE","CELL_RANGE","CELL_VALUE","BaseMessage","detachMessageElement","_messageElement","_getMessageElement","drawCellMessageInternal","createMessageElementInternal","CLASSNAME_ME","MESSAGE_CLASSNAME_ME","HIDDEN_CLASSNAME_ME","SHOWN_CLASSNAME_ME","MessageElement","rootElement","_rootElement","messageElement","createMessageDomElement","_attachCell","_detach","CLASSNAME_EME","MESSAGE_CLASSNAME_EME","ErrorMessageElement","drawExclamationMarkBox","boxRect","fillRect","fillColor","fillRectWithState","ErrorMessage","hasFocusGrid","drawBorderWithClip","InfoMessage","_message","drawInformationMarkBox","CLASSNAME_WME","MESSAGE_CLASSNAME_WME","WarningMessageElement","WarningMessage","EMPTY_MESSAGE","MESSAGE_INSTANCE_FACTORY","warning","normalizeMessage","hasMessage","MessageHandler","_messageInstances","_bindGridEvent","messageInstances","_getMessageInstanceOfMessage","_attachInfo","instance","attachMessageElement","moveMessageElement","onSelectMessage","_attach","_move","parser","DOMParser","findElement","Svg","svgCode","parseFromString","_svg","documentElement","_glyphs","_glyphUnis","svg","fontFaceElement","_fontFace","fontElement","glyphName","unicode","walkGlyph","elementToPaths","getD","circle","cx","cy","ANGLE","anchorX","theta","cos","anchorY","sin","controlX","tan","controlY","paths","circleToPath","buildObject","isGlyph","ud","svgToIcon","fontFace","qualifiedName","glyph","findGlyph","findGlyphByUnicode","fontHorizAdvX","fontVertAdvX","horizAdvX","vertAdvX","unitsPerEm","contentSize","outerHTML","glyphToJSON","viewBox","svgToJSON","builtins","arrowDownward","arrowUpward","edit","star","starBorder","starHalf","svgIcons","mag","sqrt","angle","sign","acos","dot","ellipseFromEllipticalArc","rx","ry","phi","fA","fS","xPrime","cost","sint","rotClockwise","xPrime2","pointMul","rx2","ry2","lambda","factor","cPrime","sum","rotCounterClockwise","meanVec","x1UnitVector","x2UnitVector","translate","rotate","PathCommands","lMx","lMy","reflected","lx","ly","lastCommand","makeReflected","M","px","py","m","L","H","V","Z","z","C","cp1x","cp1y","cp2x","cp2y","S","cpx","cpy","Q","quadraticCurveTo","q","T","A","xAxisRotation","largeArcFlag","sweepFlag","builder","argsProvider","_commands","buildPush","_ops","arcTo","ellipse","numArgs","ops","pathTokens","subsequentCommand","fst","Path2DShim","CanvasRenderingContext2D","originalFill","getPath2D","Path2D","path2DManager","module","upsideDown","xRate","yRate","_Path2D","path2d","getWidth","breakWidth","itr","candidateIndex","chars","beforeWidth","charWidth","beforeContent","afterContent","Inline","_callback","offsetRight","offsetBottom","allWidth","candidate","InlineDrawer","_arg","FontRuler","testStr","display","white-space","font-variant","font-size","font-style","font-weight","line-height","computeStyle","_el","LastResortFonts","SERIF","SANS_SERIF","watchRunners","FontWatchRunner","activeCallbacks","inactiveCallbacks","status","lastResortWidths_","fontRulerA_","fontRulerB_","lastResortRulerA","lastResortRulerB","started_","check_","activeCallback","inactiveCallback","runner","widthA","widthB","isFallbackFont_","isLastResortFont_","finish_","widthMatches_","lastResortFont","HAS_WEBKIT_FALLBACK_BUG","match","hasWebKitFallbackBug","widthsMatchLastResortWidths_","callbacks","cb","loads","load","legacy","fonts","ready","InlineIcon","_icon","letterSpacing","InlineImage","imageLeft","imageTop","imageWidth","imageHeight","_src","_imageLeft","_imageTop","_imageWidth","_imageHeight","_onloaded","_loadImage","_inlineImg","_inlineImgPromise","InlinePath2D","_path","buildSvgDataUrl","XMLSerializer","serializeToString","encodeURIComponent","getSvgElement","doc","nodes","SVGElement","InlineSvg","svgElem","elmWidth","elmHeight","numElmWidth","numElmHeight","iconOf","isIconConstructorOption","isInlineImageConstructorOption","isInlineSvgConstructorOption","regedIcons","regedIcon","drawWidth","drawHeight","drawRegisteredIcon","buildInlines","inline","il","getThemeColor","gridThemeColor","defaultThemeColor","ThemeResolver","SWITCH_STYLE","default","INLINE_ELLIPSIS","inlineUtils.of","getFont","getGridThemeColor","getGridThemeFont","drawInlines","inlines","drawInline","canDraw","onReady","inlineWidths","inlineWidth","inlineUtils.buildInlines","inlineToString","inlineUtils.string","getOverflowInline","isAllowOverflow","getOverflowInlinesIndex","remWidth","isOverflowInlines","breakWidthInlines","indexData","afterInlines","beforeInlines","canBreak","breakWord","breakAll","splitIndex","truncateInlines","overflowInline","_inlineRect","truncInlines","_multiInlineRect","multiInlines","rectHeight","buildedMultiInlines","procLineClamp","tis","procLine","lineRow","pad","buildedInline","gridDrawCheckbox","positionOpt","boxWidth","getSwitchBtnSize","gridDrawSwitchBtn","GridCanvasHelper","_theme","calcWidth","calcHeight","calculator","createCalculator","box","clipLeft","clipWidth","clipTop","clipHeight","paddingNums","rectLeft","rectTop","rectRight","rectBottom","inlineHeight","selectionColor","getFillColorState","isEditing","getSelectionColorState","fillCell","startOffset","self","gridDrawRadioButton","xOffset","lineNodeSpace","nodeRadius","rectMiddle","isLastLevel","isLastRecord","symbolRadius","setLineDash","BaseTooltip","detachTooltipElement","_tooltipElement","_getTooltipElement","createTooltipElementInternal","CLASS_NAME","CONTENT_CLASS_NAME","HIDDEN_CLASS_NAME","SHOWN_CLASS_NAME","TooltipElement","createTooltipDomElement","createTooltipMessageElement","doSetContent","cls","rootTop","rootLeft","rootHeight","rootWidth","bTop","lLeft","rLeft","Tooltip","HtmlTooltipElement","HtmlTooltip","TOOLTIP_INSTANCE_FACTORY","overflow-html","overflow-text","TooltipHandler","_tooltipInstances","tooltipInstances","instanceInfo","_getTooltipInstanceInfo","attachTooltipElement","moveTooltipElement","_isAttachCell","getCellOverflowType","getTooltipInstanceInfo","_arrayEqual","_getCellValues","_getCellValue","bodyCellRange","spanBodyOptions","_getBodyCellRange","_getField","_getCellMessage","column","_getHeaderField","_getCellIcon1","retIcon","iconOpt","_hasHeaderField","_getCellIcon0","_getRecordIndexByRow","hasField","_hasField","_onDrawValue","gridCanvasHelper","drawCellBg","fillOpt","fillCellWithState","drawCellBorder","borderSelection","_getCellIcon","clearCell","_getHeaderIcon","_getContentHidden","_refreshHeader","headerEvents","HeaderBaseStyle","setMinColWidth","setMaxColWidth","setColDisableResize","headerRowHeight","setRowHeight","_refreshRowCount","_tryWithUpdateDataSource","dataSourceEventIds","fireSelectedEvent","_setRecords","newDataSource","ofArray","_setDataSource","EMPTY","_onRangePaste","pasteRowCount","pasteColCount","hasEditable","actionColumnsBox","actionColumnsRow","duplicate","actionRow","valuesRow","valuesCol","getCellValue","oldValue","onPasteCellRangeBox","newEnd","_onRangeDelete","deleteRowCount","deleteColCount","_oldValue","onDeleteCellRangeBox","registerPlugin","register","themePlugins","iconPlugins","registerPlugins","_kakaGrid","version","_core","_tools","ListGrid","omits","omit","tooltipHandler","allowRangePaste","monitorResize","resize","oldState","oldField","getHeaderField","newField","getCellRangeByField","colObj","layoutRange","newFocus","convertCopyValue","setRectFilter","_updateRect","valueCallback","changeValueCallback","_setCellValue","newValue","beforeStartCol","beforeStartRow","beforeEndCol","beforeEndRow","reviseFocusRect","_headers","_themes","_GridCanvasHelper","_register","kakaGrid"],"mappings":"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"}